<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>2023 å¹´åº¦æ€»ç»“</title>
    <url>/2023/12/29/2023%20%E5%B9%B4%E5%BA%A6%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<p>7ç‚¹10åˆ†ï¼Œä»å…¬å¸èµ°å‡ºå»ï¼Œ2023æœ€åä¸€ä¸ªå·¥ä½œæ—¥å·²ç»ç»“æŸäº†ï¼Œå¾ˆå¿«åˆä¸€å¹´è¿‡å»äº†ï¼Œå°è¯•å†™ä¸€ä¸‹ä¸€å¹´çš„ç›˜ç‚¹ï¼Œç•™ä¸‹ç‚¹è®°å¿†ã€‚</p>
<span id="more"></span>

<h1 id="å…³äºæˆ‘è‡ªå·±"><a href="#å…³äºæˆ‘è‡ªå·±" class="headerlink" title="å…³äºæˆ‘è‡ªå·±"></a>å…³äºæˆ‘è‡ªå·±</h1><p>æˆ¿å­ç»ˆäºäº¤æˆ¿äº†ï¼Œç¬¬ä¸€æ¬¡æ¬è¿›äº†å±äºè‡ªå·±çš„å®¶ï¼Œè£…ä¿®çš„ä¸æ˜¯å¾ˆå¥½ï¼Œä½ç½®ä¹Ÿä¸æ˜¯å¾ˆå¥½ï¼Œä½†æ˜¯è¿™æ˜¯æˆ‘çš„ç¬¬ä¸€ä¸ªå®¶ï¼Œæˆ‘å¾ˆæ»¡è¶³äº†ã€‚ä»¥åä¼šè¶Šæ¥è¶Šå¥½çš„ã€‚<br>è·Ÿå¥³ç¥¨è¦è®¢å©šäº†ï¼Œæ˜å¹´ä¼šç»“å©šï¼ŒåŒå–œä¸´é—¨å§ï¼Œ2024å¹´å‡†å¤‡ç»“å©šã€‚</p>
<hr>
<p>å†ç»ˆç”Ÿå­¦ä¹ è¿™ä»¶äº‹æƒ…ä¸Šé¢ï¼Œæˆ‘è¿˜æ˜¯æ²¡æ‰¾åˆ°ä»€ä¹ˆç‰¹åˆ«é€‚åˆæˆ‘çš„æ–¹å¼ï¼Œä¸€ç›´å°è¯•åœ¨åŠªåŠ›ï¼Œå¥½åƒæ”¶è·ä¹Ÿä¸æ˜¯ç‰¹åˆ«å¤§ï¼Œä¸çŸ¥é“æ˜å¹´æˆ‘èƒ½ä¸èƒ½æ‰¾åˆ°ç­”æ¡ˆã€‚<br>2023å¹´çœ‹åˆ°ä¹¦ä¹Ÿæ¯”2022å¹´å°‘äº†å¾ˆå¤šï¼Œæ¯”ä»¥å‰æ›´å¿™äº†æ˜¯ä¸€ä¸ªç†ç”±ï¼Œä½†æ˜¯æˆ‘å¥½åƒå¤„ç†ä¸äº†å¾ˆå¤æ‚çš„äº‹åŠ¡ï¼Œä»Šå¹´å¥½å‡ æ¬¡è¢«æåˆ°æœ‰ç‚¹å´©æºƒäº†ã€‚</p>
<h1 id="å·¥ä½œæ–¹é¢"><a href="#å·¥ä½œæ–¹é¢" class="headerlink" title="å·¥ä½œæ–¹é¢"></a>å·¥ä½œæ–¹é¢</h1><p>åŸåœ°è¸æ­¥ï¼Œå¯ä»¥é¢„æ–™åˆ°ç»©æ•ˆæ¯”å»å¹´è¿˜å·®ã€‚å åŠ å¤§ç¯å¢ƒä¸å¥½ï¼Œå…¬å¸ä¸€ç›´åœ¨è£å‘˜ï¼Œä¸€æ½­æ­»æ°´ï¼Œè‡ªå·±çš„æŠ€æœ¯ä¹ŸåŸåœ°è¸æ­¥ï¼Œæ‹…å¿ƒ35å²å±æœºï¼Œå¦‚æœè¢«è£å‘˜ï¼Œé•¿æ²™å¤§æ¦‚ç‡å¾…ä¸ä¸‹å»äº†ï¼Œæ‰¾ä¸åˆ°å·¥ä½œã€‚</p>
<h1 id="Luck-in-2024"><a href="#Luck-in-2024" class="headerlink" title="Luck in 2024"></a>Luck in 2024</h1><ol>
<li>ç»§ç»­é˜…è¯»ï¼Œé˜…è¯»æ‰èƒ½è¿›æ­¥ã€‚</li>
<li>å­¦ä¼šè¿‡é¸¡è´¼å’ŒæŠ é—¨çš„æ—¥å­ã€‚</li>
<li>æŠŠè‹±è¯­ç”¨èµ·æ¥ </li>
<li>å­¦ä¼šNodeJS</li>
</ol>
]]></content>
      <categories>
        <category>blog</category>
      </categories>
      <tags>
        <tag>å¹´åº¦æ€»ç»“</tag>
      </tags>
  </entry>
  <entry>
    <title>Go - Ordering in Select Statements</title>
    <url>/2020/04/29/Go%20-%20Ordering%20in%20Select%20Statements/</url>
    <content><![CDATA[<p> <a href="https://medium.com/a-journey-with-go/go-ordering-in-select-statements-fd0ff80fd8d6">åŸæ–‡é“¾æ¥</a></p>
<p><a href="https://medium.com/@blanchon.vincent?source=post_page-----fd0ff80fd8d6----------------------">Vincent Blanchon</a></p>
<hr>
<p><img src="https://blog-image-1253555052.cos.ap-guangzhou.myqcloud.com/20200429220520.png"></p>
<blockquote>
<p>æœ¬æ–‡åŸºäº go 1.14 </p>
</blockquote>
<p><code>select</code> å…è®¸åœ¨ä¸€ä¸ªgoroutineä¸­ç®¡ç†å¤šä¸ªchannelã€‚ä½†æ˜¯ï¼Œå½“æ‰€æœ‰channelåŒæ—¶å°±ç»ªçš„æ—¶å€™ï¼Œgoéœ€è¦åœ¨å…¶ä¸­é€‰æ‹©ä¸€ä¸ªæ‰§è¡Œã€‚goè¿˜éœ€è¦å¤„ç†æ²¡æœ‰channelå°±ç»ªçš„æƒ…å†µï¼Œæˆ‘ä»¬å…ˆä»å°±ç»ªçš„channelå¼€å§‹ã€‚</p>
<h1 id="Order"><a href="#Order" class="headerlink" title="Order"></a>Order</h1><p><code>select</code> ä¸ä¼šæŒ‰ç…§ä»»ä½•è§„åˆ™æˆ–è€…ä¼˜å…ˆçº§é€‰æ‹©åˆ°è¾¾çš„channelã€‚goæ ‡å‡†åº“åœ¨æ¯æ¬¡è®¿é—®çš„æ—¶å€™ï¼Œéƒ½ä¼šå°†ä»–ä»¬é¡ºåºæ‰“ä¹±ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸èƒ½ä¿è¯ä»»ä½•é¡ºåºã€‚</p>
<p>çœ‹ä¸€ä¸ªæœ‰ä¸‰ä¸ªå°±ç»ªçš„channelçš„ä¾‹å­ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	a := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">bool</span>, <span class="number">100</span>)</span><br><span class="line">	b := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">bool</span>, <span class="number">100</span>)</span><br><span class="line">	c := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">bool</span>, <span class="number">100</span>)</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">		a &lt;- <span class="literal">true</span></span><br><span class="line">		b &lt;- <span class="literal">true</span></span><br><span class="line">		c &lt;- <span class="literal">true</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">		<span class="keyword">select</span> &#123;</span><br><span class="line">		<span class="keyword">case</span> &lt;-a:</span><br><span class="line">			<span class="built_in">print</span>(<span class="string">&quot;&lt; a&quot;</span>)</span><br><span class="line"></span><br><span class="line">		<span class="keyword">case</span> &lt;-b:</span><br><span class="line">			<span class="built_in">print</span>(<span class="string">&quot;&lt; b&quot;</span>)</span><br><span class="line"></span><br><span class="line">		<span class="keyword">case</span> &lt;-c:</span><br><span class="line">			<span class="built_in">print</span>(<span class="string">&quot;&lt; c&quot;</span>)</span><br><span class="line"></span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			<span class="built_in">print</span>(<span class="string">&quot;&lt; default&quot;</span>)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸‰ä¸ªchanneléƒ½æœ‰ä¸‰ä¸ªå®Œæ•´çš„bufferï¼ˆä¸ä¼šé˜»å¡ï¼‰ï¼Œä¸‹é¢æ˜¯ç¨‹åºçš„è¾“å‡º</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">&lt; b&lt; a&lt; a&lt; b&lt; c&lt; c&lt; c&lt; a&lt; b&lt; b</span><br></pre></td></tr></table></figure>

<p>åœ¨ select çš„æ¯æ¬¡è¿­ä»£ä¸­ï¼Œcase éƒ½ä¼šè¢«æ‰“ä¹±ï¼š</p>
<p><img src="https://blog-image-1253555052.cos.ap-guangzhou.myqcloud.com/20200429223415.png"></p>
<p>ç”±äºgo ä¸ä¼šåˆ é™¤é‡å¤çš„channelï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨å¤šæ¬¡æ·»åŠ caseæ¥å½±å“ç»“æœï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   a := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">bool</span>, <span class="number">100</span>)</span><br><span class="line">   b := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">bool</span>, <span class="number">100</span>)</span><br><span class="line">   c := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">bool</span>, <span class="number">100</span>)</span><br><span class="line">   <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">      a &lt;- <span class="literal">true</span></span><br><span class="line">      b &lt;- <span class="literal">true</span></span><br><span class="line">      c &lt;- <span class="literal">true</span></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">      <span class="keyword">select</span> &#123;</span><br><span class="line">      <span class="keyword">case</span> &lt;-a:</span><br><span class="line">         <span class="built_in">print</span>(<span class="string">&quot;&lt; a&quot;</span>)</span><br><span class="line">      <span class="keyword">case</span> &lt;-a:</span><br><span class="line">         <span class="built_in">print</span>(<span class="string">&quot;&lt; a&quot;</span>)</span><br><span class="line">      <span class="keyword">case</span> &lt;-a:</span><br><span class="line">         <span class="built_in">print</span>(<span class="string">&quot;&lt; a&quot;</span>)</span><br><span class="line">      <span class="keyword">case</span> &lt;-a:</span><br><span class="line">         <span class="built_in">print</span>(<span class="string">&quot;&lt; a&quot;</span>)</span><br><span class="line">      <span class="keyword">case</span> &lt;-a:</span><br><span class="line">         <span class="built_in">print</span>(<span class="string">&quot;&lt; a&quot;</span>)</span><br><span class="line">      <span class="keyword">case</span> &lt;-a:</span><br><span class="line">         <span class="built_in">print</span>(<span class="string">&quot;&lt; a&quot;</span>)</span><br><span class="line">      <span class="keyword">case</span> &lt;-a:</span><br><span class="line">         <span class="built_in">print</span>(<span class="string">&quot;&lt; a&quot;</span>)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">case</span> &lt;-b:</span><br><span class="line">         <span class="built_in">print</span>(<span class="string">&quot;&lt; b&quot;</span>)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">case</span> &lt;-c:</span><br><span class="line">         <span class="built_in">print</span>(<span class="string">&quot;&lt; c&quot;</span>)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">         <span class="built_in">print</span>(<span class="string">&quot;&lt; default&quot;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºçš„ç»“æœï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">&lt; c&lt; a&lt; b&lt; a&lt; b&lt; a&lt; a&lt; c&lt; a&lt; a</span><br></pre></td></tr></table></figure>

<p>å½“æ‰€æœ‰channelåŒæ—¶å‡†å¤‡å°±ç»ªæ—¶ï¼Œæœ‰80ï¼…çš„æœºä¼šé€‰æ‹©é€šé“aã€‚ä¸‹é¢æ¥çœ‹ä¸€ä¸‹channelæœªå°±ç»ªçš„æƒ…å†µã€‚</p>
<h1 id="Non-ready-channels"><a href="#Non-ready-channels" class="headerlink" title="Non-ready channels"></a>Non-ready channels</h1><p><code>select</code> è¿è¡Œæ—¶ï¼Œå¦‚æœæ²¡æœ‰ä¸€ä¸ªcase channelå°±ç»ªï¼Œé‚£ä¹ˆä»–å°±ä¼šè¿è¡Œ<code>default:</code>,å¦‚æœ <code>select</code>ä¸­æ²¡æœ‰å†™defaultï¼Œé‚£ä¹ˆä»–å°±è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œå¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   a := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">bool</span>, <span class="number">100</span>)</span><br><span class="line">   b := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">bool</span>, <span class="number">100</span>)</span><br><span class="line">   <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">      time.Sleep(time.Minute)</span><br><span class="line">      <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">         a &lt;- <span class="literal">true</span></span><br><span class="line">         b &lt;- <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">   &#125;()</span><br><span class="line"></span><br><span class="line">   <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">      <span class="keyword">select</span> &#123;</span><br><span class="line">      <span class="keyword">case</span> &lt;-a:</span><br><span class="line">         <span class="built_in">print</span>(<span class="string">&quot;&lt; a&quot;</span>)</span><br><span class="line">      <span class="keyword">case</span> &lt;-b:</span><br><span class="line">         <span class="built_in">print</span>(<span class="string">&quot;&lt; b&quot;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢é‚£ä¸ªä¾‹å­ä¸­ï¼Œå°†åœ¨ä¸€åˆ†é’Ÿåæ‰“å°ç»“æœã€‚<code>select</code>é˜»å¡åœ¨ channelä¸Šã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå¤„ç†<code>select</code>çš„å‡½æ•°å°†ä¼šè®¢é˜…æ‰€æœ‰channelå¹¶ä¸”ç­‰å¾…ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªgoroutine#7åœ¨selectä¸­ç­‰å¾…çš„ç¤ºä¾‹ï¼Œå…¶ä¸­å¦ä¸€ä¸ªgoroutine#4ä¹Ÿåœ¨ç­‰å¾…channelï¼š</p>
<p><img src="https://blog-image-1253555052.cos.ap-guangzhou.myqcloud.com/20200429225528.png"></p>
<p>Goroutine(G7)è®¢é˜…æ‰€æœ‰é¢‘é“å¹¶åœ¨åˆ—è¡¨æœ«å°¾ç­‰å¾…ã€‚ å¦‚æœchannelå‘é€äº†ä¸€æ¡æ¶ˆæ¯ï¼Œchannelå°†é€šçŸ¥å·²åœ¨ç­‰å¾…è¯¥æ¶ˆæ¯çš„å¦ä¸€ä¸ªGoroutineã€‚ä¸€æ—¦æ”¶åˆ°é€šçŸ¥ï¼Œ<code>select </code>å°†å–æ¶ˆè®¢é˜…æ‰€æœ‰channelï¼Œå¹¶ä¸”è¿”å›åˆ°ä»£ç è¿è¡Œ.</p>
<p>æ›´å¤šå…³äºchannelä¸ç­‰å¾…é˜Ÿåˆ—çš„ä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ä½œè€…å¦å¤–ä¸€ç¯‡æ–‡ç« <a href="https://medium.com/a-journey-with-go/go-buffered-and-unbuffered-channels-29a107c00268"><em>Go: Buffered and Unbuffered Channels</em></a><em>.</em></p>
<p>ä¸Šé¢ä»‹ç»çš„é€»è¾‘ï¼Œéƒ½æ˜¯é’ˆå¯¹äºæœ‰ä¸¤ä¸ªæˆ–è€…ä»¥ä¸Šçš„æ´»åŠ¨çš„channelï¼Œå®é™…ä¸Šå¦‚æœåªæœ‰ä¸€ä¸ªæ´»åŠ¨çš„channelï¼Œgoä¹æ„ç®€åŒ–select</p>
<h1 id="Simplification"><a href="#Simplification" class="headerlink" title="Simplification"></a>Simplification</h1><p>å¦‚æœåªæœ‰ä¸€ä¸ªcase åŠ ä¸Šä¸€ä¸ªdefaultï¼Œä¾‹å­ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   t:= time.NewTicker(time.Second)</span><br><span class="line">   <span class="keyword">for</span>   &#123;</span><br><span class="line">      <span class="keyword">select</span> &#123;</span><br><span class="line">      <span class="keyword">case</span> &lt;-t.C:</span><br><span class="line">         <span class="built_in">print</span>(<span class="string">&quot;1 second &quot;</span>)</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">         <span class="built_in">print</span>(<span class="string">&quot;default branch&quot;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ç§æƒ…å†µä¸‹ã€‚Goä¼šä»¥éé˜»å¡æ¨¡å¼è¯»å–channelçš„æ“ä½œæ›¿æ¢selectè¯­å¥ã€‚å¦‚æœchannelåœ¨ç¼“å†²åŒºä¸­æ²¡æœ‰ä»»ä½•å€¼ï¼Œæˆ–è€…å‘é€æ–¹å‡†å¤‡å‘é€æ¶ˆæ¯ï¼Œå°†ä¼šè¿è¡Œdefaultã€‚å°±åƒä¸‹é¢è¿™å¼ å›¾</p>
<p><img src="https://blog-image-1253555052.cos.ap-guangzhou.myqcloud.com/20200429231908.png"></p>
<p>å¦‚æœæ²¡æœ‰defaultï¼Œåˆ™ Go é€šè¿‡é˜»å¡channelæ“ä½œé‡å†™ select è¯­å¥ã€‚</p>
]]></content>
      <categories>
        <category>Go</category>
      </categories>
      <tags>
        <tag>go</tag>
        <tag>åº•å±‚</tag>
      </tags>
  </entry>
  <entry>
    <title>Go iota, ä¸æ˜¯æšä¸¾</title>
    <url>/2024/03/27/Go%20iota,%20%E4%B8%8D%E6%98%AF%E6%9E%9A%E4%B8%BE/</url>
    <content><![CDATA[<p>ä¸Šå‘¨å†hacker news ä¸Šæœ‰ä¸€ç¯‡è®¨è®ºgo enum çš„ æ–‡ç«  <a href="https://www.zarl.dev/articles/enums">Go Enums Suck</a>ï¼ˆå¾ˆå¼€å¿ƒè¿˜èƒ½å†hacker news  ä¸Šçœ‹åˆ°goç›¸å…³çš„ä¿¡æ¯ï¼‰ï¼Œæˆ‘ä¸æƒ³å¯¹è¿™ç¯‡æ–‡ç« å‘è¡¨ä»€ä¹ˆçœ‹æ³•ï¼Œä½œè€…è¯´çš„éƒ½æ˜¯æ­£ç¡®çš„ å¦‚æœæŠŠiota å½“æˆenumçœ‹ï¼Œè·Ÿå…¶ä»–è¯­è¨€ç›¸æ¯”è¾ƒï¼Œç¡®å®å¾ˆç³Ÿç³•ï¼Œæœ¬ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬è®¨è®ºä¸€ä¸‹iota çš„ç”¨æ³•ã€‚</p>
<span id="more"></span>
<h1 id="iota-åœ¨-Go-ä¸­çš„ä½¿ç”¨"><a href="#iota-åœ¨-Go-ä¸­çš„ä½¿ç”¨" class="headerlink" title="iota åœ¨ Go ä¸­çš„ä½¿ç”¨"></a>iota åœ¨ Go ä¸­çš„ä½¿ç”¨</h1><h1 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h1><p>Go è¯­è¨€å®é™…ä¸Šæ²¡æœ‰ç›´æ¥æ”¯æŒæšä¸¾çš„å…³é”®å­—ã€‚ä¸€èˆ¬æˆ‘ä»¬éƒ½æ˜¯é€šè¿‡ <code>const</code> + <code>iota</code> å®ç°æšä¸¾çš„èƒ½åŠ›ã€‚<br>æœ‰äººè¦é—®äº†ï¼Œä¸ºä»€ä¹ˆä¸€å®šè¦ä½¿ç”¨æšä¸¾å‘¢ï¼Ÿ<code>stackoverflow</code> ä¸Šæœ‰ä¸€ä¸ªé«˜èµçš„å›ç­”ï¼Œå¦‚ä¸‹:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">You should always use enums when a variable (especially a method parameter) can only take one out of a small set of possible values. Examples would be things like type constants (contract status: &quot;permanent&quot;, &quot;temp&quot;, &quot;apprentice&quot;), or flags (&quot;execute now&quot;, &quot;defer execution&quot;).</span><br><span class="line"></span><br><span class="line">If you use enums instead of integers (or String codes), you increase compile-time checking and avoid errors from passing in invalid constants, and you document which values are legal to use.</span><br><span class="line"></span><br><span class="line">BTW, overuse of enums might mean that your methods do too much (it&#x27;s often better to have several separate methods, rather than one method that takes several flags which modify what it does), but if you have to use flags or type codes, enums are the way to go.</span><br></pre></td></tr></table></figure>
<h1 id="å¦‚ä½•å®ç°æšä¸¾"><a href="#å¦‚ä½•å®ç°æšä¸¾" class="headerlink" title="å¦‚ä½•å®ç°æšä¸¾"></a>å¦‚ä½•å®ç°æšä¸¾</h1><p><code>iota</code> æ˜¯ Go ä¸­é¢„å£°æ˜çš„ä¸€ä¸ªç‰¹æ®Šå¸¸é‡ã€‚å®ƒä¼šè¢«é¢„å£°æ˜ä¸º0ï¼Œä½†æ˜¯å®ƒçš„å€¼åœ¨ç¼–è¯‘é˜¶æ®µå¹¶éæ˜¯å›ºå®šçš„ï¼Œå½“é¢„å£°æ˜çš„ <code>iota</code> å‡ºç°åœ¨ä¸€ä¸ªå¸¸é‡å£°æ˜ä¸­çš„æ—¶å€™ï¼Œå®ƒçš„å€¼åœ¨ç¬¬nä¸ªå¸¸é‡æè¿°ä¸­çš„å€¼ä¸ºn(ä»0å¼€å§‹)ã€‚æ‰€ä»¥å®ƒåªåœ¨åŒç±»å‹å¤šä¸ªå¸¸é‡å£°æ˜çš„æƒ…å†µä¸‹æ‰æ˜¾å¾—æœ‰æ„ä¹‰ã€‚</p>
<p>æ¯”å¦‚ï¼Œå¤§å®¶éƒ½äº†è§£çš„ç”µå•†ï¼Œè®¢å•ç³»ç»Ÿä¸€å®šä¼šæ¶‰åŠåˆ°è®¢å•çŠ¶æ€çš„æµè½¬ã€‚é‚£ä¹ˆè¿™æ—¶å€™ï¼Œæˆ‘ä»¬ä¸€èˆ¬å¯ä»¥è¿™æ ·åš:</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> OrderStatus <span class="type">int</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	Cancelled OrderStatus = <span class="literal">iota</span> <span class="comment">//è®¢å•å·²å–æ¶ˆ 0</span></span><br><span class="line">	NoPay     OrderStatus = <span class="literal">iota</span> <span class="comment">//æœªæ”¯ä»˜  1</span></span><br><span class="line">	PendIng   OrderStatus = <span class="literal">iota</span> <span class="comment">// æœªå‘è´§ 2</span></span><br><span class="line">	Delivered OrderStatus = <span class="literal">iota</span> <span class="comment">// å·²å‘è´§ 3</span></span><br><span class="line">	Received  OrderStatus = <span class="literal">iota</span> <span class="comment">// å·²æ”¶è´§ 4</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(Cancelled, NoPay) <span class="comment">// æ‰“å°:0,1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å½“ç„¶ï¼Œè¿™æ ·çœ‹ç€å¥½éº»çƒ¦ã€‚å…¶å®ï¼Œå…¶ä»–å¸¸é‡å¯ä»¥é‡å¤ä¸Šä¸€è¡Œ <code>iota</code> è¡¨è¾¾å¼ï¼Œæˆ‘ä»¬å¯ä»¥æ”¹æˆè¿™æ ·ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> OrderStatus <span class="type">int</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	Cancelled OrderStatus = <span class="literal">iota</span> <span class="comment">//è®¢å•å·²å–æ¶ˆ 0</span></span><br><span class="line">	NoPay                        <span class="comment">//æœªæ”¯ä»˜ 1</span></span><br><span class="line">	PendIng                      <span class="comment">// æœªå‘è´§ 2</span></span><br><span class="line">	Delivered                    <span class="comment">// å·²å‘è´§ 3</span></span><br><span class="line">	Received                     <span class="comment">// å·²æ”¶è´§ 4</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(Cancelled, NoPay) <span class="comment">// æ‰“å°:0,1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ‰äººä¼šç”¨ 0 çš„å€¼æ¥è¡¨ç¤ºçŠ¶æ€å—ï¼Ÿä¸€èˆ¬éƒ½ä¸ä¼šï¼Œæˆ‘ä»¬æƒ³ä»¥1å¼€å¤´ï¼Œé‚£ä¹ˆå¯ä»¥è¿™æ ·ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> OrderStatus <span class="type">int</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	Cancelled OrderStatus = <span class="literal">iota</span>+<span class="number">1</span> <span class="comment">//è®¢å•å·²å–æ¶ˆ 1</span></span><br><span class="line">	NoPay                        <span class="comment">//æœªæ”¯ä»˜ 2</span></span><br><span class="line">	PendIng                      <span class="comment">// æœªå‘è´§ 3</span></span><br><span class="line">	Delivered                    <span class="comment">// å·²å‘è´§ 4</span></span><br><span class="line">	Received                     <span class="comment">// å·²æ”¶è´§ 5</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(Cancelled, NoPay) <span class="comment">// æ‰“å°:1,2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬è¿˜æƒ³åœ¨ <code>Delivered</code> åè·³è¿‡ä¸€ä¸ªæ•°å­—ï¼Œæ‰æ˜¯ <code>Received</code> çš„å€¼,ä¹Ÿå°±æ˜¯ <code>Received=6</code>ï¼Œé‚£ä¹ˆå¯ä»¥å€ŸåŠ© <code>_</code> ç¬¦å·ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> OrderStatus <span class="type">int</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	Cancelled OrderStatus = <span class="literal">iota</span>+<span class="number">1</span> <span class="comment">//è®¢å•å·²å–æ¶ˆ 1</span></span><br><span class="line">	NoPay                        <span class="comment">//æœªæ”¯ä»˜ 2</span></span><br><span class="line">	PendIng                      <span class="comment">// æœªå‘è´§ 3</span></span><br><span class="line">	Delivered                    <span class="comment">// å·²å‘è´§ 4</span></span><br><span class="line">	_</span><br><span class="line">	Received                     <span class="comment">// å·²æ”¶è´§ 6</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(Received) <span class="comment">// æ‰“å°:6</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é¡ºç€æ¥å¯ä»¥ï¼Œå€’ç€å½“ç„¶ä¹Ÿè¡Œã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> OrderStatus <span class="type">int</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	Max = <span class="number">5</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	Received  OrderStatus = Max - <span class="literal">iota</span> <span class="comment">// å·²æ”¶è´§  5</span></span><br><span class="line">	Delivered                          <span class="comment">// å·²å‘è´§ 4</span></span><br><span class="line">	PendIng                            <span class="comment">// æœªå‘è´§ 3</span></span><br><span class="line">	NoPay                              <span class="comment">//æœªæ”¯ä»˜ 2</span></span><br><span class="line">	Cancelled                          <span class="comment">//è®¢å•å·²å–æ¶ˆ 1</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(Received,Delivered) <span class="comment">// æ‰“å°:5,4</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½ è¿˜å¯ä»¥ä½¿ç”¨ä½è¿ç®—ï¼Œæ¯”å¦‚åœ¨ go æºç ä¸­çš„åŒ… <code>sync</code> ä¸­çš„é”ä¸Šé¢æœ‰è¿™ä¹ˆä¸€æ®µä»£ç ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> (</span><br><span class="line">    mutexLocked = <span class="number">1</span> &lt;&lt; <span class="literal">iota</span>  <span class="comment">//1&lt;&lt;0</span></span><br><span class="line">    mutexWoken               <span class="comment">//1&lt;&lt;1</span></span><br><span class="line">    mutexStarving            <span class="comment">//1&lt;&lt;2</span></span><br><span class="line">    mutexWaiterShift = <span class="literal">iota</span>  <span class="comment">//3</span></span><br><span class="line"></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;mutexLockedçš„å€¼&quot;</span>,mutexLocked) <span class="comment">//æ‰“å°ï¼š1</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;mutexWokençš„å€¼&quot;</span>,mutexWoken) <span class="comment">//æ‰“å°ï¼š2</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;mutexStarvingçš„å€¼&quot;</span>,mutexStarving) <span class="comment">//æ‰“å°ï¼š4</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;mutexWaiterShiftçš„å€¼&quot;</span>,mutexWaiterShift) <span class="comment">// æ‰“å°ï¼š3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯èƒ½æœ‰äººå¹³å¸¸æ˜¯ç›´æ¥å®šä¹‰å¸¸é‡å€¼æˆ–è€…ç”¨å­—ç¬¦ä¸²æ¥è¡¨ç¤ºçš„ã€‚<br>æ¯”å¦‚ï¼Œä¸Šé¢è¿™äº›æˆ‘å®Œå…¨å¯ä»¥ç”¨ <code>string</code> æ¥è¡¨ç¤ºï¼Œæˆ‘è¿˜çœŸè§è¿‡ç”¨å­—ç¬¦ä¸²æ¥è¡¨ç¤ºè®¢å•çŠ¶æ€çš„ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	Cancelled = <span class="string">&quot;cancelled&quot;</span></span><br><span class="line">	NoPay     = <span class="string">&quot;noPay&quot;</span></span><br><span class="line">	PendIng   = <span class="string">&quot;pendIng&quot;</span></span><br><span class="line">	Delivered = <span class="string">&quot;delivered&quot;</span></span><br><span class="line">	Received  = <span class="string">&quot;received&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> OrderStatusMsg = <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">string</span>&#123;</span><br><span class="line">	Cancelled: <span class="string">&quot;è®¢å•å·²å–æ¶ˆ&quot;</span>,</span><br><span class="line">	NoPay:     <span class="string">&quot;æœªä»˜æ¬¾&quot;</span>,</span><br><span class="line">	PendIng:   <span class="string">&quot;æœªå‘è´§&quot;</span>,</span><br><span class="line">	Delivered: <span class="string">&quot;å·²å‘è´§&quot;</span>,</span><br><span class="line">	Received:  <span class="string">&quot;å·²æ”¶è´§&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(OrderStatusMsg[Cancelled])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ–è€…ç›´æ¥å®šä¹‰æ•´å½¢å¸¸é‡å€¼ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	Cancelled = <span class="number">1</span></span><br><span class="line">	NoPay     = <span class="number">2</span></span><br><span class="line">	PendIng   = <span class="number">3</span></span><br><span class="line">	Delivered = <span class="number">4</span></span><br><span class="line">	Received  = <span class="number">5</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> OrderStatusMsg = <span class="keyword">map</span>[<span class="type">int</span>]<span class="type">string</span>&#123;</span><br><span class="line">	Cancelled: <span class="string">&quot;è®¢å•å·²å–æ¶ˆ&quot;</span>,</span><br><span class="line">	NoPay:     <span class="string">&quot;æœªä»˜æ¬¾&quot;</span>,</span><br><span class="line">	PendIng:   <span class="string">&quot;æœªå‘è´§&quot;</span>,</span><br><span class="line">	Delivered: <span class="string">&quot;å·²å‘è´§&quot;</span>,</span><br><span class="line">	Received:  <span class="string">&quot;å·²æ”¶è´§&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(OrderStatusMsg[Cancelled])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…¶å®ä¸Šè¿°ä¸¤ç§éƒ½å¯ä»¥ï¼Œä½†æ˜¯ç›¸æ¯”ä¹‹ä¸‹ä½¿ç”¨ <code>iota</code> æ›´æœ‰ä¼˜åŠ¿ã€‚</p>
<ul>
<li>èƒ½ä¿è¯ä¸€ç»„å¸¸é‡çš„å”¯ä¸€æ€§ï¼Œäººå·¥å®šä¹‰çš„ä¸èƒ½ä¿è¯ã€‚</li>
<li>å¯ä»¥ä¸ºä¸€ç»„åŠ¨ä½œåˆ†äº«åŒä¸€ç§è¡Œä¸ºã€‚</li>
<li>é¿å…æ— æ•ˆå€¼ã€‚</li>
<li>æé«˜ä»£ç é˜…è¯»æ€§ä»¥åŠç»´æŠ¤ã€‚</li>
</ul>
<h1 id="å»¶ä¼¸"><a href="#å»¶ä¼¸" class="headerlink" title="å»¶ä¼¸"></a>å»¶ä¼¸</h1><p>æŒ‰ç…§ä¸Šé¢æˆ‘ä»¬æ‰€æ¼”ç¤ºçš„ï¼Œæœ€åæˆ‘ä»¬å¯ä»¥è¿™æ ·æ“ä½œã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> OrderStatus <span class="type">int</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	Cancelled OrderStatus = <span class="literal">iota</span> + <span class="number">1</span> <span class="comment">//è®¢å•å·²å–æ¶ˆ 1</span></span><br><span class="line">	NoPay                            <span class="comment">//æœªæ”¯ä»˜ 2</span></span><br><span class="line">	PendIng                          <span class="comment">// æœªå‘è´§ 3</span></span><br><span class="line">	Delivered                        <span class="comment">// å·²å‘è´§ 4</span></span><br><span class="line">	Received                         <span class="comment">// å·²æ”¶è´§ 5</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">//å…¬å…±è¡Œä¸º èµ‹äºˆç±»å‹ String() å‡½æ•°ï¼Œæ–¹ä¾¿æ‰“å°å€¼å«ä¹‰</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(order OrderStatus)</span></span> String() <span class="type">string</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> [...]<span class="type">string</span>&#123;<span class="string">&quot;cancelled&quot;</span>, <span class="string">&quot;noPay&quot;</span>, <span class="string">&quot;pendIng&quot;</span>, <span class="string">&quot;delivered&quot;</span>, <span class="string">&quot;received&quot;</span>&#125;[order<span class="number">-1</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆ›å»ºå…¬å…±è¡Œä¸º èµ‹äºˆç±»å‹ int å‡½æ•° EnumIndex()</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(order OrderStatus)</span></span> EnumIndex() <span class="type">int</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="type">int</span>(order)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> order OrderStatus = Received</span><br><span class="line">	fmt.Println(order.String())    <span class="comment">// æ‰“å°:received</span></span><br><span class="line">	fmt.Println(order.EnumIndex()) <span class="comment">// æ‰“å°:5</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»äº† <code>Golang</code> ä¸­å¯¹ <code>iota</code> çš„ä½¿ç”¨ä»‹ç»ï¼Œä»¥åŠæˆ‘ä»¬ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å®ƒã€‚æ¯ä¸€ç§è¯­è¨€çš„è®¾è®¡éƒ½ä¸€å®šä¸æ˜¯å®Œç¾çš„ï¼Œæˆ‘ä»¬è¦é€‚åº”å®ƒã€‚</p>
]]></content>
      <categories>
        <category>go</category>
      </categories>
      <tags>
        <tag>go</tag>
      </tags>
  </entry>
  <entry>
    <title>Go tool: expvar è‡ªå®šä¹‰åº¦é‡æ•°æ®ï¼Œè¾…åŠ©å®šä½æ€§èƒ½ç“¶é¢ˆç‚¹</title>
    <url>/2024/03/15/Go%20tool%EF%BC%9Aexpvar%20%E8%87%AA%E5%AE%9A%E4%B9%89%E5%BA%A6%E9%87%8F%E6%95%B0%E6%8D%AE%EF%BC%8C%E8%BE%85%E5%8A%A9%E5%AE%9A%E4%BD%8D%E6%80%A7%E8%83%BD%E7%93%B6%E9%A2%88%E7%82%B9/</url>
    <content><![CDATA[<p>ä»‹ç» go å†…ç½®å·¥å…·åŒ… expvar çš„ä½¿ç”¨ï¼Œèƒ½å¤Ÿå¸®æˆ‘ä»¬å®ç°ä»€ä¹ˆåŠŸèƒ½ï¼Œä»¥åŠå®ƒè·Ÿpprof çš„åŒºåˆ«</p>
<span id="more"></span>
<p>#go #ç›‘æ§ #è‡ªå®šä¹‰<br>åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œè¦æƒ³å¯¹Goåº”ç”¨å­˜åœ¨çš„æ€§èƒ½ç“¶é¢ˆè¿›è¡Œå‰–æï¼Œé¦–å…ˆå°±è¦ä½¿ç”¨pprof å¯¹ä¸åŒç±»å‹çš„æ€§èƒ½æ•°æ®è¿›è¡Œæ”¶é›†å’Œé‡‡æ ·ã€‚æœ‰ä¸¤ç§æ”¶é›†å’Œé‡‡æ ·æ•°æ®çš„æ–¹æ³•ã€‚</p>
<ul>
<li>åœ¨å¾®è§‚å±‚é¢ï¼Œé‡‡ç”¨é€šè¿‡è¿è¡Œæ€§èƒ½åŸºå‡†æµ‹è¯•æ”¶é›†å’Œé‡‡æ ·æ•°æ®çš„æ–¹æ³•ï¼Œè¿™ç§æ–¹æ³•é€‚ç”¨äºå®šä½å‡½æ•°æˆ–æ–¹æ³•å®ç°ä¸­å­˜åœ¨æ€§èƒ½ç“¶é¢ˆç‚¹çš„æƒ…å½¢ï¼›</li>
<li>åœ¨å®è§‚å±‚é¢ï¼Œé‡‡ç”¨ç‹¬ç«‹ç¨‹åºæ”¶é›†å’Œé‡‡æ ·æ•°æ®çš„æ–¹æ³•ã€‚ä½†é€šè¿‡ç‹¬ç«‹ç¨‹åºè¿›è¡Œæ€§èƒ½æ•°æ®é‡‡æ ·æ—¶ï¼Œå¾€å¾€å¾ˆéš¾å¿«é€Ÿæ•æ‰åˆ°çœŸæ­£çš„ç“¶é¢ˆç‚¹ï¼Œå°¤å…¶æ˜¯å¯¹äºé‚£äº›å†…éƒ¨ç»“æ„å¤æ‚ã€ä¸šåŠ¡é€»è¾‘è¿‡å¤šã€å†…éƒ¨æœ‰è¾ƒå¤šå¹¶å‘çš„Goç¨‹åºã€‚æˆ‘ä»¬åœ¨å¯¹è¿™æ ·çš„ç¨‹åºè¿›è¡Œæ€§èƒ½é‡‡æ ·æ—¶ï¼ŒçœŸæ­£çš„ç“¶é¢ˆç‚¹å¾ˆå¯èƒ½è¢«å…¶ä»–æ•°æ®é®ç›–ã€‚<br><strong>é‚£ä¹ˆå¦‚ä½•èƒ½æ›´é«˜æ•ˆåœ°æ•æ‰åˆ°åº”ç”¨çš„æ€§èƒ½ç“¶é¢ˆç‚¹å‘¢ï¼Ÿ</strong><br>æˆ‘ä»¬å¯ä»¥é€šè¿‡éƒ¨ç½²agentæˆ–è€…å…¶ä»–æ–¹å¼ï¼Œé€šè¿‡æŸ¥è¯¢åº”ç”¨å¤–éƒ¨ç‰¹å¾è€Œè·å–çš„æ¢é’ˆç±»ï¼ˆprobingï¼‰æ•°æ®ï¼ˆæ¯”å¦‚æŸ¥çœ‹åº”ç”¨æŸç«¯å£æ˜¯å¦æœ‰å“åº”å¹¶è¿”å›æ­£ç¡®çš„æ•°æ®æˆ–çŠ¶æ€ç ï¼‰ï¼Œç›¸æ¯”äºè¿™äº›æ¶ˆæ¯ï¼Œæˆ‘ä»¬å¯èƒ½è¿˜æƒ³çŸ¥é“ä¸€äº›å†…çœçš„æ¶ˆæ¯ï¼Œæ¯”å¦‚æ›´å¤šçš„æœ‰å…³åº”ç”¨ç¨‹åºçŠ¶æ€çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚è¿™äº›ä¸Šä¸‹æ–‡ä¿¡æ¯å¯ä»¥æ˜¯åº”ç”¨å¯¹å„ç±»èµ„æºçš„å ç”¨ä¿¡æ¯ï¼Œæ¯”å¦‚åº”ç”¨è¿è¡Œå ç”¨äº†å¤šå°‘å†…å­˜ç©ºé—´ï¼Œä¹Ÿå¯ä»¥æ˜¯è‡ªå®šä¹‰çš„æ€§èƒ½æŒ‡æ ‡ä¿¡æ¯ï¼Œæ¯”å¦‚å•ä½æ—¶é—´å¤„ç†çš„å¤–éƒ¨è¯·æ±‚æ•°é‡ã€åº”ç­”å»¶è¿Ÿã€é˜Ÿåˆ—ç§¯å‹é‡ç­‰ã€‚<br>è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦ go å®˜æ–¹çš„å¦å¤–ä¸€ä¸ªåŒ… <a href="https://pkg.go.dev/expvar">expvar</a></li>
</ul>
<blockquote>
<p>Package expvar provides a standardized interface to public variables, such as operation counters in servers. It exposes these variables via HTTP at &#x2F;debug&#x2F;vars in JSON format.</p>
</blockquote>
<p>æˆ‘ä»¬å¯ä»¥è½»æ¾åœ°ä½¿ç”¨Goæ ‡å‡†åº“æä¾›çš„expvaråŒ…æŒ‰ç»Ÿä¸€æ¥å£ã€ç»Ÿä¸€æ•°æ®æ ¼å¼ã€ä¸€è‡´çš„æŒ‡æ ‡å®šä¹‰æ–¹æ³•è¾“å‡ºè‡ªå®šä¹‰çš„åº¦é‡æ•°æ®ã€‚åœ¨æœ¬ç¯‡åšå®¢ä¸­ï¼Œæˆ‘ä»¬å°±ä¸€èµ·æ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨expvarè¾“å‡ºè‡ªå®šä¹‰çš„æ€§èƒ½åº¦é‡æ•°æ®ã€‚  </p>
<h1 id="ä¸€ä¸ªä¾‹å­"><a href="#ä¸€ä¸ªä¾‹å­" class="headerlink" title="ä¸€ä¸ªä¾‹å­"></a>ä¸€ä¸ªä¾‹å­</h1><p>æˆ‘ä»¬é¦–å…ˆæ¥çœ‹ä¸€ä¸ªä¾‹å­</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> (  </span><br><span class="line">    _ <span class="string">&quot;expvar&quot;</span>  </span><br><span class="line">    <span class="string">&quot;fmt&quot;</span>    <span class="string">&quot;net/http&quot;</span>)  </span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;  </span><br><span class="line">    http.Handle(<span class="string">&quot;/hi&quot;</span>, http.HandlerFunc(<span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter,  </span></span></span><br><span class="line"><span class="params"><span class="function">       r *http.Request)</span></span> &#123;  </span><br><span class="line">       w.Write([]<span class="type">byte</span>(<span class="string">&quot;hi\n&quot;</span>))  </span><br><span class="line">    &#125;))  </span><br><span class="line">    fmt.Println(http.ListenAndServe(<span class="string">&quot;localhost:8080&quot;</span>, <span class="literal">nil</span>))  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶åæˆ‘ä»¬è®¿é—®ä¸€ä¸‹<code>http://localhost:8080/debug/vars</code><br><img src="https://images.hxzhouh.com/blog-images/2024/03/a74e96c20015c0490c2668b06451c1b6.png" alt="Pasted image 20240314192240"><br>expvar è¿”å›çš„æ˜¯æ ‡å‡†æ ¼å¼çš„JSONã€‚<br>åœ¨é»˜è®¤è¿”å›çš„çŠ¶æ€æ•°æ®ä¸­åŒ…å«äº†ä¸¤ä¸ªå­—æ®µï¼šcmdlineå’Œmemstatsã€‚<br>è¿™ä¸¤ä¸ªè¾“å‡ºæ•°æ®æ˜¯expvaråŒ…åœ¨initå‡½æ•°ä¸­å°±å·²ç»å‘å¸ƒï¼ˆPublishï¼‰äº†çš„å˜é‡ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">src/expvar/expvar.<span class="keyword">go</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;  </span><br><span class="line">  http.HandleFunc(<span class="string">&quot;/debug/vars&quot;</span>, expvarHandler)  </span><br><span class="line">  Publish(<span class="string">&quot;cmdline&quot;</span>, Func(cmdline))  </span><br><span class="line">  Publish(<span class="string">&quot;memstats&quot;</span>, Func(memstats))  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="https://pkg.go.dev/os#Args">cmdline</a></strong> å­—æ®µçš„å«ä¹‰æ˜¯è¾“å‡ºæ•°æ®çš„åº”ç”¨åï¼Œè¿™é‡Œå› ä¸ºæ˜¯é€šè¿‡go runè¿è¡Œçš„åº”ç”¨ï¼Œæ‰€ä»¥cmdlineçš„å€¼æ˜¯ä¸€ä¸ªä¸´æ—¶è·¯å¾„ä¸‹çš„åº”ç”¨ã€‚<br><strong><a href="https://pkg.go.dev/runtime#MemStats">memstats</a></strong> è¾“å‡ºçš„æ•°æ®å¯¹åº”çš„æ˜¯runtime.Memstatsç»“æ„ä½“ï¼Œåæ˜ çš„æ˜¯åº”ç”¨åœ¨è¿è¡ŒæœŸé—´å †å†…å­˜åˆ†é…ã€æ ˆå†…å­˜åˆ†é…åŠGCçš„çŠ¶æ€ã€‚runtime.Memstatsç»“æ„ä½“çš„å­—æ®µå¯èƒ½ä¼šéšç€Goç‰ˆæœ¬çš„æ¼”è¿›è€Œå‘ç”Ÿå˜åŒ–ï¼Œå…¶å­—æ®µå…·ä½“å«ä¹‰å¯ä»¥å‚è€ƒMemstatsç»“æ„ä½“ä¸­çš„æ³¨é‡Šã€‚</p>
<h1 id="é€šè¿‡expvarè¾“å‡ºè‡ªå®šä¹‰åº¦é‡æ•°æ®"><a href="#é€šè¿‡expvarè¾“å‡ºè‡ªå®šä¹‰åº¦é‡æ•°æ®" class="headerlink" title="é€šè¿‡expvarè¾“å‡ºè‡ªå®šä¹‰åº¦é‡æ•°æ®"></a>é€šè¿‡expvarè¾“å‡ºè‡ªå®šä¹‰åº¦é‡æ•°æ®</h1><p>åŒæ ·ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªä¾‹å­è¯´æ˜ å¦‚ä½•è‡ªå®šä¹‰åº¦é‡æ•°æ®ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> (  </span><br><span class="line">    <span class="string">&quot;expvar&quot;</span>  </span><br><span class="line">    _ <span class="string">&quot;expvar&quot;</span>  </span><br><span class="line">    <span class="string">&quot;fmt&quot;</span>    <span class="string">&quot;net/http&quot;</span>)  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">var</span> customVar = <span class="built_in">new</span>(expvar.Map).Init()  </span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;  </span><br><span class="line">    customVar.Set(<span class="string">&quot;hi_count&quot;</span>, <span class="built_in">new</span>(expvar.Int))  </span><br><span class="line">    expvar.Publish(<span class="string">&quot;custom&quot;</span>, customVar)  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;  </span><br><span class="line">    http.Handle(<span class="string">&quot;/hi&quot;</span>, http.HandlerFunc(<span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter,  </span></span></span><br><span class="line"><span class="params"><span class="function">       r *http.Request)</span></span> &#123;  </span><br><span class="line">       <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;  </span><br><span class="line">          customVar.Add(<span class="string">&quot;hi_count&quot;</span>, <span class="number">1</span>)  </span><br><span class="line">       &#125;()  </span><br><span class="line">       w.Write([]<span class="type">byte</span>(<span class="string">&quot;hi\n&quot;</span>))  </span><br><span class="line">    &#125;))  </span><br><span class="line">    fmt.Println(http.ListenAndServe(<span class="string">&quot;localhost:8080&quot;</span>, <span class="literal">nil</span>))  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚ä»¥ä¸Šç¤ºä¾‹æ‰€ç¤ºï¼Œå®šä¹‰ä¸€ä¸ªexpvar.Mapç±»å‹å˜é‡åï¼Œå¯ä»¥å‘è¯¥å¤åˆæŒ‡æ ‡å˜é‡ä¸­æ·»åŠ æŒ‡æ ‡ï¼Œæ¯”å¦‚ç¤ºä¾‹ä¸­çš„â€œhi_countâ€<br>ç„¶åé‡æ–°è¿è¡Œä¾‹å­ã€‚å…ˆè°ƒç”¨ä¸¤æ¬¡ localhost:8080&#x2F;hi</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">âœ  test git:(main) âœ— curl localhost:8080/hi</span><br><span class="line">hi</span><br><span class="line">âœ  test git:(main) âœ— curl localhost:8080/hi                </span><br><span class="line">hi</span><br><span class="line">âœ  test git:(main) âœ— curl http://localhost:8080/debug/vars </span><br><span class="line">&#123;</span><br><span class="line">&quot;cmdline&quot;: [&quot;/Users/hxzhouh/Library/Caches/JetBrains/GoLand2023.3/tmp/GoLand/___go_build_github_com_hxzhouh_go_example_expvar&quot;],</span><br><span class="line">&quot;custom&quot;: &#123;&quot;hi_count&quot;: 2&#125;,</span><br><span class="line">&quot;memstats&quot;:&quot;.....&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>expvar è¾“å‡ºäº†æˆ‘ä»¬æƒ³è¦çš„ç»“æœã€‚å®é™…ä¸Šexpvar å¯ä»¥è¾“å‡ºä»»ä½•æˆ‘ä»¬æƒ³è¦çš„ç»“æœï¼Œè¿™é‡Œå°±ä¸å±•å¼€æè¿°ã€‚</p>
<h1 id="è¾“å‡ºæ•°æ®çš„å±•ç¤º"><a href="#è¾“å‡ºæ•°æ®çš„å±•ç¤º" class="headerlink" title="è¾“å‡ºæ•°æ®çš„å±•ç¤º"></a>è¾“å‡ºæ•°æ®çš„å±•ç¤º</h1><p>é€šè¿‡&#x2F;debug&#x2F;varsæœåŠ¡ç«¯ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°æ ‡å‡†JSONæ ¼å¼çš„åº”ç”¨å†…éƒ¨çŠ¶æ€æ•°æ®ï¼Œæ•°æ®é‡‡é›†å‡ºæ¥åå¯æ ¹æ®ä¸åŒå¼€å‘è€…çš„éœ€æ±‚è¿›è¡Œè½¬æ¢å’Œå±•ç¤ºã€‚JSONæ ¼å¼æ–‡æœ¬å¾ˆå®¹æ˜“ååºåˆ—åŒ–ï¼Œå¼€å‘è€…å¯è‡ªè¡Œè§£æåä½¿ç”¨ï¼Œæ¯”å¦‚ï¼šç¼–å†™ä¸€ä¸ªPrometheus exporterï¼Œå°†æ•°æ®å¯¼å…¥PrometheusèƒŒåçš„å­˜å‚¨ï¼ˆæ¯”å¦‚InfluxDBï¼‰ä¸­ï¼Œå¹¶åˆ©ç”¨ä¸€äº›åŸºäºWebå›¾å½¢åŒ–çš„æ–¹å¼ç›´è§‚å±•ç¤ºå‡ºæ¥ï¼›æˆ–è€…å¯¼å…¥Elasticsearchï¼Œå†é€šè¿‡Kibanaæˆ–Grafanaçš„é¡µé¢å±•ç¤ºå‡ºæ¥ã€‚<br>æˆ‘ä»¬è¿™é‡Œå±•ç¤ºgoå¼€å‘è€…<a href="https://twitter.com/idanyliuk">Ivan Daniluk</a> å¼€å‘çš„ expvarmonï¼Œ é¦–å…ˆå®‰è£…å®ƒ</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">go get github.com/divan/expvarmon</span><br></pre></td></tr></table></figure>

<p>ç„¶åæŸ¥çœ‹æ•°æ®</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">expvarmon -ports=&quot;8080&quot; -vars=&quot;custom.hi_count,mem:memstats.Alloc,mem:memstats.Sys,mem:memstats.HeapAlloc,mem:memstats.HeapInuse,duration:memstats.PauseNs,duration:memstats.PauseTotalNs&quot;</span><br></pre></td></tr></table></figure>
<p>ç»“æœå¾ˆgeek<br><img src="https://images.hxzhouh.com/blog-images/2024/03/07330c38becc77adad1a63bc7503bb7b.png" alt="Pasted image 20240314195301"></p>
<p>expvaråŒ…ä¸ä»…å¯ç”¨äºè¾…åŠ©ç¼©å°å®šä½æ€§èƒ½ç“¶é¢ˆçš„èŒƒå›´ï¼Œè¿˜å¯ä»¥ç”¨æ¥è¾“å‡ºåº¦é‡æ•°æ®ä»¥å¯¹åº”ç”¨çš„è¿è¡ŒçŠ¶æ€è¿›è¡Œç›‘æ§ï¼Œè¿™æ ·å½“ç¨‹åºå‡ºç°é—®é¢˜æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å¿«é€Ÿå‘ç°é—®é¢˜å¹¶åˆ©ç”¨è¾“å‡ºçš„åº¦é‡æ•°æ®å¯¹ç¨‹åºè¿›è¡Œè¯Šæ–­å¹¶å¿«é€Ÿå®šä½é—®é¢˜</p>
<h1 id="è·Ÿ-pprof-çš„åŒºåˆ«"><a href="#è·Ÿ-pprof-çš„åŒºåˆ«" class="headerlink" title="è·Ÿ pprof çš„åŒºåˆ«"></a>è·Ÿ pprof çš„åŒºåˆ«</h1><p><code>pprof</code>Â æ˜¯ Go è¯­è¨€å¦ä¸€ä¸ªå†…ç½®çš„æ€§èƒ½å‰–æå·¥å…·ï¼Œä¸»è¦ç”¨äºåˆ†æç¨‹åºçš„ CPU ä½¿ç”¨æƒ…å†µå’Œå†…å­˜å ç”¨æƒ…å†µã€‚ä¸Â <code>expvar</code>Â æä¾›å®æ—¶ç›‘æ§æœåŠ¡å†…éƒ¨å˜é‡ä¸åŒï¼Œ<code>pprof</code>Â æ›´å¤šåœ°ç”¨äºæ€§èƒ½åˆ†æå’Œä¼˜åŒ–ã€‚ç®€è€Œè¨€ä¹‹ï¼Œ<code>expvar</code>Â èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬è§‚å¯Ÿç¨‹åºçš„â€æ´»åŠ¨â€æ•°æ®ï¼Œè€ŒÂ <code>pprof</code>Â ä¸“æ³¨äºç¨‹åºçš„â€æ€§èƒ½â€æ•°æ®ã€‚<br><code>expvar</code>Â ä»¥ç®€å•çš„æ–¹å¼å…¬å¼€åº”ç”¨ç¨‹åºçš„å®æ—¶çŠ¶æ€æ•°æ®ï¼Œå¦‚å½“å‰æ´»è·ƒè¿æ¥æ•°æˆ–å·²å¤„ç†è¯·æ±‚çš„è®¡æ•°å™¨ã€‚å…¶è®¾è®¡æ„å›¾æ˜¯é•¿æœŸè¿è¡Œä»¥ç›‘æ§åº”ç”¨çŠ¶æ€ï¼Œå¯¹äºæƒ³è¦å¿«é€Ÿäº†è§£åº”ç”¨å¥åº·çŠ¶å†µçš„å¼€å‘è€…è€Œè¨€ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸ç›´æ¥çš„å·¥å…·ã€‚</p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>expvar æ˜¯ä¸€ä¸ªå¾ˆå¼ºå¤§çš„å·¥å…·ï¼Œä»–å¯ä»¥å¸®åŠ©æˆ‘ä»¬å®ç°åº”ç”¨å†…æƒ…å†µçš„ç›‘æ§ï¼Œå¹¶ä¸”å¾ˆæ–¹ä¾¿çš„è·Ÿå…¶ä»–ç›‘æ§å¹³å°å¯¹æ¥ï¼Œæ˜¯æ¯ä¸ªgopher éƒ½åº”è¯¥æŒæ¡çš„å·¥å…·ã€‚</p>
]]></content>
      <categories>
        <category>blog</category>
      </categories>
      <tags>
        <tag>go</tag>
        <tag>ç›‘æ§</tag>
      </tags>
  </entry>
  <entry>
    <title>Golang å¤§æ€å™¨ä¹‹æ€§èƒ½å‰–æ PProf</title>
    <url>/2022/09/30/Golang%20%E5%A4%A7%E6%9D%80%E5%99%A8%E4%B9%8B%E6%80%A7%E8%83%BD%E5%89%96%E6%9E%90%20pprof/</url>
    <content><![CDATA[<h1 id="Golang-å¤§æ€å™¨ä¹‹æ€§èƒ½å‰–æ-pprof"><a href="#Golang-å¤§æ€å™¨ä¹‹æ€§èƒ½å‰–æ-pprof" class="headerlink" title="Golang å¤§æ€å™¨ä¹‹æ€§èƒ½å‰–æ pprof"></a>Golang å¤§æ€å™¨ä¹‹æ€§èƒ½å‰–æ pprof</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å†™äº†å‡ å¨ä»£ç ï¼Œå®ç°äº†å‡ ç™¾ä¸ªæ¥å£ã€‚åŠŸèƒ½æµ‹è¯•ä¹Ÿé€šè¿‡äº†ï¼Œç»ˆäºæˆåŠŸçš„éƒ¨ç½²ä¸Šçº¿äº†<br>ç»“æœï¼Œæ€§èƒ½ä¸ä½³ï¼Œä»€ä¹ˆé¬¼ï¼ŸğŸ˜­</p>
<h2 id="æƒ³åšæ€§èƒ½åˆ†æï¼Ÿ"><a href="#æƒ³åšæ€§èƒ½åˆ†æï¼Ÿ" class="headerlink" title="æƒ³åšæ€§èƒ½åˆ†æï¼Ÿ"></a>æƒ³åšæ€§èƒ½åˆ†æï¼Ÿ</h2><h3 id="PProf"><a href="#PProf" class="headerlink" title="PProf"></a>PProf</h3><p>æƒ³è¦è¿›è¡Œæ€§èƒ½ä¼˜åŒ–ï¼Œé¦–å…ˆç©ç›®åœ¨ Go è‡ªèº«æä¾›çš„å·¥å…·é“¾æ¥ä½œä¸ºåˆ†æä¾æ®ï¼Œæœ¬æ–‡å°†å¸¦ä½ å­¦ä¹ ã€ä½¿ç”¨ Go åèŠ±å›­ï¼Œæ¶‰åŠå¦‚ä¸‹ï¼š</p>
<ul>
<li>runtime&#x2F;pprofï¼šé‡‡é›†ç¨‹åºï¼ˆé Serverï¼‰çš„è¿è¡Œæ•°æ®è¿›è¡Œåˆ†æ</li>
<li>net&#x2F;http&#x2F;pprofï¼šé‡‡é›† HTTP Server çš„è¿è¡Œæ—¶æ•°æ®è¿›è¡Œåˆ†æ</li>
</ul>
<h3 id="æ˜¯ä»€ä¹ˆ"><a href="#æ˜¯ä»€ä¹ˆ" class="headerlink" title="æ˜¯ä»€ä¹ˆ"></a>æ˜¯ä»€ä¹ˆ</h3><p>pprof æ˜¯ç”¨äºå¯è§†åŒ–å’Œåˆ†ææ€§èƒ½åˆ†ææ•°æ®çš„å·¥å…·<br>pprof ä»¥ <a href="https://github.com/google/pprof/blob/master/proto/profile.proto">profile.proto</a> è¯»å–åˆ†ææ ·æœ¬çš„é›†åˆï¼Œå¹¶ç”ŸæˆæŠ¥å‘Šä»¥å¯è§†åŒ–å¹¶å¸®åŠ©åˆ†ææ•°æ®ï¼ˆæ”¯æŒæ–‡æœ¬å’Œå›¾å½¢æŠ¥å‘Šï¼‰<br>profile.proto æ˜¯ä¸€ä¸ª Protocol Buffer v3 çš„æè¿°æ–‡ä»¶ï¼Œå®ƒæè¿°äº†ä¸€ç»„ callstack å’Œ symbolization ä¿¡æ¯ï¼Œ ä½œç”¨æ˜¯è¡¨ç¤ºç»Ÿè®¡åˆ†æçš„ä¸€ç»„é‡‡æ ·çš„è°ƒç”¨æ ˆï¼Œæ˜¯å¾ˆå¸¸è§çš„ stacktrace é…ç½®æ–‡ä»¶æ ¼å¼</p>
<h3 id="æ”¯æŒä»€ä¹ˆä½¿ç”¨æ¨¡å¼"><a href="#æ”¯æŒä»€ä¹ˆä½¿ç”¨æ¨¡å¼" class="headerlink" title="æ”¯æŒä»€ä¹ˆä½¿ç”¨æ¨¡å¼"></a>æ”¯æŒä»€ä¹ˆä½¿ç”¨æ¨¡å¼</h3><ul>
<li>Report generationï¼šæŠ¥å‘Šç”Ÿæˆ</li>
<li>Interactive terminal useï¼šäº¤äº’å¼ç»ˆç«¯ä½¿ç”¨</li>
<li>Web interfaceï¼šWeb ç•Œé¢</li>
</ul>
<h3 id="å¯ä»¥åšä»€ä¹ˆ"><a href="#å¯ä»¥åšä»€ä¹ˆ" class="headerlink" title="å¯ä»¥åšä»€ä¹ˆ"></a>å¯ä»¥åšä»€ä¹ˆ</h3><ul>
<li>CPU Profilingï¼šCPU åˆ†æï¼ŒæŒ‰ç…§ä¸€å®šçš„é¢‘ç‡é‡‡é›†æ‰€ç›‘å¬çš„åº”ç”¨ç¨‹åº CPUï¼ˆå«å¯„å­˜å™¨ï¼‰çš„ä½¿ç”¨æƒ…å†µï¼Œå¯ç¡®å®šåº”ç”¨ç¨‹åºåœ¨ä¸»åŠ¨æ¶ˆè€— CPU å‘¨æœŸæ—¶èŠ±è´¹æ—¶é—´çš„ä½ç½®<ul>
<li>ä¸€æ—¦å¯ç”¨CPUæ•°æ®é‡‡æ ·ï¼ŒGoè¿è¡Œæ—¶ä¼šæ¯éš”ä¸€æ®µçŸ­æš‚çš„æ—¶é—´ï¼ˆ10msï¼‰å°±ä¸­æ–­ä¸€æ¬¡ï¼ˆç”±SIGPROFä¿¡å·å¼•å‘ï¼‰å¹¶è®°å½•å½“å‰æ‰€æœ‰goroutineçš„å‡½æ•°æ ˆä¿¡æ¯ï¼ˆå­˜å…¥cpu.profï¼‰ã€‚</li>
</ul>
</li>
<li>Memory Profilingï¼šå†…å­˜åˆ†æï¼Œåœ¨åº”ç”¨ç¨‹åºè¿›è¡Œå †åˆ†é…æ—¶è®°å½•å †æ ˆè·Ÿè¸ªï¼Œç”¨äºç›‘è§†å½“å‰å’Œå†å²å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œä»¥åŠæ£€æŸ¥å†…å­˜æ³„æ¼<ul>
<li>å †å†…å­˜åˆ†é…çš„é‡‡æ ·é¢‘ç‡å¯é…ç½®ï¼Œé»˜è®¤&#x3D;&#x3D;æ¯1000æ¬¡&#x3D;&#x3D;å †å†…å­˜åˆ†é…ä¼šåšä¸€æ¬¡é‡‡æ ·ï¼ˆå­˜å…¥mem.profï¼‰ã€‚</li>
</ul>
</li>
<li>Block Profilingï¼šé˜»å¡åˆ†æï¼Œè®°å½• goroutine é˜»å¡ç­‰å¾…åŒæ­¥ï¼ˆåŒ…æ‹¬å®šæ—¶å™¨é€šé“ï¼‰çš„ä½ç½®</li>
<li>Mutex Profilingï¼šäº’æ–¥é”åˆ†æï¼ŒæŠ¥å‘Šäº’æ–¥é”çš„ç«äº‰æƒ…å†µ</li>
</ul>
<h2 id="ä¸€ä¸ªç®€å•çš„ä¾‹å­"><a href="#ä¸€ä¸ªç®€å•çš„ä¾‹å­" class="headerlink" title="ä¸€ä¸ªç®€å•çš„ä¾‹å­"></a>ä¸€ä¸ªç®€å•çš„ä¾‹å­</h2><p>æˆ‘ä»¬å°†ç¼–å†™ä¸€ä¸ªç®€å•ä¸”æœ‰ç‚¹é—®é¢˜çš„ä¾‹å­ï¼Œç”¨äºåŸºæœ¬çš„ç¨‹åºåˆæ­¥åˆ†æ</p>
<h3 id="ç¼–å†™-demo-æ–‡ä»¶"><a href="#ç¼–å†™-demo-æ–‡ä»¶" class="headerlink" title="ç¼–å†™ demo æ–‡ä»¶"></a>ç¼–å†™ demo æ–‡ä»¶</h3><p>ï¼ˆ1ï¼‰demo.goï¼Œæ–‡ä»¶å†…å®¹ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;log&quot;</span></span><br><span class="line">    <span class="string">&quot;net/http&quot;</span></span><br><span class="line">    _ <span class="string">&quot;net/http/pprof&quot;</span></span><br><span class="line">    <span class="string">&quot;github.com/EDDYCJY/go-pprof-example/data&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">for</span> &#123;</span><br><span class="line">            log.Println(data.Add(<span class="string">&quot;https://github.com/EDDYCJY&quot;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;()</span><br><span class="line">    http.ListenAndServe(<span class="string">&quot;0.0.0.0:6060&quot;</span>, <span class="literal">nil</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ï¼ˆ2ï¼‰data&#x2F;d.goï¼Œæ–‡ä»¶å†…å®¹ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> data</span><br><span class="line"><span class="keyword">var</span> datas []<span class="type">string</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Add</span><span class="params">(str <span class="type">string</span>)</span></span> <span class="type">string</span> &#123;</span><br><span class="line">    data := []<span class="type">byte</span>(str)</span><br><span class="line">    sData := <span class="type">string</span>(data)</span><br><span class="line">    datas = <span class="built_in">append</span>(datas, sData)</span><br><span class="line">    <span class="keyword">return</span> sData</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œè¿™ä¸ªæ–‡ä»¶ï¼Œä½ çš„ HTTP æœåŠ¡ä¼šå¤šå‡º &#x2F;debug&#x2F;pprof çš„ endpoint å¯ç”¨äºè§‚å¯Ÿåº”ç”¨ç¨‹åºçš„æƒ…å†µ</p>
<h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><h4 id="ä¸€ã€é€šè¿‡-Web-ç•Œé¢"><a href="#ä¸€ã€é€šè¿‡-Web-ç•Œé¢" class="headerlink" title="ä¸€ã€é€šè¿‡ Web ç•Œé¢"></a>ä¸€ã€é€šè¿‡ Web ç•Œé¢</h4><p>æŸ¥çœ‹å½“å‰æ€»è§ˆï¼šè®¿é—® <code>http://127.0.0.1:6060/debug/pprof/</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">/debug/pprof/</span><br><span class="line">profiles:</span><br><span class="line">0    block</span><br><span class="line">5    goroutine</span><br><span class="line">3    heap</span><br><span class="line">0    mutex</span><br><span class="line">9    threadcreate</span><br><span class="line">full goroutine stack dump</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªé¡µé¢ä¸­æœ‰è®¸å¤šå­é¡µé¢ï¼Œå’±ä»¬ç»§ç»­æ·±ç©¶ä¸‹å»ï¼Œçœ‹çœ‹å¯ä»¥å¾—åˆ°ä»€ä¹ˆï¼Ÿ</p>
<ul>
<li>cpuï¼ˆCPU Profilingï¼‰: <code>$HOST/debug/pprof/profile</code>ï¼Œé»˜è®¤è¿›è¡Œ 30s çš„ CPU Profilingï¼Œå¾—åˆ°ä¸€ä¸ªåˆ†æç”¨çš„ profile æ–‡ä»¶</li>
<li>blockï¼ˆBlock Profilingï¼‰ï¼š<code>$HOST/debug/pprof/block</code>ï¼ŒæŸ¥çœ‹å¯¼è‡´é˜»å¡åŒæ­¥çš„å †æ ˆè·Ÿè¸ª</li>
<li>goroutineï¼š<code>$HOST/debug/pprof/goroutine</code>ï¼ŒæŸ¥çœ‹å½“å‰æ‰€æœ‰è¿è¡Œçš„ goroutines å †æ ˆè·Ÿè¸ª</li>
<li>heapï¼ˆMemory Profilingï¼‰: <code>$HOST/debug/pprof/heap</code>ï¼ŒæŸ¥çœ‹æ´»åŠ¨å¯¹è±¡çš„å†…å­˜åˆ†é…æƒ…å†µ</li>
<li>mutexï¼ˆMutex Profilingï¼‰ï¼š<code>$HOST/debug/pprof/mutex</code>ï¼ŒæŸ¥çœ‹å¯¼è‡´äº’æ–¥é”çš„ç«äº‰æŒæœ‰è€…çš„å †æ ˆè·Ÿè¸ª</li>
<li>threadcreateï¼š<code>$HOST/debug/pprof/threadcreate</code>ï¼ŒæŸ¥çœ‹åˆ›å»ºæ–°OSçº¿ç¨‹çš„å †æ ˆè·Ÿè¸ª</li>
</ul>
<h4 id="äºŒã€é€šè¿‡äº¤äº’å¼ç»ˆç«¯ä½¿ç”¨"><a href="#äºŒã€é€šè¿‡äº¤äº’å¼ç»ˆç«¯ä½¿ç”¨" class="headerlink" title="äºŒã€é€šè¿‡äº¤äº’å¼ç»ˆç«¯ä½¿ç”¨"></a>äºŒã€é€šè¿‡äº¤äº’å¼ç»ˆç«¯ä½¿ç”¨</h4><p>ï¼ˆ1ï¼‰go tool pprof <a href="http://localhost/">http://localhost</a>:6060&#x2F;debug&#x2F;pprof&#x2F;profile?seconds&#x3D;60</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">go tool pprof http://localhost:6060/debug/pprof/profile\?seconds\=60</span></span><br><span class="line">Fetching profile over HTTP from http://localhost:6060/debug/pprof/profile?seconds=60</span><br><span class="line">Saved profile in /Users/eddycjy/pprof/pprof.samples.cpu.007.pb.gz</span><br><span class="line">Type: cpu</span><br><span class="line">Duration: 1mins, Total samples = 26.55s (44.15%)</span><br><span class="line">Entering interactive mode (type &quot;help&quot; for commands, &quot;o&quot; for options)</span><br><span class="line">(pprof) </span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œè¯¥å‘½ä»¤åï¼Œéœ€ç­‰å¾… 60 ç§’ï¼ˆå¯è°ƒæ•´ seconds çš„å€¼ï¼‰ï¼Œpprof ä¼šè¿›è¡Œ CPU Profilingã€‚ç»“æŸåå°†é»˜è®¤è¿›å…¥ pprof çš„äº¤äº’å¼å‘½ä»¤æ¨¡å¼ï¼Œå¯ä»¥å¯¹åˆ†æçš„ç»“æœè¿›è¡ŒæŸ¥çœ‹æˆ–å¯¼å‡ºã€‚å…·ä½“å¯æ‰§è¡Œ <code>pprof help</code> æŸ¥çœ‹å‘½ä»¤è¯´æ˜</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(pprof) top10</span><br><span class="line">Showing nodes accounting for 25.92s, 97.63% of 26.55s total</span><br><span class="line">Dropped 85 nodes (cum &lt;= 0.13s)</span><br><span class="line">Showing top 10 nodes out of 21</span><br><span class="line">      flat  flat%   sum%        cum   cum%</span><br><span class="line">    23.28s 87.68% 87.68%     23.29s 87.72%  syscall.Syscall</span><br><span class="line">     0.77s  2.90% 90.58%      0.77s  2.90%  runtime.memmove</span><br><span class="line">     0.58s  2.18% 92.77%      0.58s  2.18%  runtime.freedefer</span><br><span class="line">     0.53s  2.00% 94.76%      1.42s  5.35%  runtime.scanobject</span><br><span class="line">     0.36s  1.36% 96.12%      0.39s  1.47%  runtime.heapBitsForObject</span><br><span class="line">     0.35s  1.32% 97.44%      0.45s  1.69%  runtime.greyobject</span><br><span class="line">     0.02s 0.075% 97.51%     24.96s 94.01%  main.main.func1</span><br><span class="line">     0.01s 0.038% 97.55%     23.91s 90.06%  os.(*File).Write</span><br><span class="line">     0.01s 0.038% 97.59%      0.19s  0.72%  runtime.mallocgc</span><br><span class="line">     0.01s 0.038% 97.63%     23.30s 87.76%  syscall.Write</span><br></pre></td></tr></table></figure>

<ul>
<li><p>flatï¼šç»™å®šå‡½æ•°ä¸Šè¿è¡Œè€—æ—¶</p>
</li>
<li><p>flat%ï¼šåŒä¸Šçš„ CPU è¿è¡Œè€—æ—¶æ€»æ¯”ä¾‹</p>
</li>
<li><p>sum%ï¼šç»™å®šå‡½æ•°ç´¯ç§¯ä½¿ç”¨ CPU æ€»æ¯”ä¾‹</p>
</li>
<li><p>cumï¼šå½“å‰å‡½æ•°åŠ ä¸Šå®ƒä¹‹ä¸Šçš„è°ƒç”¨è¿è¡Œæ€»è€—æ—¶</p>
</li>
<li><p>cum%ï¼šåŒä¸Šçš„ CPU è¿è¡Œè€—æ—¶æ€»æ¯”ä¾‹<br>æœ€åä¸€åˆ—ä¸ºå‡½æ•°åç§°ï¼Œåœ¨å¤§å¤šæ•°çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™äº”åˆ—å¾—å‡ºä¸€ä¸ªåº”ç”¨ç¨‹åºçš„è¿è¡Œæƒ…å†µï¼ŒåŠ ä»¥ä¼˜åŒ– ğŸ¤”<br>ï¼ˆ2ï¼‰<code>go tool pprof [http://localhost](http://localhost/):6060/debug/pprof/heap</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ go tool pprof http://localhost:6060/debug/pprof/heap</span><br><span class="line">Fetching profile over HTTP from http://localhost:6060/debug/pprof/heap</span><br><span class="line">Saved profile in /Users/eddycjy/pprof/pprof.alloc_objects.alloc_space.inuse_objects.inuse_space.008.pb.gz</span><br><span class="line">Type: inuse_space</span><br><span class="line">Entering interactive mode (type &quot;help&quot; for commands, &quot;o&quot; for options)</span><br><span class="line">(pprof) top</span><br><span class="line">Showing nodes accounting for 837.48MB, 100% of 837.48MB total</span><br><span class="line">      flat  flat%   sum%        cum   cum%</span><br><span class="line">  837.48MB   100%   100%   837.48MB   100%  main.main.func1</span><br></pre></td></tr></table></figure>
</li>
<li><p>-inuse_spaceï¼šåˆ†æåº”ç”¨ç¨‹åºçš„å¸¸é©»å†…å­˜å ç”¨æƒ…å†µ</p>
</li>
<li><p>-alloc_objectsï¼šåˆ†æåº”ç”¨ç¨‹åºçš„å†…å­˜ä¸´æ—¶åˆ†é…æƒ…å†µ<br>ï¼ˆ3ï¼‰ go tool pprof <a href="http://localhost/">http://localhost</a>:6060&#x2F;debug&#x2F;pprof&#x2F;block<br>ï¼ˆ4ï¼‰ go tool pprof <a href="http://localhost/">http://localhost</a>:6060&#x2F;debug&#x2F;pprof&#x2F;mutex</p>
</li>
</ul>
<h4 id="ä¸‰ã€PProf-å¯è§†åŒ–ç•Œé¢"><a href="#ä¸‰ã€PProf-å¯è§†åŒ–ç•Œé¢" class="headerlink" title="ä¸‰ã€PProf å¯è§†åŒ–ç•Œé¢"></a>ä¸‰ã€PProf å¯è§†åŒ–ç•Œé¢</h4><p>è¿™æ˜¯ä»¤äººæœŸå¾…çš„ä¸€å°èŠ‚ã€‚åœ¨è¿™ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ç®€å•çš„ç¼–å†™å¥½æµ‹è¯•ç”¨ä¾‹æ¥è·‘ä¸€ä¸‹</p>
<h5 id="ç¼–å†™æµ‹è¯•ç”¨ä¾‹"><a href="#ç¼–å†™æµ‹è¯•ç”¨ä¾‹" class="headerlink" title="ç¼–å†™æµ‹è¯•ç”¨ä¾‹"></a>ç¼–å†™æµ‹è¯•ç”¨ä¾‹</h5><p>ï¼ˆ1ï¼‰æ–°å»º data&#x2F;d_test.goï¼Œæ–‡ä»¶å†…å®¹ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> data</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;testing&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> url = <span class="string">&quot;https://github.com/EDDYCJY&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestAdd</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">    s := Add(url)</span><br><span class="line">    <span class="keyword">if</span> s == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">        t.Errorf(<span class="string">&quot;Test.Add error!&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkAdd</span><span class="params">(b *testing.B)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; b.N; i++ &#123;</span><br><span class="line">        Add(url)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ï¼ˆ2ï¼‰æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">go <span class="built_in">test</span> -bench=. -cpuprofile=cpu.prof</span></span><br><span class="line">pkg: github.com/EDDYCJY/go-pprof-example/data</span><br><span class="line">BenchmarkAdd-4       10000000           187 ns/op</span><br><span class="line">PASS</span><br><span class="line">ok      github.com/EDDYCJY/go-pprof-example/data    2.300s</span><br></pre></td></tr></table></figure>

<p>-memprofile ä¹Ÿå¯ä»¥äº†è§£ä¸€ä¸‹</p>
<h5 id="å¯åŠ¨-pprof-å¯è§†åŒ–ç•Œé¢"><a href="#å¯åŠ¨-pprof-å¯è§†åŒ–ç•Œé¢" class="headerlink" title="å¯åŠ¨ pprof å¯è§†åŒ–ç•Œé¢"></a>å¯åŠ¨ pprof å¯è§†åŒ–ç•Œé¢</h5><p>æ–¹æ³•ä¸€ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">go tool pprof -http=:8080 cpu.prof</span></span><br></pre></td></tr></table></figure>
<p>æ–¹æ³•äºŒï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">go tool pprof cpu.prof</span> </span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">(pprof) web</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœå‡ºç° <code>Could not execute dot; may need to install graphviz.</code>ï¼Œå°±æ˜¯æç¤ºä½ è¦å®‰è£… <code>graphviz</code> äº† ï¼ˆè¯·å³æ‹è°·æ­Œï¼‰</p>
<h5 id="æŸ¥çœ‹-PProf-å¯è§†åŒ–ç•Œé¢"><a href="#æŸ¥çœ‹-PProf-å¯è§†åŒ–ç•Œé¢" class="headerlink" title="æŸ¥çœ‹ PProf å¯è§†åŒ–ç•Œé¢"></a>æŸ¥çœ‹ PProf å¯è§†åŒ–ç•Œé¢</h5><p>ï¼ˆ1ï¼‰Top</p>
<img src="https://blog-image-1253555052.cos.ap-guangzhou.myqcloud.com/20200316152406.png"/>

<p>ï¼ˆ2ï¼‰Graph<br><img src="https://images.hxzhouh.com/blog-images/2024/02/d0e9e7808e59d9cdcdd22b893d1345d1.png"></p>
<p>æ¡†è¶Šå¤§ï¼Œçº¿è¶Šç²—ä»£è¡¨å®ƒå ç”¨çš„æ—¶é—´è¶Šå¤§å“¦<br>ï¼ˆ3ï¼‰Peek<br><img src="https://images.hxzhouh.com/blog-images/2024/02/0c2680e3f4e27bf49358421a4501c8bc.png"><br>ï¼ˆ4ï¼‰Source<br><img src="https://images.hxzhouh.com/blog-images/2024/02/355adcb3b34bede7aef069f1dbe07656.png"></p>
<p>é€šè¿‡ PProf çš„å¯è§†åŒ–ç•Œé¢ï¼Œæˆ‘ä»¬èƒ½å¤Ÿæ›´æ–¹ä¾¿ã€æ›´ç›´è§‚çš„çœ‹åˆ° Go åº”ç”¨ç¨‹åºçš„è°ƒç”¨é“¾ã€ä½¿ç”¨æƒ…å†µç­‰ï¼Œå¹¶ä¸”åœ¨ View èœå•æ ä¸­ï¼Œè¿˜æ”¯æŒå¦‚ä¸Šå¤šç§æ–¹å¼çš„åˆ‡æ¢<br>ä½ æƒ³æƒ³ï¼Œåœ¨çƒ¦æ¼ä¸çŸ¥é“ä»€ä¹ˆé—®é¢˜çš„æ—¶å€™ï¼Œèƒ½ç”¨è¿™äº›è¾…åŠ©å·¥å…·æ¥æ£€æµ‹é—®é¢˜ï¼Œæ˜¯ä¸æ˜¯ç¬é—´æ•ˆç‡ç¿»å€äº†å‘¢ ğŸ‘Œ</p>
<h4 id="å››ã€PProf-ç«ç„°å›¾"><a href="#å››ã€PProf-ç«ç„°å›¾" class="headerlink" title="å››ã€PProf ç«ç„°å›¾"></a>å››ã€PProf ç«ç„°å›¾</h4><p>å¦ä¸€ç§å¯è§†åŒ–æ•°æ®çš„æ–¹æ³•æ˜¯ç«ç„°å›¾ï¼Œéœ€æ‰‹åŠ¨å®‰è£…åŸç”Ÿ PProf å·¥å…·ï¼š<br>ï¼ˆ1ï¼‰ å®‰è£… PProf</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ go get -u github.com/google/pprof</span><br></pre></td></tr></table></figure>
<p>ï¼ˆ2ï¼‰ å¯åŠ¨ PProf å¯è§†åŒ–ç•Œé¢:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ pprof -http=:8080 cpu.prof</span><br></pre></td></tr></table></figure>
<p>ï¼ˆ3ï¼‰ æŸ¥çœ‹ PProf å¯è§†åŒ–ç•Œé¢<br>æ‰“å¼€ PProf çš„å¯è§†åŒ–ç•Œé¢æ—¶ï¼Œä½ ä¼šæ˜æ˜¾å‘ç°æ¯”å®˜æ–¹å·¥å…·é“¾çš„ PProf ç²¾è‡´ä¸€äº›ï¼Œå¹¶ä¸”å¤šäº† Flame Graphï¼ˆç«ç„°å›¾ï¼‰</p>
<p>å®ƒå°±æ˜¯æœ¬æ¬¡çš„ç›®æ ‡ä¹‹ä¸€ï¼Œå®ƒçš„æœ€å¤§ä¼˜ç‚¹æ˜¯åŠ¨æ€çš„ã€‚è°ƒç”¨é¡ºåºç”±ä¸Šåˆ°ä¸‹ï¼ˆA -&gt; B -&gt; C -&gt; Dï¼‰ï¼Œæ¯ä¸€å—ä»£è¡¨ä¸€ä¸ªå‡½æ•°ï¼Œè¶Šå¤§ä»£è¡¨å ç”¨ CPU çš„æ—¶é—´æ›´é•¿ã€‚åŒæ—¶å®ƒä¹Ÿæ”¯æŒç‚¹å‡»å—æ·±å…¥è¿›è¡Œåˆ†æï¼</p>
<p><img src="https://images.hxzhouh.com/blog-images/2024/02/0534f37a2dddcf7127ce74175ae3b119.png"></p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>åœ¨æœ¬ç« èŠ‚ï¼Œç²—ç•¥åœ°ä»‹ç»äº† Go çš„æ€§èƒ½åˆ©å™¨ PProfã€‚åœ¨ç‰¹å®šçš„åœºæ™¯ä¸­ï¼ŒPProf ç»™å®šä½ã€å‰–æé—®é¢˜å¸¦äº†æå¤§çš„å¸®åŠ©<br>å¸Œæœ›æœ¬æ–‡å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œå¦å¤–å»ºè®®èƒ½å¤Ÿè‡ªå·±å®é™…æ“ä½œä¸€éï¼Œæœ€å¥½æ˜¯å¯ä»¥æ·±å…¥ç¢ç£¨ä¸€ä¸‹ï¼Œå†…å«å¤§é‡çš„ç”¨æ³•ã€çŸ¥è¯†ç‚¹</p>
<h2 id="æ€è€ƒé¢˜"><a href="#æ€è€ƒé¢˜" class="headerlink" title="æ€è€ƒé¢˜"></a>æ€è€ƒé¢˜</h2><p>ä½ å¾ˆä¼˜ç§€çš„çœ‹åˆ°äº†æœ€åï¼Œé‚£ä¹ˆæœ‰ä¸¤é“ç®€å•çš„æ€è€ƒé¢˜ï¼Œå¸Œæœ›æ‹“å±•ä½ çš„æ€è·¯<br>ï¼ˆ1ï¼‰flat ä¸€å®šå¤§äº cum å—ï¼Œä¸ºä»€ä¹ˆï¼Ÿä»€ä¹ˆåœºæ™¯ä¸‹ cum ä¼šæ¯” flat å¤§ï¼Ÿ<br>ï¼ˆ2ï¼‰æœ¬ç« èŠ‚çš„ demo ä»£ç ï¼Œæœ‰ä»€ä¹ˆæ€§èƒ½é—®é¢˜ï¼Ÿæ€ä¹ˆè§£å†³å®ƒï¼Ÿ<br>æ¥ï¼Œæ™’å‡ºä½ çš„æƒ³æ³•</p>
]]></content>
      <categories>
        <category>go</category>
      </categories>
      <tags>
        <tag>Go</tag>
        <tag>æœ€ä½³å®è·µ</tag>
        <tag>pprof</tag>
      </tags>
  </entry>
  <entry>
    <title>Golang é€šè¿‡ Consul å®ç°åˆ†å¸ƒå¼é”</title>
    <url>/2020/03/24/Golang%20%E9%80%9A%E8%BF%87%20Consul%20%E5%AE%9E%E7%8E%B0%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/</url>
    <content><![CDATA[<h1 id="Consul-æ˜¯ä»€ä¹ˆ"><a href="#Consul-æ˜¯ä»€ä¹ˆ" class="headerlink" title="Consul æ˜¯ä»€ä¹ˆ"></a>Consul æ˜¯ä»€ä¹ˆ</h1><p>Consul æ˜¯ä¸€ä¸ªæ”¯æŒå¤šæ•°æ®ä¸­å¿ƒåˆ†å¸ƒå¼é«˜å¯ç”¨çš„æœåŠ¡å‘ç°å’Œé…ç½®å…±äº«çš„æœåŠ¡è½¯ä»¶,ç”± HashiCorp å…¬å¸ç”¨ Go è¯­è¨€å¼€å‘, åŸºäº Mozilla Public License 2.0 çš„åè®®è¿›è¡Œå¼€æº. Consul æ”¯æŒå¥åº·æ£€æŸ¥,å¹¶å…è®¸ HTTP å’Œ DNS åè®®è°ƒç”¨ API å­˜å‚¨é”®å€¼å¯¹.<br>å‘½ä»¤è¡Œè¶…çº§å¥½ç”¨çš„è™šæ‹Ÿæœºç®¡ç†è½¯ä»¶ vgrant ä¹Ÿæ˜¯ HashiCorp å…¬å¸å¼€å‘çš„äº§å“.<br>ä¸€è‡´æ€§åè®®é‡‡ç”¨ Raft ç®—æ³•,ç”¨æ¥ä¿è¯æœåŠ¡çš„é«˜å¯ç”¨. ä½¿ç”¨ GOSSIP åè®®ç®¡ç†æˆå‘˜å’Œå¹¿æ’­æ¶ˆæ¯, å¹¶ä¸”æ”¯æŒ ACL è®¿é—®æ§åˆ¶.</p>
<h1 id="Consul-çš„ä½¿ç”¨åœºæ™¯"><a href="#Consul-çš„ä½¿ç”¨åœºæ™¯" class="headerlink" title="Consul çš„ä½¿ç”¨åœºæ™¯"></a>Consul çš„ä½¿ç”¨åœºæ™¯</h1><ul>
<li>docker å®ä¾‹çš„æ³¨å†Œä¸é…ç½®å…±äº«</li>
<li>coreos å®ä¾‹çš„æ³¨å†Œä¸é…ç½®å…±äº«</li>
<li>vitess é›†ç¾¤</li>
<li>SaaS åº”ç”¨çš„é…ç½®å…±äº«</li>
<li>ä¸ confd æœåŠ¡é›†æˆï¼ŒåŠ¨æ€ç”Ÿæˆ nginx å’Œ haproxy é…ç½®æ–‡ä»¶</li>
</ul>
<h1 id="Consul-çš„ä¼˜åŠ¿"><a href="#Consul-çš„ä¼˜åŠ¿" class="headerlink" title="Consul çš„ä¼˜åŠ¿"></a>Consul çš„ä¼˜åŠ¿</h1><ul>
<li>ä½¿ç”¨ Raft ç®—æ³•æ¥ä¿è¯ä¸€è‡´æ€§, æ¯”å¤æ‚çš„ Paxos ç®—æ³•æ›´ç›´æ¥. ç›¸æ¯”è¾ƒè€Œè¨€, zookeeper é‡‡ç”¨çš„æ˜¯ Paxos, è€Œ etcd ä½¿ç”¨çš„åˆ™æ˜¯ Raft.</li>
<li>æ”¯æŒå¤šæ•°æ®ä¸­å¿ƒï¼Œå†…å¤–ç½‘çš„æœåŠ¡é‡‡ç”¨ä¸åŒçš„ç«¯å£è¿›è¡Œç›‘å¬ã€‚ å¤šæ•°æ®ä¸­å¿ƒé›†ç¾¤å¯ä»¥é¿å…å•æ•°æ®ä¸­å¿ƒçš„å•ç‚¹æ•…éšœ,è€Œå…¶éƒ¨ç½²åˆ™éœ€è¦è€ƒè™‘ç½‘ç»œå»¶è¿Ÿ, åˆ†ç‰‡ç­‰æƒ…å†µç­‰. zookeeper å’Œ etcd å‡ä¸æä¾›å¤šæ•°æ®ä¸­å¿ƒåŠŸèƒ½çš„æ”¯æŒ.</li>
<li>æ”¯æŒå¥åº·æ£€æŸ¥. etcd ä¸æä¾›æ­¤åŠŸèƒ½.</li>
<li>æ”¯æŒ http å’Œ dns åè®®æ¥å£. zookeeper çš„é›†æˆè¾ƒä¸ºå¤æ‚, etcd åªæ”¯æŒ http åè®®.</li>
<li>å®˜æ–¹æä¾›webç®¡ç†ç•Œé¢, etcd æ— æ­¤åŠŸèƒ½.<br>ç»¼åˆæ¯”è¾ƒ, Consul ä½œä¸ºæœåŠ¡æ³¨å†Œå’Œé…ç½®ç®¡ç†çš„æ–°æ˜Ÿ, æ¯”è¾ƒå€¼å¾—å…³æ³¨å’Œç ”ç©¶.</li>
</ul>
<h1 id="Consul-çš„è§’è‰²"><a href="#Consul-çš„è§’è‰²" class="headerlink" title="Consul çš„è§’è‰²"></a>Consul çš„è§’è‰²</h1><p>client: å®¢æˆ·ç«¯, æ— çŠ¶æ€, å°† HTTP å’Œ DNS æ¥å£è¯·æ±‚è½¬å‘ç»™å±€åŸŸç½‘å†…çš„æœåŠ¡ç«¯é›†ç¾¤.<br>server: æœåŠ¡ç«¯, ä¿å­˜é…ç½®ä¿¡æ¯, é«˜å¯ç”¨é›†ç¾¤, åœ¨å±€åŸŸç½‘å†…ä¸æœ¬åœ°å®¢æˆ·ç«¯é€šè®¯, é€šè¿‡å¹¿åŸŸç½‘ä¸å…¶ä»–æ•°æ®ä¸­å¿ƒé€šè®¯. æ¯ä¸ªæ•°æ®ä¸­å¿ƒçš„ server æ•°é‡æ¨èä¸º 3 ä¸ªæˆ–æ˜¯ 5 ä¸ª.</p>
<h1 id="ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼é”"><a href="#ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼é”" class="headerlink" title="ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼é”"></a>ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼é”</h1><p><strong>åˆ†å¸ƒå¼é”</strong>ï¼Œæ˜¯æ§åˆ¶<a href="https://zh.wikipedia.org/w/index.php?title=%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F&action=edit&redlink=1" title="åˆ†å¸ƒå¼ç³»ç»Ÿï¼ˆé¡µé¢ä¸å­˜åœ¨ï¼‰">åˆ†å¸ƒå¼ç³»ç»Ÿ</a>ä¹‹é—´åŒæ­¥è®¿é—®å…±äº«<a href="https://zh.wikipedia.org/wiki/%E8%B5%84%E6%BA%90" title="èµ„æº">èµ„æº</a>çš„ä¸€ç§æ–¹å¼ã€‚åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¸¸å¸¸éœ€è¦åè°ƒä»–ä»¬çš„åŠ¨ä½œã€‚å¦‚æœä¸åŒçš„ç³»ç»Ÿæˆ–æ˜¯åŒä¸€ä¸ªç³»ç»Ÿçš„ä¸åŒä¸»æœºä¹‹é—´å…±äº«äº†ä¸€ä¸ªæˆ–ä¸€ç»„èµ„æºï¼Œé‚£ä¹ˆè®¿é—®è¿™äº›èµ„æºçš„æ—¶å€™ï¼Œå¾€å¾€éœ€è¦<a href="https://zh.wikipedia.org/wiki/%E4%BA%92%E6%96%A5" title="äº’æ–¥">äº’æ–¥</a>æ¥é˜²æ­¢å½¼æ­¤å¹²æ‰°æ¥ä¿è¯ä¸€è‡´æ€§ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¾¿éœ€è¦ä½¿ç”¨åˆ°åˆ†å¸ƒå¼é”ã€‚<br>ç›®å‰å‡ ä¹å¾ˆå¤šå¤§å‹ç½‘ç«™åŠåº”ç”¨éƒ½æ˜¯åˆ†å¸ƒå¼éƒ¨ç½²çš„ï¼Œåˆ†å¸ƒå¼åœºæ™¯ä¸­çš„æ•°æ®ä¸€è‡´æ€§é—®é¢˜ä¸€ç›´æ˜¯ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„è¯é¢˜ã€‚åˆ†å¸ƒå¼çš„CAPç†è®ºå‘Šè¯‰æˆ‘ä»¬â€œä»»ä½•ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿéƒ½æ— æ³•åŒæ—¶æ»¡è¶³ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ã€å¯ç”¨æ€§ï¼ˆAvailabilityï¼‰å’Œåˆ†åŒºå®¹é”™æ€§ï¼ˆPartition toleranceï¼‰ï¼Œæœ€å¤šåªèƒ½åŒæ—¶æ»¡è¶³ä¸¤é¡¹ã€‚â€æ‰€ä»¥ï¼Œå¾ˆå¤šç³»ç»Ÿåœ¨è®¾è®¡ä¹‹åˆå°±è¦å¯¹è¿™ä¸‰è€…åšå‡ºå–èˆã€‚åœ¨äº’è”ç½‘é¢†åŸŸçš„ç»å¤§å¤šæ•°çš„åœºæ™¯ä¸­ï¼Œéƒ½éœ€è¦ç‰ºç‰²å¼ºä¸€è‡´æ€§æ¥æ¢å–ç³»ç»Ÿçš„é«˜å¯ç”¨æ€§ï¼Œç³»ç»Ÿå¾€å¾€åªéœ€è¦ä¿è¯â€œæœ€ç»ˆä¸€è‡´æ€§â€ï¼Œåªè¦è¿™ä¸ªæœ€ç»ˆæ—¶é—´æ˜¯åœ¨ç”¨æˆ·å¯ä»¥æ¥å—çš„èŒƒå›´å†…å³å¯ã€‚<br>åœ¨å¾ˆå¤šåœºæ™¯ä¸­ï¼Œæˆ‘ä»¬ä¸ºäº†ä¿è¯æ•°æ®çš„æœ€ç»ˆä¸€è‡´æ€§ï¼Œéœ€è¦å¾ˆå¤šçš„æŠ€æœ¯æ–¹æ¡ˆæ¥æ”¯æŒï¼Œæ¯”å¦‚åˆ†å¸ƒå¼äº‹åŠ¡ã€åˆ†å¸ƒå¼é”ç­‰ã€‚æœ‰çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦ä¿è¯ä¸€ä¸ªæ–¹æ³•åœ¨åŒä¸€æ—¶é—´å†…åªèƒ½è¢«åŒä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œã€‚<br>åœ¨è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨Consulæ¥ç®¡ç†åˆ†å¸ƒå¼é”ã€‚Consulå†…ç½®äº†æœåŠ¡æ³¨å†Œä¸å‘ç°æ¡† æ¶ã€åˆ†å¸ƒä¸€è‡´æ€§åè®®å®ç°ã€å¥åº·æ£€æŸ¥ã€Key&#x2F;Valueå­˜å‚¨ã€å¤šæ•°æ®ä¸­å¿ƒæ–¹æ¡ˆï¼Œä¸å†éœ€è¦ä¾èµ–å…¶ä»–å·¥å…·ï¼ˆæ¯”å¦‚<a href="http://tonybai.com/tag/zookeeper">ZooKeeper</a>ç­‰ï¼‰ã€‚</p>
<h3 id="Sessions"><a href="#Sessions" class="headerlink" title="Sessions"></a>Sessions</h3><p><a href="https://o6rr5e4by.qnssl.com/wp-content/uploads/2017/01/consul-sessions-56bc7006.png"></a><br>sessionæ˜¯ä¸€ä¸ªè¿œç¨‹è¿›ç¨‹å’ŒconsulèŠ‚ç‚¹ä¹‹é—´çš„é“¾æ¥ï¼Œå®ƒç”±ä¸€ä¸ªè¿œç¨‹è¿›ç¨‹å’Œå¯ä»¥æ˜¾å¼æ— æ•ˆæˆ–ç”±äºå¥åº·æ£€æŸ¥æœºåˆ¶ã€‚æ ¹æ®ä¼šè¯é…ç½®ï¼Œåˆ›å»ºä¸å·²å¤±æ•ˆä¼šè¯é”æ‘§æ¯æˆ–é‡Šæ”¾ã€‚</p>
<h4 id="Health-checks"><a href="#Health-checks" class="headerlink" title="Health checks"></a>Health checks</h4><p>Consulæ”¯æŒå¤šç§æ£€æŸ¥ ï¼ˆå¦‚ HTTPã€ TCP ç­‰ï¼‰ã€‚åœ¨sessionåˆ›å»ºè¿‡ç¨‹ä¸­å¯ä»¥å®šä¹‰çš„å¥åº·æ£€æŸ¥åˆ—è¡¨ã€‚è¿™äº›æ£€æŸ¥å°†ç”¨äºç¡®å®šæ˜¯å¦sessioéœ€è¦ä½¿ä¹‹å¤±æ•ˆã€‚</p>
<h4 id="TTL"><a href="#TTL" class="headerlink" title="TTL"></a>TTL</h4><p>é™¤äº†å¥åº·æ£€æŸ¥ï¼Œä¼šè¯ä¹Ÿå…·æœ‰å†…ç½®æ”¯æŒçš„ TTLã€‚å½“ TTL è¿‡æœŸsessionè¢«è§†ä¸ºæ— æ•ˆã€‚è¿œç¨‹è¿›ç¨‹è´Ÿè´£æ›´æ–°sessionä¹‹å‰ TTL è¿‡æœŸã€‚</p>
<h3 id="Golang-API"><a href="#Golang-API" class="headerlink" title="Golang API"></a>Golang API</h3><p><a href="https://godoc.org/github.com/hashicorp/consul/api">Consul API client</a> æä¾›ä¸€ä¸ªæ–¹ä¾¿çš„æŠ½è±¡ï¼Œsessionå’Œ K&#x2F;V å­˜å‚¨ã€‚æœ‰æ˜¯ä¸€ä¸ªé”ç»“æ„ä¸é”å®šã€ è§£é”å’Œç ´åçš„æ–¹æ³•ã€‚ä¹Ÿæœ‰ç”¨äºå¸®åŠ©åˆ›å»ºé”å®ä¾‹æ–¹æ³•ã€‚API å®¢æˆ·ç«¯è¿˜è´Ÿè´£æ›´æ–°ä¼šè¯ã€‚</p>
<h4 id="Creating-the-Consul-client"><a href="#Creating-the-Consul-client" class="headerlink" title="Creating the Consul client"></a>Creating the Consul client</h4><figure class="highlight golang"><table><tr><td class="code"><pre><span class="line">client, err := api.NewClient(&amp;api.Config&#123;Address: <span class="string">&quot;127.0.0.1:8500&quot;</span>&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="Creating-Lock-instance"><a href="#Creating-Lock-instance" class="headerlink" title="Creating Lock instance"></a>Creating Lock instance</h4><figure class="highlight golang"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> LockOptions <span class="keyword">struct</span> &#123;</span><br><span class="line">    Key <span class="type">string</span> <span class="comment">// Must be set and have write permissions</span></span><br><span class="line">    Value []<span class="type">byte</span> <span class="comment">// Optional, value to associate with the lock</span></span><br><span class="line">    Session <span class="type">string</span> <span class="comment">// Optional, created if not specified</span></span><br><span class="line">    SessionOpts *SessionEntry <span class="comment">// Optional, options to use when creating a session</span></span><br><span class="line">    SessionName <span class="type">string</span> <span class="comment">// Optional, defaults to DefaultLockSessionName (ignored if SessionOpts is given)</span></span><br><span class="line">    SessionTTL <span class="type">string</span> <span class="comment">// Optional, defaults to DefaultLockSessionTTL (ignored if SessionOpts is given)</span></span><br><span class="line">    MonitorRetries <span class="type">int</span> <span class="comment">// Optional, defaults to 0 which means no retries</span></span><br><span class="line">    MonitorRetryTime time.Duration <span class="comment">// Optional, defaults to DefaultMonitorRetryTime</span></span><br><span class="line">    LockWaitTime time.Duration <span class="comment">// Optional, defaults to DefaultLockWaitTime</span></span><br><span class="line">    LockTryOnce <span class="type">bool</span> <span class="comment">// Optional, defaults to false which means try forever</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>LockOptions æ˜¯æ‰€æœ‰å¯èƒ½çš„é€‰é¡¹çš„å®¹å™¨ï¼Œå¯ä»¥ç”¨äºè®¾ç½®é”®å’Œå€¼ã€ å®šåˆ¶ä¼šè¯æˆ–è®¾ç½®TTLã€‚</p>
<figure class="highlight golang"><table><tr><td class="code"><pre><span class="line">opts := &amp;api.LockOptions&#123;</span><br><span class="line">    Key: <span class="string">&quot;webhook_receiver/1&quot;</span>,</span><br><span class="line">    Value: []<span class="type">byte</span>(<span class="string">&quot;set by sender 1&quot;</span>),</span><br><span class="line">    SessionTTL: <span class="string">&quot;10s&quot;</span>,</span><br><span class="line">    SessionOpts: &amp;api.SessionEntry&#123;</span><br><span class="line">    Checks: []<span class="type">string</span>&#123;<span class="string">&quot;check1&quot;</span>, <span class="string">&quot;check2&quot;</span>&#125;,</span><br><span class="line">    Behavior: <span class="string">&quot;release&quot;</span>,</span><br><span class="line">&#125;,</span><br><span class="line">&#125;</span><br><span class="line">lock, err := client.LockOpts(opts)</span><br></pre></td></tr></table></figure>
<p>å¦ä¸€ç§å¸¸ç”¨çš„æ–¹æ³•æ˜¯ LockKeyï¼Œå®ƒåˆ›å»ºä¸€ä¸ªé”ä¸æ‰€æœ‰é€‰é¡¹è®¾ç½®ä¸ºé»˜è®¤æ¡ç›®åç§°é™¤å¤–ã€‚</p>
<figure class="highlight golang"><table><tr><td class="code"><pre><span class="line">lock, err := client.LockKey(<span class="string">&quot;webhook_receiver/1&quot;</span>)</span><br></pre></td></tr></table></figure>
<h4 id="Acquiring-lock"><a href="#Acquiring-lock" class="headerlink" title="Acquiring lock"></a>Acquiring lock</h4><figure class="highlight golang"><table><tr><td class="code"><pre><span class="line">stopCh := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;)</span><br><span class="line">lockCh, err := lock.Lock(stopCh)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="built_in">panic</span>(err)</span><br><span class="line">&#125;</span><br><span class="line">cancelCtx, cancelRequest := context.WithCancel(context.Background())</span><br><span class="line">req, _ := http.NewRequest(<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;https://example.com/webhook&quot;</span>, <span class="literal">nil</span>)</span><br><span class="line">req = req.WithContext(cancelCtx)</span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">http.DefaultClient.Do(req)</span><br><span class="line"><span class="keyword">select</span> &#123;</span><br><span class="line"><span class="keyword">case</span> &lt;-cancelCtx.Done():</span><br><span class="line">log.Println(<span class="string">&quot;request cancelled&quot;</span>)</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">log.Println(<span class="string">&quot;request done&quot;</span>)</span><br><span class="line">err = lock.Unlock()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Println(<span class="string">&quot;lock already unlocked&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;()</span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">&lt;-lockCh</span><br><span class="line">cancelRequest()</span><br><span class="line">&#125;()</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>go</category>
      </categories>
      <tags>
        <tag>Go</tag>
        <tag>æœ€ä½³å®è·µ</tag>
      </tags>
  </entry>
  <entry>
    <title>Obsidian æœ€ä½³å®è·µ -æŒç»­æ›´æ–°</title>
    <url>/2023/09/24/Obsidian%20%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/</url>
    <content><![CDATA[<h1 id="Obsidian-æœ€ä½³å®è·µ"><a href="#Obsidian-æœ€ä½³å®è·µ" class="headerlink" title="Obsidian æœ€ä½³å®è·µ"></a>Obsidian æœ€ä½³å®è·µ</h1><p>#obsidian</p>
<h1 id="æˆ‘ç”¨Obsidian-æ¥åšä»€ä¹ˆï¼Ÿ"><a href="#æˆ‘ç”¨Obsidian-æ¥åšä»€ä¹ˆï¼Ÿ" class="headerlink" title="æˆ‘ç”¨Obsidian æ¥åšä»€ä¹ˆï¼Ÿ"></a>æˆ‘ç”¨Obsidian æ¥åšä»€ä¹ˆï¼Ÿ</h1><h2 id="å†™åšå®¢"><a href="#å†™åšå®¢" class="headerlink" title="å†™åšå®¢"></a>å†™åšå®¢</h2><p>æˆ‘çš„<a href="https://blog.hxzhouh.com/">blog</a> æ˜¯ç”¨Hugo ç¼–è¯‘ï¼Œ æ‰˜ç®¡åœ¨Cloudflare ä¸Šé¢çš„ï¼Œå…·ä½“æ‰˜ç®¡æ•™ç¨‹è¯·å‚è€ƒï¼š<a href="https://developers.cloudflare.com/pages/framework-guides/deploy-a-hugo-site/">Deploy a Hugo site</a> obsidianå†ä¸­é—´çš„ä½œç”¨å°±æ˜¯ ç®¡ç†æ–‡ç« äº†ã€‚æˆ‘ç”¨è½¯é“¾æ¥å°† hugo ç›®å½•é‡Œé¢çš„content è¿æ¥åˆ° obsidian çš„ç›®å½•ï¼Œç„¶åé…åˆ æ’ä»¶ QuickAdd &amp; Template æ’ä»¶ï¼Œå¾ˆæ–¹ä¾¿çš„å°±æ·»åŠ ä¸€ç¯‡æ–°çš„åšå®¢ã€‚<br>å†™å®Œåšå®¢åï¼Œç”¨Raycast è§¦å‘ä¸€ä¸‹pushï¼ˆè„šæœ¬ï¼‰ï¼Œè¿™æ ·å°±æå®šäº†ã€‚ã€‚</p>
<h2 id="æ—¥è®°"><a href="#æ—¥è®°" class="headerlink" title="æ—¥è®°"></a>æ—¥è®°</h2><p>é…åˆ å®˜æ–¹æ’ä»¶ + template </p>
<h2 id="ä½¿ç”¨ç®€æ‚¦è®°å½•ç½‘ç»œå†…å®¹"><a href="#ä½¿ç”¨ç®€æ‚¦è®°å½•ç½‘ç»œå†…å®¹" class="headerlink" title="ä½¿ç”¨ç®€æ‚¦è®°å½•ç½‘ç»œå†…å®¹"></a>ä½¿ç”¨ç®€æ‚¦è®°å½•ç½‘ç»œå†…å®¹</h2><h2 id="æœ¬åœ°æ—¥è®°æœ¬ã€‚"><a href="#æœ¬åœ°æ—¥è®°æœ¬ã€‚" class="headerlink" title="æœ¬åœ°æ—¥è®°æœ¬ã€‚"></a>æœ¬åœ°æ—¥è®°æœ¬ã€‚</h2><p><a href="https://github.com/Kenshin/simpread/discussions/3807">https://github.com/Kenshin/simpread/discussions/3807</a></p>
<h1 id="ä¸€äº›å°æŠ€å·§"><a href="#ä¸€äº›å°æŠ€å·§" class="headerlink" title="ä¸€äº›å°æŠ€å·§"></a>ä¸€äº›å°æŠ€å·§</h1><ul>
<li>åœ¨Preferences ä¸­ é€‰æ‹©ç¼–è¾‘å™¨ï¼Œå¯ä»¥ å…³é—­æ˜¾ç¤º æ–‡æ¡£çš„å±æ€§ã€‚</li>
<li>å¿…é¡»å…ˆè®¾ç½®å¥½æ—¶é—´æ ¼å¼ ,æˆ‘ç»Ÿä¸€ä½¿ç”¨çš„æ ¼å¼æ˜¯ YYYY-MM-DD(2023-12-31) ã€YYYY-MM-DD HH:mm:ss (2023-12-31 15:06:59)</li>
</ul>
<h2 id="é™å®šæ ‡ç­¾-æ˜¾ç¤ºå…³é”®å­—æ‰€åœ¨è¡Œ"><a href="#é™å®šæ ‡ç­¾-æ˜¾ç¤ºå…³é”®å­—æ‰€åœ¨è¡Œ" class="headerlink" title="é™å®šæ ‡ç­¾-æ˜¾ç¤ºå…³é”®å­—æ‰€åœ¨è¡Œ"></a>é™å®šæ ‡ç­¾-æ˜¾ç¤ºå…³é”®å­—æ‰€åœ¨è¡Œ</h2><p><a href="https://coffeetea.top/zh/dataview-snippets/Dvjs-QueryTags-inlineKeywords.html">https://coffeetea.top/zh/dataview-snippets/Dvjs-QueryTags-inlineKeywords.html</a><br>ç”¨å°†æ‰€æœ‰å…³é”®å­—çš„ç¬”è®°æ”¶é›†åˆ°ä¸€ä¸ªé¡µé¢ã€‚ emm æˆ‘ä¹Ÿä¸çŸ¥é“æœ‰å•¥ç”¨ã€‚</p>
<h2 id="ç‰¹å®šæ–‡ä»¶å¤¹è‡ªåŠ¨ä½¿ç”¨æŸä¸ªæ¨¡æ¿ã€‚"><a href="#ç‰¹å®šæ–‡ä»¶å¤¹è‡ªåŠ¨ä½¿ç”¨æŸä¸ªæ¨¡æ¿ã€‚" class="headerlink" title="ç‰¹å®šæ–‡ä»¶å¤¹è‡ªåŠ¨ä½¿ç”¨æŸä¸ªæ¨¡æ¿ã€‚"></a>ç‰¹å®šæ–‡ä»¶å¤¹è‡ªåŠ¨ä½¿ç”¨æŸä¸ªæ¨¡æ¿ã€‚</h2><h1 id="æ­£åœ¨ä½¿ç”¨çš„æ’ä»¶"><a href="#æ­£åœ¨ä½¿ç”¨çš„æ’ä»¶" class="headerlink" title="æ­£åœ¨ä½¿ç”¨çš„æ’ä»¶"></a>æ­£åœ¨ä½¿ç”¨çš„æ’ä»¶</h1><ul>
<li><a href="https://github.com/argenos/nldates-obsidian">Natural Language Dates</a> æ–¹ä¾¿çš„è¾“å…¥æ—¶é—´ï¼Œå…·ä½“è¯·å‚è€ƒ GitHubä¸»é¡µï¼Œåé¢ä¸€äº›è‡ªåŠ¨åŒ–åŠŸèƒ½éƒ½æ˜¯åŸºäº <a href="https://github.com/argenos/nldates-obsidian">Natural Language Dates</a> å®ç°</li>
<li><a href="https://github.com/platers/obsidian-linter">Linter</a>ï¼šä¸€ä¸ªè‡ªåŠ¨æ ¼å¼åŒ–å·¥å…·ï¼Œå¯ä»¥å®ç°è¯¸å¦‚è‡ªåŠ¨æ·»åŠ åˆ›å»ºæ—¶é—´ ã€æ›´æ–°æ—¶é—´åˆ°metadataï¼Œè‡ªåŠ¨çº é”™ç­‰åŠŸèƒ½ã€‚å¾ˆå¼ºå¤§ï¼Œä¹Ÿæ¯”è¾ƒå¤æ‚ï¼Œå¯ä»¥å°è¯•äº†è§£ä¸€ä¸‹ã€‚</li>
<li>template æ’ä»¶ </li>
<li><a href="https://github.com/coddingtonbear/obsidian-local-rest-api">Obsidian Local REST API</a>è¯¥æ’ä»¶ä¸º Obsidian æä¾›äº† REST APIï¼Œæ‚¨å¯ä»¥ä¸å…¶ä»–å·¥å…·ä¸­çš„ç¬”è®°è¿›è¡Œäº¤äº’ï¼Œä»¥ä¾¿æ‚¨å¯ä»¥è‡ªåŠ¨åŒ–éœ€è¦è‡ªåŠ¨åŒ–çš„æ“ä½œã€‚ç›®å‰æˆ‘åªç”¨åˆ°äº†<a href="https://github.com/coddingtonbear/obsidian-web">Obsidian Web</a> è¿™ä¸ªæ‹“å±•ï¼Œåé¢æˆ–è®¸ä¼šå†™ä¸€äº›æœ‰æ„æ€çš„ä¸œè¥¿ï¼Œæ´»è¿™ä¸ªè·ŸRaycastè”åŠ¨èµ·æ¥ã€‚ã€‚ éœ€è¦ç¢ç£¨ä¸€ä¸‹ã€‚</li>
</ul>
<h1 id="å­¦ä¹ èµ„æº"><a href="#å­¦ä¹ èµ„æº" class="headerlink" title="å­¦ä¹ èµ„æº"></a>å­¦ä¹ èµ„æº</h1>]]></content>
      <categories>
        <category>éšç¬”</category>
      </categories>
  </entry>
  <entry>
    <title>Go ç¼–ç¨‹æ¨¡å¼ 05 ä¿®é¥°å™¨ï¼ˆDecorationï¼‰</title>
    <url>/2024/03/04/Go%20%E7%BC%96%E7%A8%8B%E6%A8%A1%E5%BC%8F%2005%20%E4%BF%AE%E9%A5%B0%E5%99%A8%EF%BC%88Decoration%EF%BC%89/</url>
    <content><![CDATA[<p>Go æ˜¯ä¸€ç§é™æ€ç±»å‹çš„ç¼–è¯‘è¯­è¨€ï¼Œå®ƒçš„è®¾è®¡ç›®æ ‡æ˜¯ç®€æ´ã€é«˜æ•ˆã€‚è™½ç„¶ Go ä¸æ˜¯ä¸€ç§å®Œå…¨çš„é¢å‘å¯¹è±¡è¯­è¨€ï¼Œä½†æ˜¯æˆ‘ä»¬ä»ç„¶å¯ä»¥ä½¿ç”¨ä¸€äº›è®¾è®¡æ¨¡å¼æ¥æé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚ä»Šå¤©ï¼Œæˆ‘å°†ä»‹ç»ä¸€ç§å¸¸è§çš„è®¾è®¡æ¨¡å¼ï¼šä¿®é¥°å™¨æ¨¡å¼ã€‚</p>
<span id="more"></span>
<h2 id="01-ä»€ä¹ˆæ˜¯ä¿®é¥°å™¨æ¨¡å¼ï¼Ÿ"><a href="#01-ä»€ä¹ˆæ˜¯ä¿®é¥°å™¨æ¨¡å¼ï¼Ÿ" class="headerlink" title="01 ä»€ä¹ˆæ˜¯ä¿®é¥°å™¨æ¨¡å¼ï¼Ÿ"></a>01 ä»€ä¹ˆæ˜¯ä¿®é¥°å™¨æ¨¡å¼ï¼Ÿ</h2><p>ä¿®é¥°å™¨æ¨¡å¼æ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œå®ƒå…è®¸æˆ‘ä»¬åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°æ·»åŠ è¡Œä¸ºåˆ°å¯¹è±¡ä¸Šï¼Œè€Œä¸æ”¹å˜å…¶å®ç°ã€‚è¿™æ˜¯é€šè¿‡åˆ›å»ºä¸€ä¸ªåŒ…è£…å¯¹è±¡æˆ–ä¿®é¥°å™¨æ¥å®ç°çš„ï¼Œè¿™ä¸ªä¿®é¥°å™¨åŒ…å«äº†åŸå§‹å¯¹è±¡ï¼Œå¹¶æä¾›äº†ä¸€ä¸ªå¢å¼ºçš„æ¥å£æ¥æ·»åŠ æ–°çš„è¡Œä¸ºã€‚</p>
<p>åœ¨ Go ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‡½æ•°ä½œä¸ºä¿®é¥°å™¨ï¼Œè¿™æ˜¯å› ä¸º Go æ”¯æŒé«˜é˜¶å‡½æ•°ï¼Œå³å‡½æ•°å¯ä»¥ä½œä¸ºå‚æ•°ä¼ é€’ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºè¿”å›å€¼ã€‚</p>
<h2 id="02-ä¸€ä¸ªä¾‹å­"><a href="#02-ä¸€ä¸ªä¾‹å­" class="headerlink" title="02 ä¸€ä¸ªä¾‹å­"></a>02 ä¸€ä¸ªä¾‹å­</h2><p>ä¸ºäº†æ›´å¥½åœ°ç†è§£ä¿®é¥°å™¨æ¨¡å¼ï¼Œè®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥çœ‹çœ‹å¦‚ä½•åœ¨ Go ä¸­å®ç°å®ƒã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå‡½æ•°ç±»å‹Â <code>Foo</code>Â å’Œä¸€ä¸ªä¿®é¥°å™¨ç±»å‹Â <code>FooDecorator</code>ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Foo <span class="function"><span class="keyword">func</span><span class="params">(<span class="type">string</span>)</span></span> <span class="type">string</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> FooDecorator <span class="function"><span class="keyword">func</span><span class="params">(Foo)</span></span> Foo</span><br></pre></td></tr></table></figure>

<p>ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªä¿®é¥°å™¨ï¼Œå®ƒæ¥å—ä¸€ä¸ªÂ <code>Foo</code>Â ç±»å‹çš„å‡½æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„Â <code>Foo</code>Â å‡½æ•°ï¼Œè¿™ä¸ªæ–°çš„å‡½æ•°åœ¨è°ƒç”¨åŸå§‹å‡½æ•°ä¹‹å‰å’Œä¹‹åæ·»åŠ äº†ä¸€äº›è¡Œä¸ºï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithLog</span><span class="params">(decorated Foo)</span></span> Foo &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(s <span class="type">string</span>)</span></span> <span class="type">string</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;Before calling decorated function&quot;</span>)</span><br><span class="line">        result := decorated(s)</span><br><span class="line">        fmt.Println(<span class="string">&quot;After calling decorated function&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªÂ <code>Foo</code>Â å‡½æ•°ï¼Œå¹¶ä½¿ç”¨ä¿®é¥°å™¨æ¥å¢å¼ºå®ƒï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    foo := <span class="function"><span class="keyword">func</span><span class="params">(s <span class="type">string</span>)</span></span> <span class="type">string</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;Foo function called&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> s</span><br><span class="line">    &#125;</span><br><span class="line">    foo = WithLog(foo)</span><br><span class="line">    foo(<span class="string">&quot;Hello, world!&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªÂ <code>Foo</code>Â å‡½æ•°ï¼Œç„¶åä½¿ç”¨Â <code>WithLog</code>Â ä¿®é¥°å™¨æ¥å¢å¼ºå®ƒã€‚å½“æˆ‘ä»¬è°ƒç”¨å¢å¼ºåçš„å‡½æ•°æ—¶ï¼Œå®ƒä¼šé¦–å…ˆæ‰“å°ä¸€æ¡æ¶ˆæ¯ï¼Œç„¶åè°ƒç”¨åŸå§‹çš„Â <code>Foo</code>Â å‡½æ•°ï¼Œæœ€åå†æ‰“å°ä¸€æ¡æ¶ˆæ¯ã€‚</p>
<p>è¿™å°±æ˜¯ Go ä¸­çš„ä¿®é¥°å™¨æ¨¡å¼ã€‚é€šè¿‡ä½¿ç”¨ä¿®é¥°å™¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸ä¿®æ”¹åŸå§‹å‡½æ•°çš„æƒ…å†µä¸‹ï¼ŒåŠ¨æ€åœ°æ·»åŠ æ–°çš„è¡Œä¸ºã€‚</p>
<h1 id="HTTP-ç›¸å…³çš„ä¸€ä¸ªç¤ºä¾‹"><a href="#HTTP-ç›¸å…³çš„ä¸€ä¸ªç¤ºä¾‹" class="headerlink" title="HTTP ç›¸å…³çš„ä¸€ä¸ªç¤ºä¾‹"></a>HTTP ç›¸å…³çš„ä¸€ä¸ªç¤ºä¾‹</h1><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†çœ‹ä¸€ä¸ªå¤„ç† HTTP è¯·æ±‚çš„ç›¸å…³ä¾‹å­ã€‚å…ˆçœ‹ä¸€ä¸ªç®€å•çš„ HTTP Server çš„ä»£ç ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;log&quot;</span></span><br><span class="line">    <span class="string">&quot;net/http&quot;</span></span><br><span class="line">    <span class="string">&quot;strings&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithServerHeader</span><span class="params">(h http.HandlerFunc)</span></span> http.HandlerFunc &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">        log.Println(<span class="string">&quot;---&gt;WithServerHeader()&quot;</span>)</span><br><span class="line">        w.Header().Set(<span class="string">&quot;Server&quot;</span>, <span class="string">&quot;HelloServer v0.0.1&quot;</span>)</span><br><span class="line">        h(w, r)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hello</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">    log.Printf(<span class="string">&quot;Recieved Request %s from %s\n&quot;</span>, r.URL.Path, r.RemoteAddr)</span><br><span class="line">    fmt.Fprintf(w, <span class="string">&quot;Hello, World! &quot;</span>+r.URL.Path)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    http.HandleFunc(<span class="string">&quot;/v1/hello&quot;</span>, WithServerHeader(hello))</span><br><span class="line">    err := http.ListenAndServe(<span class="string">&quot;:8080&quot;</span>, <span class="literal">nil</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Fatal(<span class="string">&quot;ListenAndServe: &quot;</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ®µä»£ç ä¸­ä½¿ç”¨åˆ°äº†ä¿®é¥°å™¨æ¨¡å¼ï¼ŒWithServerHeader() å‡½æ•°å°±æ˜¯ä¸€ä¸ª Decoratorï¼Œå®ƒä¼šä¼ å…¥ä¸€ä¸ª http.HandlerFuncï¼Œç„¶åè¿”å›ä¸€ä¸ªæ”¹å†™çš„ç‰ˆæœ¬ã€‚è¿™ä¸ªä¾‹å­è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œç”¨ WithServerHeader() å°±å¯ä»¥åŠ å…¥ä¸€ä¸ª Response çš„ Headerã€‚æ‰€ä»¥ï¼Œè¿™æ ·çš„å‡½æ•°æˆ‘ä»¬å¯ä»¥å†™å‡ºå¥½å¤šã€‚å¦‚ä¸‹æ‰€ç¤ºï¼Œæœ‰å†™ HTTP å“åº”å¤´çš„ï¼Œæœ‰å†™è®¤è¯ Cookie çš„ï¼Œæœ‰æ£€æŸ¥è®¤è¯ Cookie çš„ï¼Œæœ‰æ‰“æ—¥å¿—çš„â€¦â€¦</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;log&quot;</span></span><br><span class="line">    <span class="string">&quot;net/http&quot;</span></span><br><span class="line">    <span class="string">&quot;strings&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithServerHeader</span><span class="params">(h http.HandlerFunc)</span></span> http.HandlerFunc &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">        log.Println(<span class="string">&quot;---&gt;WithServerHeader()&quot;</span>)</span><br><span class="line">        w.Header().Set(<span class="string">&quot;Server&quot;</span>, <span class="string">&quot;HelloServer v0.0.1&quot;</span>)</span><br><span class="line">        h(w, r)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithAuthCookie</span><span class="params">(h http.HandlerFunc)</span></span> http.HandlerFunc &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">        log.Println(<span class="string">&quot;---&gt;WithAuthCookie()&quot;</span>)</span><br><span class="line">        cookie := &amp;http.Cookie&#123;Name: <span class="string">&quot;Auth&quot;</span>, Value: <span class="string">&quot;Pass&quot;</span>, Path: <span class="string">&quot;/&quot;</span>&#125;</span><br><span class="line">        http.SetCookie(w, cookie)</span><br><span class="line">        h(w, r)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithBasicAuth</span><span class="params">(h http.HandlerFunc)</span></span> http.HandlerFunc &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">        log.Println(<span class="string">&quot;---&gt;WithBasicAuth()&quot;</span>)</span><br><span class="line">        cookie, err := r.Cookie(<span class="string">&quot;Auth&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> || cookie.Value != <span class="string">&quot;Pass&quot;</span> &#123;</span><br><span class="line">            w.WriteHeader(http.StatusForbidden)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        h(w, r)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithDebugLog</span><span class="params">(h http.HandlerFunc)</span></span> http.HandlerFunc &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">        log.Println(<span class="string">&quot;---&gt;WithDebugLog&quot;</span>)</span><br><span class="line">        r.ParseForm()</span><br><span class="line">        log.Println(r.Form)</span><br><span class="line">        log.Println(<span class="string">&quot;path&quot;</span>, r.URL.Path)</span><br><span class="line">        log.Println(<span class="string">&quot;scheme&quot;</span>, r.URL.Scheme)</span><br><span class="line">        log.Println(r.Form[<span class="string">&quot;url_long&quot;</span>])</span><br><span class="line">        <span class="keyword">for</span> k, v := <span class="keyword">range</span> r.Form &#123;</span><br><span class="line">            log.Println(<span class="string">&quot;key:&quot;</span>, k)</span><br><span class="line">            log.Println(<span class="string">&quot;val:&quot;</span>, strings.Join(v, <span class="string">&quot;&quot;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">        h(w, r)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hello</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">    log.Printf(<span class="string">&quot;Recieved Request %s from %s\n&quot;</span>, r.URL.Path, r.RemoteAddr)</span><br><span class="line">    fmt.Fprintf(w, <span class="string">&quot;Hello, World! &quot;</span>+r.URL.Path)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    http.HandleFunc(<span class="string">&quot;/v1/hello&quot;</span>, WithServerHeader(WithAuthCookie(hello)))</span><br><span class="line">    http.HandleFunc(<span class="string">&quot;/v2/hello&quot;</span>, WithServerHeader(WithBasicAuth(hello)))</span><br><span class="line">    http.HandleFunc(<span class="string">&quot;/v3/hello&quot;</span>, WithServerHeader(WithBasicAuth(WithDebugLog(hello))))</span><br><span class="line">    err := http.ListenAndServe(<span class="string">&quot;:8080&quot;</span>, <span class="literal">nil</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Fatal(<span class="string">&quot;ListenAndServe: &quot;</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å¤šä¸ªä¿®é¥°å™¨çš„-Pipeline"><a href="#å¤šä¸ªä¿®é¥°å™¨çš„-Pipeline" class="headerlink" title="å¤šä¸ªä¿®é¥°å™¨çš„ Pipeline"></a>å¤šä¸ªä¿®é¥°å™¨çš„ Pipeline</h2><p>åœ¨ä½¿ç”¨ä¸Šï¼Œéœ€è¦å¯¹å‡½æ•°ä¸€å±‚å±‚åœ°å¥—èµ·æ¥ï¼Œçœ‹ä¸Šå»å¥½åƒä¸æ˜¯å¾ˆå¥½çœ‹ï¼Œå¦‚æœéœ€è¦ä¿®é¥°å™¨æ¯”è¾ƒå¤šçš„è¯ï¼Œä»£ç å°±ä¼šæ¯”è¾ƒéš¾çœ‹äº†ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬å¯ä»¥é‡æ„ä¸€ä¸‹ã€‚é‡æ„æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå†™ä¸€ä¸ªå·¥å…·å‡½æ•°ï¼Œç”¨æ¥éå†å¹¶è°ƒç”¨å„ä¸ªä¿®é¥°å™¨ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> HttpHandlerDecorator <span class="function"><span class="keyword">func</span><span class="params">(http.HandlerFunc)</span></span> http.HandlerFunc</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Handler</span><span class="params">(h http.HandlerFunc, decors ...HttpHandlerDecorator)</span></span> http.HandlerFunc &#123;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="keyword">range</span> decors &#123;</span><br><span class="line">        d := decors[<span class="built_in">len</span>(decors)<span class="number">-1</span>-i] <span class="comment">// iterate in reverse</span></span><br><span class="line">        h = d(h)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> h</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶åï¼Œæˆ‘ä»¬å°±å¯ä»¥åƒä¸‹é¢è¿™æ ·ä½¿ç”¨äº†ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">http.HandleFunc(<span class="string">&quot;/v4/hello&quot;</span>, Handler(hello,</span><br><span class="line">                WithServerHeader, WithBasicAuth, WithDebugLog))</span><br></pre></td></tr></table></figure>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>å†è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ç”¨ä¸¤ä¸ªä¾‹å­æ¼”ç¤ºäº†ä¿®é¥°å™¨æ¨¡å¼ï¼Œä½†æ˜¯å› ä¸º<code>Go</code>è¯­è¨€ä¸­ä¸æ”¯æŒæ³¨è§£è¿™ä¸ªè¯­æ³•ç³–ï¼Œæ‰€ä»¥ä½¿ç”¨è£…é¥°å™¨è¿˜æ˜¯æœ‰ç‚¹ä¸‘é™‹çš„ï¼Œä¸è¿‡è¿™ä¸ªæ€æƒ³è¿˜æ˜¯æŒºé‡è¦çš„ï¼Œæˆ‘ä»¬æ—¥å¸¸å¼€å‘ä¸­å¯ä»¥å‚è€ƒè¿™ç§æ€æƒ³ï¼Œå†™å‡ºæ›´ä¼˜è´¨çš„ä»£ç æ¥ã€‚</p>
]]></content>
      <categories>
        <category>blog</category>
      </categories>
      <tags>
        <tag>go</tag>
        <tag>ç¼–ç¨‹æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>go è§£å¯† defer çš„ä¼˜é›…é™·é˜±</title>
    <url>/2024/04/02/Go%20%E8%A7%A3%E5%AF%86%EF%BC%9A%20defer%20%E7%9A%84%E4%BC%98%E9%9B%85%E9%99%B7%E9%98%B1/</url>
    <content><![CDATA[<p>åœ¨<a href="https://medium.com/gitconnected/decrypt-go-panic-and-recover-5304d0d436c4">ä¸Šä¸€ç¯‡</a>æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„defer æ¥recover panicï¼Œåœ¨gopherçš„å®é™…å·¥ä½œä¸­ï¼Œdefer å°±åƒä¸€ä¸ªå¿ è¯šå¯é çš„é˜Ÿå‹ä¸€æ ·ï¼Œæ€»æ˜¯å†èƒŒåé»˜é»˜çš„å¸®æˆ‘ä»¬å¤„ç†æ”¶å°¾çš„å·¥ä½œã€‚  æ¯”å¦‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">wg.Add(goroutines)  </span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; goroutines; i++ &#123;  </span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;  </span><br><span class="line">       <span class="keyword">defer</span> wg.Done()  </span><br><span class="line">       <span class="keyword">for</span> j := <span class="number">0</span>; j &lt; count/goroutines; j++ &#123;  </span><br><span class="line">          atomic.AddInt64(&amp;sum, <span class="number">1</span>)  </span><br><span class="line">       &#125;  </span><br><span class="line">    &#125;()  </span><br><span class="line">&#125;  </span><br><span class="line">wg.Wait()</span><br></pre></td></tr></table></figure>
<p>é‡Šæ”¾é”ï¼Œæˆ–è€…å…¶ä»–ä»»ä½•èµ„æºã€‚</p>
<blockquote>
<p>åœ¨Goä¸­ï¼Œåªæœ‰åœ¨å‡½æ•°å’Œæ–¹æ³•å†…éƒ¨æ‰èƒ½ä½¿ç”¨deferï¼›deferå…³é”®å­—åé¢åªèƒ½æ¥å‡½æ•°æˆ–æ–¹æ³•ï¼Œè¿™äº›å‡½æ•°è¢«ç§°ä¸ºdeferredå‡½æ•°ã€‚<br>deferå°†å®ƒä»¬æ³¨å†Œåˆ°å…¶æ‰€åœ¨goroutineç”¨äºå­˜æ”¾deferredå‡½æ•°çš„æ ˆæ•°æ®ç»“æ„ä¸­ï¼Œè¿™äº›deferredå‡½æ•°å°†åœ¨æ‰§è¡Œdeferçš„å‡½æ•°é€€å‡ºå‰è¢«æŒ‰åè¿›å…ˆå‡ºï¼ˆLIFOï¼‰çš„é¡ºåºè°ƒåº¦æ‰§è¡Œ</p>
</blockquote>
<p><img src="https://images.hxzhouh.com/blog-images/2024/02/7ca8d7abc4864e3b4c698edd9144ecf6.png" alt="Pasted image 20240229205228"><br>æ— è®ºæ˜¯æ‰§è¡Œåˆ°å‡½æ•°ä½“å°¾éƒ¨è¿”å›ï¼Œè¿˜æ˜¯åœ¨æŸä¸ªé”™è¯¯å¤„ç†åˆ†æ”¯æ˜¾å¼è°ƒç”¨returnè¿”å›ï¼ŒæŠ‘æˆ–å‡ºç°panicï¼Œå·²ç»å­˜å‚¨åˆ°deferredå‡½æ•°æ ˆä¸­çš„å‡½æ•°éƒ½ä¼šè¢«è°ƒåº¦æ‰§è¡Œã€‚å› æ­¤ï¼Œdeferredå‡½æ•°æ˜¯ä¸€ä¸ªåœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½å¯ä»¥ä¸ºå‡½æ•°è¿›è¡Œæ”¶å°¾å·¥ä½œçš„å¥½åœºåˆã€‚</p>
<h1 id="defer-çš„å‡ ä¸ªä½¿ç”¨åœºæ™¯"><a href="#defer-çš„å‡ ä¸ªä½¿ç”¨åœºæ™¯" class="headerlink" title="defer çš„å‡ ä¸ªä½¿ç”¨åœºæ™¯"></a>defer çš„å‡ ä¸ªä½¿ç”¨åœºæ™¯</h1><ul>
<li>panic æ•è·,å› ä¸ºdeferred å†ä»»æ„åœºæ™¯ä¸‹éƒ½ä¼šè¢«æ‰§è¡Œï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å†deferä¸­å¤„ç†å¼‚å¸¸ã€‚ï¼ˆä¸å»ºè®®è¿™ä¹ˆåšï¼Œå¦‚æœæ˜¯ä¸€èˆ¬é”™è¯¯ï¼Œä¸å»ºè®®panicï¼Œå¦‚æœå¿…é¡»panic ï¼Œå°±ä¸è¦æ•è·ï¼‰</li>
<li>é‡Šæ”¾èµ„æº</li>
<li>å»¶è¿Ÿæ‰§è¡Œï¼Œè®°å½•å‡½æ•°æ‰§è¡Œçš„æ—¶é—´æ¯”å¦‚<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(s time.Time)</span></span> &#123;</span><br><span class="line">		fmt.Println(time.Now().Sub(s))</span><br><span class="line">	&#125;(time.Now())</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="defer-å¸¦æ¥çš„æ€§èƒ½æŸè€—"><a href="#defer-å¸¦æ¥çš„æ€§èƒ½æŸè€—" class="headerlink" title="defer å¸¦æ¥çš„æ€§èƒ½æŸè€—"></a>defer å¸¦æ¥çš„æ€§èƒ½æŸè€—</h1><p>deferè®©è¿›è¡Œèµ„æºé‡Šæ”¾ï¼ˆå¦‚æ–‡ä»¶æè¿°ç¬¦ã€é”ï¼‰çš„è¿‡ç¨‹å˜å¾—ä¼˜é›…å¾ˆå¤šï¼Œä¹Ÿä¸æ˜“å‡ºé”™ã€‚ä½†åœ¨æ€§èƒ½æ•æ„Ÿçš„ç¨‹åºä¸­ï¼Œdeferå¸¦æ¥çš„æ€§èƒ½è´Ÿæ‹…ä¹Ÿæ˜¯Gopherå¿…é¡»çŸ¥æ™“å’Œæƒè¡¡çš„ã€‚<br><a href="https://gist.github.com/hxzhouh/a07dd587ba52a8afdb07d5655c8ca303">https://gist.github.com/hxzhouh/a07dd587ba52a8afdb07d5655c8ca303</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">î‚¶hxzhouh î‚° atomic î‚° âœ (ïˆ main î­‹ 1) î‚° â™¥ 20:16 î‚° go test -bench=BenchmarkFooWithDefer </span><br><span class="line">10000000</span><br><span class="line">goos: darwin</span><br><span class="line">goarch: arm64</span><br><span class="line">pkg: github.com/hxzhouh/go-example/atomic</span><br><span class="line">BenchmarkFooWithDefer-10        189423524                6.353 ns/op</span><br><span class="line">PASS</span><br><span class="line">ok      github.com/hxzhouh/go-example/atomic    3.631s</span><br><span class="line">î‚¶hxzhouh î‚° atomic î‚° âœ (ïˆ main î­‹ 1) î‚° â™¥ 21:05 î‚° go test -bench=BenchmarkFooWithoutDefer </span><br><span class="line">BenchmarkFooWithoutDefer-10     273232389                4.397 ns/op</span><br><span class="line">PASS</span><br><span class="line">ok      github.com/hxzhouh/go-example/atomic    2.875s</span><br></pre></td></tr></table></figure>

<p>åœ¨ go1.12 ç‰ˆæœ¬ä¸­ç›¸åŒçš„æµ‹è¯•ä»£ç ï¼Œé defer ç‰ˆæœ¬ è¦æ¯”defer ç‰ˆæœ¬å¿«7å€ï¼Œç»è¿‡1.13 1.14 ä¸¤ä¸ªå¤§ç‰ˆæœ¬çš„ä¼˜åŒ–ï¼Œdefer çš„æ€§èƒ½å·²ç»æ˜¾è‘—æé«˜äº†ï¼Œåœ¨æˆ‘çš„ç”µè„‘ä¸Šï¼Œédefer ç‰ˆæœ¬è¿˜æ˜¯æœ‰ç€50%å·¦å³çš„æ€§èƒ½é¢†å…ˆã€‚</p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>åœ¨å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„ç¨‹åºå¯¹æ€§èƒ½å¹¶ä¸å¤ªæ•æ„Ÿï¼Œæˆ‘å»ºè®®å°½é‡ä½¿ç”¨deferï¼ŒåŒæ—¶æˆ‘ä»¬éœ€è¦äº†è§£defer è¿è¡Œçš„åŸç†ï¼Œä»¥åŠå‡ ä¸ªè¦é¿å…çš„åœ°æ–¹ã€‚</p>
]]></content>
      <categories>
        <category>golang</category>
      </categories>
      <tags>
        <tag>go</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux è¿œç¨‹æœåŠ¡å™¨å…å¯†ç™»å½•</title>
    <url>/2023/09/22/Linux%20%E8%BF%9C%E7%A8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%85%8D%E5%AF%86%E7%99%BB%E5%BD%95/</url>
    <content><![CDATA[<h1 id="Linux-è¿œç¨‹æœåŠ¡å™¨å…å¯†ç™»å½•"><a href="#Linux-è¿œç¨‹æœåŠ¡å™¨å…å¯†ç™»å½•" class="headerlink" title="Linux è¿œç¨‹æœåŠ¡å™¨å…å¯†ç™»å½•"></a>Linux è¿œç¨‹æœåŠ¡å™¨å…å¯†ç™»å½•</h1><p>å…å¯†ç™»å½•çš„åŸç†ï¼šé€šè¿‡å¯†é’¥è®¤è¯ç™»å½•ï¼Œé¦–å…ˆåœ¨è‡ªå·±çš„æœåŠ¡å™¨ä¸Šç”Ÿæˆå…¬é’¥å’Œç§é’¥ï¼Œå…¶æ¬¡å°†å…¬é’¥ä¸Šä¼ åˆ°è¿œç¨‹æœåŠ¡ä¸­ï¼Œåœ¨äºè¿œç¨‹æœåŠ¡å™¨å»ºç«‹è¿æ¥é€šä¿¡æ—¶ï¼Œè¿œç¨‹æœåŠ¡å™¨é¦–å…ˆä¼šéªŒè¯è¯¥æœåŠ¡å™¨ä¸Šæ˜¯å¦åŒ…å«è¯·æ±‚æœåŠ¡å™¨çš„å…¬é’¥ï¼Œè‹¥ä¸åŒ…å«åˆ™éœ€è¦è¿œç¨‹ç™»å½•çš„ç”¨æˆ·è¾“å…¥å¯†ç ã€‚</p>
<span id="more"></span>

<p>å…å¯†ç™»å½•çš„åŸç†ï¼šé€šè¿‡å¯†é’¥è®¤è¯ç™»å½•ï¼Œé¦–å…ˆåœ¨è‡ªå·±çš„æœåŠ¡å™¨ä¸Šç”Ÿæˆå…¬é’¥å’Œç§é’¥ï¼Œå…¶æ¬¡å°†å…¬é’¥ä¸Šä¼ åˆ°è¿œç¨‹æœåŠ¡ä¸­ï¼Œåœ¨äºè¿œç¨‹æœåŠ¡å™¨å»ºç«‹è¿æ¥é€šä¿¡æ—¶ï¼Œè¿œç¨‹æœåŠ¡å™¨é¦–å…ˆä¼šéªŒè¯è¯¥æœåŠ¡å™¨ä¸Šæ˜¯å¦åŒ…å«è¯·æ±‚æœåŠ¡å™¨çš„å…¬é’¥ï¼Œè‹¥ä¸åŒ…å«åˆ™éœ€è¦è¿œç¨‹ç™»å½•çš„ç”¨æˆ·è¾“å…¥å¯†ç ã€‚</p>
<h2 id="åˆ›å»ºæœ¬åœ°å¯†é’¥å¯¹"><a href="#åˆ›å»ºæœ¬åœ°å¯†é’¥å¯¹" class="headerlink" title="åˆ›å»ºæœ¬åœ°å¯†é’¥å¯¹"></a>åˆ›å»ºæœ¬åœ°å¯†é’¥å¯¹</h2><p>ï¼ˆå¦‚æœæ²¡æœ‰~&#x2F;.sshæ–‡ä»¶å¤¹ï¼Œåˆ™æ–°å»ºä¸€ä¸ª.sshæ–‡ä»¶å¤¹ï¼Œmkdir ï½&#x2F;.sshï¼‰åœ¨æœ¬åœ°ç”Ÿæˆå¯†é’¥å¯¹ï¼ˆå…¬é’¥ä¸ç§é’¥ï¼‰<br><code>ssh-keygen -t rsa</code></p>
<p>æ•²ä¸‹å›è½¦åä¼šæœ‰ä¸‰ä¸ªäº¤äº’ï¼Œç¬¬ä¸€ä¸ªæ˜¯æ–‡ä»¶åï¼Œé»˜è®¤æ˜¯id_rsaï¼Œå¦‚éœ€ä¿®æ”¹ï¼Œè‡ªå·±è¾“å…¥ä¸€ä¸ªæ–‡ä»¶åå³å¯ã€‚ç¬¬äºŒä¸ªä¸ç¬¬ä¸‰ä¸ªæ˜¯å¯†ç ä¸å¯†ç ç¡®è®¤ï¼Œæ˜¯ä»¥åä½¿ç”¨è¯¥å…¬é’¥æ—¶è¦è¾“å…¥çš„å¯†ç ï¼Œä¸€èˆ¬ä¸è®¾ç½®ï¼Œå¦‚æœ‰å¼ºçƒˆçš„å®‰å…¨éœ€æ±‚ï¼Œè‡ªå·±è®¾ç½®å³å¯ã€‚æœ€åä¼šç”Ÿæˆä¸¤ä¸ªæ–‡ä»¶id_rsaï¼Œid_rsa.pubã€‚ä»¥.pubç»“å°¾çš„å…¬é’¥ï¼Œå¦ä¸€ä¸ªæ˜¯ç§é’¥ã€‚</p>
<h2 id="ä¸Šä¼ å…¬é’¥åˆ°ç›®æ ‡æœåŠ¡å™¨"><a href="#ä¸Šä¼ å…¬é’¥åˆ°ç›®æ ‡æœåŠ¡å™¨" class="headerlink" title="ä¸Šä¼ å…¬é’¥åˆ°ç›®æ ‡æœåŠ¡å™¨"></a>ä¸Šä¼ å…¬é’¥åˆ°ç›®æ ‡æœåŠ¡å™¨</h2><p>è¿›å…¥ï½&#x2F;.sshæ–‡ä»¶å¤¹ä¸­æœ‰id_rsaï¼ˆç§é’¥æ–‡ä»¶ï¼‰id_rsa.pub(å…¬é’¥æ–‡ä»¶)ï¼Œå°†å…¬é’¥æ–‡ä»¶id_rsa.pubä¸Šä¼ åˆ°æœåŠ¡å™¨çš„.ssh&#x2F;authorized_keysæ–‡ä»¶ä¸­ã€‚<br>ä¸Šä¼ <br><code>scpÂ  ï½/.ssh/id_rsa.pub glt@10.112.1.1:~/</code><br>ç„¶å è¿›å…¥è¿œç¨‹æœåŠ¡å™¨ï¼Œæ‰¾åˆ°ä¸Šä¼ çš„id_rsa.pubæ–‡ä»¶ï¼Œç„¶åå°†å…¬é’¥æ·»åŠ åˆ°è¿œç¨‹æœåŠ¡å™¨çš„~&#x2F;.ssh&#x2F;authorized_keys æ–‡ä»¶ä¸­:<br><code>cat ~/id_rsa.pub &gt;&gt; ~./.ssh/authorized_keys</code><br>æˆ–è€…ç›´æ¥ç”¨ssh-copy-idå‘½ä»¤ï¼Œå°†æ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼š<br>&#96;ssh-copy-id -i ~&#x2F;.ssh&#x2F;id_rsa.pub <a href="mailto:&#103;&#x6c;&#x74;&#x40;&#x31;&#x30;&#x2e;&#49;&#x31;&#x32;&#46;&#49;&#46;&#x31;">&#103;&#x6c;&#x74;&#x40;&#x31;&#x30;&#x2e;&#49;&#x31;&#x32;&#46;&#49;&#46;&#x31;</a></p>
<blockquote>
<p>ssh-copy-idæ˜¯ç”¨æ¥å°†æœ¬åœ°å…¬é’¥æ‹·è´åˆ°è¿œç¨‹çš„authorized_keysæ–‡ä»¶çš„è„šæœ¬å‘½ä»¤ï¼Œå®ƒè¿˜ä¼šå°†èº«ä»½æ ‡è¯†è¿½åŠ åˆ°è¿œç¨‹æœåŠ¡å™¨çš„ <code>ï½/.ssh/authorized_keys</code> æ–‡ä»¶ä¸­ï¼Œå¹¶ç»™è¿œç¨‹ä¸»æœºçš„ç”¨æˆ·ç›®å½•é€‚å½“çš„æƒé™ã€‚</p>
</blockquote>
<ol>
<li>æŠŠä¸“ç”¨å¯†é’¥æ·»åŠ åˆ°ssh-agentçš„é«˜é€Ÿç¼“å­˜ä¸­ï¼š<br><code>ssh-add</code></li>
<li>é‡å¯sshæœåŠ¡<br><code>service sshd restart</code><br>æˆ–è€…<br><code>systemctlÂ  restartÂ  sshd</code></li>
</ol>
<p>6.ä½¿ç”¨sshç™»å½•è¿œç¨‹æœåŠ¡å™¨ç³»ç»Ÿ<br><code>ssh æœåŠ¡å™¨ç”¨æˆ·å@æœåŠ¡å™¨åœ°å€</code><br>è¡¥å……ï¼š<br>å¦‚æœä¸Šè¿°é…ç½®å¤±è´¥ã€‚</p>
<ol>
<li>å…ˆåœ¨æœ¬åœ°é…ç½®ï¼Œé…ç½®è‡ªèº«æœåŠ¡å™¨çš„å…å¯†ç™»å½•ï¼Œè‡ªå·±è¿æ¥è‡ªå·±ã€‚</li>
<li>æ£€æŸ¥æ–‡ä»¶æƒé™</li>
</ol>
<p>å°†authorized_keys æ–‡ä»¶çš„æƒé™ä¿®æ”¹ä¸º600ï¼š <code>chmod 600 authorized_keys</code><br>å°† .sshÂ  æ–‡ä»¶å¤¹çš„æƒé™ä¿®æ”¹ä¸º700ï¼š <code>chmod 700Â  .ssh</code></p>
<p>3.æŸ¥çœ‹é…ç½®æ–‡ä»¶sshd_configÂ  :Â  Â </p>
<p>vim &#x2F;etc&#x2F;ssh&#x2F;sshd_config</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">RSAAuthentication yesÂ  Â  Â  Â Â #RSAè®¤è¯</span><br><span class="line">PubkeyAuthentication yesÂ  Â  Â #å…¬é’¥è®¤è¯</span><br><span class="line">AuthorizedKeysFile .ssh/authorized_keys #å…¬é’¥è®¤è¯æ–‡ä»¶è·¯å¾„</span><br></pre></td></tr></table></figure>

<p>å¦‚æœç”¨rootç”¨æˆ·æœ‰å¤±è´¥çš„æƒ…å†µï¼Œæ£€æŸ¥PermitRootLogin yesÂ  è¿™ä¸ªé…ç½®é€‰é¡¹ï¼ˆæ³¨æ„ï¼Œè¿™æ˜¯rootç”¨æˆ·çš„è¿œç¨‹ç™»å½•ï¼Œæ¯”è¾ƒå±é™©ï¼‰ã€‚</p>
<p>4.ä¿®æ”¹é…ç½®æ–‡ä»¶åï¼Œè®©é…ç½®æ–‡ä»¶ç”Ÿæ•ˆ<br>ç«‹å³ç”Ÿæ•ˆï¼šsource &#x2F;etc&#x2F;ssh&#x2F;sshd_coonfig<br>é‡å¯sshæœåŠ¡ï¼šsudo &#x2F;etc&#x2F;init.d&#x2F;ssh restart  </p>
<h2 id="æœ¬åœ°é…ç½®å…å¯†ç™»å½•"><a href="#æœ¬åœ°é…ç½®å…å¯†ç™»å½•" class="headerlink" title="æœ¬åœ°é…ç½®å…å¯†ç™»å½•"></a>æœ¬åœ°é…ç½®å…å¯†ç™»å½•</h2><p>5.ç»™è¿œç¨‹ç™»å½•é…ç½®åˆ«å</p>
<p>è¿›å…¥æœ¬åœ°æœºå™¨çš„ç›®å½•ï½&#x2F;.sshä¸‹æ‰¾åˆ°configæ–‡ä»¶ï¼ˆè‹¥ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªtouch configï¼‰, æŒ‰å¦‚ä¸‹è¿›è¡Œé…ç½®</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Host  glt                                  # ç»™è¿œç¨‹æœåŠ¡å™¨å–ä¸€ä¸ªåˆ«å</span><br><span class="line">HostName  10.1.1.1       #ç›®çš„æœºå™¨çš„ip</span><br><span class="line">User username              #sshç™»å½•æ—¶çš„ç”¨æˆ·å</span><br><span class="line">Port   22                         #sshæ‰€ä½¿ç”¨çš„ç«¯å£ï¼Œé»˜è®¤æ˜¯22</span><br><span class="line">IdentityFile  /home/ç”¨æˆ·å/.ssh/id_rsa.pub     #å¯¹åº”æœåŠ¡å™¨å…¬é’¥çš„æœ¬åœ°ç§é’¥æ–‡ä»¶è·¯å¾„</span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥å°±å¯ä»¥ä½¿ç”¨ssh gltÂ  Â è¿›è¡Œè¿œç¨‹ç™»å½•ã€‚</p>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>RWmutexï¼šç«™åœ¨å·¨äººè‚©è†€ä¸Šè·³èˆ</title>
    <url>/2024/04/03/RWmutex%EF%BC%9A%E7%AB%99%E5%9C%A8%E5%B7%A8%E4%BA%BA%E8%82%A9%E8%86%80%E4%B8%8A%E8%B7%B3%E8%88%9E/</url>
    <content><![CDATA[<p>æˆ‘ä»¬åœ¨ä½¿ç”¨mutex çš„è¿‡ç¨‹ä¸­ï¼Œä¸ç®¡æ˜¯è¯»è¿˜æ˜¯å†™ï¼Œéƒ½é€šè¿‡ Mutex æ¥ä¿è¯åªæœ‰ä¸€ä¸ª goroutine è®¿é—®å…±äº«èµ„æºï¼Œè¿™åœ¨æŸäº›æƒ…å†µä¸‹æœ‰ç‚¹â€œæµªè´¹â€ã€‚æ¯”å¦‚è¯´ï¼Œåœ¨å†™å°‘è¯»å¤šçš„æƒ…å†µä¸‹ï¼Œå³ä½¿ä¸€æ®µæ—¶é—´å†…æ²¡æœ‰å†™æ“ä½œï¼Œå¤§é‡å¹¶å‘çš„è¯»è®¿é—®ä¹Ÿä¸å¾—ä¸åœ¨ Mutex çš„ä¿æŠ¤ä¸‹å˜æˆäº†ä¸²è¡Œè®¿é—®ï¼Œè¿™ä¸ªæ—¶å€™ä½¿ç”¨ Mutexï¼Œå¯¹æ€§èƒ½çš„å½±å“å°±æ¯”è¾ƒå¤§ã€‚  <strong>RWmutex å°±æ˜¯ä¸ºäº†ä¼˜åŒ–è¿™é—®é¢˜è€Œå®ç°çš„</strong></p>
<p>å¦‚æœæ‚¨æ²¡æœ‰é˜…è¯»è¿‡ mutex æ–‡ç« ï¼Œè¯·å…ˆé˜…è¯»æˆ‘çš„è¿™ç¯‡ å…³äºmutex çš„æ–‡ç« ï¼ŒRWmutex æ˜¯åŸºäºmutex å®ç°çš„ï¼Œå°±åƒç«™åœ¨å·¨äººè‚©è†€ä¸Šè·³èˆã€‚<br><a href="https://medium.com/gitconnected/go-source-code-sync-mutex-3082a25ef092">https://medium.com/gitconnected/go-source-code-sync-mutex-3082a25ef092</a></p>
<span id="more"></span>
<h1 id="ä»€ä¹ˆæ˜¯-RWMutex"><a href="#ä»€ä¹ˆæ˜¯-RWMutex" class="headerlink" title="ä»€ä¹ˆæ˜¯ RWMutex"></a>ä»€ä¹ˆæ˜¯ RWMutex</h1><p>ç®€å•è§£é‡Šä¸€ä¸‹è¯»å†™é” RWMutexã€‚æ ‡å‡†åº“ä¸­çš„ RWMutex æ˜¯ä¸€ä¸ª reader&#x2F;writer äº’æ–¥é”ã€‚RWMutex åœ¨æŸä¸€æ—¶åˆ»åªèƒ½ç”±ä»»æ„æ•°é‡çš„ reader æŒæœ‰ï¼Œæˆ–è€…æ˜¯åªè¢«å•ä¸ªçš„ writer æŒæœ‰ã€‚è¿™å°±æ˜¯ readers-writers é—®é¢˜, readers-writers é—®é¢˜ä¸€èˆ¬æœ‰ä¸‰ç±»ï¼ŒåŸºäºå¯¹è¯»å’Œå†™æ“ä½œçš„ä¼˜å…ˆçº§ï¼Œè¯»å†™é”çš„è®¾è®¡å’Œå®ç°ä¹Ÿåˆ†æˆä¸‰ç±»ã€‚  </p>
<ul>
<li><strong>Read-preferring</strong>ï¼šè¯»ä¼˜å…ˆçš„è®¾è®¡å¯ä»¥æä¾›å¾ˆé«˜çš„å¹¶å‘æ€§ï¼Œä½†æ˜¯ï¼Œåœ¨ç«äº‰æ¿€çƒˆçš„æƒ…å†µä¸‹å¯èƒ½ä¼šå¯¼è‡´å†™é¥¥é¥¿ã€‚è¿™æ˜¯å› ä¸ºï¼Œå¦‚æœæœ‰å¤§é‡çš„è¯»ï¼Œè¿™ç§è®¾è®¡ä¼šå¯¼è‡´åªæœ‰æ‰€æœ‰çš„è¯»éƒ½é‡Šæ”¾äº†é”ä¹‹åï¼Œå†™æ‰å¯èƒ½è·å–åˆ°é”ã€‚  </li>
<li><strong>Write-preferring</strong>ï¼šå†™ä¼˜å…ˆçš„è®¾è®¡æ„å‘³ç€ï¼Œå¦‚æœå·²ç»æœ‰ä¸€ä¸ª writer åœ¨ç­‰å¾…è¯·æ±‚é”çš„è¯ï¼Œå®ƒä¼šé˜»æ­¢æ–°æ¥çš„è¯·æ±‚é”çš„ reader è·å–åˆ°é”ï¼Œæ‰€ä»¥ä¼˜å…ˆä¿éšœ writerã€‚å½“ç„¶ï¼Œå¦‚æœæœ‰ä¸€äº› reader å·²ç»è¯·æ±‚äº†é”çš„è¯ï¼Œæ–°è¯·æ±‚çš„ writer ä¹Ÿä¼šç­‰å¾…å·²ç»å­˜åœ¨çš„ reader éƒ½é‡Šæ”¾é”ä¹‹åæ‰èƒ½è·å–ã€‚æ‰€ä»¥ï¼Œå†™ä¼˜å…ˆçº§è®¾è®¡ä¸­çš„ä¼˜å…ˆæƒæ˜¯é’ˆå¯¹æ–°æ¥çš„è¯·æ±‚è€Œè¨€çš„ã€‚è¿™ç§è®¾è®¡ä¸»è¦é¿å…äº† writer çš„é¥¥é¥¿é—®é¢˜ã€‚  </li>
<li><strong>ä¸æŒ‡å®šä¼˜å…ˆçº§</strong>ï¼šè¿™ç§è®¾è®¡æ¯”è¾ƒç®€å•ï¼Œä¸åŒºåˆ† reader å’Œ writer ä¼˜å…ˆçº§ï¼ŒæŸäº›åœºæ™¯ä¸‹è¿™ç§ä¸æŒ‡å®šä¼˜å…ˆçº§çš„è®¾è®¡åè€Œæ›´æœ‰æ•ˆï¼Œå› ä¸ºç¬¬ä¸€ç±»ä¼˜å…ˆçº§ä¼šå¯¼è‡´å†™é¥¥é¥¿ï¼Œç¬¬äºŒç±»ä¼˜å…ˆçº§å¯èƒ½ä¼šå¯¼è‡´è¯»é¥¥é¥¿ï¼Œè¿™ç§ä¸æŒ‡å®šä¼˜å…ˆçº§çš„è®¿é—®ä¸å†åŒºåˆ†è¯»å†™ï¼Œå¤§å®¶éƒ½æ˜¯åŒä¸€ä¸ªä¼˜å…ˆçº§ï¼Œè§£å†³äº†é¥¥é¥¿çš„é—®é¢˜ã€‚<br>Go æ ‡å‡†åº“ä¸­çš„ RWMutex è®¾è®¡æ˜¯ Write-preferring æ–¹æ¡ˆã€‚ä¸€ä¸ªæ­£åœ¨é˜»å¡çš„ Lock è°ƒç”¨ä¼šæ’é™¤æ–°çš„ reader è¯·æ±‚åˆ°é”ã€‚</li>
</ul>
<h1 id="RWMutex-çš„å®ç°"><a href="#RWMutex-çš„å®ç°" class="headerlink" title="RWMutex çš„å®ç°"></a>RWMutex çš„å®ç°</h1><blockquote>
<p>æœ¬æ–‡åŸºäºgo 1.21.4 </p>
</blockquote>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> RWMutex <span class="keyword">struct</span> &#123;  </span><br><span class="line">    w           Mutex        <span class="comment">// held if there are pending writers  </span></span><br><span class="line">    writerSem   <span class="type">uint32</span>       <span class="comment">// semaphore for writers to wait for completing readers  </span></span><br><span class="line">    readerSem   <span class="type">uint32</span>       <span class="comment">// semaphore for readers to wait for completing writers  </span></span><br><span class="line">    readerCount atomic.Int32 <span class="comment">// number of pending readers  </span></span><br><span class="line">    readerWait  atomic.Int32 <span class="comment">// number of departing readers  </span></span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">const</span> rwmutexMaxReaders = <span class="number">1</span> &lt;&lt; <span class="number">30</span></span><br><span class="line"><span class="comment">// </span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(rw *RWMutex)</span></span> Lock()&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(rw *RWMutex)</span></span> Unlock() &#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(rw *RWMutex)</span></span> RLock()&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(rw *RWMutex)</span></span> RUnlock()&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(rw *RWMutex)</span></span> TryLock() <span class="type">bool</span>&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(rw *RWMutex)</span></span> TryRLock() <span class="type">bool</span>&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(rw *RWMutex)</span></span> RLocker() Locker&#123;&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>å­—æ®µ readerCountï¼šè®°å½•å½“å‰ reader çš„æ•°é‡ï¼ˆä»¥åŠæ˜¯å¦æœ‰ writer ç«äº‰é”ï¼‰ï¼›</li>
<li>readerWaitï¼šè®°å½• writer è¯·æ±‚é”æ—¶éœ€è¦ç­‰å¾… read å®Œæˆçš„ reader çš„æ•°é‡ï¼›</li>
</ul>
<h2 id="RLock-RUnlock-çš„å®ç°"><a href="#RLock-RUnlock-çš„å®ç°" class="headerlink" title="RLock&#x2F;RUnlock çš„å®ç°"></a>RLock&#x2F;RUnlock çš„å®ç°</h2><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(rw *RWMutex)</span></span> RLock() &#123;</span><br><span class="line">    <span class="keyword">if</span> atomic.AddInt32(&amp;rw.readerCount, <span class="number">1</span>) &lt; <span class="number">0</span> &#123;</span><br><span class="line">            <span class="comment">// rw.readerCount æ˜¯è´Ÿå€¼çš„æ—¶å€™ï¼Œæ„å‘³ç€æ­¤æ—¶æœ‰writerç­‰å¾…è¯·æ±‚é”ï¼Œå› ä¸ºwriterä¼˜å…ˆçº§é«˜ï¼Œæ‰€ä»¥æŠŠåæ¥çš„readeré˜»å¡ä¼‘çœ ,</span></span><br><span class="line">        runtime_SemacquireMutex(&amp;rw.readerSem, <span class="literal">false</span>, <span class="number">0</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(rw *RWMutex)</span></span> RUnlock() &#123;</span><br><span class="line">    <span class="keyword">if</span> r := atomic.AddInt32(&amp;rw.readerCount, <span class="number">-1</span>); r &lt; <span class="number">0</span> &#123;</span><br><span class="line">        rw.rUnlockSlow(r) <span class="comment">// æœ‰ç­‰å¾…çš„writer</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(rw *RWMutex)</span></span> rUnlockSlow(r <span class="type">int32</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> atomic.AddInt32(&amp;rw.readerWait, <span class="number">-1</span>) == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="comment">// æœ€åä¸€ä¸ªreaderäº†ï¼Œwriterç»ˆäºæœ‰æœºä¼šè·å¾—é”äº†</span></span><br><span class="line">        runtime_Semrelease(&amp;rw.writerSem, <span class="literal">false</span>, <span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¬¬ 2 è¡Œæ˜¯å¯¹ reader è®¡æ•°åŠ  1ã€‚<br>readerCount è¿™ä¸ªå­—æ®µæœ‰åŒé‡å«ä¹‰ï¼šæ²¡æœ‰ writer ç«äº‰æˆ–æŒæœ‰é”æ—¶ï¼ŒreaderCount å’Œæˆ‘ä»¬æ­£å¸¸ç†è§£çš„ reader çš„è®¡æ•°æ˜¯ä¸€æ ·çš„ï¼›<br>å¦‚æœæœ‰ writer ç«äº‰é”æˆ–è€…æŒæœ‰é”æ—¶ï¼Œé‚£ä¹ˆï¼ŒreaderCount ä¸ä»…ä»…æ‰¿æ‹…ç€ reader çš„è®¡æ•°åŠŸèƒ½ï¼Œè¿˜èƒ½å¤Ÿæ ‡è¯†å½“å‰æ˜¯å¦æœ‰ writer ç«äº‰æˆ–æŒæœ‰é”ï¼ˆåé¢ä¼šè¯´æ˜ï¼‰ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹,readerä¼šé˜»å¡ç­‰å¾…writer å”¤é†’ï¼ˆç¬¬å››è¡Œï¼‰ã€‚<br>è°ƒç”¨ RUnlock çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å°† Reader çš„è®¡æ•°å‡å» 1ï¼ˆç¬¬ 8 è¡Œï¼‰ï¼Œå› ä¸º reader çš„æ•°é‡å‡å°‘äº†ä¸€ä¸ªã€‚ä½†æ˜¯ï¼Œç¬¬ 8 è¡Œçš„ AddInt32 çš„è¿”å›å€¼è¿˜æœ‰å¦å¤–ä¸€ä¸ªå«ä¹‰ã€‚å¦‚æœå®ƒæ˜¯è´Ÿå€¼ï¼Œå°±è¡¨ç¤ºå½“å‰æœ‰ writer ç«äº‰é”ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿˜ä¼šè°ƒç”¨ rUnlockSlow æ–¹æ³•ï¼Œæ£€æŸ¥æ˜¯ä¸æ˜¯ reader éƒ½é‡Šæ”¾è¯»é”äº†ï¼Œå¦‚æœè¯»é”éƒ½é‡Šæ”¾äº†ï¼Œé‚£ä¹ˆå¯ä»¥å”¤é†’è¯·æ±‚å†™é”çš„ writer äº†ã€‚<strong>å½“ä¸€ä¸ªæˆ–è€…å¤šä¸ª reader æŒæœ‰é”çš„æ—¶å€™ï¼Œç«äº‰é”çš„ writer ä¼šç­‰å¾…è¿™äº› reader é‡Šæ”¾å®Œï¼Œæ‰å¯èƒ½æŒæœ‰è¿™æŠŠé”</strong>ã€‚</p>
<h2 id="LOCK"><a href="#LOCK" class="headerlink" title="LOCK"></a>LOCK</h2><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(rw *RWMutex)</span></span> Lock() &#123;</span><br><span class="line">    <span class="comment">// é¦–å…ˆè§£å†³å…¶ä»–writerç«äº‰é—®é¢˜</span></span><br><span class="line">    rw.w.Lock()</span><br><span class="line">    <span class="comment">// åè½¬readerCountï¼Œå‘Šè¯‰readeræœ‰writerç«äº‰é”</span></span><br><span class="line">    r := atomic.AddInt32(&amp;rw.readerCount, -rwmutexMaxReaders) + rwmutexMaxReaders</span><br><span class="line">    <span class="comment">// å¦‚æœå½“å‰æœ‰readeræŒæœ‰é”ï¼Œé‚£ä¹ˆéœ€è¦ç­‰å¾…</span></span><br><span class="line">    <span class="keyword">if</span> r != <span class="number">0</span> &amp;&amp; atomic.AddInt32(&amp;rw.readerWait, r) != <span class="number">0</span> &#123;</span><br><span class="line">        runtime_SemacquireMutex(&amp;rw.writerSem, <span class="literal">false</span>, <span class="number">0</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>RWMutex æ˜¯ä¸€ä¸ªå¤š writer å¤š reader çš„è¯»å†™é”ï¼Œæ‰€ä»¥åŒæ—¶å¯èƒ½æœ‰å¤šä¸ª writer å’Œ readerã€‚é‚£ä¹ˆï¼Œä¸ºäº†é¿å… writer ä¹‹é—´çš„ç«äº‰ï¼ŒRWMutex å°±ä¼šä½¿ç”¨ä¸€ä¸ª Mutex æ¥ä¿è¯ writer çš„äº’æ–¥ã€‚ä¸€æ—¦ä¸€ä¸ª writer è·å¾—äº†å†…éƒ¨çš„äº’æ–¥é”ï¼Œå°±ä¼šåè½¬ readerCount å­—æ®µï¼ŒæŠŠå®ƒä»åŸæ¥çš„æ­£æ•´æ•° readerCount(&gt;&#x3D;0) ä¿®æ”¹ä¸ºè´Ÿæ•°ï¼ˆreaderCount-rwmutexMaxReadersï¼‰ï¼Œè®©è¿™ä¸ªå­—æ®µä¿æŒä¸¤ä¸ªå«ä¹‰ï¼ˆæ—¢ä¿å­˜äº† reader çš„æ•°é‡ï¼Œåˆè¡¨ç¤ºå½“å‰æœ‰ writerï¼‰ã€‚æˆ‘ä»¬æ¥çœ‹ä¸‹ä¸‹é¢çš„ä»£ç ã€‚ç¬¬ 5 è¡Œï¼Œè¿˜ä¼šè®°å½•å½“å‰æ´»è·ƒçš„ reader æ•°é‡ï¼Œæ‰€è°“æ´»è·ƒçš„ readerï¼Œå°±æ˜¯æŒ‡æŒæœ‰è¯»é”è¿˜æ²¡æœ‰é‡Šæ”¾çš„é‚£äº› readerã€‚</p>
<p>å¦‚æœ readerCount ä¸æ˜¯ 0ï¼Œå°±è¯´æ˜å½“å‰æœ‰æŒæœ‰è¯»é”çš„ readerï¼ŒRWMutex éœ€è¦æŠŠè¿™ä¸ªå½“å‰ readerCount èµ‹å€¼ç»™ readerWait å­—æ®µä¿å­˜ä¸‹æ¥ï¼ˆç¬¬ 7 è¡Œï¼‰ï¼Œ åŒæ—¶ï¼Œè¿™ä¸ª writer è¿›å…¥é˜»å¡ç­‰å¾…çŠ¶æ€ï¼ˆç¬¬ 8 è¡Œï¼‰ã€‚<br>æ¯å½“ä¸€ä¸ª reader é‡Šæ”¾è¯»é”çš„æ—¶å€™ï¼ˆè°ƒç”¨ RUnlock æ–¹æ³•æ—¶ï¼‰ï¼ŒreaderWait å­—æ®µå°±å‡ 1ï¼Œç›´åˆ°æ‰€æœ‰çš„æ´»è·ƒçš„ reader éƒ½é‡Šæ”¾äº†è¯»é”ï¼Œæ‰ä¼šå”¤é†’è¿™ä¸ª writerã€‚</p>
<h2 id="Unlock"><a href="#Unlock" class="headerlink" title="Unlock"></a>Unlock</h2><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(rw *RWMutex)</span></span> Unlock() &#123;</span><br><span class="line">    <span class="comment">// å‘Šè¯‰readeræ²¡æœ‰æ´»è·ƒçš„writeräº†</span></span><br><span class="line">    r := atomic.AddInt32(&amp;rw.readerCount, rwmutexMaxReaders)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å”¤é†’é˜»å¡çš„readerä»¬</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="type">int</span>(r); i++ &#123;</span><br><span class="line">        runtime_Semrelease(&amp;rw.readerSem, <span class="literal">false</span>, <span class="number">0</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// é‡Šæ”¾å†…éƒ¨çš„äº’æ–¥é”</span></span><br><span class="line">    rw.w.Unlock()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å½“ä¸€ä¸ª writer é‡Šæ”¾é”çš„æ—¶å€™ï¼Œå®ƒä¼šå†æ¬¡åè½¬ readerCount å­—æ®µã€‚ï¼ˆç”±è´Ÿæ•°ä¿®æ”¹ä¸ºæ­£æ•°ï¼‰ï¼Œç„¶åå”¤é†’é˜»å¡çš„readerã€‚åœ¨ RWMutex çš„ Unlock è¿”å›ä¹‹å‰ï¼Œéœ€è¦æŠŠå†…éƒ¨çš„äº’æ–¥é”é‡Šæ”¾ã€‚é‡Šæ”¾å®Œæ¯•åï¼Œå…¶ä»–çš„ writer æ‰å¯ä»¥ç»§ç»­ç«äº‰è¿™æŠŠé”ã€‚</p>
<h2 id="TryLock-TryRLock"><a href="#TryLock-TryRLock" class="headerlink" title="TryLock &amp; TryRLock"></a>TryLock &amp; TryRLock</h2><p><code>TryRLock</code>Â å’ŒÂ <code>TryLock</code>Â çš„å®ç°éƒ½å¾ˆç®€å•ï¼Œéƒ½æ˜¯å°è¯•è·å–è¯»é”æˆ–è€…å†™é”ï¼Œå¦‚æœè·å–ä¸åˆ°å°±è¿”å›Â <code>false</code>ï¼Œè·å–åˆ°äº†å°±è¿”å›Â <code>true</code>ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•ä¸ä¼šé˜»å¡ç­‰å¾…ã€‚ç›´æ¥çœ‹æºä»£ç ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(rw *RWMutex)</span></span> TryLock() <span class="type">bool</span> &#123;  </span><br><span class="line">    <span class="keyword">if</span> !rw.w.TryLock() &#123;   <span class="comment">// æœ‰ goroutine æŒæœ‰å†™é”</span></span><br><span class="line">       <span class="keyword">return</span> <span class="literal">false</span>  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="comment">// è¯»é”è¢«å ç”¨</span></span><br><span class="line">    <span class="keyword">if</span> !rw.readerCount.CompareAndSwap(<span class="number">0</span>, -rwmutexMaxReaders) &#123;  </span><br><span class="line">       rw.w.Unlock()  </span><br><span class="line">       <span class="keyword">return</span> <span class="literal">false</span>  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// TryRLock å°è¯•é”å®š rw ä»¥è¿›è¡Œè¯»å–ï¼Œå¹¶æŠ¥å‘Šæ˜¯å¦æˆåŠŸã€‚ </span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(rw *RWMutex)</span></span> TryRLock() <span class="type">bool</span> &#123; </span><br><span class="line">	<span class="keyword">for</span> &#123; </span><br><span class="line">		c := rw.readerCount.Load() </span><br><span class="line">		<span class="comment">// æœ‰ goroutine æŒæœ‰å†™é” </span></span><br><span class="line">		<span class="keyword">if</span> c &lt; <span class="number">0</span> &#123; </span><br><span class="line">			<span class="keyword">return</span> <span class="literal">false</span> </span><br><span class="line">		&#125; </span><br><span class="line">		<span class="comment">// å°è¯•è·å–è¯»é” </span></span><br><span class="line">		<span class="keyword">if</span> rw.readerCount.CompareAndSwap(c, c+<span class="number">1</span>) &#123;</span><br><span class="line">		 <span class="keyword">return</span> <span class="literal">true</span> </span><br><span class="line">		&#125; </span><br><span class="line">	&#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="äº‰è®®ç‚¹"><a href="#äº‰è®®ç‚¹" class="headerlink" title="äº‰è®®ç‚¹"></a>äº‰è®®ç‚¹</h1><p>Mutexé‚£äº›äº‰è®®ç‚¹ï¼Œåœ¨RWMutex è¿™é‡Œä¹Ÿå­˜åœ¨ï¼Œæ¯”å¦‚ä¸å¯é‡å…¥ï¼Œä¸å¯å¤åˆ¶ï¼Œå†™ä»£ç çš„æ—¶å€™éœ€è¦ä»”ç»†è€ƒè™‘ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä¸€ä¸ªRWmutex é”™è¯¯çš„ä½¿ç”¨ä¾‹å­</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> mu sync.RWMutex</span><br><span class="line"></span><br><span class="line">    <span class="comment">// writer,ç¨å¾®ç­‰å¾…ï¼Œç„¶ååˆ¶é€ ä¸€ä¸ªè°ƒç”¨Lockçš„åœºæ™¯</span></span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        time.Sleep(<span class="number">200</span> * time.Millisecond)</span><br><span class="line">        mu.Lock()</span><br><span class="line">        fmt.Println(<span class="string">&quot;Lock&quot;</span>)</span><br><span class="line">        time.Sleep(<span class="number">100</span> * time.Millisecond)</span><br><span class="line">        mu.Unlock()</span><br><span class="line">        fmt.Println(<span class="string">&quot;Unlock&quot;</span>)</span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        factorial(&amp;mu, <span class="number">10</span>) <span class="comment">// è®¡ç®—10çš„é˜¶ä¹˜, 10!</span></span><br><span class="line">    &#125;()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">select</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€’å½’è°ƒç”¨è®¡ç®—é˜¶ä¹˜</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">factorial</span><span class="params">(m *sync.RWMutex, n <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> n &lt; <span class="number">1</span> &#123; <span class="comment">// é˜¶ä¹˜é€€å‡ºæ¡ä»¶ </span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(<span class="string">&quot;RLock&quot;</span>)</span><br><span class="line">    m.RLock()</span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;RUnlock&quot;</span>)</span><br><span class="line">        m.RUnlock()</span><br><span class="line">    &#125;()</span><br><span class="line">    time.Sleep(<span class="number">100</span> * time.Millisecond)</span><br><span class="line">    <span class="keyword">return</span> factorial(m, n<span class="number">-1</span>) * n <span class="comment">// é€’å½’è°ƒç”¨</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><ol>
<li>RWMutex æ˜¯åŸºäºMutex å®ç°çš„ã€‚</li>
<li>åœ¨è¯»å¤šå†™å°‘çš„åœºæ™¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨RWMutex æ›¿ä»£Mutex æé«˜æ€§èƒ½ã€‚</li>
<li>åŒä¸€æ—¶é—´å†…ï¼Œå¯ä»¥æœ‰å¤šä¸ªreaderé€šè¿‡RLock()æŒæœ‰RWMutexï¼Œ</li>
<li>å½“ä¸€ä¸ªwirter é€šè¿‡Lock()åŠ é”æ—¶ï¼Œä¼šå…ˆé˜»æ­¢æ–°çš„reader åŠ é”ï¼Œç„¶åç­‰å¾…æ‰€æœ‰çš„æ‰€æœ‰çš„readeré‡Šæ”¾åå†åŠ é”ã€‚</li>
<li>writer é€šè¿‡ULock()é‡Šæ”¾é”æ—¶ï¼Œä¼šå”¤é†’ç­‰å¾…çš„readerã€‚</li>
</ol>
]]></content>
      <categories>
        <category>golang</category>
      </categories>
      <tags>
        <tag>go</tag>
      </tags>
  </entry>
  <entry>
    <title>go trace view trace æ˜¾ç¤ºç©ºç™½</title>
    <url>/2020/03/21/go%20trace%20view%20trace%20%E6%98%BE%E7%A4%BA%E7%A9%BA%E7%99%BD/</url>
    <content><![CDATA[<blockquote>
<p>go trace ç”¨æ¥è·Ÿè¸ª goroutinesè¿è¡Œæƒ…å†µ,è·Ÿpprofé…åˆä½¿ç”¨ï¼Œå¯ä»¥èµ·åˆ°äº‹åŠåŠŸå€çš„æ•ˆæœã€‚ä½†æ˜¯ï¼Œgo trace çš„view trace åœ¨chromeä¸‹ä¸€ç‰‡ç©ºç™½ã€‚</p>
</blockquote>
<p>åŸå› æ˜¯å› ä¸ºè°·æ­Œåœ¨æŸä¸€ç‰ˆæœ¬çš„chromeä¸­ç¦ç”¨äº†æœ¬åœ°<a href="crbug.com/1036492.">API</a></p>
<p>è§£å†³åŠæ³•ï¼š</p>
<ol>
<li>æ³¨å†Œä¸€ä¸ªchrome token <a href="https://developers.chrome.com/origintrials/#/register_trial/2431943798780067841">https://developers.chrome.com/origintrials/#/register_trial/2431943798780067841</a> èµ„æ–™éšä¾¿å¡«å†™ï¼Œè®°å¾—æœ€åä¸€å®šè¦ feedbackã€‚</li>
<li>ä¿®æ”¹ go trace ä»£ç  <code>src/cmd/trace/trace.go</code> åœ¨headä¸­æ·»åŠ ä¸€è¡Œ <meta http-equiv="origin-trial" content="YOUR_TOKEN_GOES_HERE"> ç„¶å<code> go install</code> ä¸€ä¸‹</li>
<li>åœ¨ $gopath&#x2F;misc&#x2F;trace&#x2F;trace_viewer_full.html ä¸­ çœ‹åˆ°</li>
</ol>
<p><img src="https://blog-image-1253555052.cos.ap-guangzhou.myqcloud.com/20200428161814.png"></p>
<p>è¯´æ˜é…ç½®æˆåŠŸï¼Œ</p>
<ol start="4">
<li>åœ¨ä½¿ç”¨ go traceå¾—æ—¶å€™èƒ½å¤Ÿæ­£å¸¸åŠ è½½å‡º view traceã€‚</li>
</ol>
<p>Enjoyï¼</p>
]]></content>
      <categories>
        <category>go</category>
      </categories>
      <tags>
        <tag>Go</tag>
        <tag>æœ€ä½³å®è·µ</tag>
      </tags>
  </entry>
  <entry>
    <title>go æ€ä¹ˆåšstw</title>
    <url>/2020/04/28/go%20%E6%80%8E%E6%A0%B7%E5%81%9A%20stw/</url>
    <content><![CDATA[<blockquote>
<p>åŸæ–‡é“¾æ¥:  <a href="https://medium.com/a-journey-with-go/go-how-does-go-stop-the-world-1ffab8bc8846">Go: How Does Go Stop the World? </a>:<br>Author :   <a href="https://medium.com/@blanchon.vincent?source=post_page-----1ffab8bc8846----------------------">Vincent Blanchon</a></p>
</blockquote>
<p><strong>æœ¬æ–‡åŸºäº go 1.13</strong></p>
<p>åœ¨åƒåœ¾å›æ”¶ç®—æ³•ä¸­ï¼ŒStop The Wordï¼ˆSTWï¼‰æ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„æ¦‚å¿µï¼Œä»–ä¼šä¸­æ–­ç¨‹åºè¿è¡Œï¼Œæ·»åŠ å†™å±éšœï¼Œ<code>ä»¥ä¾¿æ‰«æå†…å­˜</code> ,ç°åœ¨ä¸€èµ·æ¥çœ‹çœ‹å®ƒå†…éƒ¨çš„åŸç†ä»¥åŠå¯èƒ½å­˜åœ¨çš„é—®é¢˜</p>
<h1 id="STW"><a href="#STW" class="headerlink" title="STW"></a>STW</h1><p>åœæ­¢ç¨‹åºè¿è¡Œæ„å‘³ç€åœæ­¢æ‰€æœ‰è¿è¡Œæ€çš„<code>goroutines</code>,ä¸€ä¸ªç®€å•çš„ä¾‹å­:</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   runtime.GC()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œåƒåœ¾å›æ”¶ç®—æ³•å°†è§¦å‘ä¸¤ä¸ªé˜¶æ®µçš„STW </p>
<blockquote>
<p>æœ‰å…³åƒåœ¾å›æ”¶çš„æ›´å¤šç»†èŠ‚ï¼Œè¯·å‚è€ƒåŒä½œè€…çš„å¦å¤–ä¸€ç¯‡æ–‡ç« <em>â€œ</em><a href="https://medium.com/a-journey-with-go/go-how-does-the-garbage-collector-mark-the-memory-72cfc12c6976"><em>Go: How Does the Garbage Collector Mark the Memory?</em></a></p>
</blockquote>
<h2 id="STWçš„æ­¥éª¤"><a href="#STWçš„æ­¥éª¤" class="headerlink" title="STWçš„æ­¥éª¤"></a>STWçš„æ­¥éª¤</h2><p>ç¬¬ä¸€æ­¥ï¼ŒæŠ¢å æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„<code>goroutines</code></p>
<p><img src="https://blog-image-1253555052.cos.ap-guangzhou.myqcloud.com/20200428164159.png"></p>
<p>ç¬¬äºŒæ­¥ï¼Œä¸€æ—¦ <code>goroutines</code>è¢«æŠ¢å ï¼Œæ­£åœ¨è¿è¡Œçš„<code>goroutines</code>å°†åœ¨å®‰å…¨çš„åœ°æ–¹æš‚åœï¼Œç„¶åæ‰€æœ‰çš„p<sup>[1]</sup>éƒ½å°†è¢«æ ‡è®°ä¸ºæš‚åœï¼Œåœæ­¢è¿è¡Œä»»ä½•ä»£ç ã€‚</p>
<p><img src="https://blog-image-1253555052.cos.ap-guangzhou.myqcloud.com/20200428164444.png"></p>
<p>ç¬¬ä¸‰æ­¥ï¼Œç„¶åï¼Œgoè°ƒåº¦å™¨å°†M<sup>[2]</sup>ä¸Påˆ†ç¦»,å¹¶ä¸”å°†Mæ”¾åˆ°ç©ºé—²åˆ—è¡¨é‡Œé¢ã€‚</p>
<p><img src="https://blog-image-1253555052.cos.ap-guangzhou.myqcloud.com/20200428164609.png"></p>
<p>å¯¹äºåœ¨æ¯ä¸ªMä¸Šè¿è¡Œçš„Goroutinesï¼Œå®ƒä»¬å°†åœ¨å…¨å±€é˜Ÿåˆ—<sup>[3]</sup>&gt;ä¸­ç­‰å¾…ï¼š</p>
<p><img src="https://blog-image-1253555052.cos.ap-guangzhou.myqcloud.com/20200428164654.png"></p>
<p>é‚£ä¹ˆï¼Œä¸€æ—¦æ‰€æœ‰çš„<code>goroutines</code>éƒ½åœæ­¢äº†ï¼Œé‚£ä¹ˆå”¯ä¸€æ´»è·ƒçš„<code>goroutines</code> ï¼ˆåƒåœ¾å›æ”¶<code>goroutines</code>ï¼‰å°†ä¼šå®‰å…¨çš„è¿è¡Œï¼Œå¹¶ä¸”åœ¨åƒåœ¾å›æ”¶å®Œæˆåï¼Œé‡æ–°æ‹‰èµ·æ‰€æœ‰çš„<code>goroutines</code>ã€‚å…·ä½“æƒ…å†µï¼Œå¯ä»¥é€šè¿‡ go traceæŸ¥çœ‹ã€‚</p>
<p><img src="https://blog-image-1253555052.cos.ap-guangzhou.myqcloud.com/20200428165140.png"></p>
<h1 id="System-calls"><a href="#System-calls" class="headerlink" title="System calls"></a>System calls</h1><p>STWæ—¶æœŸå¯èƒ½ä¼šå½±å“ç³»ç»Ÿè°ƒç”¨ï¼Œå› ä¸ºç³»ç»Ÿè°ƒç”¨å¯èƒ½ä¼šåœ¨stwæ—¶æœŸè¿”å›ï¼Œé€šè¿‡å¯†é›†æ‰§è¡Œç³»ç»Ÿè°ƒç”¨çš„ç¨‹åºæ¥çœ‹çœ‹æ€æ ·å¤„ç†è¿™ç§æƒ…å†µï¼Œ</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line">   wg.Add(<span class="number">10</span>)   <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">      <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">         http.Get(<span class="string">`https://httpstat.us/200`</span>)</span><br><span class="line">         wg.Done()</span><br><span class="line">      &#125;()</span><br><span class="line">   &#125;   wg.Wait()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»–çš„traceæƒ…å†µã€‚</p>
<p><img src="https://blog-image-1253555052.cos.ap-guangzhou.myqcloud.com/20200428165604.png"></p>
<p>ç³»ç»Ÿè°ƒç”¨åœ¨STWæ—¶æœŸè¿”å›ï¼Œä½†æ˜¯ç°åœ¨å·²ç»æ²¡æœ‰Påœ¨è¿è¡Œäº†ã€‚æ‰€ä»¥ä»–ä¼šæ”¾åˆ°å…¨å±€é˜Ÿåˆ—é‡Œé¢,ç­‰å¾…STWç»“æŸåå†è¿è¡Œã€‚</p>
<h1 id="Latencies"><a href="#Latencies" class="headerlink" title="Latencies"></a>Latencies</h1><p>STWçš„ç¬¬ä¸‰æ­¥å°†æ‰€æœ‰çš„Mä¸Påˆ†ç¦»ã€‚ç„¶è€Œï¼Œgoå°†ç­‰å¾…è°ƒåº¦ç¨‹åºè¿è¡Œã€ç³»ç»Ÿè°ƒç”¨ç­‰è‡ªåŠ¨åœæ­¢ã€‚ç­‰å¾…goroutineè¢«æŠ¢å åº”è¯¥å¾ˆå¿«ï¼Œä½†æ˜¯åœ¨æŸäº›æƒ…å†µä¸‹ä¼šäº§ç”Ÿä¸€äº›å»¶è¿Ÿï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªæç«¯çš„ä¾‹å­ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="keyword">var</span> t <span class="type">int</span></span><br><span class="line">   <span class="keyword">for</span> i := <span class="number">0</span>;i &lt; <span class="number">20</span> ;i++  &#123;</span><br><span class="line">      <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">         <span class="keyword">for</span> i := <span class="number">0</span>;i &lt; <span class="number">1000000000</span> ;i++ &#123;</span><br><span class="line">            t++</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;()</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   runtime.GC()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>STWæ—¶é•¿è¾¾åˆ°äº†2.6S</p>
<p><img src="https://blog-image-1253555052.cos.ap-guangzhou.myqcloud.com/20200428172521.png"></p>
<p>æ²¡æœ‰å‡½æ•°è°ƒç”¨çš„goroutineå°†ä¸ä¼šè¢«æŠ¢å ï¼Œå¹¶ä¸”å®ƒçš„Påœ¨ä»»åŠ¡ç»“æŸä¹‹å‰ä¸ä¼šè¢«é‡Šæ”¾ã€‚è¿™å°†è¿«ä½¿STWç­‰å¾…ä»–ï¼Œ æœ‰å‡ ç§è§£å†³æ–¹æ¡ˆå¯æ”¹å–„å¾ªç¯ä¸­çš„æŠ¢å ï¼Œæœ‰å…³å…¶çš„æ›´å¤šä¿¡æ¯ï¼Œå¯ä»¥æŸ¥çœ‹ä½œè€…å¦å¤–ä¸€ç¯‡æ–‡ç«  [<a href="https://medium.com/a-journey-with-go/go-goroutine-and-preemption-d6bc2aa2f4b7">Go: Goroutine and Preemption).</a></p>
]]></content>
      <categories>
        <category>go</category>
      </categories>
      <tags>
        <tag>go</tag>
      </tags>
  </entry>
  <entry>
    <title>Go è§£å¯†ï¼španic å‡ºç°çš„ä¸‰ç§åŸå› </title>
    <url>/2024/04/02/Go%20%E8%A7%A3%E5%AF%86%EF%BC%9Apanic%20%E5%87%BA%E7%8E%B0%E7%9A%84%E4%B8%89%E7%A7%8D%E5%8E%9F%E5%9B%A0/</url>
    <content><![CDATA[<h1 id="panic-æ˜¯ä»€ä¹ˆ"><a href="#panic-æ˜¯ä»€ä¹ˆ" class="headerlink" title="panic æ˜¯ä»€ä¹ˆ"></a>panic æ˜¯ä»€ä¹ˆ</h1><p>åˆå­¦ Go çš„æ—¶å€™ï¼Œå¿ƒé‡Œå¸¸å¸¸å¾ˆå¤šç–‘é—®ï¼Œæœ‰æ—¶å€™çœ‹ä¼¼æ‡‚äº†çš„é—®é¢˜ï¼Œå…¶å®æ˜¯æ˜¯è€Œéã€‚<br>panic ç©¶ç«Ÿæ˜¯ä»€ä¹ˆï¼Ÿçœ‹ä¼¼æ˜¾è€Œæ˜“è§çš„é—®é¢˜ï¼Œä½†æ˜¯å´å›ç­”ä¸å‡ºä¸ªæ‰€ä»¥ç„¶æ¥ã€‚ä»Šå¤©æˆ‘æƒ³å½»åº•ææ‡‚è¿™ä¸ªé—®é¢˜ã€‚</p>
<span id="more"></span>
<h1 id="panic-çš„ä¸‰ç§åŸå› "><a href="#panic-çš„ä¸‰ç§åŸå› " class="headerlink" title="panic çš„ä¸‰ç§åŸå› "></a>panic çš„ä¸‰ç§åŸå› </h1><p>ä»€ä¹ˆæ—¶å€™ä¼šäº§ç”Ÿ panic ï¼Ÿ  æˆ‘ä»¬å…ˆä»â€œå½¢â€æ¥å­¦ä¹ ã€‚ä»å¼€å‘è€…çš„è§’åº¦æ¥çœ‹ï¼Œå¯ä»¥åˆ†ä¸ºä¸»åŠ¨å’Œè¢«åŠ¨æ–¹å¼ï¼Œè¢«åŠ¨çš„æ–¹å¼æœ‰ä¸¤ç§ï¼Œå¦‚ä¸‹ï¼š<br><strong>ä¸»åŠ¨æ–¹å¼</strong>ï¼š</p>
<ul>
<li>å¼€å‘è€…ä¸»åŠ¨è°ƒç”¨ <code>panic()</code> å‡½æ•°ï¼›<br><strong>è¢«åŠ¨çš„æ–¹å¼</strong>ï¼š</li>
<li>ç¼–è¯‘å™¨çš„éšè—ä»£ç è§¦å‘ï¼›</li>
<li>å†…æ ¸å‘é€ç»™è¿›ç¨‹ä¿¡å·è§¦å‘ ï¼›</li>
</ul>
<h2 id="ç¼–è¯‘å™¨çš„éšè—ä»£ç "><a href="#ç¼–è¯‘å™¨çš„éšè—ä»£ç " class="headerlink" title="ç¼–è¯‘å™¨çš„éšè—ä»£ç "></a>ç¼–è¯‘å™¨çš„éšè—ä»£ç </h2><p>Go ä¹‹æ‰€ä»¥ç®€å•åˆå¼ºå¤§ï¼Œç¼–è¯‘å™¨å±…åŠŸè‡³ä¼Ÿã€‚éå¸¸å¤šçš„äº‹æƒ…æ˜¯ç¼–è¯‘å™¨å¸®ç¨‹åºçŒ¿åšäº†çš„ï¼Œé€»è¾‘è¡¥å……ï¼Œå†…å­˜çš„é€ƒé€¸åˆ†æç­‰ç­‰ã€‚<br><strong>åŒ…æ‹¬ panic çš„æŠ›å‡ºï¼</strong><br>ä¸¾ä¸ªéå¸¸å…¸å‹çš„ä¾‹å­ï¼šæ•´æ•°ç®—æ³•<strong>é™¤é›¶</strong>ä¼šå‘ç”Ÿ panicï¼Œæ€ä¹ˆåšåˆ°çš„ï¼Ÿ<br>çœ‹ä¸€æ®µæç®€ä»£ç ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">divzero</span><span class="params">(a, b <span class="type">int</span>)</span></span> <span class="type">int</span> &#123; </span><br><span class="line">	c := a/b </span><br><span class="line">	<span class="keyword">return</span> c </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢å‡½æ•°å°±ä¼šæœ‰é™¤é›¶çš„é£é™©ï¼Œå½“ b ç­‰äº 0 çš„æ—¶å€™ï¼Œç¨‹åºå°±ä¼šè§¦å‘ panicï¼Œç„¶åé€€å‡ºï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">root@ubuntu:~/code/gopher/src/panic<span class="comment"># ./test_zero panic: runtime error: integer divide by zero goroutine 1 [running]: main.zero(0x64, 0x0, 0x0) /root/code/gopher/src/panic/test_zero.go:6 +0x52</span></span><br></pre></td></tr></table></figure>

<p><strong>é—®é¢˜æ¥äº†ï¼šç¨‹åºæ€ä¹ˆè§¦å‘çš„ panic ï¼Ÿ</strong><br><strong>ä»£ç é¢å‰æ— ç§˜å¯†ã€‚</strong><br>å¯ä»£ç çœ‹ä¸å‡ºå•¥å‘€ï¼Œä¸å°±æ˜¯ä¸€è¡Œ <code>c := a/b</code> å˜›ï¼Ÿ<br>æ˜¯<strong>æ±‡ç¼–ä»£ç </strong>ã€‚<strong>å› ä¸ºè¿™æ®µéšè—èµ·æ¥çš„é€»è¾‘ï¼Œæ˜¯ç¼–è¯‘å™¨å¸®ä½ åŠ çš„ã€‚</strong><br>ç”¨ dlv è°ƒè¯•æ–­ç‚¹åˆ° <code>divzero</code> å‡½æ•°ï¼Œç„¶åæ‰§è¡Œ <code>disassemble</code> ï¼Œä½ å°±èƒ½çœ‹åˆ°ç§˜å¯†äº†ã€‚æˆªå–éƒ¨åˆ†æ±‡ç¼–ï¼Œå¹¶å¤‡æ³¨äº†ä¸‹ï¼š</p>
<figure class="highlight x86asm"><table><tr><td class="code"><pre><span class="line"> (dlv) disassemble</span><br><span class="line">TEXT main<span class="number">.</span><span class="meta">zero</span>(SB) /root/code/gopher/src/panic/test_zero<span class="number">.</span>go</span><br><span class="line">    // åˆ¤æ–­ b æ˜¯å¦ç­‰äº <span class="number">0</span> </span><br><span class="line"><span class="symbol">    test_zero.go:</span><span class="number">6</span>  <span class="number">0x4aa3c1</span>    4885c9          <span class="keyword">test</span> <span class="built_in">rcx</span>, <span class="built_in">rcx</span></span><br><span class="line">    // ä¸ç­‰äº <span class="number">0</span> å°±è·³è½¬åˆ° <span class="number">0x4aa3c8</span> æ‰§è¡ŒæŒ‡ä»¤ï¼Œå¦åˆ™å°±å¾€ä¸‹æ‰§è¡Œ</span><br><span class="line"><span class="symbol">    test_zero.go:</span><span class="number">6</span>  <span class="number">0x4aa3c4</span>    <span class="number">7502</span>            <span class="keyword">jnz</span> <span class="number">0x4aa3c8</span></span><br><span class="line">    // æ‰§è¡Œåˆ°è¿™é‡Œï¼Œå°±è¯´æ˜ b æ˜¯ <span class="number">0</span> å€¼ï¼Œå°±è·³è½¬åˆ° <span class="number">0x4aa3ed</span> ï¼Œä¹Ÿå°±æ˜¯ <span class="keyword">call</span> $runtime<span class="number">.</span>panicdivide</span><br><span class="line">=&gt;  test_zero<span class="number">.</span>go:<span class="number">6</span>  <span class="number">0x4aa3c6</span>    eb25            <span class="keyword">jmp</span> <span class="number">0x4aa3ed</span></span><br><span class="line"><span class="symbol">    test_zero.go:</span><span class="number">6</span>  <span class="number">0x4aa3c8</span>    4883f9ff        <span class="keyword">cmp</span> <span class="built_in">rcx</span>, -<span class="number">0x1</span></span><br><span class="line"><span class="symbol">    test_zero.go:</span><span class="number">6</span>  <span class="number">0x4aa3cc</span>    <span class="number">7407</span>            <span class="keyword">jz</span> <span class="number">0x4aa3d5</span></span><br><span class="line"><span class="symbol">    test_zero.go:</span><span class="number">6</span>  <span class="number">0x4aa3ce</span>    <span class="number">4899</span>            <span class="keyword">cqo</span></span><br><span class="line"><span class="symbol">    test_zero.go:</span><span class="number">6</span>  <span class="number">0x4aa3d0</span>    48f7f9          <span class="keyword">idiv</span> <span class="built_in">rcx</span></span><br><span class="line">    // ...</span><br><span class="line"><span class="symbol">    test_zero.go:</span><span class="number">7</span>  <span class="number">0x4aa3ec</span>    c3              <span class="keyword">ret</span></span><br><span class="line">    // çœ‹åˆ°ç¥å¥‡çš„å‡½æ•°äº†å˜› ï¼</span><br><span class="line"><span class="symbol">    test_zero.go:</span><span class="number">6</span>  <span class="number">0x4aa3ed</span>    e8ee27f8ff      <span class="keyword">call</span> $runtime<span class="number">.</span>panicdivide</span><br></pre></td></tr></table></figure>

<p>çœ‹åˆ°ç§˜å¯†çš„å‡½æ•°äº†å—ï¼Ÿ<br><strong>ç¼–è¯‘å™¨å·å·åŠ ä¸Šäº†</strong>ä¸€æ®µ <code>if/else</code> çš„åˆ¤æ–­é€»è¾‘ï¼Œå¹¶ä¸”è¿˜ç»™åŠ äº† <code>runtime.panicdivide</code> çš„ä»£ç ã€‚</p>
<ol>
<li>å¦‚æœ b &#x3D;&#x3D; 0 ï¼Œé‚£ä¹ˆè·³è½¬æ‰§è¡Œå‡½æ•° <code>runtime.panicdivide</code> ï¼›<br>å†æ¥çœ‹ä¸€çœ¼ <code>panicdivide</code> å‡½æ•°ï¼Œè¿™æ˜¯ä¸€æ®µæç®€çš„å°è£…ï¼š</li>
</ol>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// runtime/panic.go</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">panicdivide</span><span class="params">()</span></span> &#123;</span><br><span class="line">    panicCheck2(<span class="string">&quot;integer divide by zero&quot;</span>)</span><br><span class="line">    <span class="built_in">panic</span>(divideError)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>çœ‹åˆ°äº†ä¸ï¼Œè¿™é‡Œé¢è°ƒç”¨çš„å°±æ˜¯ <code>panic()</code> å‡½æ•°ã€‚<br>é™¤é›¶è§¦å‘çš„ panic å°±æ˜¯è¿™æ ·æ¥çš„ï¼Œå®ƒä¸æ˜¯çŸ³å¤´é‡Œè¹¦å‡ºæ¥çš„ï¼Œè€Œæ˜¯ç¼–è¯‘å™¨å¤šåŠ çš„é€»è¾‘åˆ¤æ–­ä¿è¯äº†é™¤æ•°ä¸º 0 çš„æ—¶å€™ï¼Œè§¦å‘ panic å‡½æ•°ã€‚<br>ç¼–è¯‘å™¨åŠ çš„éšè—é€»è¾‘ï¼Œè°ƒç”¨äº†æŠ›å‡º panic çš„å‡½æ•°ã€‚</p>
<h2 id="è¿›ç¨‹ä¿¡å·è§¦å‘"><a href="#è¿›ç¨‹ä¿¡å·è§¦å‘" class="headerlink" title="è¿›ç¨‹ä¿¡å·è§¦å‘"></a>è¿›ç¨‹ä¿¡å·è§¦å‘</h2><p>æœ€å…¸å‹çš„æ˜¯<strong>éæ³•åœ°å€è®¿é—®</strong>ï¼Œæ¯”å¦‚ï¼Œ nil æŒ‡é’ˆ è®¿é—®ä¼šè§¦å‘ panicï¼Œæ€ä¹ˆåšåˆ°çš„ï¼Ÿ</p>
<p>çœ‹ä¸€ä¸ªæç®€çš„ä¾‹å­ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">nilptr</span><span class="params">(b *<span class="type">int</span>)</span></span> <span class="type">int</span> &#123; c := *b <span class="keyword">return</span> c &#125;</span><br></pre></td></tr></table></figure>

<p>å½“è°ƒç”¨ <code>nilptr( nil )</code> çš„æ—¶å€™ï¼Œå°†ä¼šå¯¼è‡´è¿›ç¨‹å¼‚å¸¸é€€å‡ºï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">root@ubuntu:~/code/gopher/src/panic<span class="comment"># ./test_nil panic: runtime error: invalid memory address or nil pointer dereference [signal SIGSEGV: segmentation violation code=0x1 addr=0x0 pc=0x4aa3bc] goroutine 1 [running]: main.nilptr(0x0, 0x0) /root/code/gopher/src/panic/test_nil.go:6 +0x1c</span></span><br></pre></td></tr></table></figure>

<p>é—®é¢˜æ¥äº†ï¼šè¿™é‡Œçš„ panic åˆæ˜¯æ€ä¹ˆå½¢æˆçš„å‘¢ï¼Ÿ</p>
<p>åœ¨ Go è¿›ç¨‹å¯åŠ¨çš„æ—¶å€™ä¼šæ³¨å†Œé»˜è®¤çš„ä¿¡å·å¤„ç†ç¨‹åºï¼ˆ <code>sigtramp</code> ï¼‰</p>
<p>åœ¨ cpu è®¿é—®åˆ° 0 åœ°å€ä¼šè§¦å‘ page fault å¼‚å¸¸ï¼Œè¿™æ˜¯ä¸€ä¸ªéæ³•åœ°å€ï¼Œå†…æ ¸ä¼šå‘é€ <code>SIGSEGV</code> ä¿¡å·ç»™è¿›ç¨‹ï¼Œæ‰€ä»¥å½“æ”¶åˆ° <code>SIGSEGV</code> ä¿¡å·çš„æ—¶å€™ï¼Œå°±ä¼šè®© <code>sigtramp</code> å‡½æ•°æ¥å¤„ç†ï¼Œæœ€ç»ˆè°ƒç”¨åˆ° <code>panic</code> å‡½æ•° ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sigtramp ï¼ˆçº¯æ±‡ç¼–ä»£ç ï¼‰ </span><br><span class="line">	-&gt; sigtrampgo ï¼ˆ signal_unix.go ï¼‰ </span><br><span class="line">		-&gt; sighandler ï¼ˆ signal_sighandler.go ï¼‰ </span><br><span class="line">			-&gt; preparePanic ï¼ˆ signal_amd64x.go ï¼‰ </span><br><span class="line">				-&gt; sigpanic ï¼ˆ signal_unix.go ï¼‰ </span><br><span class="line">					-&gt; panicmem </span><br><span class="line">						-&gt; panic </span><br></pre></td></tr></table></figure>

<p>åœ¨ <code>sigpanic</code> å‡½æ•°ä¸­ä¼šè°ƒç”¨åˆ° <code>panicmem</code> ï¼Œåœ¨è¿™ä¸ªé‡Œé¢å°±ä¼šè°ƒç”¨ panic å‡½æ•°ï¼Œä»è€Œèµ°ä¸Šäº† Go è‡ªå·±çš„ panic ä¹‹è·¯ã€‚</p>
<p><code>panicmem</code> å’Œ <code>panicdivide</code> ç±»ä¼¼ï¼Œéƒ½æ˜¯å¯¹ <code>panic( )</code> çš„æç®€å°è£…ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">panicmem</span><span class="params">()</span></span> &#123;</span><br><span class="line">	panicCheck2(<span class="string">&quot;invalid memory address or nil pointer dereference&quot;</span>)</span><br><span class="line">	<span class="built_in">panic</span>(memoryError) </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>è¿™ç§æ–¹å¼æ˜¯é€šè¿‡ä¿¡å·è½¯ä¸­æ–­çš„æ–¹å¼æ¥èµ°åˆ° Go æ³¨å†Œçš„ä¿¡å·å¤„ç†é€»è¾‘ï¼Œä»è€Œè°ƒç”¨åˆ° <code>panic( )</code> çš„å‡½æ•°ã€‚</strong><br>gophers å¯èƒ½ä¼šå¥½å¥‡ï¼Œä¿¡å·å¤„ç†çš„é€»è¾‘ä»€ä¹ˆæ—¶å€™æ³¨å†Œè¿›å»çš„ï¼Ÿ<br>åœ¨è¿›ç¨‹åˆå§‹åŒ–çš„æ—¶å€™ï¼Œåˆ›å»º M0ï¼ˆçº¿ç¨‹ï¼‰çš„æ—¶å€™ç”¨ç³»ç»Ÿè°ƒç”¨ <code>sigaction</code> ç»™ä¿¡å·æ³¨å†Œå¤„ç†å‡½æ•°ä¸º <code>sigtramp</code> ï¼Œè°ƒç”¨æ ˆå¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mstartm0 ï¼ˆproc.goï¼‰ </span><br><span class="line">	-&gt; initsig (signal_unix.go:113) </span><br><span class="line">		-&gt; setsig ï¼ˆos_linux.goï¼‰</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·çš„è¯ï¼Œä»¥åè§¦å‘äº†ä¿¡å·è½¯ä¸­æ–­ï¼Œå°±èƒ½è°ƒç”¨åˆ° Go çš„ä¿¡å·å¤„ç†å‡½æ•°ï¼Œä»è€Œè¿›è¡Œè¯­è¨€å±‚é¢çš„ panic å¤„ç† ã€‚<br>æ€»çš„æ¥è¯´ï¼Œè¿™ä¸ªæ˜¯ä»ç³»ç»Ÿå±‚é¢åˆ°ç‰¹å®šè¯­è¨€å±‚é¢çš„å¤„ç†è½¬å˜ã€‚</p>
<h2 id="å¼€å‘è€…ä¸»åŠ¨panic"><a href="#å¼€å‘è€…ä¸»åŠ¨panic" class="headerlink" title="å¼€å‘è€…ä¸»åŠ¨panic"></a>å¼€å‘è€…ä¸»åŠ¨panic</h2><p>ç¬¬ä¸‰ç§æ–¹å¼ï¼Œå°±æ˜¯å¼€å‘è€…è‡ªå·±ä¸»åŠ¨è°ƒç”¨ <code>panic</code> æŠ›å‡ºæ¥çš„ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123; </span><br><span class="line">	<span class="built_in">panic</span>(<span class="string">&quot;panic test&quot;</span>) </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç®€å•çš„å‡½æ•°è°ƒç”¨ï¼Œè¿™ä¸ªè¶…ç®€å•çš„ã€‚</p>
<h1 id="èŠèŠ-panic-åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#èŠèŠ-panic-åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="èŠèŠ panic åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ"></a>èŠèŠ panic åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ</h1><p>ç°åœ¨æˆ‘ä»¬æ‘¸é€äº† panic äº§ç”Ÿçš„å§¿åŠ¿ï¼Œä»¥ä¸Šä¸‰ç§æ–¹å¼ï¼Œæ— è®ºå“ªä¸€ç§éƒ½å½’ä¸€åˆ° <code>panic( )</code> è¿™ä¸ªå‡½æ•°è°ƒç”¨ã€‚<strong>æ‰€ä»¥æœ‰ä¸€ç‚¹å¾ˆæ˜ç¡®ï¼španic è¿™ä¸ªä¸œè¥¿æ˜¯è¯­è¨€å±‚é¢çš„å¤„ç†é€»è¾‘ã€‚</strong></p>
<p>panic å‘ç”Ÿä¹‹åï¼Œå¦‚æœ Go ä¸åšä»»ä½•ç‰¹æ®Šå¤„ç†ï¼Œé»˜è®¤è¡Œä¸ºæ˜¯æ‰“å°å †æ ˆï¼Œé€€å‡ºç¨‹åºã€‚<br>ç°åœ¨å›åˆ°æœ€æœ¬æºçš„é—®é¢˜ï¼španic åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ<br>è¿™é‡Œä¸çº ç»“æ¦‚å¿µï¼Œåªæè¿°å‡ ä¸ªç®€å•çš„äº‹å®ï¼š</p>
<ol>
<li><code>panic()</code> å‡½æ•°å†…éƒ¨ä¼šäº§ç”Ÿä¸€ä¸ªå…³é”®çš„æ•°æ®ç»“æ„ä½“ <code>_panic</code> ï¼Œå¹¶ä¸”æŒ‚æ¥åˆ° goroutine ä¹‹ä¸Šï¼›</li>
<li><code>panic()</code> å‡½æ•°å†…éƒ¨ä¼šæ‰§è¡Œ <code>_defer</code> å‡½æ•°é“¾æ¡ï¼Œå¹¶é’ˆå¯¹ <code>_panic</code> çš„çŠ¶æ€è¿›è¡Œ<strong>å¯¹åº”çš„å¤„ç†</strong>ï¼›</li>
</ol>
<p>ä»€ä¹ˆå«åš <code>panic()</code> çš„å¯¹åº”çš„å¤„ç†ï¼Ÿ<br>å¾ªç¯æ‰§è¡Œ goroutine ä¸Šé¢çš„ <code>_defer</code> å‡½æ•°é“¾ï¼Œå¦‚æœæ‰§è¡Œå®Œäº†éƒ½è¿˜æ²¡æœ‰æ¢å¤ <code>_panic</code> çš„çŠ¶æ€ï¼Œé‚£å°±æ²¡å¾—åŠæ³•äº†ï¼Œ<strong>é€€å‡ºè¿›ç¨‹ï¼Œæ‰“å°å †æ ˆ</strong>ã€‚</p>
<p>å¦‚æœåœ¨ goroutine çš„ <code>_defer</code> é“¾ä¸Šï¼Œæœ‰ä¸ªæœ‹å‹ recover äº†ä¸€ä¸‹ï¼ŒæŠŠè¿™ä¸ª <code>_panic</code> æ ‡è®°æˆæ¢å¤ï¼Œé‚£äº‹æƒ…å°±åˆ°æ­¤ä¸ºæ­¢ï¼Œå°±ä»è¿™ä¸ª <code>_defer</code> å‡½æ•°æ‰§è¡Œåç»­æ­£å¸¸ä»£ç å³å¯ï¼Œèµ° <code>deferreturn</code> çš„é€»è¾‘ã€‚</p>
<p><strong>æ‰€ä»¥ï¼Œpanic æ˜¯ä»€ä¹ˆ ï¼Ÿ</strong><br>å®ƒå°±æ˜¯ä¸ªç‰¹æ®Šå‡½æ•°è°ƒç”¨ï¼Œä»…æ­¤è€Œå·²ã€‚<br>æœ‰å¤šç‰¹æ®Šï¼Ÿæˆ‘ä¼šåœ¨ä¸‹ç¯‡å‰–æå…¶æ·±åº¦åŸç†ã€‚å¯ä»¥å…ˆæ€è€ƒå‡ ä¸ªå°é—®é¢˜ï¼š</p>
<ul>
<li>panic ç©¶ç«Ÿæ˜¯å•¥ï¼Ÿæ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Ÿè¿˜æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Ÿ</li>
<li>ä¸ºä»€ä¹ˆ panic ä¼šè®© Go è¿›ç¨‹é€€å‡ºçš„ ï¼Ÿ</li>
<li>ä¸ºä»€ä¹ˆ recover ä¸€å®šè¦æ”¾åœ¨ defer é‡Œé¢æ‰ç”Ÿæ•ˆï¼Ÿ</li>
<li>ä¸ºä»€ä¹ˆ recover å·²ç»æ”¾åœ¨ defer é‡Œé¢ï¼Œä½†æ˜¯è¿›ç¨‹è¿˜æ˜¯æ²¡æœ‰æ¢å¤ï¼Ÿ</li>
<li>ä¸ºä»€ä¹ˆ panic ä¹‹åï¼Œè¿˜èƒ½å† panic ï¼Ÿæœ‰å•¥å½±å“ï¼Ÿ</li>
</ul>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ol>
<li>panic äº§ç”Ÿçš„ä¸‰å¤§å§¿åŠ¿ï¼šç¨‹åºçŒ¿ä¸»åŠ¨ï¼Œç¼–è¯‘å™¨è¾…åŠ©é€»è¾‘ï¼Œè½¯ä¸­æ–­ä¿¡å·è§¦å‘ï¼›</li>
<li>æ— è®ºå“ªä¸€ç§å§¿åŠ¿ï¼Œæœ€ç»ˆéƒ½æ˜¯å½’ä¸€åˆ° <code>panic()</code> å‡½æ•°çš„å¤„ç†ï¼Œpanic åªæ˜¯è¯­è¨€å±‚é¢çš„å¤„ç†é€»è¾‘ï¼›</li>
<li>panic å‘ç”Ÿä¹‹åï¼Œå¦‚æœä¸åšå¤„ç†ï¼Œé»˜è®¤è¡Œä¸ºæ˜¯æ‰“å° panic åŸå› ï¼Œæ‰“å°å †æ ˆï¼Œè¿›ç¨‹é€€å‡ºï¼›</li>
</ol>
]]></content>
      <categories>
        <category>golang</category>
      </categories>
      <tags>
        <tag>go</tag>
      </tags>
  </entry>
  <entry>
    <title>aws ec2 åˆ‡æ¢åˆ°ipv6</title>
    <url>/2023/12/12/aws%20ec2%20%E5%88%87%E6%8D%A2%E5%88%B0ipv6/</url>
    <content><![CDATA[<p>ipv6 å‡ºæ¥å·²ç»å¾ˆä¹…äº†ï¼Œå·¥ä½œä¸­ä¹Ÿå¤„ç†è¿‡å¾ˆå¤šæ¬¡ipv6çš„taskï¼Œä½†æ˜¯ä»æ¥æ²¡æƒ³è¿‡æŠŠè‡ªå·±çš„ec2åˆ‡æ¢åˆ°ipv4ï¼Œæ˜¨å¤©å†é‚®ä»¶å›æ”¶ç«™é‡Œé¢çœ‹åˆ°äº†ä¸€ä¸ªé‚®ä»¶ï¼Œaws çš„ipv4 2024.2.1 è¦æ”¶è´¹äº†ï¼Œè¿™å°±ä¸èƒ½å¿½ç•¥äº†ğŸ˜„ï¼Œåˆšå¥½ä»Šå¤©æœ‰ç©ºå°±æŠŠä»–åˆ‡æ¢æˆäº†ipv6ï¼Œè¿‡ç¨‹æœ‰ç‚¹æŠ˜è…¾ã€‚ æœ¬æ–‡ä¸ä»…é€‚ç”¨ec2ï¼Œå…¶ä»–linux ä¸»æœºåº”è¯¥ä¹Ÿæ”¯æŒã€‚</p>
<p><img src="https://images.hxzhouh.com/blog-images/2023/12/c08e861b12930298c2ed4aea11b1c523.png" alt="image-20231212145049883"><span id="more"></span></p>
<h1 id="ä¸ºec2-æ·»åŠ ä¸€ä¸ªipv6-åœ°å€"><a href="#ä¸ºec2-æ·»åŠ ä¸€ä¸ªipv6-åœ°å€" class="headerlink" title="ä¸ºec2 æ·»åŠ ä¸€ä¸ªipv6 åœ°å€"></a>ä¸ºec2 æ·»åŠ ä¸€ä¸ªipv6 åœ°å€</h1><p>æˆ‘çš„ec2 çš„dns è§£æåœ¨Cloudflareï¼Œæ‰€ä»¥ä¸»è¦æ˜¯å‚è€ƒè¿™ç¯‡åšå®¢ã€‚<a href="https://blog.cloudflare.com/zh-cn/amazon-2bn-ipv4-tax-how-avoid-paying-zh-cn/">Amazon çš„ 20 äº¿ IPv4 ç¨è´¹ â€” ä»¥åŠå¦‚ä½•é¿å…æ”¯ä»˜è¿™ç¬”è´¹ç”¨</a></p>
<p>ä»¥åŠ<a href="https://docs.aws.amazon.com/zh_cn/vpc/latest/userguide/vpc-migrate-ipv6.html">å°† VPC ä» IPv4 è¿ç§»åˆ° IPv6</a>ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯<a href="https://docs.aws.amazon.com/zh_cn/vpc/latest/userguide/vpc-migrate-ipv6.html">å°† VPC ä» IPv4 è¿ç§»åˆ° IPv6</a>ã€‚è¿™ä¸ªdemoä¸­vpcæ˜¯æœ‰ä¸€ä¸ªå…¬æœ‰å­ç½‘ä»¥åŠä¸€ä¸ªç§æœ‰å­ç½‘ï¼Œå¦‚æœæ‚¨åƒæˆ‘ä¸€æ ·åªæœ‰ä¸€ä¸ªå…¬æœ‰å­ç½‘ï¼Œé‚£è¿™éƒ¨åˆ†å°±ä¸éœ€è¦è®¾ç½®äº†ã€‚</p>
<p><img src="https://images.hxzhouh.com/blog-images/2023/12/7c757c6ffdd0c2d7ffff2f4c00e93f29.png" alt="image-20231212145739848"></p>
<p>ä¸å¾—ä¸è¯´ï¼Œaws çš„æ–‡æ¡£å†™çš„çœŸå¥½ï¼Œè¿™ä¸€ç‚¹ï¼Œéœ€è¦å¤šå¤šå­¦ä¹ ã€‚</p>
<p>è®¾ç½®å®Œæˆçš„ç»“æœåº”è¯¥æ˜¯è¿™æ ·çš„ã€‚åŒæ—¶æœ‰ipv4 ä¸ipv6 åœ°å€ã€‚åœ¨å®‰å…¨ç»„ä¸­ä¹Ÿä¸ºipv6æ·»åŠ ç›¸åŒçš„è§„åˆ™ã€‚</p>
<p><img src="https://images.hxzhouh.com/blog-images/2023/12/68699f4797ea3c86c62c3964407c0e3b.png" alt="image-20231212150653820"></p>
<h1 id="åº”ç”¨æ”¯æŒ"><a href="#åº”ç”¨æ”¯æŒ" class="headerlink" title="åº”ç”¨æ”¯æŒ"></a>åº”ç”¨æ”¯æŒ</h1><p>æˆ‘çš„ec2 ä¸Šåªè·‘äº†ä¸€ä¸ªnginx + dockerï¼Œå¹³æ—¶ç”¨sshç™»å½•ã€‚æ‰€ä»¥éœ€è¦ä¸ºNginx ä¸sshd æ·»åŠ  ipv6æ”¯æŒã€‚</p>
<h2 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h2><p>å¯¹äºæ‚¨çš„ HTTP æœåŠ¡å™¨å—ï¼ˆç›‘å¬ç«¯å£ 80 çš„é‚£ä¸ªï¼‰ï¼Œæ·»åŠ ä¸€è¡Œ <code>listen [::]:80;</code>ã€‚è¿™ä½¿å¾— Nginx åŒæ—¶ç›‘å¬ IPv4 å’Œ IPv6 çš„ HTTP æµé‡ã€‚ä¿®æ”¹åçš„æœåŠ¡å™¨å—åº”è¯¥åƒè¿™æ ·ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    listen [::]:80;</span><br><span class="line">    server_name hexo.hxzhouh.com;</span><br><span class="line">    return 301 https://$host$request_uri;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹äºæ¯ä¸ª HTTPS æœåŠ¡å™¨å—ï¼ˆç›‘å¬ç«¯å£ 443 çš„é‚£äº›ï¼‰ï¼Œåœ¨æ¯ä¸ªå—ä¸­æ·»åŠ  <code>listen [::]:443 ssl;</code>ã€‚è¿™å°†ä½¿å¾— Nginx ç›‘å¬ IPv6 ä¸Šçš„ HTTPS æµé‡ã€‚ä¾‹å¦‚ï¼Œå¯¹äºç¬¬ä¸€ä¸ª HTTPS æœåŠ¡å™¨å—ï¼Œä½ éœ€è¦åšå¦‚ä¸‹ä¿®æ”¹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 443 ssl;</span><br><span class="line">    listen [::]:443 ssl;</span><br><span class="line">    server_name hexo.hxzhouh.com;</span><br><span class="line">    # å…¶ä½™é…ç½®...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹æ¯ä¸ª HTTPS <code>server</code> å—è¿›è¡Œè¿™æ ·çš„ä¿®æ”¹ã€‚ç„¶åæµ‹è¯•ä¸€ä¸‹ <code>Nginx -t</code> å¦‚æœæ²¡é—®é¢˜å°±é‡æ–°åŠ è½½Nginxé…ç½® <code>systemctl reload nginx</code></p>
<h2 id="sshd"><a href="#sshd" class="headerlink" title="sshd"></a>sshd</h2><p>å†sshd_config ä¿®æ”¹ï¼Œåˆ é™¤å¯¹<code>AddressFamily any</code>çš„æ³¨é‡Šï¼ˆå³åˆ é™¤å‰é¢çš„<code>#</code>ï¼‰ï¼Œä¸º ssh ç­‰åº”ç”¨ç¨‹åºå¼€å¯ IPv6 ç›‘å¬ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /etc/ssh/sshd_config </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Port 22</span></span><br><span class="line">AddressFamily any</span><br><span class="line">AddressFamily inet</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">ListenAddress 0.0.0.0</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">ListenAddress ::</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åé‡å¯ sshd <code>sudo systemctl reload sshd </code>ï¼Œæ‰§è¡Œ<code>netstat -tupln</code>å‘½ä»¤ï¼Œè‹¥å‡ºç°ä»¥ä¸‹æŠ¥æ–‡ï¼Œè¡¨ç¤ºæŸ¥ ssh å·²æˆåŠŸç›‘å¬ IPv6ã€‚</p>
<p><img src="https://images.hxzhouh.com/blog-images/2023/12/1b5feee3b3f881dbbb252e82e789838e.png" alt="image-20231212152302361"></p>
<p>è¿™æ ·åº”ç”¨å±‚å°±ä¿®æ”¹å¥½äº†ã€‚</p>
<h1 id="dns-è®¾ç½®"><a href="#dns-è®¾ç½®" class="headerlink" title="dns è®¾ç½®"></a>dns è®¾ç½®</h1><p>æœ€åï¼Œåœ¨Cloudflare é‡Œé¢è®¾ç½® ä¸€ä¸‹dnsï¼ŒæŠŠä»¥å‰çš„ipv4 çš„Aè®°å½•å…¨éƒ¨æ”¹æˆAAAA çš„ipv6  å°±å¯ä»¥äº†ã€‚</p>
<p><img src="https://images.hxzhouh.com/blog-images/2023/12/1df24903dda8dbb4996968d55286d099.png" alt="image-20231212151550030"></p>
<h2 id="å¤§åŠŸå‘Šæˆï¼Œæµ‹è¯•ä¸€ä¸‹å¦‚æœæ²¡é—®é¢˜çš„è¯ï¼Œå°±å¯ä»¥æŠŠipv4åœ°å€åˆ äº†ã€‚çœçš„æ‰£é’±ã€‚"><a href="#å¤§åŠŸå‘Šæˆï¼Œæµ‹è¯•ä¸€ä¸‹å¦‚æœæ²¡é—®é¢˜çš„è¯ï¼Œå°±å¯ä»¥æŠŠipv4åœ°å€åˆ äº†ã€‚çœçš„æ‰£é’±ã€‚" class="headerlink" title="å¤§åŠŸå‘Šæˆï¼Œæµ‹è¯•ä¸€ä¸‹å¦‚æœæ²¡é—®é¢˜çš„è¯ï¼Œå°±å¯ä»¥æŠŠipv4åœ°å€åˆ äº†ã€‚çœçš„æ‰£é’±ã€‚"></a>å¤§åŠŸå‘Šæˆï¼Œæµ‹è¯•ä¸€ä¸‹å¦‚æœæ²¡é—®é¢˜çš„è¯ï¼Œå°±å¯ä»¥æŠŠipv4åœ°å€åˆ äº†ã€‚çœçš„æ‰£é’±ã€‚</h2><p>æ›´æ–°ï¼š æ­£åœ¨è¿è¡Œçš„å®ä¾‹æ— æ³•åˆ é™¤ipv4åœ°å€ï¼Œåªèƒ½é€šè¿‡AMI é‡å»ºï¼ŒæŠ˜è…¾å‘€ï¼Œä½†æ˜¯aws ä¸å†ç»™æˆ‘å‘é‚®ä»¶äº†ã€‚âœŒï¸  </p>
<p><a href="https://repost.aws/questions/QUVmpO9BWGSuGwQh5tXk3f5w/how-to-remove-ipv4-public-ip-address-from-ec2-instances-before-february-2024-ipv6">How to remove IPv4 public IP address from ec2 instances before February 2024? (IPv6)</a></p>
]]></content>
      <categories>
        <category>blog</category>
      </categories>
      <tags>
        <tag>linux</tag>
        <tag>ipv6</tag>
      </tags>
  </entry>
  <entry>
    <title>hash table ä¸€ä¸ªå¤è€çš„ç»å…¸æ•°æ®ç»“æ„</title>
    <url>/2024/02/26/hash%20table%20%E4%B8%80%E4%B8%AA%E5%8F%A4%E8%80%81%E7%9A%84%E7%BB%8F%E5%85%B8%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/</url>
    <content><![CDATA[<p><a href="https://en.wikipedia.org/wiki/Hash_table">å“ˆå¸Œè¡¨</a>ä¸€ç§å¤è€çš„æ•°æ®ç»“æ„ï¼Œåœ¨ 1953 å¹´å°±æœ‰äººä½¿ç”¨æ‹‰é“¾æ³•å®ç°äº†å“ˆå¸Œè¡¨ï¼Œå®ƒèƒ½å¤Ÿé€šè¿‡é”®ç›´æ¥è·å–è¯¥é”®å¯¹åº”çš„å€¼ã€‚</p>
<span id="more"></span>
<p>å“ˆå¸Œè¡¨æ˜¯è®¡ç®—æœºç§‘å­¦ä¸­çš„æœ€é‡è¦æ•°æ®ç»“æ„ä¹‹ä¸€ï¼Œè¿™ä¸ä»…å› ä¸ºå®ƒÂ ğ‘‚(1)çš„è¯»å†™æ€§èƒ½éå¸¸ä¼˜ç§€ï¼Œè¿˜å› ä¸ºå®ƒæä¾›äº†é”®å€¼ä¹‹é—´çš„æ˜ å°„ã€‚æƒ³è¦å®ç°ä¸€ä¸ªæ€§èƒ½ä¼˜å¼‚çš„å“ˆå¸Œè¡¨ï¼Œéœ€è¦æ³¨æ„ä¸¤ä¸ªå…³é”®ç‚¹ â€”â€” å“ˆå¸Œå‡½æ•°å’Œå†²çªè§£å†³æ–¹æ³•ã€‚</p>
<h1 id="å“ˆå¸Œå‡½æ•°"><a href="#å“ˆå¸Œå‡½æ•°" class="headerlink" title="å“ˆå¸Œå‡½æ•°"></a>å“ˆå¸Œå‡½æ•°</h1><p>å®ç°å“ˆå¸Œè¡¨çš„å…³é”®ç‚¹åœ¨äºå“ˆå¸Œå‡½æ•°çš„é€‰æ‹©ï¼Œå“ˆå¸Œå‡½æ•°çš„é€‰æ‹©åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šèƒ½å¤Ÿå†³å®šå“ˆå¸Œè¡¨çš„è¯»å†™æ€§èƒ½ã€‚åœ¨ç†æƒ³æƒ…å†µä¸‹ï¼Œå“ˆå¸Œå‡½æ•°åº”è¯¥èƒ½å¤Ÿå°†ä¸åŒé”®æ˜ å°„åˆ°ä¸åŒçš„ç´¢å¼•ä¸Šï¼Œè¿™è¦æ±‚<strong>å“ˆå¸Œå‡½æ•°çš„è¾“å‡ºèŒƒå›´å¤§äºè¾“å…¥èŒƒå›´</strong>ï¼Œä½†æ˜¯ç”±äºé”®çš„æ•°é‡ä¼šè¿œè¿œå¤§äºæ˜ å°„çš„èŒƒå›´ï¼Œæ‰€ä»¥åœ¨å®é™…ä½¿ç”¨æ—¶ï¼Œè¿™ä¸ªç†æƒ³çš„æ•ˆæœæ˜¯ä¸å¯èƒ½å®ç°çš„ã€‚</p>
<p><img src="https://images.hxzhouh.com/blog-images/2024/02/115908816b27b8962368c75184a9b3db.png" alt="Pasted image 20240226162401"></p>
<p>æ¯”è¾ƒå®é™…çš„æ–¹å¼æ˜¯è®©å“ˆå¸Œå‡½æ•°çš„ç»“æœèƒ½å¤Ÿå°½å¯èƒ½çš„å‡åŒ€åˆ†å¸ƒï¼Œç„¶åé€šè¿‡å·¥ç¨‹ä¸Šçš„æ‰‹æ®µè§£å†³å“ˆå¸Œç¢°æ’çš„é—®é¢˜ã€‚å“ˆå¸Œå‡½æ•°æ˜ å°„çš„ç»“æœä¸€å®šè¦å°½å¯èƒ½å‡åŒ€ï¼Œç»“æœä¸å‡åŒ€çš„å“ˆå¸Œå‡½æ•°ä¼šå¸¦æ¥æ›´å¤šçš„å“ˆå¸Œå†²çªä»¥åŠæ›´å·®çš„è¯»å†™æ€§èƒ½ã€‚</p>
<p>å¦‚æœä½¿ç”¨ç»“æœåˆ†å¸ƒè¾ƒä¸ºå‡åŒ€çš„å“ˆå¸Œå‡½æ•°ï¼Œé‚£ä¹ˆå“ˆå¸Œçš„å¢åˆ æ”¹æŸ¥çš„æ—¶é—´å¤æ‚åº¦ä¸ºÂ ğ‘‚(1)ï¼›ä½†æ˜¯å¦‚æœå“ˆå¸Œå‡½æ•°çš„ç»“æœåˆ†å¸ƒä¸å‡åŒ€ï¼Œé‚£ä¹ˆæ‰€æœ‰æ“ä½œçš„æ—¶é—´å¤æ‚åº¦å¯èƒ½ä¼šè¾¾åˆ°Â ğ‘‚(ğ‘›)ï¼Œç”±æ­¤çœ‹æ¥ï¼Œä½¿ç”¨å¥½çš„å“ˆå¸Œå‡½æ•°æ˜¯è‡³å…³é‡è¦çš„ã€‚</p>
<h1 id="å†²çªè§£å†³"><a href="#å†²çªè§£å†³" class="headerlink" title="å†²çªè§£å†³"></a>å†²çªè§£å†³</h1><p>å°±åƒæˆ‘ä»¬ä¹‹å‰æ‰€æåˆ°çš„ï¼Œåœ¨é€šå¸¸æƒ…å†µä¸‹ï¼Œå“ˆå¸Œå‡½æ•°è¾“å…¥çš„èŒƒå›´ä¸€å®šä¼šè¿œè¿œå¤§äºè¾“å‡ºçš„èŒƒå›´ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨å“ˆå¸Œè¡¨æ—¶ä¸€å®šä¼šé‡åˆ°å†²çªï¼Œå“ªæ€•æˆ‘ä»¬ä½¿ç”¨äº†å®Œç¾çš„å“ˆå¸Œå‡½æ•°ï¼Œå½“è¾“å…¥çš„é”®è¶³å¤Ÿå¤šä¹Ÿä¼šäº§ç”Ÿå†²çªã€‚ç„¶è€Œå¤šæ•°çš„å“ˆå¸Œå‡½æ•°éƒ½æ˜¯ä¸å¤Ÿå®Œç¾çš„ï¼Œæ‰€ä»¥ä»ç„¶å­˜åœ¨å‘ç”Ÿå“ˆå¸Œç¢°æ’çš„å¯èƒ½ï¼Œè¿™æ—¶å°±éœ€è¦ä¸€äº›æ–¹æ³•æ¥è§£å†³å“ˆå¸Œç¢°æ’çš„é—®é¢˜ï¼Œå¸¸è§æ–¹æ³•çš„å°±æ˜¯å¼€æ”¾å¯»å€æ³•å’Œæ‹‰é“¾æ³•ã€‚</p>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œæåˆ°çš„å“ˆå¸Œç¢°æ’ä¸æ˜¯å¤šä¸ªé”®å¯¹åº”çš„å“ˆå¸Œå®Œå…¨ç›¸ç­‰ï¼Œå¯èƒ½æ˜¯å¤šä¸ªå“ˆå¸Œçš„éƒ¨åˆ†ç›¸ç­‰ï¼Œä¾‹å¦‚ï¼šä¸¤ä¸ªé”®å¯¹åº”å“ˆå¸Œçš„å‰å››ä¸ªå­—èŠ‚ç›¸åŒã€‚</p>
</blockquote>
<h2 id="å¼€æ”¾å¯»å€æ³•"><a href="#å¼€æ”¾å¯»å€æ³•" class="headerlink" title="å¼€æ”¾å¯»å€æ³•"></a>å¼€æ”¾å¯»å€æ³•</h2><p><a href="https://en.wikipedia.org/wiki/Open_addressing">å¼€æ”¾å¯»å€æ³•</a>æ˜¯ä¸€ç§åœ¨å“ˆå¸Œè¡¨ä¸­è§£å†³å“ˆå¸Œç¢°æ’çš„æ–¹æ³•ï¼Œè¿™ç§æ–¹æ³•çš„æ ¸å¿ƒæ€æƒ³æ˜¯<strong>ä¾æ¬¡æ¢æµ‹å’Œæ¯”è¾ƒæ•°ç»„ä¸­çš„å…ƒç´ ä»¥åˆ¤æ–­ç›®æ ‡é”®å€¼å¯¹æ˜¯å¦å­˜åœ¨äºå“ˆå¸Œè¡¨ä¸­</strong>ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨å¼€æ”¾å¯»å€æ³•æ¥å®ç°å“ˆå¸Œè¡¨ï¼Œé‚£ä¹ˆå®ç°å“ˆå¸Œè¡¨åº•å±‚çš„æ•°æ®ç»“æ„å°±æ˜¯æ•°ç»„ï¼Œä¸è¿‡å› ä¸ºæ•°ç»„çš„é•¿åº¦æœ‰é™ï¼Œå‘å“ˆå¸Œè¡¨å†™å…¥ (author, draven) è¿™ä¸ªé”®å€¼å¯¹æ—¶ä¼šä»å¦‚ä¸‹çš„ç´¢å¼•å¼€å§‹éå†ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">index := hash(<span class="string">&quot;author&quot;</span>) % array.<span class="built_in">len</span></span><br></pre></td></tr></table></figure>
<p>å½“æˆ‘ä»¬å‘å½“å‰å“ˆå¸Œè¡¨å†™å…¥æ–°çš„æ•°æ®æ—¶ï¼Œå¦‚æœå‘ç”Ÿäº†å†²çªï¼Œå°±ä¼šå°†é”®å€¼å¯¹å†™å…¥åˆ°ä¸‹ä¸€ä¸ªç´¢å¼•ä¸ä¸ºç©ºçš„ä½ç½®ï¼š<br><img src="https://images.hxzhouh.com/blog-images/2024/02/36c3801d2fdec9f0f37196273076e6c6.png" alt="Pasted image 20240226163147"></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå½“ Key3 ä¸å·²ç»å­˜å…¥å“ˆå¸Œè¡¨ä¸­çš„ä¸¤ä¸ªé”®å€¼å¯¹ Key1 å’Œ Key2 å‘ç”Ÿå†²çªæ—¶ï¼ŒKey3 ä¼šè¢«å†™å…¥ Key2 åé¢çš„ç©ºé—²ä½ç½®ã€‚å½“æˆ‘ä»¬å†å»è¯»å– Key3 å¯¹åº”çš„å€¼æ—¶å°±ä¼šå…ˆè·å–é”®çš„å“ˆå¸Œå¹¶å–æ¨¡ï¼Œè¿™ä¼šå…ˆå¸®åŠ©æˆ‘ä»¬æ‰¾åˆ° Key1ï¼Œæ‰¾åˆ° Key1 åå‘ç°å®ƒä¸ Key 3 ä¸ç›¸ç­‰ï¼Œæ‰€ä»¥ä¼šç»§ç»­æŸ¥æ‰¾åé¢çš„å…ƒç´ ï¼Œç›´åˆ°å†…å­˜ä¸ºç©ºæˆ–è€…æ‰¾åˆ°ç›®æ ‡å…ƒç´ ã€‚</p>
<p>å½“éœ€è¦æŸ¥æ‰¾æŸä¸ªé”®å¯¹åº”çš„å€¼æ—¶ï¼Œä¼šä»ç´¢å¼•çš„ä½ç½®å¼€å§‹çº¿æ€§æ¢æµ‹æ•°ç»„ï¼Œæ‰¾åˆ°ç›®æ ‡é”®å€¼å¯¹æˆ–è€…ç©ºå†…å­˜å°±æ„å‘³ç€è¿™ä¸€æ¬¡æŸ¥è¯¢æ“ä½œçš„ç»“æŸã€‚</p>
<p>å¼€æ”¾å¯»å€æ³•ä¸­å¯¹æ€§èƒ½å½±å“æœ€å¤§çš„æ˜¯<strong>è£…è½½å› å­</strong>ï¼Œå®ƒæ˜¯æ•°ç»„ä¸­å…ƒç´ çš„æ•°é‡ä¸æ•°ç»„å¤§å°çš„æ¯”å€¼ã€‚éšç€è£…è½½å› å­çš„å¢åŠ ï¼Œçº¿æ€§æ¢æµ‹çš„å¹³å‡ç”¨æ—¶å°±ä¼šé€æ¸å¢åŠ ï¼Œè¿™ä¼šå½±å“å“ˆå¸Œè¡¨çš„è¯»å†™æ€§èƒ½ã€‚å½“è£…è½½ç‡è¶…è¿‡ 70% ä¹‹åï¼Œå“ˆå¸Œè¡¨çš„æ€§èƒ½å°±ä¼šæ€¥å‰§ä¸‹é™ï¼Œè€Œä¸€æ—¦è£…è½½ç‡è¾¾åˆ° 100%ï¼Œæ•´ä¸ªå“ˆå¸Œè¡¨å°±ä¼šå®Œå…¨å¤±æ•ˆï¼Œè¿™æ—¶æŸ¥æ‰¾å’Œæ’å…¥ä»»æ„å…ƒç´ çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯Â ğ‘‚(ğ‘›)Â çš„ï¼Œè¿™æ—¶éœ€è¦éå†æ•°ç»„ä¸­çš„å…¨éƒ¨å…ƒç´ ï¼Œæ‰€ä»¥åœ¨å®ç°å“ˆå¸Œè¡¨æ—¶ä¸€å®šè¦å…³æ³¨è£…è½½å› å­çš„å˜åŒ–ã€‚</p>
<h2 id="æ‹‰é“¾æ³•"><a href="#æ‹‰é“¾æ³•" class="headerlink" title="æ‹‰é“¾æ³•"></a>æ‹‰é“¾æ³•</h2><p>ä¸å¼€æ”¾åœ°å€æ³•ç›¸æ¯”ï¼Œæ‹‰é“¾æ³•æ˜¯å“ˆå¸Œè¡¨æœ€å¸¸è§çš„å®ç°æ–¹æ³•ï¼Œå¤§å¤šæ•°çš„ç¼–ç¨‹è¯­è¨€éƒ½ç”¨æ‹‰é“¾æ³•å®ç°å“ˆå¸Œè¡¨ï¼Œå®ƒçš„å®ç°æ¯”è¾ƒå¼€æ”¾åœ°å€æ³•ç¨å¾®å¤æ‚ä¸€äº›ï¼Œä½†æ˜¯å¹³å‡æŸ¥æ‰¾çš„é•¿åº¦ä¹Ÿæ¯”è¾ƒçŸ­ï¼Œå„ä¸ªç”¨äºå­˜å‚¨èŠ‚ç‚¹çš„å†…å­˜éƒ½æ˜¯åŠ¨æ€ç”³è¯·çš„ï¼Œå¯ä»¥èŠ‚çœæ¯”è¾ƒå¤šçš„å­˜å‚¨ç©ºé—´ã€‚</p>
<p>å®ç°æ‹‰é“¾æ³•ä¸€èˆ¬ä¼šä½¿ç”¨æ•°ç»„åŠ ä¸Šé“¾è¡¨ï¼Œä¸è¿‡ä¸€äº›ç¼–ç¨‹è¯­è¨€ä¼šåœ¨æ‹‰é“¾æ³•çš„å“ˆå¸Œä¸­å¼•å…¥çº¢é»‘æ ‘ä»¥ä¼˜åŒ–æ€§èƒ½ï¼Œæ‹‰é“¾æ³•ä¼šä½¿ç”¨é“¾è¡¨æ•°ç»„ä½œä¸ºå“ˆå¸Œåº•å±‚çš„æ•°æ®ç»“æ„ï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ƒçœ‹æˆå¯ä»¥æ‰©å±•çš„äºŒç»´æ•°ç»„ï¼š<br><img src="https://images.hxzhouh.com/blog-images/2024/02/c08cf7411207d7e1243b466d389c0d84.png" alt="Pasted image 20240226163743"></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå½“æˆ‘ä»¬éœ€è¦å°†ä¸€ä¸ªé”®å€¼å¯¹ (Key5, Value5) å†™å…¥å“ˆå¸Œè¡¨æ—¶ï¼Œé”®å€¼å¯¹ä¸­çš„é”® Key5 éƒ½ä¼šå…ˆç»è¿‡ä¸€ä¸ªå“ˆå¸Œå‡½æ•°ï¼Œå“ˆå¸Œå‡½æ•°è¿”å›çš„å“ˆå¸Œä¼šå¸®åŠ©æˆ‘ä»¬é€‰æ‹©ä¸€ä¸ªæ¡¶ï¼Œå’Œå¼€æ”¾åœ°å€æ³•ä¸€æ ·ï¼Œé€‰æ‹©æ¡¶çš„æ–¹å¼æ˜¯ç›´æ¥å¯¹å“ˆå¸Œè¿”å›çš„ç»“æœå–æ¨¡ï¼š</p>
<p>é€‰æ‹©äº† 7 å·æ¡¶åå°±å¯ä»¥éå†å½“å‰æ¡¶ä¸­çš„é“¾è¡¨äº†ï¼Œåœ¨éå†é“¾è¡¨çš„è¿‡ç¨‹ä¸­ä¼šé‡åˆ°ä»¥ä¸‹ä¸¤ç§æƒ…å†µï¼š</p>
<ol>
<li>æ‰¾åˆ°é”®ç›¸åŒçš„é”®å€¼å¯¹ â€” æ›´æ–°é”®å¯¹åº”çš„å€¼ï¼›</li>
<li>æ²¡æœ‰æ‰¾åˆ°é”®ç›¸åŒçš„é”®å€¼å¯¹ â€” åœ¨é“¾è¡¨çš„æœ«å°¾è¿½åŠ æ–°çš„é”®å€¼å¯¹ï¼›</li>
</ol>
<p>å¦‚æœè¦åœ¨å“ˆå¸Œè¡¨ä¸­è·å–æŸä¸ªé”®å¯¹åº”çš„å€¼ï¼Œä¼šç»å†å¦‚ä¸‹çš„è¿‡ç¨‹ï¼š<br><img src="https://images.hxzhouh.com/blog-images/2024/02/c83cdf09292493a641d1dca35f44b7b7.png" alt="Pasted image 20240226163932"><br>Key6 å±•ç¤ºäº†ä¸€ä¸ªé”®åœ¨å“ˆå¸Œè¡¨ä¸­ä¸å­˜åœ¨çš„ä¾‹å­ï¼Œå½“å“ˆå¸Œè¡¨å‘ç°å®ƒå‘½ä¸­ 5 å·æ¡¶æ—¶ï¼Œå®ƒä¼šä¾æ¬¡éå†æ¡¶ä¸­çš„é“¾è¡¨ï¼Œç„¶è€Œéå†åˆ°é“¾è¡¨çš„æœ«å°¾ä¹Ÿæ²¡æœ‰æ‰¾åˆ°æœŸæœ›çš„é”®ï¼Œæ‰€ä»¥å“ˆå¸Œè¡¨ä¸­æ²¡æœ‰è¯¥é”®å¯¹åº”çš„å€¼ã€‚</p>
<p>åœ¨ä¸€ä¸ªæ€§èƒ½æ¯”è¾ƒå¥½çš„å“ˆå¸Œè¡¨ä¸­ï¼Œæ¯ä¸€ä¸ªæ¡¶ä¸­éƒ½åº”è¯¥æœ‰ 0<del>1 ä¸ªå…ƒç´ ï¼Œæœ‰æ—¶ä¼šæœ‰ 2</del>3 ä¸ªï¼Œå¾ˆå°‘ä¼šè¶…è¿‡è¿™ä¸ªæ•°é‡ã€‚è®¡ç®—å“ˆå¸Œã€å®šä½æ¡¶å’Œéå†é“¾è¡¨ä¸‰ä¸ªè¿‡ç¨‹æ˜¯å“ˆå¸Œè¡¨è¯»å†™æ“ä½œçš„ä¸»è¦å¼€é”€ï¼Œä½¿ç”¨æ‹‰é“¾æ³•å®ç°çš„å“ˆå¸Œä¹Ÿæœ‰è£…è½½å› å­è¿™ä¸€æ¦‚å¿µï¼š</p>
<p><code>è£…è½½å› å­:=å…ƒç´ æ•°é‡Ã·æ¡¶æ•°é‡</code></p>
<p>ä¸å¼€æ”¾åœ°å€æ³•ä¸€æ ·ï¼Œæ‹‰é“¾æ³•çš„è£…è½½å› å­è¶Šå¤§ï¼Œå“ˆå¸Œçš„è¯»å†™æ€§èƒ½å°±è¶Šå·®ã€‚åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ä½¿ç”¨æ‹‰é“¾æ³•çš„å“ˆå¸Œè¡¨è£…è½½å› å­éƒ½ä¸ä¼šè¶…è¿‡ 1ï¼Œå½“å“ˆå¸Œè¡¨çš„è£…è½½å› å­è¾ƒå¤§æ—¶ä¼šè§¦å‘å“ˆå¸Œçš„æ‰©å®¹ï¼Œåˆ›å»ºæ›´å¤šçš„æ¡¶æ¥å­˜å‚¨å“ˆå¸Œä¸­çš„å…ƒç´ ï¼Œä¿è¯æ€§èƒ½ä¸ä¼šå‡ºç°ä¸¥é‡çš„ä¸‹é™ã€‚å¦‚æœæœ‰ 1000 ä¸ªæ¡¶çš„å“ˆå¸Œè¡¨å­˜å‚¨äº† 10000 ä¸ªé”®å€¼å¯¹ï¼Œå®ƒçš„æ€§èƒ½æ˜¯ä¿å­˜ 1000 ä¸ªé”®å€¼å¯¹çš„ 1&#x2F;10ï¼Œä½†æ˜¯ä»ç„¶æ¯”åœ¨é“¾è¡¨ä¸­ç›´æ¥è¯»å†™å¥½ 1000 å€ã€‚</p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æœ¬æ–‡è®²è¿°äº†hashtable çš„åŸºæœ¬å·¥ä½œåŸç†ï¼Œ å“ˆå¸Œè¡¨æ˜¯ä¸€ç§éå¸¸é‡è¦çš„æ•°æ®ç»“æ„ï¼Œå®ƒèƒ½æä¾›å¿«é€Ÿçš„é”®å€¼æ˜ å°„ï¼Œå¹¶æœ‰è‰¯å¥½çš„è¯»å†™æ€§èƒ½ã€‚å“ˆå¸Œè¡¨çš„æ€§èƒ½ä¸»è¦å–å†³äºä¸¤ä¸ªå…³é”®ç‚¹ï¼šå“ˆå¸Œå‡½æ•°çš„é€‰æ‹©å’Œå†²çªè§£å†³æ–¹æ³•ã€‚<br>å®é™…ä¸Šè¿˜æœ‰å¾ˆå¤šå·¥ç¨‹ä¸Šçš„é—®é¢˜æ²¡æœ‰å›ç­”ï¼Œæ¯”å¦‚hashå‡½æ•°çš„æ€§èƒ½ï¼Œhash å¦‚ä½•åŠ¨æ€æ‰©ç¼©å®¹ï¼Œè¿˜æœ‰ åŸºäºçº¢é»‘æ ‘ä¼˜åŒ–bucket çš„æ€§èƒ½ç­‰ï¼Œè¿™äº›éƒ½æ˜¯å·¥ç¨‹ä¸Šçš„é—®é¢˜ï¼Œä¸å½±å“æˆ‘ä»¬äº†è§£hashtable çš„å·¥ä½œåŸç†ã€‚<br>ä¸‹ä¸€ç¯‡æˆ‘ä»¬å°†åŸºäº hashtable çš„åŸºç¡€çŸ¥è¯†ï¼Œæ·±å…¥äº†è§£goè¯­è¨€map çš„è®¾è®¡ä¸å®ç°ã€‚</p>
]]></content>
      <categories>
        <category>blog</category>
      </categories>
      <tags>
        <tag>go</tag>
        <tag>hash</tag>
      </tags>
  </entry>
  <entry>
    <title></title>
    <url>/2024/04/03/Time%20in%20computers,%20context%20switching.%5D%5D/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>newè·Ÿmake çš„åŒºåˆ«</title>
    <url>/2020/03/21/new%E8%B7%9Fmake%20%E7%9A%84%E5%8C%BA%E5%88%AB/</url>
    <content><![CDATA[<h1 id="newè·Ÿmake-çš„åŒºåˆ«"><a href="#newè·Ÿmake-çš„åŒºåˆ«" class="headerlink" title="newè·Ÿmake çš„åŒºåˆ«"></a>newè·Ÿmake çš„åŒºåˆ«</h1><blockquote>
<p>new å’Œ make éƒ½å¯ä»¥ç”¨æ¥åˆ†é…ç©ºé—´ï¼Œåˆå§‹åŒ–ç±»å‹ï¼Œä½†æ˜¯å®ƒä»¬ç¡®æœ‰ä¸åŒã€‚</p>
</blockquote>
<h2 id="new-T-è¿”å›çš„æ˜¯-T-çš„æŒ‡é’ˆ"><a href="#new-T-è¿”å›çš„æ˜¯-T-çš„æŒ‡é’ˆ" class="headerlink" title="new(T) è¿”å›çš„æ˜¯ T çš„æŒ‡é’ˆ"></a><strong>new(T) è¿”å›çš„æ˜¯ T çš„æŒ‡é’ˆ</strong></h2><p>new(T) ä¸ºä¸€ä¸ª T ç±»å‹æ–°å€¼åˆ†é…ç©ºé—´å¹¶å°†æ­¤ç©ºé—´åˆå§‹åŒ–ä¸º T çš„é›¶å€¼ï¼Œè¿”å›çš„æ˜¯æ–°å€¼çš„åœ°å€ï¼Œä¹Ÿå°±æ˜¯ T ç±»å‹çš„æŒ‡é’ˆ *Tï¼Œè¯¥æŒ‡é’ˆæŒ‡å‘ T çš„æ–°åˆ†é…çš„é›¶å€¼ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">p1 := <span class="built_in">new</span>(<span class="type">int</span>)</span><br><span class="line">fmt.Printf(<span class="string">&quot;p1 --&gt; %#v \n &quot;</span>, p1) <span class="comment">//(*int)(0xc42000e250)</span></span><br><span class="line">fmt.Printf(<span class="string">&quot;p1 point to --&gt; %#v \n &quot;</span>, *p1) <span class="comment">//0</span></span><br><span class="line"><span class="keyword">var</span> p2 *<span class="type">int</span></span><br><span class="line">i := <span class="number">0</span></span><br><span class="line">p2 = &amp;i</span><br><span class="line">fmt.Printf(<span class="string">&quot;p2 --&gt; %#v \n &quot;</span>, p2) <span class="comment">//(*int)(0xc42000e278)</span></span><br><span class="line">fmt.Printf(<span class="string">&quot;p2 point to --&gt; %#v \n &quot;</span>, *p2) <span class="comment">//0</span></span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„ä»£ç æ˜¯ç­‰ä»·çš„ï¼Œnew(int) å°†åˆ†é…çš„ç©ºé—´åˆå§‹åŒ–ä¸º int çš„é›¶å€¼ï¼Œä¹Ÿå°±æ˜¯ 0ï¼Œå¹¶è¿”å› int çš„æŒ‡é’ˆï¼Œè¿™å’Œç›´æ¥å£°æ˜æŒ‡é’ˆå¹¶åˆå§‹åŒ–çš„æ•ˆæœæ˜¯ç›¸åŒçš„ã€‚</p>
<h2 id="make-åªèƒ½ç”¨äº-slice-map-channel"><a href="#make-åªèƒ½ç”¨äº-slice-map-channel" class="headerlink" title="make åªèƒ½ç”¨äº slice,map,channel"></a><strong>make åªèƒ½ç”¨äº slice,map,channel</strong></h2><p>make åªèƒ½ç”¨äº sliceï¼Œmapï¼Œchannel ä¸‰ç§ç±»å‹ï¼Œmake(T, args) è¿”å›çš„æ˜¯åˆå§‹åŒ–ä¹‹åçš„ T ç±»å‹çš„å€¼ï¼Œè¿™ä¸ªæ–°å€¼å¹¶ä¸æ˜¯ T ç±»å‹çš„é›¶å€¼ï¼Œä¹Ÿä¸æ˜¯æŒ‡é’ˆ *Tï¼Œæ˜¯ç»è¿‡åˆå§‹åŒ–ä¹‹åçš„ T çš„å¼•ç”¨ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> s1 []<span class="type">int</span></span><br><span class="line"><span class="keyword">if</span> s1 == <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;s1 is nil --&gt; %#v \n &quot;</span>, s1) <span class="comment">// []int(nil)</span></span><br><span class="line">&#125;</span><br><span class="line">s2 := <span class="built_in">make</span>([]<span class="type">int</span>, <span class="number">3</span>)</span><br><span class="line"><span class="keyword">if</span> s2 == <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;s2 is nil --&gt; %#v \n &quot;</span>, s2)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;s2 is not nill --&gt; %#v \n &quot;</span>, s2)<span class="comment">// []int&#123;0, 0, 0&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>slice çš„é›¶å€¼æ˜¯ nilï¼Œä½¿ç”¨ make ä¹‹å slice æ˜¯ä¸€ä¸ªåˆå§‹åŒ–çš„ sliceï¼Œå³ slice çš„é•¿åº¦ã€å®¹é‡ã€åº•å±‚æŒ‡å‘çš„ array éƒ½è¢« make å®Œæˆåˆå§‹åŒ–ï¼Œæ­¤æ—¶ slice å†…å®¹è¢«ç±»å‹ int çš„é›¶å€¼å¡«å……ï¼Œå½¢å¼æ˜¯ [0 0 0]ï¼Œmap å’Œ channel ä¹Ÿæ˜¯ç±»ä¼¼çš„ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> m1 <span class="keyword">map</span>[<span class="type">int</span>]<span class="type">string</span></span><br><span class="line"><span class="keyword">if</span> m1 == <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;m1 is nil --&gt; %#v \n &quot;</span>, m1) <span class="comment">//map[int]string(nil)</span></span><br><span class="line">&#125;</span><br><span class="line">m2 := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">int</span>]<span class="type">string</span>)</span><br><span class="line"><span class="keyword">if</span> m2 == <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;m2 is nil --&gt; %#v \n &quot;</span>, m2)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;m2 is not nill --&gt; %#v \n &quot;</span>, m2) <span class="keyword">map</span>[<span class="type">int</span>]<span class="type">string</span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> c1 <span class="keyword">chan</span> <span class="type">string</span></span><br><span class="line"><span class="keyword">if</span> c1 == <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;c1 is nil --&gt; %#v \n &quot;</span>, c1) <span class="comment">//(chan string)(nil)</span></span><br><span class="line">&#125;</span><br><span class="line">c2 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">string</span>)</span><br><span class="line"><span class="keyword">if</span> c2 == <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;c2 is nil --&gt; %#v \n &quot;</span>, c2)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;c2 is not nill --&gt; %#v \n &quot;</span>, c2)<span class="comment">//(chan string)(0xc420016120)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="make-T-args-è¿”å›çš„æ˜¯-T-çš„-å¼•ç”¨"><a href="#make-T-args-è¿”å›çš„æ˜¯-T-çš„-å¼•ç”¨" class="headerlink" title="make(T, args) è¿”å›çš„æ˜¯ T çš„ å¼•ç”¨"></a><strong>make(T, args) è¿”å›çš„æ˜¯ T çš„ å¼•ç”¨</strong></h2><p>å¦‚æœä¸ç‰¹æ®Šå£°æ˜ï¼Œgo çš„å‡½æ•°é»˜è®¤éƒ½æ˜¯æŒ‰å€¼ä¼ å‚ï¼Œå³é€šè¿‡å‡½æ•°ä¼ é€’çš„å‚æ•°æ˜¯å€¼çš„å‰¯æœ¬ï¼Œåœ¨å‡½æ•°å†…éƒ¨å¯¹å€¼ä¿®æ”¹ä¸å½±å“å€¼çš„æœ¬èº«ï¼Œä½†æ˜¯ make(T, args) è¿”å›çš„å€¼é€šè¿‡å‡½æ•°ä¼ é€’å‚æ•°ä¹‹åå¯ä»¥ç›´æ¥ä¿®æ”¹ï¼Œå³ mapï¼Œsliceï¼Œchannel é€šè¿‡å‡½æ•°ç©¿å‚ä¹‹ååœ¨å‡½æ•°å†…éƒ¨ä¿®æ”¹å°†å½±å“å‡½æ•°å¤–éƒ¨çš„å€¼ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">modifySlice</span><span class="params">(s []<span class="type">int</span>)</span></span> &#123;</span><br><span class="line">	s[<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line">s2 := <span class="built_in">make</span>([]<span class="type">int</span>, <span class="number">3</span>)</span><br><span class="line">fmt.Printf(<span class="string">&quot;%#v&quot;</span>, s2) <span class="comment">//[]int&#123;0, 0, 0&#125;</span></span><br><span class="line">modifySlice(s2)</span><br><span class="line">fmt.Printf(<span class="string">&quot;%#v&quot;</span>, s2) <span class="comment">//[]int&#123;1, 0, 0&#125;</span></span><br></pre></td></tr></table></figure>

<p>è¿™è¯´æ˜ make(T, args) è¿”å›çš„æ˜¯å¼•ç”¨ç±»å‹ï¼Œåœ¨å‡½æ•°å†…éƒ¨å¯ä»¥ç›´æ¥æ›´æ”¹åŸå§‹å€¼ï¼Œå¯¹ map å’Œ channel ä¹Ÿæ˜¯å¦‚æ­¤ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">modifyMap</span><span class="params">(m <span class="keyword">map</span>[<span class="type">int</span>]<span class="type">string</span>)</span></span> &#123;</span><br><span class="line">	m[<span class="number">0</span>] = <span class="string">&quot;string&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">modifyChan</span><span class="params">(c <span class="keyword">chan</span> <span class="type">string</span>)</span></span> &#123;</span><br><span class="line">	c &lt;- <span class="string">&quot;string&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">m2 := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">int</span>]<span class="type">string</span>)</span><br><span class="line"><span class="keyword">if</span> m2 == <span class="literal">nil</span> &#123;</span><br><span class="line">	fmt.Printf(<span class="string">&quot;m2 is nil --&gt; %#v \n &quot;</span>, m2)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	fmt.Printf(<span class="string">&quot;m2 is not nill --&gt; %#v \n &quot;</span>, m2) <span class="comment">//map[int]string&#123;&#125;</span></span><br><span class="line">&#125;</span><br><span class="line">modifyMap(m2)</span><br><span class="line">fmt.Printf(<span class="string">&quot;m2 is not nill --&gt; %#v \n &quot;</span>, m2) <span class="comment">// map[int]string&#123;0:&quot;string&quot;&#125;</span></span><br><span class="line">c2 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">string</span>)</span><br><span class="line"><span class="keyword">if</span> c2 == <span class="literal">nil</span> &#123;</span><br><span class="line">	fmt.Printf(<span class="string">&quot;c2 is nil --&gt; %#v \n &quot;</span>, c2)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	fmt.Printf(<span class="string">&quot;c2 is not nill --&gt; %#v \n &quot;</span>, c2)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">go</span> modifyChan(c2)</span><br><span class="line">fmt.Printf(<span class="string">&quot;c2 is not nill --&gt; %#v &quot;</span>, &lt;-c2) <span class="comment">//&quot;string&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="å¾ˆå°‘éœ€è¦ä½¿ç”¨-new"><a href="#å¾ˆå°‘éœ€è¦ä½¿ç”¨-new" class="headerlink" title="å¾ˆå°‘éœ€è¦ä½¿ç”¨ new"></a><strong>å¾ˆå°‘éœ€è¦ä½¿ç”¨ new</strong></h2><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Foo <span class="keyword">struct</span> &#123;</span><br><span class="line">name <span class="type">string</span></span><br><span class="line">age <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å£°æ˜åˆå§‹åŒ–</span></span><br><span class="line"><span class="keyword">var</span> foo1 Foo</span><br><span class="line">fmt.Printf(<span class="string">&quot;foo1 --&gt; %#v\n &quot;</span>, foo1) <span class="comment">//main.Foo&#123;age:0, name:&quot;&quot;&#125;</span></span><br><span class="line">foo1.age = <span class="number">1</span></span><br><span class="line">fmt.Println(foo1.age)</span><br><span class="line"><span class="comment">//struct literal åˆå§‹åŒ–</span></span><br><span class="line">foo2 := Foo&#123;&#125;</span><br><span class="line">fmt.Printf(<span class="string">&quot;foo2 --&gt; %#v\n &quot;</span>, foo2) <span class="comment">//main.Foo&#123;age:0, name:&quot;&quot;&#125;</span></span><br><span class="line">foo2.age = <span class="number">2</span></span><br><span class="line">fmt.Println(foo2.age)</span><br><span class="line"><span class="comment">//æŒ‡é’ˆåˆå§‹åŒ–</span></span><br><span class="line">foo3 := &amp;Foo&#123;&#125;</span><br><span class="line">fmt.Printf(<span class="string">&quot;foo3 --&gt; %#v\n &quot;</span>, foo3) <span class="comment">//&amp;main.Foo&#123;age:0, name:&quot;&quot;&#125;</span></span><br><span class="line">foo3.age = <span class="number">3</span></span><br><span class="line">fmt.Println(foo3.age)</span><br><span class="line"><span class="comment">//new åˆå§‹åŒ–</span></span><br><span class="line">foo4 := <span class="built_in">new</span>(Foo)</span><br><span class="line">fmt.Printf(<span class="string">&quot;foo4 --&gt; %#v\n &quot;</span>, foo4) <span class="comment">//&amp;main.Foo&#123;age:0, name:&quot;&quot;&#125;</span></span><br><span class="line">foo4.age = <span class="number">4</span></span><br><span class="line">fmt.Println(foo4.age)</span><br><span class="line"><span class="comment">//å£°æ˜æŒ‡é’ˆå¹¶ç”¨ new åˆå§‹åŒ–</span></span><br><span class="line"><span class="keyword">var</span> foo5 *Foo = <span class="built_in">new</span>(Foo)</span><br><span class="line">fmt.Printf(<span class="string">&quot;foo5 --&gt; %#v\n &quot;</span>, foo5) <span class="comment">//&amp;main.Foo&#123;age:0, name:&quot;&quot;&#125;</span></span><br><span class="line">foo5.age = <span class="number">5</span></span><br><span class="line">fmt.Println(foo5.age)</span><br></pre></td></tr></table></figure>

<p>foo1 å’Œ foo2 æ˜¯åŒæ ·çš„ç±»å‹ï¼Œéƒ½æ˜¯ Foo ç±»å‹çš„å€¼ï¼Œfoo1 æ˜¯é€šè¿‡ var å£°æ˜ï¼ŒFoo çš„ filed è‡ªåŠ¨åˆå§‹åŒ–ä¸ºæ¯ä¸ªç±»å‹çš„é›¶å€¼ï¼Œfoo2 æ˜¯é€šè¿‡å­—é¢é‡çš„å®Œæˆåˆå§‹åŒ–ã€‚foo3ï¼Œfoo4 å’Œ foo5 æ˜¯ä¸€æ ·çš„ç±»å‹ï¼Œéƒ½æ˜¯ Foo çš„æŒ‡é’ˆ <em>Fooã€‚</em>*<em>ä½†æ˜¯æ‰€æœ‰ foo éƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨ Foo çš„ filedï¼Œè¯»å–æˆ–ä¿®æ”¹ï¼Œä¸ºä»€ä¹ˆï¼Ÿ</em>å¦‚æœ x æ˜¯å¯å¯»å€çš„ï¼Œ&amp;x çš„ filed é›†åˆåŒ…å« mï¼Œx.m å’Œ (&amp;x).m æ˜¯ç­‰åŒçš„ï¼Œgo è‡ªåŠ¨åšè½¬æ¢ï¼Œä¹Ÿå°±æ˜¯ foo1.age å’Œ foo3.age è°ƒç”¨æ˜¯ç­‰ä»·çš„ï¼Œgo åœ¨ä¸‹é¢è‡ªåŠ¨åšäº†è½¬æ¢ã€‚å› è€Œå¯ä»¥ç›´æ¥ä½¿ç”¨ struct literal çš„æ–¹å¼åˆ›å»ºå¯¹è±¡ï¼Œèƒ½è¾¾åˆ°å’Œ new åˆ›å»ºæ˜¯ä¸€æ ·çš„æƒ…å†µè€Œä¸éœ€è¦ä½¿ç”¨ newã€‚</p>
<h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a><strong>å°ç»“</strong></h2><ul>
<li><p>new(T) è¿”å› T çš„æŒ‡é’ˆ *T å¹¶æŒ‡å‘ T çš„é›¶å€¼ã€‚</p>
</li>
<li><p>make(T) è¿”å›çš„åˆå§‹åŒ–çš„ Tï¼Œåªèƒ½ç”¨äº sliceï¼Œmapï¼Œchannelã€‚</p>
</li>
</ul>
]]></content>
      <categories>
        <category>go</category>
      </categories>
      <tags>
        <tag>Go</tag>
      </tags>
  </entry>
  <entry>
    <title>leetcodeè§£é¢˜ç¬”è®°-114-åŸåœ°ç®—æ³•</title>
    <url>/2020/03/24/leetcode%E8%A7%A3%E9%A2%98%E7%AC%94%E8%AE%B0-114-%E5%8E%9F%E5%9C%B0%E7%AE%97%E6%B3%95/</url>
    <content><![CDATA[<blockquote>
<p>In <a href="https://en.wikipedia.org/wiki/Computer_science">computer science</a>, an <strong>in-place algorithm</strong> is an <a href="https://en.wikipedia.org/wiki/Algorithm">algorithm</a> which transforms input using no auxiliary <a href="https://en.wikipedia.org/wiki/Data_structure">data structure</a>. However a small amount of extra storage space is allowed for auxiliary variables. The input is usually overwritten by the output as the algorithm executes. In-place algorithm updates input sequence only through replacement or swapping of elements. An algorithm which is not in-place is sometimes called <strong>not-in-place</strong> or <strong>out-of-place</strong>.â€”â€”æ‘˜è‡ª<a href="https://en.wikipedia.org/wiki/In-place_algorithm">åŸåœ°ç®—æ³•</a>çš„ç»´åŸºç™¾ç§‘</p>
</blockquote>
<p>ä¸€å¥è¯æ€»ç»“å°±æ˜¯: åŸåœ°ç®—æ³•ä¸ä¾èµ–é¢å¤–çš„èµ„æºæˆ–è€…ä¾èµ–å°‘æ•°çš„é¢å¤–èµ„æºï¼Œä»…ä¾é è¾“å‡ºæ¥è¦†ç›–è¾“å…¥çš„ä¸€ç§ç®—æ³•æ“ä½œã€‚</p>
<h1 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h1><p>å‡è®¾è¦å°†å…·æœ‰ <em>n</em> é¡¹å†…å®¹çš„æ•°ç»„ a ç¿»è½¬è¿‡æ¥ã€‚ä¸€ç§çœ‹ä¼¼ç®€å•çš„æ–¹æ³•æ˜¯åˆ›å»ºä¸€ä¸ªå¤§å°ç›¸ç­‰çš„æ–°æ•°ç»„ï¼Œç”¨é€‚å½“çš„é¡ºåºå¡«å……å‰¯æœ¬ï¼Œç„¶åå†åˆ é™¤ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">function reverse(a[<span class="number">0.</span>.n-<span class="number">1</span>])</span><br><span class="line">     allocate b[<span class="number">0.</span>.n-<span class="number">1</span>]  <span class="comment"># é¢å¤–è®¾å®šä¸€ä¸ªæ•°ç»„</span></span><br><span class="line">     <span class="keyword">for</span> i <span class="keyword">from</span> <span class="number">0</span> to n-<span class="number">1</span> <span class="comment"># ä» 0 åˆ° n-1 éå†æ•°ç»„ a</span></span><br><span class="line">         b[n -<span class="number">1</span> - i] := a[i] </span><br><span class="line">     <span class="keyword">return</span> b</span><br></pre></td></tr></table></figure>

<p>è¿™ç§æ–¹æ³•è™½ç„¶ç®€å•ï¼Œä½†æ˜¯éœ€è¦ O(n) çš„é¢å¤–ç©ºé—´ä»¥ä½¿æ•°ç»„ a å’Œ b åŒæ—¶å¯ç”¨ã€‚æ­¤å¤–ï¼Œåˆ†é…å­˜å‚¨ç©ºé—´å’Œé‡Šæ”¾å­˜å‚¨ç©ºé—´é€šå¸¸æ˜¯ç¼“æ…¢çš„æ“ä½œã€‚å¦‚æœæˆ‘ä»¬ä¸å†éœ€è¦æ•°ç»„ a çš„è¯ï¼Œå¯ä½¿ç”¨åŸåœ°ç®—æ³•ï¼Œç”¨å®ƒè‡ªå·±ç¿»è½¬çš„å†…å®¹æ¥è¦†ç›–æ‰åŸå…ˆçš„å†…å®¹ã€‚è¿™æ ·ï¼Œæ— è®ºæ•°ç»„æœ‰å¤šå¤§ï¼Œå®ƒéƒ½åªéœ€è¦è¾…åŠ©å˜é‡ i å’Œ tmpï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">function reverse_in_place(a[<span class="number">0.</span>.n-<span class="number">1</span>])</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">from</span> <span class="number">0</span> to floor((n-<span class="number">2</span>)/<span class="number">2</span>)</span><br><span class="line">        tmp := a[i]</span><br><span class="line">        a[i] := a[n âˆ’ <span class="number">1</span> âˆ’ i]</span><br><span class="line">        a[n âˆ’ <span class="number">1</span> âˆ’ i] := tmp</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·æ—¢èŠ‚çœäº†å­˜å‚¨å™¨ç©ºé—´åˆåŠ å¿«äº†è¿ç®—é€Ÿåº¦ã€‚</p>
<p>example:</p>
<p><a href="https://leetcode-cn.com/problems/flatten-binary-tree-to-linked-list/">leetCode 114</a></p>
<p>go å®ç°</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">flatten</span><span class="params">(root *TreeNode)</span></span>  &#123;</span><br><span class="line">	<span class="keyword">if</span> root == <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	flatten(root.Left)</span><br><span class="line">	flatten(root.Right)</span><br><span class="line">	temp := root.Right</span><br><span class="line">	root.Right = root.Left</span><br><span class="line">	root.Left = <span class="literal">nil</span></span><br><span class="line">	<span class="keyword">for</span> root.Right != <span class="literal">nil</span> &#123;</span><br><span class="line">		root = root.Right</span><br><span class="line">	&#125;</span><br><span class="line">	root.Right = temp</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…¶å®å°±æ˜¯ä½¿ç”¨å‰åºéå†æŠŠå³è¾¹çš„æ ‘èŠ‚ç‚¹ç§»åŠ¨åˆ°å·¦è¾¹</p>
<p>ç¬¬ä¸€è¶Ÿï¼Œå¤„ç†çš„èŠ‚ç‚¹ä¸º3ï¼Œä¿æŒä¸å˜</p>
<p>ç¬¬äºŒè¶Ÿï¼Œå¤„ç†èŠ‚ç‚¹ 4 ä¿æŒä¸å˜</p>
<p>ç¬¬ä¸‰è¶Ÿï¼Œå¤„ç†èŠ‚ç‚¹2 éœ€è¦æŠŠ èŠ‚ç‚¹3ç§»åŠ¨åˆ°2çš„å³èŠ‚ç‚¹ï¼Œç„¶åæŠŠ4 ç§»åŠ¨åˆ°2çš„æœ€å³çš„å³èŠ‚ç‚¹</p>
<p><img src="https://blog-image-1253555052.cos.ap-guangzhou.myqcloud.com/20200324161451.png"></p>
<p><img src="https://blog-image-1253555052.cos.ap-guangzhou.myqcloud.com/20200324161514.png"></p>
<p>ç¬¬å››è¶Ÿï¼šå¤„ç†èŠ‚ç‚¹6ï¼Œä¸å˜ã€‚</p>
<p>ç¬¬äº”è¶Ÿå¤„ç†èŠ‚ç‚¹ 5 ä¸å˜ï¼Œ</p>
<p>ç¬¬å…­è¶Ÿå¤„ç†èŠ‚ç‚¹1 éœ€è¦æŠŠ 2 ç§»åŠ¨åˆ° 1 çš„å³èŠ‚ç‚¹ï¼Œç„¶åæŠŠ 5 ç§»åŠ¨åˆ° 1çš„æœ€å³å³èŠ‚ç‚¹ã€‚</p>
<p><img src="https://blog-image-1253555052.cos.ap-guangzhou.myqcloud.com/20200324161751.png"></p>
<p><img src="https://blog-image-1253555052.cos.ap-guangzhou.myqcloud.com/20200324161823.png"></p>
<p>åˆ°æ­¤ï¼Œç§»åŠ¨å®Œæ¯•ï¼Œå…¨ç¨‹åªç”¨äº†ä¸€ä¸ªå˜é‡tempã€‚æ»¡è¶³åŸåœ°ç®—æ³•ã€‚</p>
]]></content>
      <categories>
        <category>leetCode</category>
      </categories>
      <tags>
        <tag>ç®—æ³•</tag>
        <tag>leetCode</tag>
      </tags>
  </entry>
  <entry>
    <title>go åç¨‹åˆ‡æ¢çš„æ€§èƒ½åˆ†æ</title>
    <url>/2024/03/20/go%20%E5%8D%8F%E7%A8%8B%E5%88%87%E6%8D%A2%E7%9A%84%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/</url>
    <content><![CDATA[<p>[[Performance analysis of goroutine switching]]<br><img src="https://images.hxzhouh.com/blog-images/2024/03/057d94f39fc9a6838acdbc94b915f654.png" alt="Pasted image 20240320201037"><br>ä¸Šä¸€ç¯‡[[è®¡ç®—æœºä¸­çš„æ—¶é—´ çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ä¼šç”¨æ‰ä½ å¤šå°‘CPUï¼Ÿ]]æ–‡ç« ä¸­ï¼Œä¸­æˆ‘ä»¬ç”¨å®éªŒçš„æ–¹å¼éªŒè¯äº†Linuxè¿›ç¨‹å’Œçº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€ï¼Œå¤§çº¦æ˜¯3-5usä¹‹é—´ã€‚è¿™ä¸ªå¼€é”€ç¡®å®ä¸ç®—å¤§ï¼Œä½†æ˜¯æµ·é‡äº’è”ç½‘æœåŠ¡ç«¯å’Œä¸€èˆ¬çš„è®¡ç®—æœºç¨‹åºç›¸æ¯”ï¼Œç‰¹ç‚¹æ˜¯ï¼š</p>
<ul>
<li>é«˜å¹¶å‘ï¼šæ¯ç§’é’Ÿéœ€è¦å¤„ç†æˆåƒä¸Šä¸‡çš„ç”¨æˆ·è¯·æ±‚ã€‚</li>
<li>å‘¨æœŸçŸ­ï¼šæ¯ä¸ªç”¨æˆ·å¤„ç†è€—æ—¶è¶ŠçŸ­è¶Šå¥½ï¼Œç»å¸¸æ˜¯msçº§åˆ«çš„</li>
<li>é«˜ç½‘ç»œIOï¼šç»å¸¸éœ€è¦ä»å…¶å®ƒæœºå™¨ä¸Šè¿›è¡Œç½‘ç»œIOã€å¦‚Redisã€Mysqlç­‰ç­‰</li>
<li>ä½è®¡ç®—ï¼šä¸€èˆ¬CPUå¯†é›†å‹çš„è®¡ç®—æ“ä½œå¹¶ä¸å¤š<br>å³ä½¿3-5usçš„å¼€é”€ï¼Œå¦‚æœä¸Šä¸‹æ–‡åˆ‡æ¢é‡ç‰¹åˆ«å¤§çš„è¯ï¼Œä¹Ÿä»ç„¶ä¼šæ˜¾å¾—æ˜¯æœ‰é‚£ä¹ˆä¸€äº›æ€§èƒ½ä½ä¸‹ã€‚ä¾‹å¦‚ä¹‹å‰çš„Web Serverä¹‹Apacheï¼Œå°±æ˜¯è¿™ç§æ¨¡å‹ä¸‹çš„è½¯ä»¶äº§å“ã€‚ï¼ˆå…¶å®å½“æ—¶Linuxæ“ä½œç³»ç»Ÿåœ¨è®¾è®¡çš„æ—¶å€™ï¼Œç›®æ ‡æ˜¯ä¸€ä¸ªé€šç”¨çš„æ“ä½œç³»ç»Ÿï¼Œå¹¶ä¸æ˜¯ä¸“é—¨é’ˆå¯¹æœåŠ¡ç«¯é«˜å¹¶å‘æ¥è®¾è®¡çš„ï¼‰</li>
</ul>
<p>ä¸ºäº†é¿å…é¢‘ç¹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œè¿˜æœ‰ä¸€ç§å¼‚æ­¥éé˜»å¡çš„å¼€å‘æ¨¡å‹ã€‚é‚£å°±æ˜¯ç”¨ä¸€ä¸ªè¿›ç¨‹æˆ–çº¿ç¨‹å»æ¥æ”¶ä¸€å¤§å †ç”¨æˆ·çš„è¯·æ±‚ï¼Œç„¶åé€šè¿‡IOå¤šè·¯å¤ç”¨çš„æ–¹å¼æ¥æé«˜æ€§èƒ½ï¼ˆè¿›ç¨‹æˆ–çº¿ç¨‹ä¸é˜»å¡ï¼Œçœå»äº†ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€ï¼‰ã€‚Nginxå’ŒNode Jså°±æ˜¯è¿™ç§æ¨¡å‹çš„å…¸å‹ä»£è¡¨äº§å“ã€‚å¹³å¿ƒè€Œè®ºï¼Œä»ç¨‹åºè¿è¡Œæ•ˆç‡ä¸Šæ¥ï¼Œè¿™ç§æ¨¡å‹æœ€ä¸ºæœºå™¨å‹å¥½ï¼Œè¿è¡Œæ•ˆç‡æ˜¯æœ€é«˜çš„ï¼ˆæ¯”ä¸‹é¢æåˆ°çš„åç¨‹å¼€å‘æ¨¡å‹è¦å¥½ï¼‰ã€‚æ‰€ä»¥Nginxå·²ç»å–ä»£äº†Apacheæˆä¸ºäº†Web Serveré‡Œçš„é¦–é€‰ã€‚ä½†æ˜¯è¿™ç§ç¼–ç¨‹æ¨¡å‹çš„é—®é¢˜åœ¨äºå¼€å‘ä¸å‹å¥½ï¼Œè¯´ç™½äº†å°±æ˜¯è¿‡äºæœºå™¨åŒ–ï¼Œç¦»è¿›ç¨‹æ¦‚å¿µè¢«æŠ½è±¡å‡ºæ¥çš„åˆè¡·èƒŒé“è€Œé©°ã€‚äººç±»æ­£å¸¸çš„çº¿æ€§æ€ç»´è¢«æ‰“ä¹±ï¼Œåº”ç”¨å±‚å¼€å‘ä»¬è¢«é€¼å¾—ä»¥éäººç±»çš„æ€ç»´å»ç¼–å†™ä»£ç ï¼Œä»£ç è°ƒè¯•ä¹Ÿå˜å¾—å¼‚å¸¸å›°éš¾ã€‚</p>
<p>äºæ˜¯å°±æœ‰ä¸€äº›èªæ˜çš„è„‘è¢‹ä»¬ç»§ç»­åœ¨åº”ç”¨å±‚åˆåŠ¨èµ·äº†ä¸»æ„ï¼Œè®¾è®¡å‡ºäº†ä¸éœ€è¦è¿›ç¨‹&#x2F;çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„â€œçº¿ç¨‹â€ï¼Œåç¨‹ã€‚ç”¨åç¨‹å»å¤„ç†é«˜å¹¶å‘çš„åº”ç”¨åœºæ™¯ï¼Œæ—¢èƒ½å¤Ÿç¬¦åˆè¿›ç¨‹æ¶‰åŠçš„åˆè¡·ï¼Œè®©å¼€å‘è€…ä»¬ç”¨äººç±»æ­£å¸¸çš„çº¿æ€§çš„æ€ç»´å»å¤„ç†è‡ªå·±çš„ä¸šåŠ¡ï¼Œä¹ŸåŒæ ·èƒ½å¤Ÿçœå»æ˜‚è´µçš„è¿›ç¨‹&#x2F;çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€ã€‚å› æ­¤å¯ä»¥è¯´ï¼Œåç¨‹å°±æ˜¯Linuxå¤„ç†æµ·é‡è¯·æ±‚åº”ç”¨åœºæ™¯é‡Œçš„è¿›ç¨‹æ¨¡å‹çš„ä¸€ä¸ªå¾ˆå¥½çš„çš„è¡¥ä¸ã€‚</p>
<p>èƒŒæ™¯ä»‹ç»å®Œäº†ï¼Œé‚£ä¹ˆæˆ‘æƒ³è¯´çš„æ˜¯ï¼Œæ¯•ç«Ÿåç¨‹çš„å°è£…è™½ç„¶è½»é‡ï¼Œä½†æ˜¯æ¯•ç«Ÿè¿˜æ˜¯éœ€è¦å¼•å…¥äº†ä¸€äº›é¢å¤–çš„ä»£ä»·çš„ã€‚é‚£ä¹ˆæˆ‘ä»¬æ¥çœ‹çœ‹è¿™äº›é¢å¤–çš„ä»£ä»·å…·ä½“å¤šå°å§ã€‚</p>
<h1 id="åç¨‹å¼€é”€æµ‹è¯•"><a href="#åç¨‹å¼€é”€æµ‹è¯•" class="headerlink" title="åç¨‹å¼€é”€æµ‹è¯•"></a>åç¨‹å¼€é”€æµ‹è¯•</h1><blockquote>
<p>æœ¬æ–‡åŸºäº go 1.22.1</p>
</blockquote>
<h2 id="åç¨‹åˆ‡æ¢CPUå¼€é”€"><a href="#åç¨‹åˆ‡æ¢CPUå¼€é”€" class="headerlink" title="åç¨‹åˆ‡æ¢CPUå¼€é”€"></a>åç¨‹åˆ‡æ¢CPUå¼€é”€</h2><pre><code>æµ‹è¯•è¿‡ç¨‹æ˜¯ä¸æ–­åœ¨åç¨‹ä¹‹é—´è®©å‡ºCPUã€‚æ ¸å¿ƒä»£ç å¦‚ä¸‹ã€‚
</code></pre>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> (  </span><br><span class="line">    <span class="string">&quot;fmt&quot;</span>  </span><br><span class="line">    <span class="string">&quot;runtime&quot;</span>    <span class="string">&quot;time&quot;</span>)  </span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">cal</span><span class="params">()</span></span> &#123;  </span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">1000000</span>; i++ &#123;  </span><br><span class="line">       runtime.Gosched()  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;  </span><br><span class="line">    runtime.GOMAXPROCS(<span class="number">1</span>)  </span><br><span class="line">    currentTime := time.Now()  </span><br><span class="line">    fmt.Println(currentTime)  </span><br><span class="line">    <span class="keyword">go</span> cal()  </span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">1000000</span>; i++ &#123;  </span><br><span class="line">       runtime.Gosched()  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    fmt.Println(time.Now().Sub(currentTime) / <span class="number">2000000</span>)  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¼–è¯‘è¿è¡Œ</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">âœ  trace git:(main) âœ— go run main.go              </span><br><span class="line">2024-03-20 19:52:24.772579 +0800 CST m=+0.000114834</span><br><span class="line">54ns</span><br><span class="line">âœ  trace git:(main) âœ— </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å¹³å‡æ¯æ¬¡åç¨‹åˆ‡æ¢çš„å¼€é”€æ˜¯ 54ns ç›¸å¯¹äºå‰é¢æ–‡ç« æµ‹å¾—çš„è¿›ç¨‹åˆ‡æ¢å¼€é”€å¤§çº¦3.5usï¼Œå¤§çº¦æ˜¯å…¶1&#x2F;70ã€‚æ¯”ç³»ç»Ÿè°ƒç”¨çš„é€ æˆçš„å¼€é”€è¿˜è¦ä½ã€‚  </p>
<h2 id="åç¨‹å†…å­˜å¼€é”€"><a href="#åç¨‹å†…å­˜å¼€é”€" class="headerlink" title="åç¨‹å†…å­˜å¼€é”€"></a>åç¨‹å†…å­˜å¼€é”€</h2><p>åœ¨ç©ºé—´ä¸Šï¼Œåç¨‹åˆå§‹åŒ–åˆ›å»ºçš„æ—¶å€™ä¸ºå…¶åˆ†é…çš„æ ˆæœ‰2KBã€‚è€Œçº¿ç¨‹æ ˆè¦æ¯”è¿™ä¸ªæ•°å­—å¤§çš„å¤šï¼Œå¯ä»¥é€šè¿‡ulimit å‘½ä»¤æŸ¥çœ‹ï¼Œä¸€èˆ¬éƒ½åœ¨å‡ å…†ï¼Œæˆ‘çš„mac ä¸Šæ˜¯8m ã€‚å¦‚æœå¯¹æ¯ä¸ªç”¨æˆ·åˆ›å»ºä¸€ä¸ªåç¨‹å»å¤„ç†ï¼Œ100ä¸‡å¹¶å‘ç”¨æˆ·è¯·æ±‚åªéœ€è¦2Gå†…å­˜å°±å¤Ÿäº†ï¼Œè€Œå¦‚æœç”¨çº¿ç¨‹æ¨¡å‹åˆ™éœ€è¦8Tã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">âœ  trace git:(main) âœ— ulimit -a   </span><br><span class="line">-t: cpu time (seconds)              unlimited</span><br><span class="line">-f: file size (blocks)              unlimited</span><br><span class="line">-d: data seg size (kbytes)          unlimited</span><br><span class="line">-s: stack size (kbytes)             8176</span><br><span class="line">-c: core file size (blocks)         0</span><br><span class="line">-v: address space (kbytes)          unlimited</span><br><span class="line">-l: locked-in-memory size (kbytes)  unlimited</span><br><span class="line">-u: processes                       2666</span><br><span class="line">-n: file descriptors                12544</span><br></pre></td></tr></table></figure>

<h1 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h1><p>åç¨‹ç”±äºæ˜¯åœ¨ç”¨æˆ·æ€æ¥å®Œæˆä¸Šä¸‹æ–‡åˆ‡æ¢çš„ï¼Œæ‰€ä»¥åˆ‡æ¢è€—æ—¶åªæœ‰åŒºåŒº50nså¤šä¸€äº›ï¼Œæ¯”è¿›ç¨‹åˆ‡æ¢è¦é«˜70å€ã€‚å•ä¸ªåç¨‹éœ€è¦çš„æ ˆå†…å­˜ä¹Ÿè¶³å¤Ÿå°ï¼Œåªéœ€è¦2KBã€‚æ‰€ä»¥ï¼Œè¿‘å‡ å¹´æ¥åç¨‹å¤§ç«ï¼Œåœ¨äº’è”ç½‘åç«¯çš„é«˜å¹¶å‘åœºæ™¯é‡Œå¤§æ”¾å…‰å½©ã€‚</p>
<p>æ— è®ºæ˜¯ç©ºé—´è¿˜æ˜¯æ—¶é—´æ€§èƒ½éƒ½æ¯”è¿›ç¨‹ï¼ˆçº¿ç¨‹ï¼‰å¥½è¿™ä¹ˆå¤šï¼Œé‚£ä¹ˆLinusä¸ºå•¥ä¸æŠŠå®ƒåœ¨æ“ä½œç³»ç»Ÿé‡Œå®ç°ï¼Ÿæ“ä½œç³»ç»Ÿä¸ºäº†å®ç°å®æ—¶æ€§æ›´å¥½çš„ç›®çš„ï¼Œå¯¹ä¸€äº›ä¼˜å…ˆçº§æ¯”è¾ƒé«˜çš„è¿›ç¨‹æ˜¯ä¼šæŠ¢å å…¶å®ƒè¿›ç¨‹çš„CPUçš„ã€‚è€Œåç¨‹æ— æ³•å®ç°è¿™ä¸€ç‚¹ï¼Œè¿˜å¾—ä¾èµ–äºæŒ¡å‰ä½¿ç”¨CPUçš„åç¨‹ä¸»åŠ¨é‡Šæ”¾ï¼Œäºæ“ä½œç³»ç»Ÿçš„å®ç°ç›®çš„ä¸ç›¸å»åˆã€‚æ‰€ä»¥åç¨‹çš„é«˜æ•ˆæ˜¯ä»¥ç‰ºç‰²å¯æŠ¢å æ€§ä¸ºä»£ä»·çš„ã€‚<br>åç¨‹æœ€ç»ˆä¹Ÿæ˜¯é™„ç€åœ¨æ“ä½œç³»ç»Ÿçº¿ç¨‹ä¸Šæ‰§è¡Œçš„ã€‚<br>æˆ‘ä»¬éœ€è¦è€ƒè™‘çš„ä¸€ä¸ªé—®é¢˜æ˜¯ã€‚<br>éš¾é“ç”¨äº†åç¨‹ï¼Œçº¿ç¨‹å°±ä¸åˆ‡æ¢äº†å—ï¼Ÿçº¿ç¨‹çš„åˆ‡æ¢é¢‘ç‡ï¼ŒåŸºæœ¬å–å†³äºçº¿ç¨‹çš„æ•°é‡ï¼Œä½¿ç”¨åç¨‹ï¼Œéœ€è¦æŒ‡å®šæ¯ä¸ªçº¿ç¨‹çš„ä»»åŠ¡ï¼ŒåŒæ ·çš„ä»»åŠ¡é‡ï¼Œåç¨‹éœ€è¦çš„çº¿ç¨‹æ•°é‡åº”è¯¥å§‹ç»ˆé«˜äºè‡ªåŠ¨åˆ†é…çš„çº¿ç¨‹æ± ã€‚<br>å› è€Œï¼š<br>    ä½¿ç”¨çº¿ç¨‹ &#x3D; çº¿ç¨‹åˆ‡æ¢å¼€é”€ï¼ˆå°ï¼‰<br>    ä½¿ç”¨åç¨‹ &#x3D; çº¿ç¨‹åˆ‡æ¢å¼€é”€ï¼ˆå¤§ï¼‰+ åç¨‹åˆ‡æ¢å¼€é”€<br>    ç„¶åCPUå¼€é”€ï¼š<br>    çº¿ç¨‹çš„æŒ‡ä»¤å‘¨æœŸ &#x3D; ä¸­æ–­æ£€æµ‹ + æŒ‡ä»¤æ‰§è¡Œï¼ˆåŒ…æ‹¬å–æŒ‡ã€è½¬æ¢å’Œæ‰§è¡Œï¼‰<br>    åç¨‹çš„æŒ‡ä»¤å‘¨æœŸ &#x3D; ä¸­æ–­æ£€æµ‹ + æŒ‡ä»¤æ‰§è¡Œ + ä¸­æ–­æ£€æµ‹ + åç¨‹ä¿¡å·æ£€æµ‹<br>    æ‰€ä»¥æˆ‘æœ‰ä»¥ä¸‹ç»“è®ºï¼š<br>    æ€§èƒ½ä¸Šï¼Œioå¤šè·¯å¤ç”¨ + çº¿ç¨‹æ± æ˜¯å®Œå…¨ç¢¾å‹åç¨‹çš„ï¼›ä½†æ˜¯åœ¨æ–¹ä¾¿ç¨‹åº¦ä¸Šï¼Œè¿˜æ˜¯åç¨‹å¥½ç”¨  </p>
<p>ç”±äºgoçš„åç¨‹è°ƒç”¨èµ·æ¥å¤ªæ–¹ä¾¿äº†ï¼Œæ‰€ä»¥ä¸€äº›goçš„ç¨‹åºå‘˜å°±å¾ˆéšæ„ä½¿ç”¨go è¿™ä¸ªå…³é”®å­—ã€‚è¦çŸ¥é“goè¿™æ¡æŒ‡ä»¤åœ¨åˆ‡æ¢åˆ°åç¨‹ä¹‹å‰ï¼Œå¾—å…ˆæŠŠåç¨‹åˆ›å»ºå‡ºæ¥ã€‚è€Œä¸€æ¬¡åˆ›å»ºåŠ ä¸Šè°ƒåº¦å¼€é”€å°±æ¶¨åˆ°400nsï¼Œå·®ä¸å¤šç›¸å½“äºä¸€æ¬¡ç³»ç»Ÿè°ƒç”¨çš„è€—æ—¶äº†ã€‚è™½ç„¶åç¨‹å¾ˆé«˜æ•ˆï¼Œä½†æ˜¯ä¹Ÿä¸è¦ä¹±ç”¨ï¼Œå¦åˆ™Rob PikeèŠ±å¤§ç²¾åŠ›ä¼˜åŒ–å‡ºæ¥çš„æ€§èƒ½ï¼Œè¢«ä½ éšæ„ä¸€goåˆç»™è‘¬é€æ‰äº†ã€‚</p>
]]></content>
      <categories>
        <category>golang</category>
      </categories>
      <tags>
        <tag>go</tag>
      </tags>
  </entry>
  <entry>
    <title>medium å†™ä½œä¸€ä¸ªæœˆçš„å¿ƒå¾—</title>
    <url>/2024/02/19/medium%20%E5%86%99%E4%BD%9C%E4%B8%80%E4%B8%AA%E6%9C%88%E7%9A%84%E5%BF%83%E5%BE%97/</url>
    <content><![CDATA[<p>1æœˆä»½çš„æ—¶å€™ï¼Œä»ä¸€ä¸ªç½‘å‹é‚£é‡Œå¾—åˆ°ç»éªŒï¼Œå†mediumä¸Šå†™ä½œå¯ä»¥èµšé’±ã€‚äºæ˜¯å¼€é€š<a href="https://x1mdx3wzpm.feishu.cn/docx/UA99drQcroan5Jx3aiXcwGoEnMg">ä¼šå‘˜è®¡åˆ’</a>ï¼Œç„¶åã€‚å¼€å§‹å†™ä½œï¼Œ1.9 åˆ°ä»Šå¤© 2.19 å·²ç»å†™äº†22ç¯‡æ–‡ç« ï¼ˆéƒ½æ˜¯æˆ‘ä»¥å‰çš„æ–‡ç« ç¿»è¯‘ï¼‰æ€»å…±æœ‰ 73ä¸ªfollows<br>æ€»é˜…è¯»é‡ 645ï¼Œè·å¾—æ”¶ç›Š $25.5<br><img src="https://images.hxzhouh.com/blog-images/2024/02/a086a96e967a82f1a4272b7f65ca3abb.png" alt="Pasted image 20240219174914"></p>
<p><img src="https://images.hxzhouh.com/blog-images/2024/02/4c12d557403a2278a3e2c648385aa188.png" alt="Pasted image 20240219173904"></p>
<p>å…³äºè¿™ä¸€ä¸ªæœˆçš„æ€»ç»“ï¼š</p>
<ol>
<li><p>medium çš„ç¡®èƒ½èµšåˆ°é’±ï¼Œ<br> ä¸€æœˆä»½çš„ $9.8 æ‰£ç¨åï¼Œå·²ç»åˆ°äº†æˆ‘çš„æ”¯ä»˜å®ã€‚å¾ˆå¤šäººé€šè¿‡medium èµšåˆ°äº†å¯è§‚çš„æ”¶å…¥ï¼ˆå½“ç„¶ï¼Œè¿™éœ€è¦ä¸€ç‚¹è¿æ°”ä»¥åŠè€å¿ƒï¼‰ ã€‚æ¯”å¦‚è¿™ä¸ªä½œè€…ï¼Œé€šè¿‡ä¸€ç¯‡30åˆ†é’Ÿæ—¶é—´å†™çš„æ–‡ç« è·å¾—äº†10000å¤šå—çš„æ”¶å…¥ï¼Œå¹¶ä¸”è¿˜åœ¨æŒç»­å¢åŠ ä¸­ã€‚ <a href="https://catcoding.me/p/my-writing-story-on-medium/">æˆ‘å¦‚ä½•å†™å‡ºä¸€ä¸‡å…ƒçš„æ–‡ç« </a></p>
</li>
<li><p>åˆ©ç”¨å‡ºç‰ˆç‰©<br> å½“å¼€å§‹å†™ä½œåï¼Œå¯ä»¥é€‰æ‹©å‡ºç‰ˆç‰©å‘è¡¨æ–‡ç« ï¼Œåˆ©ç”¨å‡ºç‰ˆç‰©è‡ªå¸¦çš„æµé‡å®Œæˆå†·å¯åŠ¨ï¼Œæ¯”å¦‚æˆ‘ç»å¸¸æŠ•ç¨¿çš„ <a href="https://levelup.gitconnected.com/">LevelUpCode</a>  å°±æ˜¯ä¸€ä¸ªæµé‡ä¸é”™çš„å‡ºç‰ˆç‰©ã€‚å‡ºç‰ˆç‰©å¦‚æœæ”¯æŒæŠ•ç¨¿çš„è¯ï¼Œä¼šåœ¨ä»–ä»¬ä¸»é¡µå†™æ˜<a href="https://levelup.gitconnected.com/how-to-get-published-on-gitconnected-dac547ef556b">wirte for us</a>,æ ¹æ®ä»–ä»¬çš„è¦æ±‚åšå°±æ˜¯äº†ã€‚<br>  å¤§æ¦‚çš„æµç¨‹å°±æ˜¯</p>
<ol>
<li>åœ¨medium å†™ä¸€ç¯‡æ–‡ç« ï¼Œä¿å­˜æˆè‰ç¨¿</li>
<li>å°†è‰ç¨¿è¿æ¥å‘é€ç»™å‡ºç‰ˆç‰©çš„ç¼–è¾‘ï¼Œ</li>
<li>ç¼–è¾‘ä¼šç»™ä½ å›é‚®ä»¶ï¼Œå°†ä½ æ·»åŠ ä¸ºä½œè€…ï¼ˆä¸€å‘¨ä»¥å†…ï¼‰</li>
<li>ç„¶ååœ¨medium å°±å¯ä»¥é€‰æ‹©å‡ºç‰ˆç‰©å‘è¡¨äº†ï¼ˆå…¶å®ä¹Ÿæ˜¯æ¨é€è‰ç¨¿ç»™å‡ºç‰ˆç‰©çš„ç¼–è¾‘ï¼‰ã€‚</li>
<li>æœ€åï¼Œç¼–è¾‘ä¼šå®¡æ ¸ä½ çš„æ–‡ç« ï¼Œç„¶åç”±ä»–ä»¬å‘è¡¨ã€‚</li>
</ol>
</li>
<li><p>ä¸€äº›å¸¸ç”¨çš„è½¯ä»¶ä»¥åŠwebå·¥å…·ï¼ˆmacï¼‰</p>
<ol>
<li>ä¸ºåšå®¢åˆ¶ä½œå°é¢å›¾ç‰‡ <a href="https://coverview.vercel.app/">https://coverview.vercel.app/</a> </li>
<li>å±å¹•å½•åˆ¶è½¯ä»¶ FocuSee </li>
<li>åˆ¶ä½œgifå›¾ç‰‡ picgif lite</li>
<li>ç”»å›¾è½¯ä»¶ draw.io æˆ–è€… excalidraw</li>
<li>ç¿»è¯‘å·¥å…· bob chatgpt</li>
<li>å†™ä½œå·¥å…·æˆ‘ç”¨çš„æ˜¯ typroï¼Œtyproå¤åˆ¶ç²˜è´´åˆ° medium èƒ½æœ€å¤§ç¨‹åº¦ä¿æŒæ ¼å¼ã€‚</li>
</ol>
</li>
<li><p>å…³äºé˜…è¯»é‡å’Œæ¶¨ç²‰</p>
<ol>
<li>æˆ‘ç°åœ¨ä¸»è¦æ˜¯é€šè¿‡ç¤¾åŒºé‡Œé¢çš„æœ‹å‹ç‚¹èµğŸ˜„ã€‚</li>
<li>æ˜¥èŠ‚æœŸé—´ï¼Œæˆ‘æ²¡æœ‰ä¸Šmedium ä¹Ÿæ¶¨äº†30å·¦å³çš„ç²‰ä¸ï¼Œæ¯å¤©çš„é˜…è¯»é‡ä¹Ÿæœ‰50å·¦å³ï¼Œåº”è¯¥éƒ½æ˜¯æ¥è‡ªå‡ºç‰ˆç‰©çš„è‡ªç„¶æµé‡ã€‚</li>
<li>å¤šå…³æ³¨åˆ«äººï¼Œç”¨å¿ƒè¯„è®ºåˆ«äººçš„æ–‡ç« ï¼Œè¹­å¤§ä½¬çš„æµé‡ã€‚ æŠŠmediumå½“æˆå­¦ä¹ çš„å¹³å°ï¼Œè€Œä¸æ˜¯å•çº¯åªè¹­æµé‡ã€‚</li>
<li>çœ‹äº†æ¯”è¾ƒå¤šæ•™äººå†™meidiumæ–‡ç« çš„æ–‡ç« ï¼ŒåŸºæœ¬ä¸Šéƒ½å†è¯´ä¸€ä¸ªå¥½æ ‡é¢˜ï¼Œä»¥åŠå¥½çš„é…å›¾ä¹‹ç±»çš„ å·´å•¦å·´å•¦ï¼Œ äºŒæœˆ-ä¸‰æœˆæˆ‘ä¼šå®è·µä¸€ä¸‹ï¼Œåœ¨å†™ä¸€ç¯‡å¦‚ä½•æé«˜é˜…è¯»é‡çš„æ–‡ç« ã€‚<br>ä»å¯åŠ¨åˆ°ç°åœ¨ï¼Œå¤§æ¦‚å°±æ˜¯åšäº†è¿™äº›äº‹æƒ…æŠŠï¼Œä¹Ÿç®—æ˜¯å¼€å§‹äº†ï¼Œåé¢æœ‰æ–°çš„æƒ³æ³•ï¼Œå†æ›´æ–°ã€‚ã€‚ã€‚</li>
</ol>
</li>
</ol>
<p>good enjoy ğŸ˜</p>
]]></content>
      <categories>
        <category>blog</category>
      </categories>
      <tags>
        <tag>å†™ä½œ</tag>
        <tag>medium</tag>
      </tags>
  </entry>
  <entry>
    <title>mediumèƒ½è®©ä½ å¿«é€Ÿçš„èµšåˆ°é’±ï¼Ÿ ä¸å¯èƒ½</title>
    <url>/2024/02/23/medium%E8%83%BD%E8%AE%A9%E4%BD%A0%E5%BF%AB%E9%80%9F%E7%9A%84%E8%B5%9A%E5%88%B0%E9%92%B1%EF%BC%9F%20%E4%B8%8D%E5%8F%AF%E8%83%BD/</url>
    <content><![CDATA[<p>mediumèƒ½è®©ä½ å¿«é€Ÿçš„èµšåˆ°é’±ï¼Ÿ ä¸å¯èƒ½<br>æˆ‘è¦ç”¨æˆ‘ä¸¤ä¸ªæœˆçš„ç»å†å‘Šè¯‰ä½ ä»¬ï¼Œè¿™æ˜¯ä¸å¯èƒ½çš„</p>
<span id="more"></span>

<p>æˆ‘å¾ˆæ—©å°±åŠ å…¥äº†mediumï¼Œä½†æ˜¯æ²¡æœ‰å¼€é€šä»˜è´¹ä¼šå‘˜ï¼Œä¹Ÿæ²¡æœ‰æ€ä¹ˆä½¿ç”¨ï¼Œä¹Ÿæ²¡ä¸Šé¢å‘è¡¨è¿‡æ–‡ç« ï¼Œ1æœˆä»½ï¼Œæˆ‘åœ¨ä¸€ä¸ªè®ºå›é‡Œé¢çŸ¥é“åŠ å…¥MPPä¼šå‘˜ï¼Œå†™ä½œç„¶åå°±å¯ä»¥èµšé’±ã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆç–¯ç‹‚çš„æƒ³æ³•ã€‚<br>æˆ‘çš„ä¸»ä¸šæ˜¯ä¸€ä¸ªåç«¯ç¨‹åºå‘˜ï¼Œå¶å°”æœ‰å†™åšå®¢çš„ä¹ æƒ¯ï¼Œä½†æ˜¯ä»¥å‰ä¹Ÿæ²¡æœ‰å†™åšå®¢èµšé’±çš„æƒ³æ³•ï¼Œæˆ‘æ˜¯ä¸€ä¸ªå†™ä½œä¸Šçš„æ–°æ‰‹ã€‚<br>æˆ‘å¼€å§‹çš„æ—¶å€™é™†ç»­æ¬è¿è‡ªå·±ä»¥å‰å†™çš„åšå®¢åˆ°mediumï¼Œç„¶åï¼Œæˆ‘çš„å™©æ¢¦å°±å¼€å§‹äº†ï¼Œ</p>
<p>æˆ‘å¼€å§‹æ¯å¤©ç›¯ç€ æˆ‘çš„followsæ•°é‡ï¼Œæ¯å¤©çœ‹reads æ•°é‡ï¼Œç­‰ç€æ›´æ–°æ”¶ç›Šï¼Œ ç„¶åå¾—åˆ°ä¸€ä¸ª0.0x ç¾å…ƒã€‚<br>ä»ä¸€æœˆåˆ°äºŒæœˆï¼Œæˆ‘å‘è¡¨äº†15ç¯‡å·¦å³çš„ä»˜è´¹æ–‡ç« ï¼Œæˆ‘çš„follows æ•°é‡æ˜¯40ï¼Œé˜…è¯»æ•°é‡å¤§æ¦‚åœ¨200å·¦å³ã€‚</p>
<p>æˆ‘çœ‹åˆ°medium ä¸Šå¾ˆå¤šäººæ•™ä½ ï¼Œä¸€ä¸ªæ˜ŸæœŸè·å¾— follows ï¼Œ2ä¸ªæœˆ2k followsï¼Œæ”¶ç›Š$1000, å‘è¡¨çš„æ–‡ç« éƒ½æ˜¯è®©ä½ å¦‚ä½•å¿«é€Ÿè·å¾—followsï¼Œæ‰“é€ ä½ çš„å¸å¼•åŠ›ã€‚ã€‚ã€‚ã€‚<br>å¯æ˜¯ï¼Œè¿™ä¸ªçœŸçš„æœ‰ç”¨å˜›ï¼Ÿ<br>æˆ‘å¼€å§‹ç–¯ç‹‚çš„ç»™åˆ«äººfollowï¼Œç»™åˆ«äººçš„å¸–å­é¼“æŒï¼Œæ¯å¤©æ‰“å¼€medium 100æ¬¡ï¼ŒæŸ¥çœ‹åŠ¨æ€æ˜¯ä¸æ˜¯æœ‰äººfollowï¼Œæœ‰æ—¶å€™ä¼šå¢åŠ å‡ ä¸ªfollowsï¼Œæˆ‘ä¼šå¼€å¿ƒçš„å‘ç–¯ï¼Œæœ‰æ—¶å€™çœ‹åˆ°æ‰äº†follows æˆ‘ä¼šå¾ˆå¤±è½ï¼Œæˆ‘æ²¡æœ‰å¸è¿‡æ¯’ï¼Œä½†æ˜¯é‚£ç§æ„Ÿè§‰æˆ‘è§‰å¾—å°±æ˜¯å¸æ¯’ã€‚ä¸¥é‡å½±å“åˆ°äº†æˆ‘çš„ç”Ÿæ´»è·Ÿå·¥ä½œã€‚<br>è¿™æ ·æ˜¯ä¸å¯¹çš„ã€‚<br>medium æ˜¯ä¸€ä¸ªä¼˜ç§€çš„ç¤¾åŒºï¼Œé‡Œé¢æœ‰å¾ˆå¤šäººåˆ†äº«è‡ªå·±å†™çš„ä¼˜ç§€çš„æ–‡ç« ï¼Œæ¯”å¦‚<a href="https://medium.com/@blanchon.vincent">Vincent</a>ç­‰ï¼Œä»–æ˜¯æˆ‘å­¦ä¹ goè¯­è¨€çš„å¯¼å¸ˆã€‚ä½†æ˜¯åœ¨æˆ‘è¿™é‡Œï¼Œå˜æˆäº†æˆ‘æƒ³åšäººçœ¼çƒçš„å·¥å…·ã€‚ä¸åº”è¯¥æ˜¯è¿™æ ·çš„ã€‚medium ä¸Šæœ‰å¾ˆå¤šæ•™äººå†™ä½œçš„æ–‡ç« ï¼Œä½†æ˜¯ ç»å¯¹ä¸æ˜¯åƒæˆ‘ç°åœ¨è¿™æ ·ï¼Œè¿™ä¹ˆè®¡è¾ƒfollows çš„æ•°é‡ï¼Œä¸ºäº†é˜…è¯»ã€follows ä¸é¡¾ä¸€åˆ‡ï¼Œæœ‰ç‚¹æœ¬æœ«å€’ç½®äº†ã€‚</p>
<p>ä¸‹é¢æˆ‘å°†è¿™æ ·åš</p>
<ol>
<li>å¯¹æˆ‘è¿‡å»ä¸¤ä¸ªæ˜ŸæœŸfollowsçš„è¡¨ç¤ºçœŸè¯šçš„é“æ­‰ï¼Œæˆ‘followä½ ä»¬å¹¶ä¸æ˜¯æˆ‘çœŸçš„å–œæ¬¢ä½ çš„æ–‡ç« ï¼Œè€Œæ˜¯æˆ‘æƒ³è¦ä½ follow å›æˆ‘ã€‚</li>
<li>è®¤çœŸçš„å¯¹å¾…æˆ‘çš„æ¯ä¸€ç¯‡æ–‡ç« ï¼Œé€šè¿‡è‡ªå·±çš„å†™çš„æ–‡ç« æ¥æ‰“åŠ¨è¯»è€…ã€‚</li>
<li>å›å½’ç”Ÿæ´»ï¼Œçƒ­çˆ±ç”Ÿæ´»ã€‚å¤šè¯»ä¹¦ï¼Œè€Œä¸æ˜¯æƒ³ç€ä¸€å¤©è¦å†™ä¸€ç¯‡æ–‡ç« ï¼Œéª—å‡ ä¸ªfollows</li>
<li>medium æ˜¯ä¸ªå¾ˆå¥½çš„å¹³å°ï¼Œä½ çš„ä¼˜ç§€ä½œå“èƒ½å¤Ÿåœ¨è¿™é‡Œå¾—åˆ°é‡‘é’±çš„å›æŠ¥ï¼Œä½†æ˜¯ä¸è¦å¤ªè®¡è¾ƒå¾—å¤±ï¼Œä½œå“å†™å¾—å¥½ï¼Œè‡ªç„¶ä¼šæœ‰äººç»™ä½ é¼“æŒã€‚</li>
</ol>
]]></content>
      <categories>
        <category>blog</category>
      </categories>
      <tags>
        <tag>medium</tag>
        <tag>å‰¯ä¸š</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸ºä»€ä¹ˆTCPæ–­å¼€çš„æ—¶å€™éœ€è¦å››æ¬¡æŒ¥æ‰‹</title>
    <url>/2024/02/16/%E4%B8%BA%E4%BB%80%E4%B9%88TCP%E6%96%AD%E5%BC%80%E7%9A%84%E6%97%B6%E5%80%99%E9%9C%80%E8%A6%81%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B/</url>
    <content><![CDATA[<p>TCPåè®®æ˜¯æˆ‘ä»¬æ—¥å¸¸ä½¿ç”¨çš„ç½‘ç»œåè®®ä¹‹ä¸€ï¼Œå®ƒä¸ä»…è´Ÿè´£å»ºç«‹è¿æ¥ï¼Œè¿˜è´Ÿè´£æ–­å¼€è¿æ¥ã€‚ä¸Šé¢ä¸Šä¸€ç¯‡<a href="https://levelup.gitconnected.com/why-tcp-requires-three-handshakes-to-establish-a-connection-31d814aac6b8">åšå®¢</a>ï¼Œæˆ‘ä»¬åˆ†æäº† Why TCP requires three handshakes to establish a connection,å»ºç«‹è¿æ¥æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä¿è¯å†å²è¿æ¥ä»¥åŠåºåˆ—å·çš„é—®é¢˜ã€‚ ä¸å»ºç«‹è¿æ¥æ—¶çš„ä¸‰æ¬¡æ¡æ‰‹ä¸åŒï¼Œæ–­å¼€è¿æ¥æ—¶éœ€è¦è¿›è¡Œå››æ¬¡æŒ¥æ‰‹ï¼ˆfour-way handshakeï¼‰ã€‚æœ¬æ–‡å°†æ¢è®¨ä¸ºä»€ä¹ˆTCPæ–­å¼€è¿æ¥éœ€è¦è¿›è¡Œå››æ¬¡æŒ¥æ‰‹ï¼Œè€Œä¸æ˜¯ä¸‰æ¬¡æˆ–å…¶ä»–æ¬¡æ•°ã€‚</p>
<span id="more"></span>
<h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>åœ¨æ·±å…¥è®¨è®ºä¸ºä»€ä¹ˆéœ€è¦å››æ¬¡æŒ¥æ‰‹ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹TCPè¿æ¥çš„æ–­å¼€è¿‡ç¨‹ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œå½“é€šä¿¡åŒæ–¹ä¸­çš„ä¸€æ–¹å†³å®šæ–­å¼€è¿æ¥æ—¶ï¼Œå®ƒä¼šå‘é€ä¸€ä¸ªFINï¼ˆFinishï¼‰æ§åˆ¶æ¶ˆæ¯ç»™å¯¹æ–¹ï¼Œè¡¨ç¤ºè‡ªå·±å·²ç»æ²¡æœ‰æ•°æ®è¦å‘é€äº†ã€‚æ¥æ”¶åˆ°FINæ¶ˆæ¯çš„ä¸€æ–¹ä¼šå‘é€ä¸€ä¸ªACKï¼ˆAcknowledgmentï¼‰æ§åˆ¶æ¶ˆæ¯ä½œä¸ºç¡®è®¤ï¼Œå¹¶è¿›å…¥åŠå…³é—­çŠ¶æ€ï¼Œè¡¨ç¤ºè‡ªå·±ä¸å†å‘é€æ•°æ®ï¼Œä½†ä»ç„¶å¯ä»¥æ¥æ”¶æ•°æ®ã€‚å½“å¦ä¸€æ–¹ä¹Ÿæ²¡æœ‰æ•°æ®è¦å‘é€æ—¶ï¼Œå®ƒä¼šå‘é€ä¸€ä¸ªFINæ¶ˆæ¯ç»™å¯¹æ–¹ï¼Œè¡¨ç¤ºè‡ªå·±ä¹Ÿå‡†å¤‡æ–­å¼€è¿æ¥ã€‚æ¥æ”¶åˆ°è¿™ä¸ªFINæ¶ˆæ¯çš„ä¸€æ–¹ä¼šå†æ¬¡å‘é€ä¸€ä¸ªACKæ¶ˆæ¯è¿›è¡Œç¡®è®¤ï¼Œç„¶åä¸¤ç«¯çš„è¿æ¥æ‰ä¼šå®Œå…¨å…³é—­ã€‚<br><img src="https://images.hxzhouh.com/blog-images/2024/03/a710aaf52810ad7ecd7423ca98a4f343.png" alt="Pasted image 20240201170632"></p>
<h2 id="è®¾è®¡"><a href="#è®¾è®¡" class="headerlink" title="è®¾è®¡"></a>è®¾è®¡</h2><p>ä¸ºä»€ä¹ˆTCPæ–­å¼€è¿æ¥éœ€è¦è¿›è¡Œå››æ¬¡æŒ¥æ‰‹ï¼Ÿä¸‹é¢æˆ‘ä»¬ä»å‡ ä¸ªæ–¹é¢æ¥åˆ†æè¿™ä¸ªé—®é¢˜ï¼š</p>
<h3 id="ç¡®ä¿æ•°æ®å®Œæ•´æ€§"><a href="#ç¡®ä¿æ•°æ®å®Œæ•´æ€§" class="headerlink" title="ç¡®ä¿æ•°æ®å®Œæ•´æ€§"></a>ç¡®ä¿æ•°æ®å®Œæ•´æ€§</h3><p>TCPåè®®æ˜¯é¢å‘è¿æ¥çš„å¯é ä¼ è¾“åè®®ï¼Œå®ƒä¿è¯æ•°æ®çš„å¯é æ€§å’Œå®Œæ•´æ€§ã€‚åœ¨æ–­å¼€è¿æ¥æ—¶ï¼ŒåŒæ–¹å¯èƒ½è¿˜æœ‰æœªå‘é€æˆ–æœªæ¥æ”¶çš„æ•°æ®åŒ…ã€‚å¦‚æœåªè¿›è¡Œä¸‰æ¬¡æŒ¥æ‰‹ï¼Œé‚£ä¹ˆåœ¨æœ€åä¸€æ¬¡æŒ¥æ‰‹æ—¶ï¼Œå¯¹æ–¹å¯èƒ½æ— æ³•å¾—çŸ¥è‡ªå·±å‘é€çš„FINæ¶ˆæ¯æ˜¯å¦å·²ç»è¢«æ¥æ”¶ã€‚è¿™æ ·ä¸€æ¥ï¼Œå¯èƒ½ä¼šå¯¼è‡´å¯¹æ–¹æœªèƒ½å®Œå…¨æ¥æ”¶åˆ°è‡ªå·±çš„æ•°æ®ï¼Œé€ æˆæ•°æ®çš„ä¸¢å¤±ã€‚å› æ­¤ï¼Œé€šè¿‡è¿›è¡Œå››æ¬¡æŒ¥æ‰‹ï¼Œå¯ä»¥ç¡®ä¿åŒæ–¹éƒ½èƒ½å¤Ÿå®Œæ•´åœ°æ¥æ”¶åˆ°å¯¹æ–¹çš„æ•°æ®ï¼Œä¿è¯æ•°æ®çš„å®Œæ•´æ€§ã€‚</p>
<h3 id="å¤„ç†ç½‘ç»œå»¶è¿Ÿå’Œä¸¢åŒ…"><a href="#å¤„ç†ç½‘ç»œå»¶è¿Ÿå’Œä¸¢åŒ…" class="headerlink" title="å¤„ç†ç½‘ç»œå»¶è¿Ÿå’Œä¸¢åŒ…"></a>å¤„ç†ç½‘ç»œå»¶è¿Ÿå’Œä¸¢åŒ…</h3><p>åœ¨ç½‘ç»œä¸­ï¼Œæ•°æ®åŒ…å¯èƒ½ä¼šå› ä¸ºç½‘ç»œå»¶è¿Ÿæˆ–ä¸¢åŒ…è€Œæ— æ³•åŠæ—¶åˆ°è¾¾ç›®çš„åœ°ã€‚åœ¨æ–­å¼€è¿æ¥æ—¶ï¼Œå¦‚æœåªè¿›è¡Œä¸‰æ¬¡æŒ¥æ‰‹ï¼Œé‚£ä¹ˆåœ¨æœ€åä¸€æ¬¡æŒ¥æ‰‹æ—¶ï¼Œå¯¹æ–¹å¯èƒ½æ— æ³•å¾—çŸ¥è‡ªå·±å‘é€çš„FINæ¶ˆæ¯æ˜¯å¦å·²ç»è¢«æ¥æ”¶ï¼Œè¿™å°±æ— æ³•ä¿è¯å¯¹æ–¹èƒ½å¤ŸåŠæ—¶å…³é—­è¿æ¥ã€‚é€šè¿‡è¿›è¡Œå››æ¬¡æŒ¥æ‰‹ï¼Œå¯ä»¥ç»™ç½‘ç»œæä¾›è¶³å¤Ÿçš„æ—¶é—´æ¥å¤„ç†å»¶è¿Ÿå’Œä¸¢åŒ…é—®é¢˜ï¼Œç¡®ä¿è¿æ¥èƒ½å¤Ÿæ­£ç¡®åœ°å…³é—­ã€‚</p>
<h3 id="ç­‰å¾…æœªå‘é€çš„æ•°æ®å‘é€å®Œæ¯•"><a href="#ç­‰å¾…æœªå‘é€çš„æ•°æ®å‘é€å®Œæ¯•" class="headerlink" title="ç­‰å¾…æœªå‘é€çš„æ•°æ®å‘é€å®Œæ¯•"></a>ç­‰å¾…æœªå‘é€çš„æ•°æ®å‘é€å®Œæ¯•</h3><p>åœ¨æ–­å¼€è¿æ¥æ—¶ï¼ŒåŒæ–¹å¯èƒ½è¿˜æœ‰æœªå‘é€çš„æ•°æ®åŒ…ã€‚å¦‚æœåªè¿›è¡Œä¸‰æ¬¡æŒ¥æ‰‹ï¼Œé‚£ä¹ˆåœ¨æœ€åä¸€æ¬¡æŒ¥æ‰‹æ—¶ï¼Œå¯¹æ–¹å¯èƒ½æ— æ³•å¾—çŸ¥è‡ªå·±å‘é€çš„FINæ¶ˆæ¯ä¹‹å‰æ˜¯å¦è¿˜æœ‰æœªå‘é€å®Œçš„æ•°æ®ã€‚é€šè¿‡è¿›è¡Œå››æ¬¡æŒ¥æ‰‹ï¼Œå¯ä»¥ç»™åŒæ–¹è¶³å¤Ÿçš„æ—¶é—´æ¥å‘é€å’Œæ¥æ”¶å‰©ä½™çš„æ•°æ®ï¼Œç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§å’Œæ­£ç¡®æ€§ã€‚</p>
<h3 id="å¤„ç†åŠå…³é—­çŠ¶æ€"><a href="#å¤„ç†åŠå…³é—­çŠ¶æ€" class="headerlink" title="å¤„ç†åŠå…³é—­çŠ¶æ€"></a>å¤„ç†åŠå…³é—­çŠ¶æ€</h3><p>åœ¨TCPè¿æ¥çš„æ–­å¼€è¿‡ç¨‹ä¸­ï¼Œä¸€æ–¹å…ˆå‘é€FINæ¶ˆæ¯è¿›å…¥åŠå…³é—­çŠ¶æ€ï¼Œè¡¨ç¤ºè‡ªå·±ä¸å†å‘é€æ•°æ®ä½†ä»ç„¶å¯ä»¥æ¥æ”¶æ•°æ®ã€‚å¦‚æœåªè¿›è¡Œä¸‰æ¬¡æŒ¥æ‰‹ï¼Œé‚£ä¹ˆå¯¹æ–¹åœ¨æ¥æ”¶åˆ°FINæ¶ˆæ¯åä¼šç«‹å³å…³é—­è¿æ¥ï¼Œè¿™æ ·å°±æ— æ³•ä¿è¯å¦ä¸€æ–¹èƒ½å¤Ÿæ­£ç¡®åœ°å¤„ç†åŠå…³é—­çŠ¶æ€ã€‚é€šè¿‡è¿›è¡Œå››æ¬¡æŒ¥æ‰‹ï¼Œå¯ä»¥ç¡®ä¿åŒæ–¹éƒ½èƒ½å¤Ÿæ­£ç¡®åœ°å¤„ç†åŠå…³é—­çŠ¶æ€ï¼Œé¿å…æ•°æ®çš„ä¸¢å¤±å’Œæ··ä¹±ã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>é€šè¿‡ä»¥ä¸Šåˆ†æï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºç»“è®ºï¼šTCPæ–­å¼€è¿æ¥éœ€è¦è¿›è¡Œå››æ¬¡æŒ¥æ‰‹æ˜¯ä¸ºäº†ç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§ã€å¤„ç†ç½‘ç»œå»¶è¿Ÿå’Œä¸¢åŒ…ã€ç­‰å¾…æœªå‘é€çš„æ•°æ®å‘é€å®Œæ¯•ä»¥åŠå¤„ç†åŠå…³é—­çŠ¶æ€ã€‚é€šè¿‡å››æ¬¡æŒ¥æ‰‹ï¼ŒåŒæ–¹èƒ½å¤Ÿæ›´å¥½åœ°åè°ƒå’Œå¤„ç†è¿æ¥çš„æ–­å¼€ï¼Œç¡®ä¿æ•°æ®çš„æ­£ç¡®ä¼ è¾“å’Œè¿æ¥çš„å®‰å…¨å…³é—­ã€‚</p>
<p>åœ¨è®¨è®ºTCPæ–­å¼€è¿æ¥æ—¶ï¼Œæˆ‘ä»¬ä¸åº”è¯¥æ‰§ç€äºä¸ºä»€ä¹ˆä½¿ç”¨å››æ¬¡æŒ¥æ‰‹ï¼Œè€Œæ˜¯åº”è¯¥ç†è§£ä¸ºä»€ä¹ˆéœ€è¦è¿›è¡Œå¤šæ¬¡æŒ¥æ‰‹æ¥ä¿è¯æ•°æ®çš„å®Œæ•´æ€§å’Œè¿æ¥çš„æ­£ç¡®å…³é—­ã€‚é€šè¿‡å¯¹TCPåè®®è®¾è®¡çš„æ·±å…¥ç†è§£ï¼Œæˆ‘ä»¬èƒ½å¤Ÿæ›´å¥½åœ°åº”ç”¨å’Œç†è§£ç½‘ç»œé€šä¿¡çš„åŸç†å’Œæœºåˆ¶ã€‚</p>
<h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><ul>
<li><a href="https://tools.ietf.org/html/rfc793">RFC 793 - Transmission Control Protocol - IETF Tools</a></li>
<li><a href="https://networkengineering.stackexchange.com/questions/24072/why-do-we-need-a-4-way-handshake-to-terminate-a-tcp-connection">Why do we need a 4-way handshake to terminate a TCP connection?</a></li>
<li><a href="https://www.geeksforgeeks.org/why-tcp-connect-termination-need-4-way-handshake">why-tcp-connect-termination-need-4-way-handshake</a></li>
</ul>
]]></content>
      <categories>
        <category>ä¸ºä»€ä¹ˆè¿™ä¹ˆè®¾è®¡</category>
      </categories>
      <tags>
        <tag>tcp</tag>
      </tags>
  </entry>
  <entry>
    <title>åœ¨VPSä¸Šæ­å»ºvaultwarden</title>
    <url>/2023/09/23/%E5%9C%A8VPS%E4%B8%8A%E6%90%AD%E5%BB%BAvaultwarden/</url>
    <content><![CDATA[<h1 id="åœ¨VPSä¸Šæ­å»ºvaultwarden"><a href="#åœ¨VPSä¸Šæ­å»ºvaultwarden" class="headerlink" title="åœ¨VPSä¸Šæ­å»ºvaultwarden"></a>åœ¨VPSä¸Šæ­å»ºvaultwarden</h1><p>ä¹‹å‰ä¸€ç›´åœ¨å¯»æ‰¾ä¸€ä¸ªæ”¯æŒè·¨å¹³å°çš„å¯†ç ç®¡ç†å·¥å…·ï¼Œå…ˆåå°è¯•äº† 1Password å’Œ LastPassï¼Œè¿«äºè´«ç©·ï¼Œåˆ‡æ¢åˆ°äº†å¼€æºçš„Â <a href="https://bitwarden.com/">Bitwarden</a> æ”¯æŒè‡ªæ‰˜ç®¡æœåŠ¡ç«¯,ä½†æ˜¯ <a href="https://bitwarden.com/">Bitwarden</a> å¯¹æ€§èƒ½è¦æ±‚æ¯”è¾ƒé«˜ï¼Œ é€€è€Œæ±‚å…¶æ¬¡ï¼Œç”¨å®ƒçš„å¦ä¸€ä¸ªå®ç°Â <a href="https://github.com/dani-garcia/vaultwarden">Vaultwarden</a>ï¼ˆåŸå Bitwarden_rsï¼‰Â <a href="https://github.com/dani-garcia/vaultwarden">Vaultwarden</a> å®Œç¾å…¼å®¹<a href="https://bitwarden.com/">Bitwarden</a> ï¼Œè¿™æ ·æˆ‘ä»¬å°±åœ¨AWS çš„å…è´¹ä¸»æœºä¸Šå¾—åˆ°äº†ä¸€ä¸ª Â <a href="https://github.com/dani-garcia/vaultwarden">Vaultwarden</a> åšåç«¯ï¼Œ<a href="https://bitwarden.com/">Bitwarden</a>åšå‰ç«¯çš„ å…è´¹å¯†ç æ‰˜ç®¡æœåŠ¡ã€‚<br>æœ¬æ–‡è¯¦ç»†æ•´ç†äº†ä½¿ç”¨vps æ­å»º ç§æœ‰ vaultwardenæœåŠ¡ï¼Œå®ç° bitwardenè‡ªæ‰˜ç®¡çš„æ­¥éª¤ï¼Œè®¾ç½®çš„å†…å®¹æœ‰ï¼š#VPSï¼Œ#åå‘ä»£ç†ï¼Œrclone è‡ªåŠ¨æŒ‚è½½Google Driveç­‰ã€‚</p>
<span id="more"></span>
<h2 id="Vaultwarden-éƒ¨ç½²"><a href="#Vaultwarden-éƒ¨ç½²" class="headerlink" title="Vaultwarden éƒ¨ç½²"></a>Vaultwarden éƒ¨ç½²</h2><p>ä½¿ç”¨docker-compose  éƒ¨ç½²ã€‚</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">vaultwarden:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">vaultwarden/server:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">vaultwarden</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">8080</span><span class="string">:80</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">3012</span><span class="string">:3012</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">ADMIN_TOKEN:</span> <span class="string">V9ZE7sCSfR9hx8Pi3M+GhiBTSG1gag0G</span></span><br><span class="line">      <span class="attr">WEBSOCKET_ENABLED:</span> <span class="string">&quot;true&quot;</span> <span class="comment"># Enable WebSocket notifications.</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/data/vaultwarden/:/data/</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">backup:</span></span><br><span class="line">    <span class="comment">#å¤‡ä»½æœåŠ¡</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">ttionya/vaultwarden-backup:latest</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">CRON:</span> <span class="string">&#x27;0 0 * * * ?&#x27;</span></span><br><span class="line">      <span class="attr">ZIP_ENABLE:</span> <span class="string">&#x27;TRUE&#x27;</span></span><br><span class="line">      <span class="attr">ZIP_PASSWORD:</span> <span class="string">&#x27;123456&#x27;</span></span><br><span class="line">      <span class="attr">ZIP_TYPE:</span> <span class="string">&#x27;zip&#x27;</span></span><br><span class="line">      <span class="attr">BACKUP_FILE_SUFFIX:</span> <span class="string">&#x27;%Y%m%d&#x27;</span></span><br><span class="line">      <span class="attr">ACKUP_KEEP_DAYS:</span> <span class="number">7</span></span><br><span class="line">      <span class="comment">#   PING_URL: &#x27;&#x27;</span></span><br><span class="line">      <span class="attr">MAIL_SMTP_ENABLE:</span> <span class="string">&#x27;TRUE&#x27;</span></span><br><span class="line">      <span class="attr">MAIL_SMTP_VARIABLES:</span> <span class="string">&#x27;  -S smtp-use-starttls \ -S smtp=smtp://smtp.164.com:587 \ -S smtp-auth=login \ -S smtp-auth-user=email-user \ -S smtp-auth-password=your-auth \ -S from=email-from(Vaultwarden_Backup)&#x27;</span></span><br><span class="line">      <span class="attr">MAIL_TO:</span> <span class="string">&#x27;example@gmail.com&#x27;</span></span><br><span class="line">      <span class="attr">MAIL_WHEN_SUCCESS:</span> <span class="string">&#x27;FALSE&#x27;</span></span><br><span class="line">      <span class="attr">MAIL_WHEN_FAILURE:</span> <span class="string">&#x27;TRUE&#x27;</span></span><br><span class="line">      <span class="attr">TIMEZONE:</span> <span class="string">&#x27;Asia/Shanghai&#x27;</span></span><br><span class="line">      <span class="attr">DATA_DIR:</span> <span class="string">&#x27;/data&#x27;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/data/vaultwarden/:/data/</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">vaultwarden-rclone-data:/config/</span></span><br><span class="line">    <span class="comment">#   - /path/to/env:/.env</span></span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">vaultwarden-data:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">vaultwarden-data</span></span><br><span class="line">  <span class="attr">vaultwarden-rclone-data:</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">vaultwarden-rclone-data</span></span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªdocker-compose.yaml æ–‡ä»¶åŒ…å« äº† vaultwarden ï¼Œä»¥åŠvaultwarden-backup ä¸¤éƒ¨åˆ†ã€‚<br>è¿è¡Œè¿™ä¸ªå‰ï¼Œéœ€è¦è®¾ç½®ä¸€ä¸‹ rcloneï¼Œè¿™é‡Œä»¥ rclone è¿æ¥ google driveä¸ºä¾‹ã€‚</p>
<blockquote>
<p>rcloneæ˜¯ä¸€æ¬¾å¼€æºçš„å‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºåœ¨ä¸åŒäº‘å­˜å‚¨æœåŠ¡ä¹‹é—´åŒæ­¥ã€å¤åˆ¶å’Œç®¡ç†æ–‡ä»¶ã€‚å®ƒæ”¯æŒå¤šç§äº‘å­˜å‚¨æä¾›å•†ï¼ŒåŒ…æ‹¬Google Driveã€Dropboxã€Amazon S3ç­‰ï¼Œå…è®¸ç”¨æˆ·é€šè¿‡ç®€å•çš„å‘½ä»¤å®ç°æ–‡ä»¶çš„ä¸Šä¼ ã€ä¸‹è½½å’ŒåŒæ­¥ï¼Œè¿˜æä¾›äº†åŠ å¯†å’Œç¼“å­˜ç­‰åŠŸèƒ½ï¼Œæ˜¯ä¸€ä¸ªå¼ºå¤§çš„äº‘å­˜å‚¨ç®¡ç†å·¥å…·ã€‚</p>
</blockquote>
<p>è¿è¡Œ ä¸‹é¢çš„æŒ‡ä»¤ï¼Œè¿›å…¥é…ç½®é¡µé¢ï¼Œ å‚è€ƒæ–‡ç«  <a href="https://pickstar.today/2022/05/vps%e4%bd%bf%e7%94%a8rclone%e6%8c%82%e8%bd%bdgoogle-drive%e8%af%a6%e7%bb%86%e8%ae%b0%e5%bd%95/">vpsä½¿ç”¨rcloneæŒ‚è½½Google Driveè¯¦ç»†è®°å½•</a>è¿›è¡Œè®¾ç½®ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run --rm -it \</span><br><span class="line">  --mount type=volume,source=vaultwarden-rclone-data,target=/config/ \</span><br><span class="line">  ttionya/vaultwarden-backup:latest \</span><br><span class="line">  rclone config</span><br></pre></td></tr></table></figure>

<p>ç„¶åæŸ¥çœ‹ä¸€ä¸‹é…ç½®çš„å†…å®¹</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run --rm -it \</span><br><span class="line">  --mount type=volume,source=vaultwarden-rclone-data,target=/config/ \</span><br><span class="line">  ttionya/vaultwarden-backup:latest \</span><br><span class="line">  rclone config show</span><br></pre></td></tr></table></figure>

<p><img src="https://images.hxzhouh.com/blog-images/2023/09/3781bb366cac1dcc520970ff606ff536.png" alt="image.png"></p>
<p>è¿™æ ·å°±å¥½äº†ã€‚</p>
<p>å†ç”¨docker-compose å¯åŠ¨vaultwarden ä»¥åŠvaultwarden-backupã€‚</p>
<p><img src="https://images.hxzhouh.com/blog-images/2023/09/c79a80b302ac3bbaff32a97b0798ff81.png" alt="image.png"></p>
<h2 id="cloudflare-åå‘ä»£ç†"><a href="#cloudflare-åå‘ä»£ç†" class="headerlink" title="cloudflare åå‘ä»£ç†"></a>cloudflare åå‘ä»£ç†</h2><p>vaultwarden å¾ˆå¤šåŠŸèƒ½ä¾èµ– https å®ç°ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ç»™vps:8080ç«¯å£å¥—ä¸€ä¸ªåŸŸå + è¯ä¹¦ï¼Œ</p>
<h3 id="è¯ä¹¦"><a href="#è¯ä¹¦" class="headerlink" title="è¯ä¹¦"></a>è¯ä¹¦</h3><p>ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œè¿™é‡Œç›´æ¥ä½¿ç”¨äº† cloudflare ä»£ç†åŸŸåï¼ŒåŒæ—¶å¯ä»¥å‰å¾€ SSL&#x2F;TLS -&gt; æºæœåŠ¡å™¨ä¸‹è½½å…¶ç”Ÿæˆçš„ä¸»æœºè¯ä¹¦ï¼Œç”¨æ¥åŠ å¯† cloudflare ä¸ä¸»æœºé—´çš„é€šè®¯ã€‚</p>
<p>å°†ç§é’¥ä¸å…¬é’¥åˆ†åˆ«ä¿å­˜åœ¨Â <code>/etc/nginx/cert/private.key</code> <code>/etc/nginx/cert/public.pem</code>ã€‚<br>ç„¶åå†VPS nginx é‡Œé¢é…ç½®</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ubuntu@ip-172-31-20-69:~$ cat /etc/nginx/nginx.conf</span><br><span class="line">user www-data;</span><br><span class="line">worker_processes auto;</span><br><span class="line">pid /run/nginx.pid;</span><br><span class="line">include /etc/nginx/modules-enabled/*.conf;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">	worker_connections 768;</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">multi_accept on;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">	sendfile on;</span><br><span class="line">	tcp_nopush on;</span><br><span class="line">	types_hash_max_size 2048;</span><br><span class="line">	include /etc/nginx/mime.types;</span><br><span class="line">	default_type application/octet-stream;</span><br><span class="line">	ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3; # Dropping SSLv3, ref: POODLE</span><br><span class="line">	ssl_prefer_server_ciphers on;</span><br><span class="line">	access_log /var/log/nginx/access.log;</span><br><span class="line">	gzip on;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	include /etc/nginx/conf.d/*.conf;</span><br><span class="line">	include /etc/nginx/sites-enabled/*;</span><br><span class="line">	server &#123;</span><br><span class="line">    		listen 80;</span><br><span class="line">    		server_name vaultwarden.example.com;</span><br><span class="line">		return 301 https://$host$request_uri;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">sslé…ç½®</span></span><br><span class="line"></span><br><span class="line">	server &#123;</span><br><span class="line">		listen 443 ssl default_server;</span><br><span class="line">		server_name vaultwarden.example.com;</span><br><span class="line">		ssl_certificate /etc/nginx/cert/public.pem;</span><br><span class="line">		ssl_certificate_key /etc/nginx/cert/private.key;</span><br><span class="line">		location / &#123;</span><br><span class="line">        		proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">        		proxy_set_header Host $http_host;</span><br><span class="line">        		proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">        		proxy_set_header Range $http_range;</span><br><span class="line">        		proxy_set_header If-Range $http_if_range;</span><br><span class="line">        		proxy_redirect off;</span><br><span class="line">        		proxy_pass http://127.0.0.1:8080;</span><br><span class="line">    		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å®¢æˆ·ç«¯è®¾ç½®"><a href="#å®¢æˆ·ç«¯è®¾ç½®" class="headerlink" title="å®¢æˆ·ç«¯è®¾ç½®"></a>å®¢æˆ·ç«¯è®¾ç½®</h2><p><a href="https://bitwarden.com/">Bitwarden</a> å®¢æˆ·ç«¯æ”¯æŒå…¨å¹³å°ï¼ŒåŒ…æ‹¬æµè§ˆå™¨ã€‚æ‰€ä»¥ å¯ä»¥æŠŠæ‰€æœ‰çš„å¯†ç éƒ½ä¿å­˜åˆ°vaultwarden ä¸­æ¥</p>
<p>å…·ä½“ä½¿ç”¨ ï¼Œè¯·å‚è€ƒ <a href="https://blog.tsinbei.com/archives/731/#4-4%E3%80%81%E4%BD%BF%E7%94%A8"># Vaultwardenï¼šå®‰å…¨ç§å¯†çš„ä¸ªäººå¯†ç ç®¡ç†å™¨</a></p>
<hr>
<p>Enjoy ğŸ˜„</p>
]]></content>
      <categories>
        <category>blog</category>
      </categories>
      <tags>
        <tag>åå‘ä»£ç†</tag>
        <tag>å¯†ç æ‰˜ç®¡</tag>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸ºä»€ä¹ˆTCPè¿æ¥æ—¶éœ€è¦3æ¬¡æ¡æ‰‹</title>
    <url>/2024/02/16/%E4%B8%BA%E4%BB%80%E4%B9%88TCP%E8%BF%9E%E6%8E%A5%E6%97%B6%E9%9C%80%E8%A6%813%E6%AC%A1%E6%8F%A1%E6%89%8B/</url>
    <content><![CDATA[<p>TCP åè®®æ˜¯æˆ‘ä»¬å‡ ä¹æ¯å¤©éƒ½ä¼šæ¥è§¦åˆ°çš„ç½‘ç»œåè®®ï¼Œç»å¤§å¤šæ•°ç½‘ç»œè¿æ¥çš„å»ºç«‹éƒ½æ˜¯åŸºäº TCP åè®®çš„ï¼Œå­¦è¿‡è®¡ç®—æœºç½‘ç»œæˆ–è€…å¯¹ TCP åè®®ç¨æœ‰äº†è§£çš„äººéƒ½çŸ¥é“ â€”â€” ä½¿ç”¨ TCP åè®®å»ºç«‹è¿æ¥éœ€è¦ç»è¿‡ä¸‰æ¬¡æ¡æ‰‹ï¼ˆthree-way handshakeï¼‰ã€‚</p>
<p>å¦‚æœè®©æˆ‘ä»¬ç®€å•è¯´è¯´ TCP å»ºç«‹è¿æ¥çš„è¿‡ç¨‹ï¼Œç›¸ä¿¡å¾ˆå¤šå‡†å¤‡è¿‡é¢è¯•çš„äººéƒ½ä¼šéå¸¸äº†è§£ï¼Œä½†æ˜¯ä¸€æ—¦æƒ³è¦æ·±ç©¶ã€ä¸ºä»€ä¹ˆ TCP å»ºç«‹è¿æ¥éœ€è¦ä¸‰æ¬¡æ¡æ‰‹ï¼Ÿã€ï¼Œä½œè€…ç›¸ä¿¡å¤§å¤šæ•°äººéƒ½æ²¡æœ‰åŠæ³•å›ç­”è¿™ä¸ªé—®é¢˜æˆ–è€…ä¼šç»™å‡ºé”™è¯¯çš„ç­”æ¡ˆï¼Œè¿™è¾¹æ–‡ç« å°±ä¼šè®¨è®ºç©¶ç«Ÿä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦ä¸‰æ¬¡æ¡æ‰‹æ‰èƒ½å»ºç«‹ TCP è¿æ¥ï¼Ÿè€Œä¸æ˜¯å››æ¬¡ã€æˆ–è€…ä¸¤æ¬¡ï¼Ÿ</p>
<span id="more"></span>
<h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>åœ¨å…·ä½“åˆ†æä»Šå¤©çš„é—®é¢˜ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆå¯ä»¥äº†è§£ä¸€ä¸‹æœ€å¸¸è§çš„é”™è¯¯ç±»æ¯”ï¼Œè¿™ä¸ªå¯¹ TCP è¿æ¥è¿‡ç¨‹çš„é”™è¯¯æ¯”å–»è¯¯å¯¼äº†å¾ˆå¤šäººï¼Œä½œè€…åœ¨æ¯”è¾ƒé•¿çš„ä¸€æ®µæ—¶é—´å†…ä¹Ÿè®¤ä¸ºå®ƒèƒ½å¤Ÿå¾ˆå¥½åœ°æè¿° TCP å»ºç«‹è¿æ¥ä¸ºä»€ä¹ˆéœ€è¦ä¸‰æ¬¡æ¡æ‰‹ï¼š</p>
<ol>
<li>ä½ å¬å¾—åˆ°å—ï¼Ÿ</li>
<li>æˆ‘èƒ½å¬åˆ°ï¼Œä½ å¬å¾—åˆ°ï¼Ÿ</li>
<li>æˆ‘ä¹Ÿèƒ½å¬åˆ°ï¼›<br>è¿™ç§ç”¨ç±»æ¯”æ¥è§£é‡Šé—®é¢˜å¾€å¾€å°±ä¼šé¢ä¸´ã€åä¸ªç±»æ¯”ä¹ä¸ªé”™ã€çš„å°´å°¬å±€é¢ï¼Œå¦‚æœåˆ«äººç”¨ç±»æ¯”å›ç­”ä½ çš„ä¸ºä»€ä¹ˆï¼Œä½ éœ€è¦ä»”ç»†æƒ³ä¸€æƒ³å®ƒçš„ç±»æ¯”é‡Œç©¶ç«Ÿå“ªé‡Œæœ‰æ¼æ´ï¼›ç±»æ¯”å¸¦æ¥çš„è§£é‡Šå¾€å¾€åªèƒ½æœ‰ç‰‡é¢çš„ç›¸ä¼¼æ€§ï¼Œæˆ‘ä»¬æ°¸è¿œä¹Ÿæ— æ³•æ‰¾åˆ°ç»å¯¹æ­£ç¡®çš„ç±»æ¯”ï¼Œå®ƒåªåœ¨æˆ‘ä»¬æƒ³è¦é€šä¿—æ˜“æ‡‚åœ°å±•ç¤ºäº‹ç‰©çš„ç‰¹æ€§æ—¶æ‰èƒ½å‘æŒ¥è¾ƒå¤§çš„ä½œç”¨ï¼Œæˆ‘ä»¬åœ¨æ–‡ç« çš„åé¢ä¼šä»‹ç»ä¸ºä»€ä¹ˆè¿™é‡Œçš„ç±»æ¯”æœ‰é—®é¢˜ï¼Œå„ä½è¯»è€…ä¹Ÿå¯ä»¥å¸¦ç€ç–‘é—®æ¥é˜…è¯»å‰©ä¸‹çš„å†…å®¹ã€‚</li>
</ol>
<p>å¾ˆå¤šäººå°è¯•å›ç­”æˆ–è€…æ€è€ƒè¿™ä¸ªé—®é¢˜çš„æ—¶å€™å…¶å®å…³æ³¨ç‚¹éƒ½æ”¾åœ¨äº†ä¸‰æ¬¡æ¡æ‰‹ä¸­çš„<strong>ä¸‰æ¬¡</strong>ä¸Šé¢ï¼Œè¿™ç¡®å®å¾ˆé‡è¦ï¼Œä½†æ˜¯å¦‚æœé‡æ–°å®¡è§†è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯¹äºã€ä»€ä¹ˆæ˜¯è¿æ¥ã€çœŸçš„æ¸…æ¥šï¼Ÿåªæœ‰çŸ¥é“<strong>è¿æ¥çš„å®šä¹‰</strong>ï¼Œæˆ‘ä»¬æ‰èƒ½å»å°è¯•å›ç­”ä¸ºä»€ä¹ˆ TCP å»ºç«‹è¿æ¥éœ€è¦ä¸‰æ¬¡æ¡æ‰‹ã€‚</p>
<blockquote>
<p>The reliability and flow control mechanisms described above require that TCPs initialize and maintain certain status information for each data stream. The combination of this information, including sockets, sequence numbers, and window sizes, is called a connection.</p>
</blockquote>
<p><a href="https://tools.ietf.org/html/rfc793">RFC 793 - Transmission Control Protocol</a>Â æ–‡æ¡£ä¸­éå¸¸æ¸…æ¥šåœ°å®šä¹‰äº† TCP ä¸­çš„è¿æ¥æ˜¯ä»€ä¹ˆï¼Œæˆ‘ä»¬ç®€å•æ€»ç»“ä¸€ä¸‹ï¼š<strong>ç”¨äºä¿è¯å¯é æ€§å’Œæµæ§åˆ¶æœºåˆ¶çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬ Socketã€åºåˆ—å·ä»¥åŠçª—å£å¤§å°å«åšè¿æ¥</strong>ã€‚</p>
<p>æ‰€ä»¥ï¼Œå»ºç«‹ TCP è¿æ¥å°±æ˜¯é€šä¿¡çš„åŒæ–¹éœ€è¦å¯¹ä¸Šè¿°çš„ä¸‰ç§ä¿¡æ¯è¾¾æˆå…±è¯†ï¼Œè¿æ¥ä¸­çš„ä¸€å¯¹ Socket æ˜¯ç”±äº’è”ç½‘åœ°å€æ ‡å¿—ç¬¦å’Œç«¯å£ç»„æˆçš„ï¼Œçª—å£å¤§å°ä¸»è¦ç”¨æ¥åšæµæ§åˆ¶ï¼Œæœ€åçš„åºåˆ—å·æ˜¯ç”¨æ¥è¿½è¸ªé€šä¿¡å‘èµ·æ–¹å‘é€çš„æ•°æ®åŒ…åºå·ï¼Œæ¥æ”¶æ–¹å¯ä»¥é€šè¿‡åºåˆ—å·å‘å‘é€æ–¹ç¡®è®¤æŸä¸ªæ•°æ®åŒ…çš„æˆåŠŸæ¥æ”¶ã€‚</p>
<p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å°†åŸæœ‰çš„é—®é¢˜è½¬æ¢æˆäº†ã€ä¸ºä»€ä¹ˆéœ€è¦é€šè¿‡ä¸‰æ¬¡æ¡æ‰‹æ‰å¯ä»¥åˆå§‹åŒ– Socketsã€çª—å£å¤§å°å’Œåˆå§‹åºåˆ—å·ï¼Ÿã€ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬å°±å¼€å§‹å¯¹è¿™ä¸ªç»†åŒ–çš„é—®é¢˜è¿›è¡Œåˆ†æå¹¶å¯»æ‰¾è§£é‡Šã€‚</p>
<h2 id="è®¾è®¡"><a href="#è®¾è®¡" class="headerlink" title="è®¾è®¡"></a>è®¾è®¡</h2><p>è¿™ç¯‡æ–‡ç« ä¸»è¦ä¼šä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ä»‹ç»ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦é€šè¿‡ä¸‰æ¬¡æ¡æ‰‹æ‰å¯ä»¥åˆå§‹åŒ– Socketsã€çª—å£å¤§å°ã€åˆå§‹åºåˆ—å·å¹¶å»ºç«‹ TCP è¿æ¥ï¼š</p>
<ul>
<li>é€šè¿‡ä¸‰æ¬¡æ¡æ‰‹æ‰èƒ½é˜»æ­¢é‡å¤å†å²è¿æ¥çš„åˆå§‹åŒ–ï¼›</li>
<li>é€šè¿‡ä¸‰æ¬¡æ¡æ‰‹æ‰èƒ½å¯¹é€šä¿¡åŒæ–¹çš„åˆå§‹åºåˆ—å·è¿›è¡Œåˆå§‹åŒ–ï¼›</li>
<li>è®¨è®ºå…¶ä»–æ¬¡æ•°æ¡æ‰‹å»ºç«‹è¿æ¥çš„å¯èƒ½æ€§ï¼›<br>è¿™å‡ ä¸ªè®ºç‚¹ä¸­çš„ç¬¬ä¸€ä¸ªæ˜¯ TCP é€‰æ‹©ä½¿ç”¨ä¸‰æ¬¡æ¡æ‰‹çš„æœ€ä¸»è¦åŸå› ï¼Œå…¶ä»–çš„å‡ ä¸ªåŸå› ç›¸æ¯”ä¹‹ä¸‹éƒ½æ˜¯æ¬¡è¦çš„åŸå› ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œå¯¹å®ƒä»¬çš„è®¨è®ºåªæ˜¯ä¸ºäº†è®©æ•´ä¸ªè§†è§’æ›´åŠ ä¸°å¯Œï¼Œé€šè¿‡å¤šæ–¹é¢ç†è§£è¿™ä¸€æœ‰è¶£çš„è®¾è®¡å†³ç­–ã€‚</li>
</ul>
<h3 id="å†å²è¿æ¥"><a href="#å†å²è¿æ¥" class="headerlink" title="å†å²è¿æ¥"></a>å†å²è¿æ¥</h3><p><a href="https://tools.ietf.org/html/rfc793">RFC 793 - Transmission Control Protocol</a>Â å…¶å®å°±æŒ‡å‡ºäº† TCP è¿æ¥ä½¿ç”¨ä¸‰æ¬¡æ¡æ‰‹çš„é¦–è¦åŸå›  â€”â€” ä¸ºäº†é˜»æ­¢å†å²çš„é‡å¤è¿æ¥åˆå§‹åŒ–é€ æˆçš„æ··ä¹±é—®é¢˜ï¼Œé˜²æ­¢ä½¿ç”¨ TCP åè®®é€šä¿¡çš„åŒæ–¹å»ºç«‹äº†é”™è¯¯çš„è¿æ¥ã€‚</p>
<blockquote>
<p>The principle reason for the three-way handshake is to prevent old duplicate connection initiations from causing confusion.</p>
</blockquote>
<p><img src="https://images.hxzhouh.com/blog-images/2024/02/25f77d0eeb97056245cda65f64a9883b.png" alt="Pasted image 20240130105811"></p>
<p>æƒ³è±¡ä¸€ä¸‹è¿™ä¸ªåœºæ™¯ï¼Œå¦‚æœé€šä¿¡åŒæ–¹çš„é€šä¿¡æ¬¡æ•°åªæœ‰ä¸¤æ¬¡ï¼Œé‚£ä¹ˆå‘é€æ–¹ä¸€æ—¦å‘å‡ºå»ºç«‹è¿æ¥çš„è¯·æ±‚ä¹‹åå®ƒå°±æ²¡æœ‰åŠæ³•æ’¤å›è¿™ä¸€æ¬¡è¯·æ±‚ï¼Œå¦‚æœåœ¨ç½‘ç»œçŠ¶å†µå¤æ‚æˆ–è€…è¾ƒå·®çš„ç½‘ç»œä¸­ï¼Œå‘é€æ–¹è¿ç»­å‘é€å¤šæ¬¡å»ºç«‹è¿æ¥çš„è¯·æ±‚ï¼Œå¦‚æœ TCP å»ºç«‹è¿æ¥åªèƒ½é€šä¿¡ä¸¤æ¬¡ï¼Œé‚£ä¹ˆæ¥æ”¶æ–¹åªèƒ½é€‰æ‹©æ¥å—æˆ–è€…æ‹’ç»å‘é€æ–¹å‘èµ·çš„è¯·æ±‚ï¼Œå®ƒå¹¶ä¸æ¸…æ¥šè¿™ä¸€æ¬¡è¯·æ±‚æ˜¯ä¸æ˜¯ç”±äºç½‘ç»œæ‹¥å µè€Œæ—©æ—©è¿‡æœŸçš„è¿æ¥ã€‚</p>
<p>æ‰€ä»¥ï¼ŒTCP é€‰æ‹©ä½¿ç”¨ä¸‰æ¬¡æ¡æ‰‹æ¥å»ºç«‹è¿æ¥å¹¶åœ¨è¿æ¥å¼•å…¥äº†Â <code>RST</code>Â è¿™ä¸€æ§åˆ¶æ¶ˆæ¯ï¼Œæ¥æ”¶æ–¹å½“æ”¶åˆ°è¯·æ±‚æ—¶ä¼šå°†å‘é€æ–¹å‘æ¥çš„Â <code>SEQ+1</code>Â å‘é€ç»™å¯¹æ–¹ï¼Œè¿™æ—¶ç”±å‘é€æ–¹æ¥åˆ¤æ–­å½“å‰è¿æ¥æ˜¯å¦æ˜¯å†å²è¿æ¥ï¼š</p>
<ul>
<li>å¦‚æœå½“å‰è¿æ¥æ˜¯å†å²è¿æ¥ï¼Œå³Â <code>SEQ</code>Â è¿‡æœŸæˆ–è€…è¶…æ—¶ï¼Œé‚£ä¹ˆå‘é€æ–¹å°±ä¼šç›´æ¥å‘é€Â <code>RST</code>Â æ§åˆ¶æ¶ˆæ¯ä¸­æ­¢è¿™ä¸€æ¬¡è¿æ¥ï¼›</li>
<li>å¦‚æœå½“å‰è¿æ¥ä¸æ˜¯å†å²è¿æ¥ï¼Œé‚£ä¹ˆå‘é€æ–¹å°±ä¼šå‘é€Â <code>ACK</code>Â æ§åˆ¶æ¶ˆæ¯ï¼Œé€šä¿¡åŒæ–¹å°±ä¼šæˆåŠŸå»ºç«‹è¿æ¥ï¼›</li>
</ul>
<p>ä½¿ç”¨ä¸‰æ¬¡æ¡æ‰‹å’ŒÂ <code>RST</code>Â æ§åˆ¶æ¶ˆæ¯å°†æ˜¯å¦å»ºç«‹è¿æ¥çš„æœ€ç»ˆæ§åˆ¶æƒäº¤ç»™äº†å‘é€æ–¹ï¼Œå› ä¸ºåªæœ‰å‘é€æ–¹æœ‰è¶³å¤Ÿçš„ä¸Šä¸‹æ–‡æ¥åˆ¤æ–­å½“å‰è¿æ¥æ˜¯å¦æ˜¯é”™è¯¯çš„æˆ–è€…è¿‡æœŸçš„ï¼Œè¿™ä¹Ÿæ˜¯ TCP ä½¿ç”¨ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥çš„æœ€ä¸»è¦åŸå› ã€‚</p>
<h3 id="åˆå§‹åºåˆ—å·"><a href="#åˆå§‹åºåˆ—å·" class="headerlink" title="åˆå§‹åºåˆ—å·"></a>åˆå§‹åºåˆ—å·</h3><p>å¦ä¸€ä¸ªä½¿ç”¨ä¸‰æ¬¡æ¡æ‰‹çš„é‡è¦çš„åŸå› å°±æ˜¯é€šä¿¡åŒæ–¹éƒ½éœ€è¦è·å¾—ä¸€ä¸ªç”¨äºå‘é€ä¿¡æ¯çš„åˆå§‹åŒ–åºåˆ—å·ï¼Œä½œä¸ºä¸€ä¸ªå¯é çš„ä¼ è¾“å±‚åè®®ï¼ŒTCP éœ€è¦åœ¨ä¸ç¨³å®šçš„ç½‘ç»œç¯å¢ƒä¸­æ„å»ºä¸€ä¸ªå¯é çš„ä¼ è¾“å±‚ï¼Œç½‘ç»œçš„ä¸ç¡®å®šæ€§å¯èƒ½ä¼šå¯¼è‡´æ•°æ®åŒ…çš„ç¼ºå¤±å’Œé¡ºåºé¢ å€’ç­‰é—®é¢˜ï¼Œå¸¸è§çš„é—®é¢˜å¯èƒ½åŒ…æ‹¬ï¼š</p>
<ul>
<li>æ•°æ®åŒ…è¢«å‘é€æ–¹å¤šæ¬¡å‘é€é€ æˆæ•°æ®çš„é‡å¤ï¼›</li>
<li>æ•°æ®åŒ…åœ¨ä¼ è¾“çš„è¿‡ç¨‹ä¸­è¢«è·¯ç”±æˆ–è€…å…¶ä»–èŠ‚ç‚¹ä¸¢å¤±ï¼›</li>
<li>æ•°æ®åŒ…åˆ°è¾¾æ¥æ”¶æ–¹å¯èƒ½æ— æ³•æŒ‰ç…§å‘é€é¡ºåºï¼›</li>
</ul>
<p>ä¸ºäº†è§£å†³ä¸Šè¿°è¿™äº›å¯èƒ½å­˜åœ¨çš„é—®é¢˜ï¼ŒTCP åè®®è¦æ±‚å‘é€æ–¹åœ¨æ•°æ®åŒ…ä¸­åŠ å…¥ã€åºåˆ—å·ã€å­—æ®µï¼Œæœ‰äº†æ•°æ®åŒ…å¯¹åº”çš„åºåˆ—å·ï¼Œæˆ‘ä»¬å°±å¯ä»¥ï¼š</p>
<ul>
<li>æ¥æ”¶æ–¹å¯ä»¥é€šè¿‡åºåˆ—å·å¯¹é‡å¤çš„æ•°æ®åŒ…è¿›è¡Œå»é‡ï¼›</li>
<li>å‘é€æ–¹ä¼šåœ¨å¯¹åº”æ•°æ®åŒ…æœªè¢« ACK æ—¶è¿›è¡Œé‡å¤å‘é€ï¼›</li>
<li>æ¥æ”¶æ–¹å¯ä»¥æ ¹æ®æ•°æ®åŒ…çš„åºåˆ—å·å¯¹å®ƒä»¬è¿›è¡Œé‡æ–°æ’åºï¼›</li>
</ul>
<p>åºåˆ—å·åœ¨ TCP è¿æ¥ä¸­æœ‰ç€éå¸¸é‡è¦çš„ä½œç”¨ï¼Œåˆå§‹åºåˆ—å·ä½œä¸º TCP è¿æ¥çš„ä¸€éƒ¨åˆ†ä¹Ÿéœ€è¦åœ¨ä¸‰æ¬¡æ¡æ‰‹æœŸé—´è¿›è¡Œåˆå§‹åŒ–ï¼Œç”±äº TCP è¿æ¥é€šä¿¡çš„åŒæ–¹éƒ½éœ€è¦è·å¾—åˆå§‹åºåˆ—å·ï¼Œæ‰€ä»¥å®ƒä»¬å…¶å®éœ€è¦å‘å¯¹æ–¹å‘é€Â <code>SYN</code>Â æ§åˆ¶æ¶ˆæ¯å¹¶æºå¸¦è‡ªå·±æœŸæœ›çš„åˆå§‹åŒ–åºåˆ—å·Â <code>SEQ</code>ï¼Œå¯¹æ–¹åœ¨æ”¶åˆ°Â <code>SYN</code>Â æ¶ˆæ¯ä¹‹åä¼šé€šè¿‡Â <code>ACK</code>Â æ§åˆ¶æ¶ˆæ¯ä»¥åŠÂ <code>SEQ+1</code>Â æ¥è¿›è¡Œç¡®è®¤ã€‚</p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œé€šä¿¡åŒæ–¹çš„ä¸¤ä¸ªÂ <code>TCP A/B</code>Â åˆ†åˆ«å‘å¯¹æ–¹å‘é€Â <code>SYN</code>Â å’ŒÂ <code>ACK</code>Â æ§åˆ¶æ¶ˆæ¯ï¼Œç­‰å¾…é€šä¿¡åŒæ–¹éƒ½è·å–åˆ°äº†è‡ªå·±æœŸæœ›çš„åˆå§‹åŒ–åºåˆ—å·ä¹‹åå°±å¯ä»¥å¼€å§‹é€šä¿¡äº†ï¼Œç”±äº TCP æ¶ˆæ¯å¤´çš„è®¾è®¡ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸­é—´çš„ä¸¤æ¬¡é€šä¿¡åˆæˆä¸€ä¸ªï¼Œ<code>TCP B</code>Â å¯ä»¥å‘Â <code>TCP A</code>Â åŒæ—¶å‘é€Â <code>ACK</code>Â å’ŒÂ <code>SYN</code>Â æ§åˆ¶æ¶ˆæ¯ï¼Œè¿™ä¹Ÿå°±å¸®åŠ©æˆ‘ä»¬å°†å››æ¬¡é€šä¿¡å‡å°‘è‡³ä¸‰æ¬¡ã€‚</p>
<blockquote>
<p>A three way handshake is necessary because sequence numbers are not tied to a global clock in the network, and TCPs may have different mechanisms for picking the ISNâ€™s. The receiver of the first SYN has no way of knowing whether the segment was an old delayed one or not, unless it remembers the last sequence number used on the connection (which is not always possible), and so it must ask the sender to verify this SYN. The three way handshake and the advantages of a clock-driven scheme are discussed in [3].</p>
</blockquote>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œç½‘ç»œä½œä¸ºä¸€ä¸ªåˆ†å¸ƒå¼çš„ç³»ç»Ÿï¼Œå…¶ä¸­å¹¶ä¸å­˜åœ¨ä¸€ä¸ªç”¨äºè®¡æ•°çš„å…¨å±€æ—¶é’Ÿï¼Œè€Œ TCP å¯ä»¥é€šè¿‡ä¸åŒçš„æœºåˆ¶æ¥åˆå§‹åŒ–åºåˆ—å·ï¼Œä½œä¸º TCP è¿æ¥çš„æ¥æ”¶æ–¹æˆ‘ä»¬æ— æ³•åˆ¤æ–­å¯¹æ–¹ä¼ æ¥çš„åˆå§‹åŒ–åºåˆ—å·æ˜¯å¦è¿‡æœŸï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦äº¤ç”±å¯¹æ–¹æ¥åˆ¤æ–­ï¼ŒTCP è¿æ¥çš„å‘èµ·æ–¹å¯ä»¥é€šè¿‡ä¿å­˜å‘å‡ºçš„åºåˆ—å·åˆ¤æ–­è¿æ¥æ˜¯å¦è¿‡æœŸï¼Œå¦‚æœè®©æ¥æ”¶æ–¹æ¥ä¿å­˜å¹¶åˆ¤æ–­åºåˆ—å·å´æ˜¯ä¸ç°å®çš„ï¼Œè¿™ä¹Ÿå†ä¸€æ¬¡å¼ºåŒ–äº†æˆ‘ä»¬åœ¨ä¸Šä¸€èŠ‚ä¸­æå‡ºçš„è§‚ç‚¹ â€”â€” é¿å…å†å²é”™è¿æ¥çš„åˆå§‹åŒ–ã€‚</p>
<h3 id="é€šä¿¡æ¬¡æ•°"><a href="#é€šä¿¡æ¬¡æ•°" class="headerlink" title="é€šä¿¡æ¬¡æ•°"></a>é€šä¿¡æ¬¡æ•°</h3><p>å½“æˆ‘ä»¬è®¨è®º TCP å»ºç«‹è¿æ¥éœ€è¦çš„é€šä¿¡æ¬¡æ•°æ—¶ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šæ‰§ç€äºä¸ºä»€ä¹ˆé€šä¿¡ä¸‰æ¬¡æ‰å¯ä»¥å»ºç«‹è¿æ¥ï¼Œè€Œä¸æ˜¯ä¸¤æ¬¡æˆ–è€…å››æ¬¡ï¼›è®¨è®ºä½¿ç”¨æ›´å¤šçš„é€šä¿¡æ¬¡æ•°æ¥å»ºç«‹è¿æ¥å¾€å¾€æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œå› ä¸ºæˆ‘ä»¬æ€»å¯ä»¥<strong>ä½¿ç”¨æ›´å¤šçš„é€šä¿¡æ¬¡æ•°äº¤æ¢ç›¸åŒçš„ä¿¡æ¯</strong>ï¼Œæ‰€ä»¥ä½¿ç”¨å››æ¬¡ã€äº”æ¬¡æˆ–è€…æ›´å¤šæ¬¡æ•°å»ºç«‹è¿æ¥åœ¨æŠ€æœ¯ä¸Šéƒ½æ˜¯å®Œå…¨å¯ä»¥å®ç°çš„ã€‚<br>è¿™ç§å¢åŠ  TCP è¿æ¥é€šä¿¡æ¬¡æ•°çš„é—®é¢˜å¾€å¾€æ²¡æœ‰è®¨è®ºçš„å¿…è¦æ€§ï¼Œæˆ‘ä»¬è¿½æ±‚çš„å…¶å®æ˜¯ç”¨æ›´å°‘çš„é€šä¿¡æ¬¡æ•°ï¼ˆç†è®ºä¸Šçš„è¾¹ç•Œï¼‰å®Œæˆä¿¡æ¯çš„äº¤æ¢ï¼Œä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨ä¸Šä¸¤èŠ‚ä¸­ä¹Ÿä¸€å†å¼ºè°ƒä½¿ç”¨ã€ä¸¤æ¬¡æ¡æ‰‹ã€æ²¡æœ‰åŠæ³•å»ºç«‹ TCP è¿æ¥ï¼Œä½¿ç”¨ä¸‰æ¬¡æ¡æ‰‹æ˜¯å»ºç«‹è¿æ¥æ‰€éœ€è¦çš„æœ€å°æ¬¡æ•°ã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æˆ‘ä»¬åœ¨è¿™ç¯‡æ–‡ç« ä¸­è®¨è®ºäº†ä¸ºä»€ä¹ˆ TCP å»ºç«‹è¿æ¥éœ€è¦ç»è¿‡ä¸‰æ¬¡æ¡æ‰‹ï¼Œåœ¨å…·ä½“åˆ†æè¿™ä¸ªé—®é¢˜ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆé‡æ–°æ€è€ƒäº† TCP è¿æ¥ç©¶ç«Ÿæ˜¯ä»€ä¹ˆï¼Œ<a href="https://tools.ietf.org/html/rfc793">RFC 793 - Transmission Control Protocol - IETF Tools</a>Â å¯¹ TCP è¿æ¥æœ‰ç€éå¸¸æ¸…æ¥šçš„å®šä¹‰ â€”â€” ç”¨äºä¿è¯å¯é æ€§å’Œæµæ§åˆ¶æœºåˆ¶çš„æ•°æ®ï¼ŒåŒ…æ‹¬ Socketã€åºåˆ—å·ä»¥åŠçª—å£å¤§å°ã€‚</p>
<p>TCP å»ºç«‹è¿æ¥æ—¶é€šè¿‡ä¸‰æ¬¡æ¡æ‰‹å¯ä»¥æœ‰æ•ˆåœ°é¿å…å†å²é”™è¯¯è¿æ¥çš„å»ºç«‹ï¼Œå‡å°‘é€šä¿¡åŒæ–¹ä¸å¿…è¦çš„èµ„æºæ¶ˆè€—ï¼Œä¸‰æ¬¡æ¡æ‰‹èƒ½å¤Ÿå¸®åŠ©é€šä¿¡åŒæ–¹è·å–åˆå§‹åŒ–åºåˆ—å·ï¼Œå®ƒä»¬èƒ½å¤Ÿä¿è¯æ•°æ®åŒ…ä¼ è¾“çš„ä¸é‡ä¸ä¸¢ï¼Œè¿˜èƒ½ä¿è¯å®ƒä»¬çš„ä¼ è¾“é¡ºåºï¼Œä¸ä¼šå› ä¸ºç½‘ç»œä¼ è¾“çš„é—®é¢˜å‘ç”Ÿæ··ä¹±ï¼Œåˆ°è¿™é‡Œä¸ä½¿ç”¨ã€ä¸¤æ¬¡æ¡æ‰‹ã€å’Œã€å››æ¬¡æ¡æ‰‹ã€çš„åŸå› å·²ç»éå¸¸æ¸…æ¥šäº†ï¼š</p>
<ul>
<li>ã€ä¸¤æ¬¡æ¡æ‰‹ã€ï¼šæ— æ³•é¿å…å†å²é”™è¯¯è¿æ¥çš„åˆå§‹åŒ–ï¼Œæµªè´¹æ¥æ”¶æ–¹çš„èµ„æºï¼›</li>
<li>ã€å››æ¬¡æ¡æ‰‹ã€ï¼šTCP åè®®çš„è®¾è®¡å¯ä»¥è®©æˆ‘ä»¬åŒæ—¶ä¼ é€’Â <code>ACK</code>Â å’ŒÂ <code>SYN</code>Â ä¸¤ä¸ªæ§åˆ¶ä¿¡æ¯ï¼Œå‡å°‘äº†é€šä¿¡æ¬¡æ•°ï¼Œæ‰€ä»¥ä¸éœ€è¦ä½¿ç”¨æ›´å¤šçš„é€šä¿¡æ¬¡æ•°ä¼ è¾“ç›¸åŒçš„ä¿¡æ¯ï¼›</li>
</ul>
<p>æˆ‘ä»¬é‡æ–°å›åˆ°åœ¨æ–‡ç« å¼€å¤´æçš„é—®é¢˜ï¼Œä¸ºä»€ä¹ˆä½¿ç”¨ç±»æ¯”è§£é‡Š TCP ä½¿ç”¨ä¸‰æ¬¡æ¡æ‰‹æ˜¯é”™è¯¯çš„ï¼Ÿè¿™ä¸»è¦è¿˜æ˜¯å› ä¸ºï¼Œè¿™ä¸ªç±»æ¯”æ²¡æœ‰è§£é‡Šæ¸…æ¥šæ ¸å¿ƒé—®é¢˜ â€”â€” é¿å…å†å²ä¸Šçš„é‡å¤è¿æ¥ã€‚</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a href="https://tools.ietf.org/html/rfc793">RFC 793 - Transmission Control Protocol - IETF Tools</a></li>
<li><a href="https://networkengineering.stackexchange.com/questions/24068/why-do-we-need-a-3-way-handshake-why-not-just-2-way">Why do we need a 3-way handshake? Why not just 2-way?</a></li>
<li><a href="https://www.geeksforgeeks.org/tcp-3-way-handshake-process/"># TCP 3-Way Handshake Process</a></li>
</ul>
]]></content>
      <categories>
        <category>blog</category>
      </categories>
      <tags>
        <tag>tcp</tag>
      </tags>
  </entry>
  <entry>
    <title>ä»€ä¹ˆæ˜¯medium çš„ publication</title>
    <url>/2024/03/12/%E4%BB%80%E4%B9%88%E6%98%AFmedium%20%E7%9A%84%20publication/</url>
    <content><![CDATA[<blockquote>
<p>This article is first published in the medium MPP plan. If you are a medium user, please follow me in <a href="https://medium.hxzhouh.com/">medium</a>. Thank you very much.</p>
</blockquote>
<p>publicationå³å‡ºç‰ˆç‰©ï¼Œä½ å¯ä»¥æŠŠä»–ç†è§£æˆä¸€æœ¬æ‚å¿—ï¼Œä½†æ˜¯å¯ä»¥éšæ—¶å‘å¸ƒï¼Œéšæ—¶ä¿®æ”¹ã€‚<br>æ¯ä¸ª publicationéƒ½æœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ªç¼–è¾‘ï¼Œè¿™ä¸ªç¼–è¾‘è´Ÿè´£å®¡æ ¸ä½ çš„æ–‡ç« ï¼Œå‘è¡¨ã€‚æ€»ä½“æµç¨‹ å¤§æ¦‚å°±è¿™æ ·å­ã€‚</p>
<span id="more"></span>

<p><img src="https://images.hxzhouh.com/blog-images/2024/03/496a388d05f3aa5966560a4840832948.png" alt="Pasted image 20240312155507"><br>å…·ä½“çš„ç»†èŠ‚å¯ä»¥çœ‹å®˜ç½‘çš„è¯´æ˜ï¼š<br><a href="https://help.medium.com/hc/en-us/articles/115004681607-Getting-started-with-a-Medium-publication">https://help.medium.com/hc/en-us/articles/115004681607-Getting-started-with-a-Medium-publication</a></p>
<h1 id="æœ‰é‚£äº›publication"><a href="#æœ‰é‚£äº›publication" class="headerlink" title="æœ‰é‚£äº›publication"></a>æœ‰é‚£äº›publication</h1><p>å®˜ç½‘å¥½åƒæ²¡æœ‰å…·ä½“çš„publication æ’åï¼Œä½†æ˜¯æœ‰ä¸€äº› ç¬¬ä¸‰æ–¹ç½‘ç«™ ä¼šè¿½è¸ªè¿™äº›ã€‚<br>æ¯”å¦‚ä¸‹é¢è¿™äº›é“¾æ¥ </p>
<ul>
<li><a href="https://nickwolny.com/medium-publications/">https://nickwolny.com/medium-publications/</a></li>
<li><a href="https://medium.com/new-writers-welcome/the-big-list-of-medium-publications-2023-8f9860f74d54">https://medium.com/new-writers-welcome/the-big-list-of-medium-publications-2023-8f9860f74d54</a></li>
<li><a href="https://medium.com/@MediumStaff/list/mediums-huge-list-of-publications-accepting-submissions-7c0ec8037e61">https://medium.com/@MediumStaff/list/mediums-huge-list-of-publications-accepting-submissions-7c0ec8037e61</a><br>ä½ å¯ä»¥ä»ä¸Šé¢æ‰¾ä¸€äº›æµé‡æ¯”è¾ƒå¤§çš„ publication é‡ç‚¹å…³æ³¨ä¸€ä¸‹ã€‚</li>
</ul>
<h1 id="å¦‚ä½•æˆä¸ºä½œè€…"><a href="#å¦‚ä½•æˆä¸ºä½œè€…" class="headerlink" title="å¦‚ä½•æˆä¸ºä½œè€…"></a>å¦‚ä½•æˆä¸ºä½œè€…</h1><p>ä»¥ Level Up Coding ä¸ºä¾‹å­<br>ä¸æ˜¯æ¯ä¸ªpublicationéƒ½å…¬å¼€æ‹›å‹Ÿä½œè€…çš„ï¼Œä½†æ˜¯å¦‚æœä»–ä»¬æ‹›å‹Ÿä½œè€…ï¼Œå°±ä¼šå†publicationçš„å®˜ç½‘æ˜¾ç¤ºå‡ºæ¥ã€‚æ¯”å¦‚<a href="https://levelup.gitconnected.com/">Level Up Coding</a>è¿™ä¸ª<br><img src="https://images.hxzhouh.com/blog-images/2024/03/ee87da8b9690509d48da5472c6aac4f6.png" alt="Pasted image 20240312160108"><br>æ ¹æ®ä»–ä»¬çš„è¦æ±‚ï¼Œå…ˆå†™ä¸€ç¯‡è‰ç¨¿ï¼Œç„¶åæŠŠè‰ç¨¿å‘é‚®ä»¶ç»™ä»–ä»¬çš„ç¼–è¾‘ç­‰å¾…ä»–ä»¬æ·»åŠ ä½ åˆ°è¿™ä¸ª publication çš„ä½œè€…ã€‚<br>è¿™ä¸ªæ—¶é—´ ä¸ç¡®å®šï¼Œæœ‰çš„å¾ˆå¿«ï¼Œæœ‰çš„å¾ˆæ…¢ ï¼ˆè€å¤–å¢¨è¿¹ï¼‰Level Up Coding æˆ‘å½“åˆå¤§æ¦‚æ˜¯ä¸‰å¤©ï¼Œä½†æ˜¯ <a href="https://docs.google.com/forms/d/e/1FAIpQLSd-uul5nrYehQxmUY6MTdxu8Fj6t1vSaUgG82oV42onrVJp_w/viewform">Dev Genius</a> è¿™ä¸ªæˆ‘æäº¤äº†ä¸€ä¸ª è¶…è¿‡ä¸€ä¸ªæ˜ŸæœŸäº†è¿˜æ²¡äººå›å¤ã€‚</p>
<h1 id="æˆä¸ºä½œè€…åï¼Œæ€ä¹ˆå‘å¸ƒæ–‡ç« ã€‚"><a href="#æˆä¸ºä½œè€…åï¼Œæ€ä¹ˆå‘å¸ƒæ–‡ç« ã€‚" class="headerlink" title="æˆä¸ºä½œè€…åï¼Œæ€ä¹ˆå‘å¸ƒæ–‡ç« ã€‚"></a>æˆä¸ºä½œè€…åï¼Œæ€ä¹ˆå‘å¸ƒæ–‡ç« ã€‚</h1><p>ä¸€èˆ¬æ·»åŠ åéƒ½ä¼šæœ‰é‚®ä»¶å›å¤ï¼Œ<br>ç„¶ååœ¨åœ¨ä½ çš„è‰ç¨¿ä¸­é€‰æ‹© è¦å‡ºç‰ˆçš„publish ï¼Œå°±åƒè¿™æ ·ã€‚</p>
<p><img src="https://images.hxzhouh.com/blog-images/2024/03/e981881175716513b1aa586b03ca550f.gif" alt="how to push to publication"><br>æäº¤åˆ°å‡ºç‰ˆç‰©åï¼Œä¸æ˜¯ç«‹å³å°±å‘è¡¨ï¼Œè€Œæ˜¯è¦ç­‰ ç¼–è¾‘å®¡æ ¸ï¼Œæ—¶é—´ä¸ç¡®å®šï¼Œæœ‰æ—¶å€™è¿˜ä¼šæ‹’ç»ã€‚æ¯”å¦‚è¯´ä½ AIç¨¿ä¹‹ç±»çš„ã€‚</p>
<h1 id="publication-ä¼˜ç¼ºç‚¹"><a href="#publication-ä¼˜ç¼ºç‚¹" class="headerlink" title="publication ä¼˜ç¼ºç‚¹"></a>publication ä¼˜ç¼ºç‚¹</h1><h2 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h2><p>æœ€å¤§çš„ç¼ºç‚¹æ˜¯ç£¨å½ï¼Œæœ‰æ—¶å€™ç­‰1ä¸ªæ˜ŸæœŸéƒ½ä¸è§ä»»ä½•ååº”ã€‚ä¹Ÿä¸æ˜¯æ‰€æœ‰çš„publication ä¹æ„æ¥å—ä½ æˆä¸ºä½œè€…çš„<br>è¿˜æœ‰ä¸€ä¸ªç¼ºç‚¹å°±æ˜¯ä½ çš„æ–‡ç« ä¼šæ˜¾ç¤ºæˆ publication çš„åŸŸåï¼Œæ¯”å¦‚æˆ‘è¿™ç¯‡<a href="https://levelup.gitconnected.com/go-source-code-analysis-rwmutex-3498b6087d57?source=collection_home---4------1-----------------------">Go Source Code Analysis: RWmutex_</a>  ï¼Œå¦‚æœä½ æ³¨é‡åæœŸæƒ³è‡ªå·±å‘å±•ç‹¬ç«‹ç«™çš„è¯ï¼Œè¿™ç‚¹éœ€è¦è€ƒè™‘ä¸€ä¸‹</p>
<h2 id="ä¸æ˜æ˜¾çš„ä¼˜ç‚¹ï¼š"><a href="#ä¸æ˜æ˜¾çš„ä¼˜ç‚¹ï¼š" class="headerlink" title="ä¸æ˜æ˜¾çš„ä¼˜ç‚¹ï¼š"></a>ä¸æ˜æ˜¾çš„ä¼˜ç‚¹ï¼š</h2><ol>
<li>å¯èƒ½ä¼šè¢«å®¡ç¨¿ï¼Œæå‡ºä¸“ä¸šçš„ä¿®æ”¹æ„è§ï¼Ÿæˆ‘æ²¡é‡åˆ°è¿‡ å“ˆå“ˆ</li>
<li>å‡ºç‰ˆç‰©è‡ªå¸¦æµé‡ï¼Œæ¯”å¦‚Level Up Coding å…¨ç½‘100k+ç²‰ä¸ï¼Œä½ çš„æ–‡ç« å‘è¡¨åï¼Œä¼šæ˜¾ç¤ºåœ¨å®ƒçš„ä¸»é¡µï¼Œä¼šç»™ä½ å¢åŠ æµé‡å§ï¼Ÿä½†æ˜¯ä¸æ˜æ˜¾<br>  <img src="https://images.hxzhouh.com/blog-images/2024/03/58e5dab79d0b28276ddec5210e73388d.png" alt="Pasted image 20240312161118"></li>
<li>publication å‘è¡¨åçš„æ–‡ç« ä¹Ÿå¯ä»¥éšæ—¶ä¿®æ”¹ï¼Œç”šè‡³æ’¤ä¸‹æ¥ï¼Œæ¢å…¶ä»–çš„å‡ºç‰ˆç‰©ï¼Œè¿™ç‚¹æ¯”è¾ƒçµæ´»ã€‚</li>
<li>çœ‹è¿‡å¾ˆå¤šå†™mediumç»éªŒçš„æ–‡ç« ï¼Œä¸è¦é€‰æ‹©å¤ªå¤§çš„å‡ºç‰ˆç‰©ï¼Œå› ä¸ºæäº¤çš„æ–‡ç« å¤šï¼Œå¯èƒ½ä½ çš„æ–‡ç« å¾ˆå¿«å°±è¢«æ·¹æ²¡äº†ï¼Œä¸€äº›å°ä¼—çš„å‡ºç‰ˆç‰©ï¼Œå¯èƒ½æ›´å¥½ã€‚æˆ‘æ²¡å°è¯•è¿‡ã€‚<br>æ€»çš„æ¥è¯´ï¼Œpublication å°±è¿™ä¹ˆå›äº‹ï¼Œæ²¡æœ‰æ˜æ˜¾çš„åå¤„ï¼Œå¯èƒ½æœ‰ç‚¹å¥½å¤„ï¼Œä½†æ˜¯ä¹Ÿå°±é‚£ä¹ˆå¤šã€‚enjoyã€‚</li>
</ol>
]]></content>
  </entry>
  <entry>
    <title>æµ…æGo ä¸»æµæ—¥å¿—åº“ï¼šä»è®¾è®¡å±‚å­¦ä¹ å¦‚ä½•é›†æˆæ—¥å¿—è½®è½¬ä¸åˆ‡å‰²åŠŸèƒ½</title>
    <url>/2024/02/16/%E6%B5%85%E6%9E%90Go%20%E4%B8%BB%E6%B5%81%E6%97%A5%E5%BF%97%E5%BA%93%EF%BC%9A%E4%BB%8E%E8%AE%BE%E8%AE%A1%E5%B1%82%E5%AD%A6%E4%B9%A0%E5%A6%82%E4%BD%95%E9%9B%86%E6%88%90%E6%97%A5%E5%BF%97%E8%BD%AE%E8%BD%AC%E4%B8%8E%E5%88%87%E5%89%B2%E5%8A%9F%E8%83%BD/</url>
    <content><![CDATA[<p>åœ¨ç°æœ‰çš„æ—¥å¿—åº“ä¸­ï¼ŒåŒ…æ‹¬Â <code>go</code>Â 1.21.0 å¼•å…¥çš„Â <code>slog</code>Â æ—¥å¿—åº“ï¼Œå®ƒä»¬é€šå¸¸éƒ½æ”¯æŒå¯¹æ—¥å¿—æ–‡ä»¶è¿›è¡Œè½®è½¬ä¸åˆ‡å‰²ï¼Œåªä¸è¿‡è¿™äº›åŠŸèƒ½å¹¶ä¸ç›´æ¥è¢«å†…ç½®ï¼Œè€Œæ˜¯éœ€è¦æˆ‘ä»¬ä¸»åŠ¨é…ç½®æ¥å¯ç”¨ã€‚</p>
<p>æœ¬æ–‡å°†æ¢è®¨å‡ ä¸ªçƒ­é—¨çš„æ—¥å¿—åº“å¦‚Â <code>logrus</code>ã€<code>zap</code>Â å’Œå®˜ç½‘çš„Â <code>slog</code>ï¼Œæˆ‘å°†åˆ†æè¿™äº›åº“çš„çš„å…³é”®è®¾è®¡å…ƒç´ ï¼Œæ¢è®¨å®ƒä»¬æ˜¯å¦‚ä½•æ”¯æŒæ—¥å¿—è½®è½¬ä¸åˆ‡å‰²åŠŸèƒ½çš„é…ç½®ã€‚</p>
<span id="more"></span>
<p>#go </p>
<h1 id="æµ…æ-logrusã€zap-å’Œ-slog-çš„è®¾è®¡"><a href="#æµ…æ-logrusã€zap-å’Œ-slog-çš„è®¾è®¡" class="headerlink" title="æµ…æ logrusã€zap å’Œ slog çš„è®¾è®¡"></a>æµ…æ logrusã€zap å’Œ slog çš„è®¾è®¡</h1><p>åœ¨å¯¹Â <code>logrus</code>ã€<code>zap</code>Â å’ŒÂ <code>slog</code>Â è¿™å‡ ä¸ªæ—¥å¿—åº“çš„è®¾è®¡è¿›è¡Œå¯¹æ¯”åˆ†ææ—¶ï¼Œä¸€ä¸ªæ˜¾è‘—çš„å…±åŒç‚¹æ˜¯å®ƒä»¬éƒ½åŒ…å«äº†Â <code>io.Writer</code>Â è¿™ä¸ªå…³é”®çš„å±æ€§ã€‚è¿™ä¸€å±æ€§åœ¨æ—¥å¿—æ¡†æ¶è®¾è®¡ä¸­èµ·ç€æ ¸å¿ƒä½œç”¨ï¼Œå®ƒå†³å®šäº†æ—¥å¿—è¾“å‡ºçš„ç›®æ ‡ä½ç½®ã€‚</p>
<h2 id="logrus-æ—¥å¿—åº“"><a href="#logrus-æ—¥å¿—åº“" class="headerlink" title="logrus æ—¥å¿—åº“"></a>logrus æ—¥å¿—åº“</h2><p><code>logrus</code>Â æ˜¯ä¸€ä¸ªåŠŸèƒ½ä¸°å¯Œçš„Goè¯­è¨€æ—¥å¿—åº“ï¼Œå®ƒæä¾›äº†ç»“æ„åŒ–æ—¥å¿—è®°å½•ã€æ—¥å¿—çº§åˆ«æ§åˆ¶ç­‰åŠŸèƒ½ã€‚</p>
<p>å½“ä½¿ç”¨Â <code>logrus</code>Â æ—¶ï¼Œå¯ä»¥è°ƒç”¨Â <code>logrus.New()</code>Â å‡½æ•°æ¥åˆ›å»ºÂ <code>Logger</code>Â å®ä¾‹ã€‚é€šè¿‡è¯¥å®ä¾‹æˆ‘ä»¬æ‰§è¡Œå¾ˆå¤šæ“ä½œï¼Œä¾‹å¦‚è‡ªå®šä¹‰æ—¥å¿—è¾“å‡ºçš„ä½ç½®å’Œæ‰“å°æ—¥å¿—ç­‰ã€‚æˆ‘ä»¬çœ‹çœ‹ä¸‹é¢çš„ä»£ç ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">logger := logrus.New()  </span><br><span class="line">logger.Out = os.Stdout <span class="comment">// stdout  </span></span><br><span class="line"><span class="comment">// or redirects to file</span></span><br><span class="line"><span class="comment">//out, err := os.OpenFile(&quot;file.log&quot;, os.O_CREATE|os.O_WRONLY, 0666)  </span></span><br><span class="line"><span class="comment">//if err != nil &#123;  </span></span><br><span class="line"><span class="comment">// panic(err)  </span></span><br><span class="line"><span class="comment">//&#125;  </span></span><br><span class="line"><span class="comment">//logger.Out = out</span></span><br></pre></td></tr></table></figure>

<p><code>Logger</code>Â ç»“æ„ä½“çš„å®šä¹‰å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Logger <span class="keyword">struct</span> &#123;  </span><br><span class="line">Out io.Writer  </span><br><span class="line">Hooks LevelHooks  </span><br><span class="line">Formatter Formatter  </span><br><span class="line"><span class="comment">// other field...  </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…³é”®å±æ€§Â <code>Out</code>ï¼Œå…¶ç±»å‹ä¸ºÂ <code>io.Writer</code>ï¼Œè¿™ä¸€å±æ€§ç”¨äºæŒ‡å®šæ—¥å¿—çš„è¾“å‡ºç›®æ ‡ï¼Œæ— è®ºæ˜¯æ ‡å‡†è¾“å‡ºã€æ–‡ä»¶ï¼Œè¿˜æ˜¯å…¶ä»–è‡ªå®šä¹‰çš„è¾“å‡ºè½½ä½“ã€‚</p>
<h2 id="zap-æ—¥å¿—åº“"><a href="#zap-æ—¥å¿—åº“" class="headerlink" title="zap æ—¥å¿—åº“"></a>zap æ—¥å¿—åº“</h2><p><code>zap</code>Â æ˜¯ä¸€ä¸ªæ€§èƒ½æé«˜çš„æ—¥å¿—åº“ã€‚å®ƒæä¾›äº†ç»“æ„åŒ–æ—¥å¿—è®°å½•ã€å¤šçº§åˆ«æ—¥å¿—æ§åˆ¶ï¼Œä»¥åŠçµæ´»çš„é…ç½®é€‰é¡¹ã€‚</p>
<p>ä¸Â <code>logrus</code>Â ç±»ä¼¼ï¼Œ<code>zap</code>Â ä¹Ÿå…è®¸æ”¯æŒé€šè¿‡é…ç½®æ¥å†³å®šæ—¥å¿—è¾“å‡ºçš„ä½ç½®ï¼Œä½†å®ç°æ–¹å¼ç•¥æœ‰ä¸åŒã€‚åœ¨Â <code>zap</code>Â ä¸­ï¼Œæ—¥å¿—è¾“å‡ºæ˜¯é€šè¿‡é…ç½®Â <code>zapcore.Core</code>Â å®ç°çš„ã€‚åœ¨åˆ›å»ºÂ <code>zapcore.Core</code>Â å®ä¾‹æ—¶ï¼Œéœ€è¦æŒ‡å®šä¸€ä¸ªÂ <code>zapcore.WriteSyncer</code>Â æ¥å£å®ç°ä½œä¸ºå‚æ•°ï¼Œè¿™ä¸ªå‚æ•°ç›´æ¥å†³å®šäº†æ—¥å¿—çš„è¾“å‡ºç›®æ ‡ã€‚è¦åˆ›å»ºÂ <code>zapcore.WriteSyncer</code>Â å®ä¾‹ï¼Œé€šå¸¸ä½¿ç”¨Â <code>zapcore.AddSync()</code>Â å‡½æ•°ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªç±»å‹ä¸ºÂ <code>io.Writer</code>Â çš„å‚æ•°ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨Â <code>zap</code>Â åˆ›å»ºæ—¥å¿—å®ä¾‹çš„åŸºæœ¬ç¤ºä¾‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">writer := zapcore.AddSync(os.Stdout) <span class="comment">// use stdout  </span></span><br><span class="line">core := zapcore.NewCore(  </span><br><span class="line">zapcore.NewJSONEncoder(zap.NewProductionEncoderConfig()),  </span><br><span class="line">writer,  </span><br><span class="line">zap.InfoLevel,  </span><br><span class="line">)  </span><br><span class="line">logger := zap.New(core)  </span><br><span class="line"><span class="keyword">defer</span> logger.Sync() <span class="comment">// åˆ·æ–°ä»»ä½•ç¼“å†²çš„æ—¥å¿—æ¡ç›®  </span></span><br><span class="line">  </span><br><span class="line"><span class="comment">// user logger </span></span><br></pre></td></tr></table></figure>

<p>å…³é”®åœ¨äºÂ <code>zapcore.AddSync()</code>Â å‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥æ”¶ä¸€ä¸ªç±»å‹ä¸ºÂ <code>io.Writer</code>Â çš„å‚æ•°ï¼Œè¿™ä¸€å‚æ•°ç”¨äºæŒ‡å®šæ—¥å¿—çš„è¾“å‡ºç›®æ ‡ï¼Œæ— è®ºæ˜¯æ ‡å‡†è¾“å‡ºã€æ–‡ä»¶ï¼Œè¿˜æ˜¯å…¶ä»–è‡ªå®šä¹‰çš„è¾“å‡ºè½½ä½“ã€‚</p>
<h2 id="slog-æ—¥å¿—åº“"><a href="#slog-æ—¥å¿—åº“" class="headerlink" title="slog æ—¥å¿—åº“"></a>slog æ—¥å¿—åº“</h2><p><code>slog</code>Â æ˜¯åœ¨Â <code>go 1.21.0</code>Â ç‰ˆæœ¬å¼•å…¥çš„ä¸€ä¸ªå®˜ç½‘æ—¥å¿—åº“ï¼Œå®ƒæä¾›äº†ç»“æ„åŒ–æ—¥å¿—ã€‚å¦‚æœæƒ³è¦æ›´è¯¦ç»†åœ°äº†è§£Â <code>slog</code>Â æ—¥å¿—åº“ï¼Œ</p>
<p>ä¸Â <code>logrus</code>Â å’ŒÂ <code>zap</code>Â ç±»ä¼¼ï¼Œ<code>slog</code>Â ä¹Ÿå…è®¸ç”¨æˆ·é€šè¿‡æŒ‡å®šÂ <code>io.Writer</code>Â å‚æ•°æ¥è®¾ç½®æ—¥å¿—è¾“å‡ºçš„ç›®æ ‡ã€‚è¿™ä¸€è®¾ç½®æ˜¯åœ¨åˆ›å»ºÂ <code>slog.Handler</code>Â æ¥å£çš„å®ç°æ—¶è¿›è¡Œçš„ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">textLogger := slog.New(slog.NewTextHandler(os.Stdout, <span class="literal">nil</span>))  </span><br><span class="line">jsonLogger := slog.New(slog.NewJSONHandler(os.Stdout, <span class="literal">nil</span>))</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸¤ä¸ªå‡½æ•°ä¸­ï¼Œ<code>slog.NewTextHandler</code>Â å’ŒÂ <code>slog.NewJSONHandler</code>Â ç¬¬ä¸€ä¸ªå‚æ•°çš„ç±»å‹éƒ½æ˜¯Â <code>io.Writer</code>ã€‚</p>
<h2 id="æµ…ææ€»ç»“"><a href="#æµ…ææ€»ç»“" class="headerlink" title="æµ…ææ€»ç»“"></a>æµ…ææ€»ç»“</h2><p>åœ¨å¯¹Â <code>logurs</code>ã€<code>zap</code>Â å’ŒÂ <code>slog</code>Â è¿™ä¸‰ä¸ªä¸»æµæ—¥å¿—åº“çš„åˆ†æä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ä¸€ä¸ªå…³é”®çš„å…±åŒç‚¹ï¼šå®ƒä»¬åœ¨å¤„ç†æ—¥å¿—è¾“å‡ºæ—¶å‡ä¾èµ–äºÂ <code>io.Writer</code>Â æ¥å£ã€‚è¿™äº›æ—¥å¿—åº“é€šè¿‡å°†Â <code>io.Writer</code>æ¥å£ä½œä¸ºå…³é”®å‚æ•°çš„ç±»å‹ï¼Œä»¥ä¾¿è®¾ç½®æ—¥å¿—çš„è¾“å‡ºç›®æ ‡ã€‚</p>
<p><img src="https://images.hxzhouh.com/blog-images/2024/02/f3e3b50c2247e4d57f5b0946497fbba8.png" alt="Pasted image 20240212220811"></p>
<h1 id="æ—¥å¿—è½®è½¬ä¸åˆ‡å‰²åŠŸèƒ½çš„å®ç°æœºåˆ¶ä¸å®è·µ"><a href="#æ—¥å¿—è½®è½¬ä¸åˆ‡å‰²åŠŸèƒ½çš„å®ç°æœºåˆ¶ä¸å®è·µ" class="headerlink" title="æ—¥å¿—è½®è½¬ä¸åˆ‡å‰²åŠŸèƒ½çš„å®ç°æœºåˆ¶ä¸å®è·µ"></a>æ—¥å¿—è½®è½¬ä¸åˆ‡å‰²åŠŸèƒ½çš„å®ç°æœºåˆ¶ä¸å®è·µ</h1><h2 id="å®ç°æœºåˆ¶"><a href="#å®ç°æœºåˆ¶" class="headerlink" title="å®ç°æœºåˆ¶"></a>å®ç°æœºåˆ¶</h2><p>åœ¨æµ…æäº†Â <code>logurs</code>ã€<code>zap</code>Â å’ŒÂ <code>slog</code>Â æ—¥å¿—åº“çš„è®¾è®¡åï¼Œæˆ‘ä»¬å‘ç°äº†å®ƒä»¬çš„å…±åŒç‚¹ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ·±å…¥äº†è§£æ—¥å¿—è½®è½¬ä¸åˆ‡å‰²åŠŸèƒ½çš„å®ç°æœºåˆ¶ã€‚</p>
<p>ä¸ºäº†å®ç°Â <strong>æ—¥å¿—æ–‡ä»¶çš„è½®è½¬ä¸åˆ‡å‰²</strong>ï¼Œé€šå¸¸æˆ‘ä»¬ä¼šå€ŸåŠ©ç¬¬ä¸‰æ–¹åº“ï¼Œå¦‚ lumberjackï¼Œå½“ç„¶è¿˜æœ‰å…¶ä»–ç±»ä¼¼çš„åº“å¯ä¾›é€‰æ‹©ï¼Œè¿™é‡Œå°±ä¸ä¸€ä¸€åˆ—ä¸¾äº†ã€‚</p>
<p><code>lumberjack</code>Â æ˜¯ä¸€ä¸ªä¸“é—¨è®¾è®¡ç”¨äºæ—¥å¿—è½®è½¬å’Œåˆ‡å‰²çš„åº“ï¼Œå…¶ä½œç”¨å¯ä»¥ç±»æ¯”äºä¸€ä¸ªå¯æ’æ‹”çš„ç»„ä»¶ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡é…ç½®è¯¥ç»„ä»¶ï¼Œå¹¶å°†å…¶Â <strong>é›†æˆ</strong>Â åˆ°æ‰€é€‰çš„æ—¥å¿—åº“ä¸­ï¼Œä»è€Œå®ç°æ—¥å¿—æ–‡ä»¶çš„è½®è½¬ä¸åˆ‡å‰²åŠŸèƒ½ã€‚</p>
<p>åˆå§‹åŒ–Â <code>lumberjack</code>Â ç»„ä»¶çš„ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">log := &amp;lumberjack.Logger&#123;  </span><br><span class="line">Filename: <span class="string">&quot;/path/file.log&quot;</span>, <span class="comment">// location of the log file</span></span><br><span class="line">MaxSize: <span class="number">10</span>, <span class="comment">// Maximum file size (in MB)</span></span><br><span class="line">MaxBackups: <span class="number">3</span>, <span class="comment">// Maximum number of old files to keep</span></span><br><span class="line">MaxAge: <span class="number">28</span>, <span class="comment">// Maximum number of days to retain old files</span></span><br><span class="line">Compress: <span class="literal">true</span>, <span class="comment">// whether to compress/archive old files</span></span><br><span class="line">LocalTime: <span class="literal">true</span>, <span class="comment">// create timestamps using local time</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªÂ <code>lumberjack.Logger</code>Â å®ä¾‹ï¼Œå¹¶è®¾ç½®äº†ä»¥ä¸‹å‚æ•°ï¼š</p>
<ul>
<li><code>Filename</code>ï¼šæŒ‡å®šæ—¥å¿—æ–‡ä»¶çš„å­˜å‚¨è·¯å¾„ã€‚</li>
<li><code>MaxSize</code>ï¼šæ—¥å¿—æ–‡ä»¶è¾¾åˆ°å¤šå°‘Â <code>MB</code>Â åè¿›è¡Œè½®è½¬ã€‚</li>
<li><code>MaxBackups</code>ï¼šæœ€å¤šä¿ç•™å¤šå°‘ä¸ªæ—§æ—¥å¿—æ–‡ä»¶ã€‚</li>
<li><code>MaxAge</code>ï¼šæ—§æ–‡ä»¶ä¿ç•™çš„æœ€é•¿æ—¶é—´ï¼ˆå¤©ï¼‰ã€‚</li>
<li><code>Compress</code>ï¼šæ˜¯å¦å‹ç¼©æ—§æ–‡ä»¶ï¼ˆå¦‚è½¬æ¢ä¸º.gzï¼‰ã€‚</li>
</ul>
<p>éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼ŒÂ <code>lumberjack</code>Â çš„Â <code>Logger</code>Â ç»“æ„ä½“å®ç°äº†Â <code>io.Writer</code>Â æ¥å£ã€‚è¿™æ„å‘³ç€æ‰€æœ‰å…³äºæ—¥å¿—æ–‡ä»¶çš„è½®è½¬ä¸åˆ‡å‰²çš„æ ¸å¿ƒé€»è¾‘éƒ½å°è£…åœ¨Â <code>Write</code>Â æ–¹æ³•ä¸­ã€‚è¿™ä¸€å®ç°ä¹Ÿæ–¹ä¾¿Â <code>Logger</code>Â ç»“æ„ä½“è¢«é›†æˆåˆ°ä»»ä½•æ”¯æŒÂ <code>io.Writer</code>Â å‚æ•°çš„æ—¥å¿—åº“ä¸­ã€‚</p>
<p>æ˜ç™½äº†è¿™äº›ï¼Œæƒ³å¿…ä½ å·²ç»çŸ¥é“å¦‚ä½•å®ç°æ—¥å¿—è½®è½¬ä¸åˆ‡å‰²çš„åŠŸèƒ½äº†å§ã€‚<code>lumberjack</code>Â çš„Â <code>logger</code>Â Â ç»“æ„ä½“å®ç°äº†Â <code>io.Writer</code>Â æ¥å£ï¼Œå› æ­¤å°†å®ƒä¼ é€’åˆ°ç¬¬ä¸‰æ–¹åº“ä¸­ï¼Œå°±èƒ½å®Œæˆé›†æˆé…ç½®äº†ã€‚</p>
<h2 id="å®è·µ"><a href="#å®è·µ" class="headerlink" title="å®è·µ"></a>å®è·µ</h2><h3 id="logrus-æ—¥å¿—åº“çš„å®ç°"><a href="#logrus-æ—¥å¿—åº“çš„å®ç°" class="headerlink" title="logrus æ—¥å¿—åº“çš„å®ç°"></a>logrus æ—¥å¿—åº“çš„å®ç°</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line">log := &amp;lumberjack.Logger&#123;</span><br><span class="line">	Filename: <span class="string">&quot;/path/file.log&quot;</span>, <span class="comment">// location of log file</span></span><br><span class="line">	MaxSize: <span class="number">10</span>, <span class="comment">// Maximum file size in MB</span></span><br><span class="line">	MaxBackups: <span class="number">3</span>, <span class="comment">// Maximum number of old files to keep</span></span><br><span class="line">	MaxAge: <span class="number">28</span>, <span class="comment">// Maximum number of days to retain old files</span></span><br><span class="line">	Compress: <span class="literal">true</span>, <span class="comment">// whether to compress/archive old files</span></span><br><span class="line">	LocalTime: <span class="literal">true</span>, <span class="comment">// create timestamps using local time</span></span><br><span class="line">&#125;</span><br><span class="line">logger := logrus.New()</span><br><span class="line">logger.Out = log</span><br></pre></td></tr></table></figure>

<h3 id="zap-æ—¥å¿—åº“çš„å®ç°"><a href="#zap-æ—¥å¿—åº“çš„å®ç°" class="headerlink" title="zap æ—¥å¿—åº“çš„å®ç°"></a>zap æ—¥å¿—åº“çš„å®ç°</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line">log := &amp;lumberjack.Logger&#123;</span><br><span class="line">	Filename: <span class="string">&quot;/path/file.log&quot;</span>, <span class="comment">// location of log file</span></span><br><span class="line">	MaxSize: <span class="number">10</span>, <span class="comment">// Maximum file size in MB</span></span><br><span class="line">	MaxBackups: <span class="number">3</span>, <span class="comment">// Maximum number of old files to keep</span></span><br><span class="line">	MaxAge: <span class="number">28</span>, <span class="comment">// Maximum number of days to retain old files</span></span><br><span class="line">	Compress: <span class="literal">true</span>, <span class="comment">// whether to compress/archive old files</span></span><br><span class="line">	LocalTime: <span class="literal">true</span>, <span class="comment">// create timestamps using local time</span></span><br><span class="line">&#125;</span><br><span class="line">writer := zapcore.AddSync(log)</span><br><span class="line">core := zapcore.NewCore(</span><br><span class="line">zapcore.NewJSONEncoder(zap.NewProductionEncoderConfig()),</span><br><span class="line">NewJSONEncoder(zap.</span><br><span class="line">zap.InfoLevel.</span><br><span class="line">)</span><br><span class="line">logger := zap.New(core)</span><br><span class="line"><span class="keyword">defer</span> logger.Sync() <span class="comment">// Flush any buffered log entries.</span></span><br></pre></td></tr></table></figure>

<h3 id="slog-æ—¥å¿—åº“çš„å®ç°"><a href="#slog-æ—¥å¿—åº“çš„å®ç°" class="headerlink" title="slog æ—¥å¿—åº“çš„å®ç°"></a>slog æ—¥å¿—åº“çš„å®ç°</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line">Log := &amp;lumberjack.Logger&#123;</span><br><span class="line">	Filename: <span class="string">&quot;/path/file.log&quot;</span>, <span class="comment">// Location of the log file</span></span><br><span class="line">	MaxSize: <span class="number">10</span>, <span class="comment">// Maximum file size (in MB)</span></span><br><span class="line">	MaxBackups: <span class="number">3</span>, <span class="comment">// Maximum number of old files retained</span></span><br><span class="line">	MaxAge: <span class="number">28</span>, <span class="comment">// Maximum number of days to keep old files</span></span><br><span class="line">	Compress: <span class="literal">true</span>, <span class="comment">// Whether to compress/archive old files</span></span><br><span class="line">	LocalTime: <span class="literal">true</span>, <span class="comment">// Create a timestamp with local time</span></span><br><span class="line">&#125;</span><br><span class="line">textLogger := slog.New(slog.NewTextHandler(log, <span class="literal">nil</span>))</span><br><span class="line">jsonLogger := slog.New(slog.NewJSONHandler(log, <span class="literal">nil</span>))</span><br></pre></td></tr></table></figure>

<p>æœ¬æ–‡å¯¹ä¸‰ä¸ªçƒ­é—¨çš„æ—¥å¿—åº“Â <code>logrus</code>ã€<code>zap</code>Â å’ŒÂ <code>slog</code>Â è®¾è®¡è¦ç´ è¿›è¡Œæµ…æï¼Œæˆ‘ä»¬å‘ç°è™½ç„¶å®ƒä»¬åœ¨åˆ›å»ºæ—¥å¿—å®ä¾‹çš„ç»†èŠ‚ä¸Šæœ‰æ‰€å·®å¼‚ï¼Œä½†å®ƒä»¬å…±åŒä¾èµ–äºÂ <code>io.Writer</code>Â æ¥å£å‚æ•°æ¥å¤„ç†æ—¥å¿—çš„è¾“å‡ºã€‚æŒæ¡å¦‚ä½•é…ç½®Â <code>io.Writer</code>Â å‚æ•°ï¼Œå¹¶ç»“åˆÂ <code>lumberjack</code>Â åº“çš„ä½¿ç”¨ï¼Œæˆ‘ä»¬å°±å¯ä»¥å®ç°æ—¥å¿—æ–‡ä»¶çš„è½®è½¬ä¸åˆ‡å‰²åŠŸèƒ½ã€‚</p>
<p>å³ä½¿åé¢æ¨å‡ºæ–°çš„æ—¥å¿—åº“ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ç±»ä¼¼çš„æ–¹æ³•ï¼Œå¿«é€Ÿåœ°é›†æˆæ—¥å¿—æ–‡ä»¶çš„è½®è½¬ä¸åˆ‡å‰²åŠŸèƒ½ã€‚</p>
]]></content>
      <categories>
        <category>Go</category>
      </categories>
      <tags>
        <tag>go</tag>
      </tags>
  </entry>
  <entry>
    <title>æ·±åº¦ä¼˜å…ˆç®—æ³•ä¸å¹¿åº¦ä¼˜å…ˆç®—æ³•</title>
    <url>/2022/09/30/%E6%B7%B1%E5%BA%A6%E4%BC%98%E5%85%88%E7%AE%97%E6%B3%95%E4%B8%8E%E5%B9%BF%E5%BA%A6%E4%BC%98%E5%85%88%E7%AE%97%E6%B3%95/</url>
    <content><![CDATA[<h1 id="æ·±åº¦ä¼˜å…ˆç®—æ³•-ï¼ˆDepth-First-Searchï¼‰"><a href="#æ·±åº¦ä¼˜å…ˆç®—æ³•-ï¼ˆDepth-First-Searchï¼‰" class="headerlink" title="æ·±åº¦ä¼˜å…ˆç®—æ³• ï¼ˆDepth-First-Searchï¼‰"></a>æ·±åº¦ä¼˜å…ˆç®—æ³• ï¼ˆDepth-First-Searchï¼‰</h1><p>æ·±åº¦ä¼˜å…ˆæœç´¢ç®—æ³•ï¼ˆDepth-First-Searchï¼‰ï¼Œæ˜¯æœç´¢ç®—æ³•çš„ä¸€ç§ã€‚å®ƒæ²¿ç€æ ‘çš„æ·±åº¦éå†æ ‘çš„èŠ‚ç‚¹ï¼Œå°½å¯èƒ½æ·±çš„æœç´¢æ ‘çš„åˆ† æ”¯ã€‚<br> å½“èŠ‚ç‚¹vçš„æ‰€æœ‰è¾¹éƒ½å·±è¢«æ¢å¯»è¿‡ï¼Œæœç´¢å°†å›æº¯åˆ°å‘ç°èŠ‚ç‚¹vçš„é‚£æ¡è¾¹çš„èµ·å§‹èŠ‚ç‚¹ã€‚<br> è¿™ä¸€è¿‡ç¨‹ä¸€ç›´è¿›è¡Œåˆ°å·²å‘ç°ä»æºèŠ‚ç‚¹å¯è¾¾çš„æ‰€æœ‰èŠ‚ç‚¹ä¸ºæ­¢ã€‚<br> å¦‚æœè¿˜å­˜åœ¨æœªè¢«å‘ ç°çš„èŠ‚ç‚¹ï¼Œåˆ™é€‰æ‹©å…¶ä¸­ä¸€ä¸ªä½œä¸ºæºèŠ‚ç‚¹å¹¶é‡å¤ä»¥ä¸Šè¿‡ç¨‹ï¼Œæ•´ä¸ªè¿›ç¨‹åå¤è¿›è¡Œç›´åˆ°æ‰€æœ‰èŠ‚ç‚¹éƒ½è¢«è®¿é—®ä¸ºæ­¢ã€‚</p>
<p>æ·±åº¦ä¼˜å…ˆæœç´¢æ˜¯å›¾è®ºä¸­çš„ç»å…¸ç®—æ³•ï¼Œåˆ©ç”¨æ·±åº¦ä¼˜å…ˆæœç´¢ç®—æ³•å¯ä»¥äº§ç”Ÿç›®æ ‡å›¾çš„ç›¸åº”æ‹“æ‰‘æ’åºè¡¨ï¼Œåˆ©ç”¨æ‹“æ‰‘æ’åºè¡¨å¯ä»¥æ–¹ä¾¿çš„è§£å†³å¾ˆå¤šç›¸å…³çš„å›¾è®ºé—®é¢˜ï¼Œå¦‚æœ€å¤§è·¯å¾„é—®é¢˜ç­‰ç­‰ã€‚ä¸€èˆ¬ç”¨å †æ•°æ®ç»“æ„æ¥è¾…åŠ©å®ç°DFSç®—æ³•ã€‚</p>
<p><strong>DFSå±äºç›²ç›®æœç´¢</strong></p>
<p>æ·±åº¦ä¼˜å…ˆéå†å›¾ç®—æ³•æ­¥éª¤ï¼š</p>
<ul>
<li>è®¿é—®é¡¶ç‚¹vï¼›</li>
<li>ä¾æ¬¡ä»vçš„æœªè¢«è®¿é—®çš„é‚»æ¥ç‚¹å‡ºå‘ï¼Œå¯¹å›¾è¿›è¡Œæ·±åº¦ä¼˜å…ˆéå†ï¼›ç›´è‡³å›¾ä¸­å’Œvæœ‰è·¯å¾„ç›¸é€šçš„é¡¶ç‚¹éƒ½è¢«è®¿é—®ï¼›</li>
<li>è‹¥æ­¤æ—¶å›¾ä¸­å°šæœ‰é¡¶ç‚¹æœªè¢«è®¿é—®ï¼Œåˆ™ä»ä¸€ä¸ªæœªè¢«è®¿é—®çš„é¡¶ç‚¹å‡ºå‘ï¼Œé‡æ–°è¿›è¡Œæ·±åº¦ä¼˜å…ˆéå†ï¼Œç›´åˆ°å›¾ä¸­æ‰€æœ‰é¡¶ç‚¹å‡è¢«è®¿é—®è¿‡ä¸ºæ­¢ã€‚</li>
</ul>
<p><strong>ä¸¾ä¸ªå®ä¾‹ï¼š</strong></p>
<p>DFS åœ¨è®¿é—®å›¾ä¸­æŸä¸€èµ·å§‹é¡¶ç‚¹ v åï¼Œç”± v å‡ºå‘ï¼Œè®¿é—®å®ƒçš„ä»»ä¸€é‚»æ¥é¡¶ç‚¹ w1ï¼›å†ä» w1 å‡ºå‘ï¼Œè®¿é—®ä¸ w1é‚» æ¥ä½†è¿˜æ²¡æœ‰è®¿é—®è¿‡çš„é¡¶ç‚¹ w2ï¼›ç„¶åå†ä» w2 å‡ºå‘ï¼Œè¿›è¡Œç±»ä¼¼çš„è®¿é—®ï¼Œâ€¦ å¦‚æ­¤è¿›è¡Œä¸‹å»ï¼Œç›´è‡³åˆ°è¾¾æ‰€æœ‰çš„é‚»æ¥é¡¶ç‚¹éƒ½è¢«è®¿é—®è¿‡çš„é¡¶ç‚¹ u ä¸ºæ­¢ã€‚<br> æ¥ç€ï¼Œé€€å›ä¸€æ­¥ï¼Œé€€åˆ°å‰ä¸€æ¬¡åˆšè®¿é—®è¿‡çš„é¡¶ç‚¹ï¼Œçœ‹æ˜¯å¦è¿˜æœ‰å…¶å®ƒæ²¡æœ‰è¢«è®¿é—®çš„é‚»æ¥é¡¶ç‚¹ã€‚å¦‚æœæœ‰ï¼Œåˆ™è®¿é—®æ­¤é¡¶ç‚¹ï¼Œä¹‹åå†ä»æ­¤é¡¶ç‚¹å‡ºå‘ï¼Œè¿›è¡Œä¸å‰è¿°ç±»ä¼¼çš„è®¿é—®ï¼›å¦‚æœæ²¡æœ‰ï¼Œå°±å†é€€å›ä¸€æ­¥è¿›è¡Œæœç´¢ã€‚é‡å¤ä¸Šè¿°è¿‡ç¨‹ï¼Œç›´åˆ°è¿é€šå›¾ä¸­æ‰€æœ‰é¡¶ç‚¹éƒ½è¢«è®¿é—®è¿‡ä¸ºæ­¢ã€‚</p>
<p>ä¾‹å¦‚ä¸‹å›¾ï¼Œå…¶æ·±åº¦ä¼˜å…ˆéå†é¡ºåºä¸º 1-&gt;2-&gt;4-&gt;8-&gt;5-&gt;3-&gt;6-&gt;7</p>
<p><img src="https://blog-image-1253555052.cos.ap-guangzhou.myqcloud.com/20200406213809.png" alt="æ·±åº¦ä¼˜å…ˆç®—æ³•"></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">dfs</span><span class="params">(root *TreeNode)</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> root == <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Print(root.Val)</span><br><span class="line">	dfs(root.Left)</span><br><span class="line">	dfs(root.Right)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="å¹¿åº¦ä¼˜å…ˆæœç´¢ç®—æ³•ï¼ˆBreadth-First-Searchï¼‰"><a href="#å¹¿åº¦ä¼˜å…ˆæœç´¢ç®—æ³•ï¼ˆBreadth-First-Searchï¼‰" class="headerlink" title="å¹¿åº¦ä¼˜å…ˆæœç´¢ç®—æ³•ï¼ˆBreadth-First-Searchï¼‰"></a>å¹¿åº¦ä¼˜å…ˆæœç´¢ç®—æ³•ï¼ˆBreadth-First-Searchï¼‰</h1><p><strong>å¹¿åº¦ä¼˜å…ˆæœç´¢ç®—æ³•ï¼ˆBreadth-First-Searchï¼‰ï¼Œæ˜¯ä¸€ç§å›¾å½¢æœç´¢ç®—æ³•</strong></p>
<p>ç®€å•çš„è¯´ï¼ŒBFSæ˜¯ä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œæ²¿ç€æ ‘(å›¾)çš„å®½åº¦éå†æ ‘(å›¾)çš„èŠ‚ç‚¹ã€‚å¦‚æœæ‰€æœ‰èŠ‚ç‚¹å‡è¢«è®¿é—®ï¼Œåˆ™ç®—æ³•ä¸­æ­¢ã€‚<br>BFSåŒæ ·å±äºç›²ç›®æœç´¢ã€‚ä¸€èˆ¬ç”¨é˜Ÿåˆ—æ•°æ®ç»“æ„æ¥è¾…åŠ©å®ç°BFSç®—æ³•ã€‚</p>
<p>ç®—æ³•æ­¥éª¤ï¼š</p>
<ol>
<li>é¦–å…ˆå°†æ ¹èŠ‚ç‚¹æ”¾å…¥é˜Ÿåˆ—ä¸­ã€‚</li>
<li>ä»é˜Ÿåˆ—ä¸­å–å‡ºç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¹¶æ£€éªŒå®ƒæ˜¯å¦ä¸ºç›®æ ‡ã€‚å¦‚æœæ‰¾åˆ°ç›®æ ‡ï¼Œåˆ™ç»“æŸæœå¯»å¹¶å›ä¼ ç»“æœã€‚å¦åˆ™å°†å®ƒæ‰€æœ‰å°šæœªæ£€éªŒè¿‡çš„ç›´æ¥å­èŠ‚ç‚¹åŠ å…¥é˜Ÿåˆ—ä¸­ã€‚</li>
<li>è‹¥é˜Ÿåˆ—ä¸ºç©ºï¼Œè¡¨ç¤ºæ•´å¼ å›¾éƒ½æ£€æŸ¥è¿‡äº†â€”â€”äº¦å³å›¾ä¸­æ²¡æœ‰æ¬²æœå¯»çš„ç›®æ ‡ã€‚ç»“æŸæœå¯»å¹¶å›ä¼ â€œæ‰¾ä¸åˆ°ç›®æ ‡â€ã€‚</li>
<li>é‡å¤æ­¥éª¤2ã€‚</li>
</ol>
<p>å¦‚ä¸Šå›¾ï¼Œå…¶å¹¿åº¦ä¼˜å…ˆç®—æ³•çš„éå†é¡ºåºä¸ºï¼š1-&gt;2-&gt;3-&gt;4-&gt;5-&gt;6-&gt;7-&gt;8</p>
<p>ä»£ç å®ç°</p>
<h3 id="leetcode-çœŸé¢˜"><a href="#leetcode-çœŸé¢˜" class="headerlink" title="leetcode çœŸé¢˜"></a>leetcode çœŸé¢˜</h3><h4 id="662-äºŒå‰æ ‘æœ€å¤§å®½åº¦"><a href="#662-äºŒå‰æ ‘æœ€å¤§å®½åº¦" class="headerlink" title="662. äºŒå‰æ ‘æœ€å¤§å®½åº¦"></a><a href="https://leetcode-cn.com/problems/maximum-width-of-binary-tree/">662. äºŒå‰æ ‘æœ€å¤§å®½åº¦</a></h4><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> AnnotatedNode <span class="keyword">struct</span> &#123;</span><br><span class="line">	node *TreeNode</span><br><span class="line">	dept,</span><br><span class="line">	ops <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> linkNode <span class="keyword">struct</span> &#123;</span><br><span class="line">	value *AnnotatedNode</span><br><span class="line">	next  *linkNode</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é“¾è¡¨</span></span><br><span class="line"><span class="keyword">type</span> linkedAnnotatedNodeList <span class="keyword">struct</span> &#123;</span><br><span class="line">	head  *linkNode <span class="comment">//é˜Ÿé¦–</span></span><br><span class="line">	tail  *linkNode <span class="comment">//é˜Ÿå°¾</span></span><br><span class="line">	count <span class="type">int</span>       <span class="comment">//é•¿åº¦</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆå§‹åŒ–é“¾è¡¨</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewLinkedAnnotatedNodeList</span><span class="params">()</span></span> *linkedAnnotatedNodeList &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;linkedAnnotatedNodeList&#123;head: <span class="literal">nil</span>, tail: <span class="literal">nil</span>, count: <span class="number">0</span>&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *linkedAnnotatedNodeList)</span></span> IsEmpty() <span class="type">bool</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> this.count == <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *linkedAnnotatedNodeList)</span></span> Add(value *AnnotatedNode) &#123;</span><br><span class="line">	node := <span class="built_in">new</span>(linkNode)</span><br><span class="line">	node.value = value</span><br><span class="line"></span><br><span class="line">	this.count++</span><br><span class="line">	<span class="keyword">if</span> this.tail == <span class="literal">nil</span> &#123;</span><br><span class="line">		this.head = node</span><br><span class="line">		this.tail = node</span><br><span class="line">		node.next = <span class="literal">nil</span></span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	this.tail.next = node</span><br><span class="line">	node.next = <span class="literal">nil</span></span><br><span class="line">	this.tail = node</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *linkedAnnotatedNodeList)</span></span> Delete() *linkNode &#123;</span><br><span class="line">	<span class="keyword">if</span> this.head == <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	this.count--</span><br><span class="line">	<span class="keyword">if</span> this.head == this.tail &#123;</span><br><span class="line">		node := this.head</span><br><span class="line">		this.head = <span class="literal">nil</span></span><br><span class="line">		this.tail = <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> node</span><br><span class="line">	&#125;</span><br><span class="line">	node := this.head</span><br><span class="line">	this.head = this.head.next</span><br><span class="line">	<span class="keyword">return</span> node</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Queue <span class="keyword">struct</span> &#123;</span><br><span class="line">	link *linkedAnnotatedNodeList</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewQueue</span><span class="params">()</span></span> *Queue &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;Queue&#123;link: NewLinkedAnnotatedNodeList()&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//åŠ å…¥é˜Ÿåˆ—</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *Queue)</span></span> Put(value *AnnotatedNode) &#123;</span><br><span class="line">	this.link.Add(value)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//popå‡ºé˜Ÿåˆ—</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *Queue)</span></span> Pop() *linkNode &#123;</span><br><span class="line">	<span class="keyword">return</span> this.link.Delete()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è·å¾—é˜Ÿåˆ—çš„é•¿åº¦</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *Queue)</span></span> GetSize() <span class="type">int</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> this.link.count</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *Queue)</span></span> IsEmpty() <span class="type">bool</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> this.GetSize() == <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">widthOfBinaryTree</span><span class="params">(root *TreeNode)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">	query := NewQueue()</span><br><span class="line">	query.Put(&amp;AnnotatedNode&#123;</span><br><span class="line">		node: root,</span><br><span class="line">		dept: <span class="number">0</span>,</span><br><span class="line">		ops:  <span class="number">0</span>,</span><br><span class="line">	&#125;)</span><br><span class="line">	curDepth := <span class="number">0</span></span><br><span class="line">	left := <span class="number">0</span></span><br><span class="line">	ans := <span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> query.GetSize() != <span class="number">0</span> &#123;</span><br><span class="line">		a := query.Pop().value</span><br><span class="line">		<span class="keyword">if</span> a.node != <span class="literal">nil</span> &#123;</span><br><span class="line">			query.Put(&amp;AnnotatedNode&#123;</span><br><span class="line">				node: a.node.Left,</span><br><span class="line">				dept: a.dept + <span class="number">1</span>,</span><br><span class="line">				ops:  a.ops * <span class="number">2</span>,</span><br><span class="line">			&#125;)</span><br><span class="line">			query.Put(&amp;AnnotatedNode&#123;</span><br><span class="line">				node: a.node.Right,</span><br><span class="line">				dept: a.dept + <span class="number">1</span>,</span><br><span class="line">				ops:  a.ops*<span class="number">2</span> + <span class="number">1</span>,</span><br><span class="line">			&#125;)</span><br><span class="line">			<span class="keyword">if</span> curDepth != a.dept &#123;</span><br><span class="line">				curDepth = a.dept</span><br><span class="line">				left = a.ops</span><br><span class="line">			&#125;</span><br><span class="line">			ans = Max(ans, a.ops-left+<span class="number">1</span>)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> ans</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Max</span><span class="params">(a, b <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> a &gt; b &#123;</span><br><span class="line">		<span class="keyword">return</span> a</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> b</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="103-äºŒå‰æ ‘çš„é”¯é½¿å½¢å±‚æ¬¡éå†"><a href="#103-äºŒå‰æ ‘çš„é”¯é½¿å½¢å±‚æ¬¡éå†" class="headerlink" title="103. äºŒå‰æ ‘çš„é”¯é½¿å½¢å±‚æ¬¡éå†"></a><a href="https://leetcode-cn.com/problems/binary-tree-zigzag-level-order-traversal/">103. äºŒå‰æ ‘çš„é”¯é½¿å½¢å±‚æ¬¡éå†</a></h4><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * type TreeNode struct &#123;</span></span><br><span class="line"><span class="comment"> *     Val int</span></span><br><span class="line"><span class="comment"> *     Left *TreeNode</span></span><br><span class="line"><span class="comment"> *     Right *TreeNode</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">type</span> AnnotatedNode <span class="keyword">struct</span> &#123;</span><br><span class="line">	node  *TreeNode</span><br><span class="line">	dept, <span class="comment">//æ·±åº¦</span></span><br><span class="line">	ops <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> linkNode <span class="keyword">struct</span> &#123;</span><br><span class="line">	value *AnnotatedNode</span><br><span class="line">	next  *linkNode</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é“¾è¡¨</span></span><br><span class="line"><span class="keyword">type</span> linkedAnnotatedNodeList <span class="keyword">struct</span> &#123;</span><br><span class="line">	head  *linkNode <span class="comment">//é˜Ÿé¦–</span></span><br><span class="line">	tail  *linkNode <span class="comment">//é˜Ÿå°¾</span></span><br><span class="line">	count <span class="type">int</span>       <span class="comment">//é•¿åº¦</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆå§‹åŒ–é“¾è¡¨</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewLinkedAnnotatedNodeList</span><span class="params">()</span></span> *linkedAnnotatedNodeList &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;linkedAnnotatedNodeList&#123;head: <span class="literal">nil</span>, tail: <span class="literal">nil</span>, count: <span class="number">0</span>&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *linkedAnnotatedNodeList)</span></span> IsEmpty() <span class="type">bool</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> this.count == <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *linkedAnnotatedNodeList)</span></span> Add(value *AnnotatedNode) &#123;</span><br><span class="line">	node := <span class="built_in">new</span>(linkNode)</span><br><span class="line">	node.value = value</span><br><span class="line"></span><br><span class="line">	this.count++</span><br><span class="line">	<span class="keyword">if</span> this.tail == <span class="literal">nil</span> &#123;</span><br><span class="line">		this.head = node</span><br><span class="line">		this.tail = node</span><br><span class="line">		node.next = <span class="literal">nil</span></span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	this.tail.next = node</span><br><span class="line">	node.next = <span class="literal">nil</span></span><br><span class="line">	this.tail = node</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *linkedAnnotatedNodeList)</span></span> Delete() *linkNode &#123;</span><br><span class="line">	<span class="keyword">if</span> this.head == <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	this.count--</span><br><span class="line">	<span class="keyword">if</span> this.head == this.tail &#123;</span><br><span class="line">		node := this.head</span><br><span class="line">		this.head = <span class="literal">nil</span></span><br><span class="line">		this.tail = <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> node</span><br><span class="line">	&#125;</span><br><span class="line">	node := this.head</span><br><span class="line">	this.head = this.head.next</span><br><span class="line">	<span class="keyword">return</span> node</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Queue <span class="keyword">struct</span> &#123;</span><br><span class="line">	link *linkedAnnotatedNodeList</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewQueue</span><span class="params">()</span></span> *Queue &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;Queue&#123;link: NewLinkedAnnotatedNodeList()&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//åŠ å…¥é˜Ÿåˆ—</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *Queue)</span></span> Put(value *AnnotatedNode) &#123;</span><br><span class="line">	this.link.Add(value)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//popå‡ºé˜Ÿåˆ—</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *Queue)</span></span> Pop() *linkNode &#123;</span><br><span class="line">	<span class="keyword">return</span> this.link.Delete()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è·å¾—é˜Ÿåˆ—çš„é•¿åº¦</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *Queue)</span></span> GetSize() <span class="type">int</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> this.link.count</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *Queue)</span></span> IsEmpty() <span class="type">bool</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> this.GetSize() == <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">zigzagLevelOrder</span><span class="params">(root *TreeNode)</span></span> [][]<span class="type">int</span> &#123;</span><br><span class="line">	result := <span class="built_in">make</span>([][]<span class="type">int</span>, <span class="number">0</span>)</span><br><span class="line">	query := NewQueue()</span><br><span class="line"></span><br><span class="line">	query.Put(&amp;AnnotatedNode&#123;node: root, dept: <span class="number">0</span>, ops: <span class="number">0</span>&#125;)</span><br><span class="line">	<span class="keyword">for</span> query.GetSize() != <span class="number">0</span> &#123;</span><br><span class="line">		a := query.Pop().value</span><br><span class="line">		<span class="keyword">if</span> a.node != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">if</span> <span class="built_in">len</span>(result) &lt;= a.dept &#123; <span class="comment">//å°äºå±‚æ•°</span></span><br><span class="line">				temp := <span class="built_in">make</span>([]<span class="type">int</span>, <span class="number">0</span>)</span><br><span class="line">				temp = <span class="built_in">append</span>(temp, a.node.Val)</span><br><span class="line">				result = <span class="built_in">append</span>(result, temp)</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				result[a.dept] = <span class="built_in">append</span>(result[a.dept], a.node.Val)</span><br><span class="line">			&#125;</span><br><span class="line">			query.Put(&amp;AnnotatedNode&#123;a.node.Left, a.dept + <span class="number">1</span>, <span class="number">0</span>&#125;)</span><br><span class="line">			query.Put(&amp;AnnotatedNode&#123;a.node.Right, a.dept + <span class="number">1</span>, <span class="number">0</span>&#125;)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="keyword">for</span> k, v := <span class="keyword">range</span> result &#123;</span><br><span class="line">		<span class="keyword">if</span> k%<span class="number">2</span> == <span class="number">1</span> &#123;</span><br><span class="line">			result[k] = stringReverse(v)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">stringReverse</span><span class="params">(src []<span class="type">int</span>)</span></span> []<span class="type">int</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> src == <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(fmt.Errorf(<span class="string">&quot;the src can&#x27;t be empty!&quot;</span>))</span><br><span class="line">	&#125;</span><br><span class="line">	count := <span class="built_in">len</span>(src)</span><br><span class="line">	mid := count / <span class="number">2</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; mid; i++ &#123;</span><br><span class="line">		tmp := src[i]</span><br><span class="line">		src[i] = src[count<span class="number">-1</span>]</span><br><span class="line">		src[count<span class="number">-1</span>] = tmp</span><br><span class="line">		count--</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> src</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>æ•°æ®ç»“æ„&amp;ç®—æ³•</category>
        <category>leetCode</category>
      </categories>
      <tags>
        <tag>DFS</tag>
        <tag>BFS</tag>
      </tags>
  </entry>
  <entry>
    <title>èŠèŠRedis  é“¾è¡¨</title>
    <url>/2022/09/30/%E8%81%8A%E8%81%8ARedis%20%20%E9%93%BE%E8%A1%A8/</url>
    <content><![CDATA[<p>é“¾è¡¨æä¾›äº†é«˜æ•ˆçš„èŠ‚ç‚¹é‡æ’èƒ½åŠ›ï¼Œ ä»¥åŠé¡ºåºæ€§çš„èŠ‚ç‚¹è®¿é—®æ–¹å¼ï¼Œ å¹¶ä¸”å¯ä»¥é€šè¿‡å¢åˆ èŠ‚ç‚¹æ¥çµæ´»åœ°è°ƒæ•´é“¾è¡¨çš„é•¿åº¦ã€‚</p>
<p>é“¾è¡¨åœ¨ Redis ä¸­çš„åº”ç”¨éå¸¸å¹¿æ³›ï¼Œ æ¯”å¦‚åˆ—è¡¨é”®çš„åº•å±‚å®ç°ä¹‹ä¸€å°±æ˜¯é“¾è¡¨ï¼š å½“ä¸€ä¸ªåˆ—è¡¨é”®åŒ…å«äº†æ•°é‡æ¯”è¾ƒå¤šçš„å…ƒç´ ï¼Œ åˆæˆ–è€…åˆ—è¡¨ä¸­åŒ…å«çš„å…ƒç´ éƒ½æ˜¯æ¯”è¾ƒé•¿çš„å­—ç¬¦ä¸²æ—¶ï¼Œ Redis å°±ä¼šä½¿ç”¨é“¾è¡¨ä½œä¸ºåˆ—è¡¨é”®çš„åº•å±‚å®ç°ã€‚</p>
<span id="more"></span>

<p>ç”±äºCè¯­è¨€è‡ªèº«æ²¡æœ‰é“¾è¡¨çš„å®ç°ï¼Œredis è‡ªå®šå®šä¹‰äº†ä¸€å¥—é“¾è¡¨çš„å®ç°</p>
<h1 id="é“¾è¡¨çš„å®šä¹‰"><a href="#é“¾è¡¨çš„å®šä¹‰" class="headerlink" title="é“¾è¡¨çš„å®šä¹‰"></a>é“¾è¡¨çš„å®šä¹‰</h1><p>æ¯ä¸ªé“¾è¡¨èŠ‚ç‚¹ä½¿ç”¨ä¸€ä¸ª <code>adlist.h/listNode</code> ç»“æ„æ¥è¡¨ç¤ºï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">listNode</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‰ç½®èŠ‚ç‚¹</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">listNode</span> *<span class="title">prev</span>;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// åç½®èŠ‚ç‚¹</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">listNode</span> *<span class="title">next</span>;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// èŠ‚ç‚¹çš„å€¼</span></span><br><span class="line">    <span class="type">void</span> *value;</span><br><span class="line"></span><br><span class="line">&#125; listNode;</span><br></pre></td></tr></table></figure>

<p>å¤šä¸ª <code>listNode</code> å¯ä»¥é€šè¿‡ <code>prev</code> å’Œ <code>next</code> æŒ‡é’ˆç»„æˆåŒç«¯é“¾è¡¨</p>
<img src="https://blog-image-1253555052.cos.ap-guangzhou.myqcloud.com/20200316215937.png" alt="é“¾è¡¨" style="zoom:200%;" />

<p>redis è¿˜æœ‰ä¸€ä¸ªæ•°æ®ç»“æ„æ¥ç®€åŒ–é“¾è¡¨çš„æ“ä½œ</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">ypedef <span class="class"><span class="keyword">struct</span> <span class="title">list</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¡¨å¤´èŠ‚ç‚¹</span></span><br><span class="line">    listNode *head;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¡¨å°¾èŠ‚ç‚¹</span></span><br><span class="line">    listNode *tail;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é“¾è¡¨æ‰€åŒ…å«çš„èŠ‚ç‚¹æ•°é‡</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> len;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// èŠ‚ç‚¹å€¼å¤åˆ¶å‡½æ•°</span></span><br><span class="line">    <span class="type">void</span> *(*dup)(<span class="type">void</span> *ptr);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// èŠ‚ç‚¹å€¼é‡Šæ”¾å‡½æ•°</span></span><br><span class="line">    <span class="type">void</span> (*<span class="built_in">free</span>)(<span class="type">void</span> *ptr);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// èŠ‚ç‚¹å€¼å¯¹æ¯”å‡½æ•°</span></span><br><span class="line">    <span class="type">int</span> (*match)(<span class="type">void</span> *ptr, <span class="type">void</span> *key);</span><br><span class="line"></span><br><span class="line">&#125; <span class="built_in">list</span>;</span><br></pre></td></tr></table></figure>

<p><code>list</code> ç»“æ„ä¸ºé“¾è¡¨æä¾›äº†è¡¨å¤´æŒ‡é’ˆ <code>head</code> ã€è¡¨å°¾æŒ‡é’ˆ <code>tail</code> ï¼Œ ä»¥åŠé“¾è¡¨é•¿åº¦è®¡æ•°å™¨ <code>len</code> ï¼Œ è€Œ <code>dup</code> ã€ <code>free</code> å’Œ <code>match</code> æˆå‘˜åˆ™æ˜¯ç”¨äºå®ç°å¤šæ€é“¾è¡¨æ‰€éœ€çš„ç±»å‹ç‰¹å®šå‡½æ•°ï¼š</p>
<ul>
<li><code>dup</code> å‡½æ•°ç”¨äºå¤åˆ¶é“¾è¡¨èŠ‚ç‚¹æ‰€ä¿å­˜çš„å€¼ï¼›</li>
<li><code>free</code> å‡½æ•°ç”¨äºé‡Šæ”¾é“¾è¡¨èŠ‚ç‚¹æ‰€ä¿å­˜çš„å€¼ï¼›</li>
<li><code>match</code> å‡½æ•°åˆ™ç”¨äºå¯¹æ¯”é“¾è¡¨èŠ‚ç‚¹æ‰€ä¿å­˜çš„å€¼å’Œå¦ä¸€ä¸ªè¾“å…¥å€¼æ˜¯å¦ç›¸ç­‰ã€‚</li>
</ul>
<p><img src="https://blog-image-1253555052.cos.ap-guangzhou.myqcloud.com/20200316220205.png"></p>
<p>Redis çš„é“¾è¡¨å®ç°çš„ç‰¹æ€§å¯ä»¥æ€»ç»“å¦‚ä¸‹ï¼š</p>
<ul>
<li>åŒç«¯ï¼š é“¾è¡¨èŠ‚ç‚¹å¸¦æœ‰ <code>prev</code> å’Œ <code>next</code> æŒ‡é’ˆï¼Œ è·å–æŸä¸ªèŠ‚ç‚¹çš„å‰ç½®èŠ‚ç‚¹å’Œåç½®èŠ‚ç‚¹çš„å¤æ‚åº¦éƒ½æ˜¯ O(1) ã€‚</li>
<li>æ— ç¯ï¼š è¡¨å¤´èŠ‚ç‚¹çš„ <code>prev</code> æŒ‡é’ˆå’Œè¡¨å°¾èŠ‚ç‚¹çš„ <code>next</code> æŒ‡é’ˆéƒ½æŒ‡å‘ <code>NULL</code> ï¼Œ å¯¹é“¾è¡¨çš„è®¿é—®ä»¥ <code>NULL</code> ä¸ºç»ˆç‚¹ã€‚</li>
<li>å¸¦è¡¨å¤´æŒ‡é’ˆå’Œè¡¨å°¾æŒ‡é’ˆï¼š é€šè¿‡ <code>list</code> ç»“æ„çš„ <code>head</code> æŒ‡é’ˆå’Œ <code>tail</code> æŒ‡é’ˆï¼Œ ç¨‹åºè·å–é“¾è¡¨çš„è¡¨å¤´èŠ‚ç‚¹å’Œè¡¨å°¾èŠ‚ç‚¹çš„å¤æ‚åº¦ä¸º O(1) ã€‚</li>
<li>å¸¦é“¾è¡¨é•¿åº¦è®¡æ•°å™¨ï¼š ç¨‹åºä½¿ç”¨ <code>list</code> ç»“æ„çš„ <code>len</code> å±æ€§æ¥å¯¹ <code>list</code> æŒæœ‰çš„é“¾è¡¨èŠ‚ç‚¹è¿›è¡Œè®¡æ•°ï¼Œ ç¨‹åºè·å–é“¾è¡¨ä¸­èŠ‚ç‚¹æ•°é‡çš„å¤æ‚åº¦ä¸º O(1) ã€‚</li>
<li>å¤šæ€ï¼š é“¾è¡¨èŠ‚ç‚¹ä½¿ç”¨ <code>void*</code> æŒ‡é’ˆæ¥ä¿å­˜èŠ‚ç‚¹å€¼ï¼Œ å¹¶ä¸”å¯ä»¥é€šè¿‡ <code>list</code> ç»“æ„çš„ <code>dup</code> ã€ <code>free</code> ã€ <code>match</code> ä¸‰ä¸ªå±æ€§ä¸ºèŠ‚ç‚¹å€¼è®¾ç½®ç±»å‹ç‰¹å®šå‡½æ•°ï¼Œ æ‰€ä»¥é“¾è¡¨å¯ä»¥ç”¨äºä¿å­˜å„ç§ä¸åŒç±»å‹çš„å€¼ã€‚</li>
</ul>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><ul>
<li>é“¾è¡¨è¢«å¹¿æ³›ç”¨äºå®ç° Redis çš„å„ç§åŠŸèƒ½ï¼Œ æ¯”å¦‚åˆ—è¡¨é”®ï¼Œ å‘å¸ƒä¸è®¢é˜…ï¼Œ æ…¢æŸ¥è¯¢ï¼Œ ç›‘è§†å™¨ï¼Œ ç­‰ç­‰ã€‚</li>
<li>æ¯ä¸ªé“¾è¡¨èŠ‚ç‚¹ç”±ä¸€ä¸ª <code>listNode</code> ç»“æ„æ¥è¡¨ç¤ºï¼Œ æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªæŒ‡å‘å‰ç½®èŠ‚ç‚¹å’Œåç½®èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œ æ‰€ä»¥ Redis çš„é“¾è¡¨å®ç°æ˜¯åŒç«¯é“¾è¡¨ã€‚</li>
<li>æ¯ä¸ªé“¾è¡¨ä½¿ç”¨ä¸€ä¸ª <code>list</code> ç»“æ„æ¥è¡¨ç¤ºï¼Œ è¿™ä¸ªç»“æ„å¸¦æœ‰è¡¨å¤´èŠ‚ç‚¹æŒ‡é’ˆã€è¡¨å°¾èŠ‚ç‚¹æŒ‡é’ˆã€ä»¥åŠé“¾è¡¨é•¿åº¦ç­‰ä¿¡æ¯ã€‚</li>
<li>å› ä¸ºé“¾è¡¨è¡¨å¤´èŠ‚ç‚¹çš„å‰ç½®èŠ‚ç‚¹å’Œè¡¨å°¾èŠ‚ç‚¹çš„åç½®èŠ‚ç‚¹éƒ½æŒ‡å‘ <code>NULL</code> ï¼Œ æ‰€ä»¥ Redis çš„é“¾è¡¨å®ç°æ˜¯æ— ç¯é“¾è¡¨ã€‚</li>
<li>é€šè¿‡ä¸ºé“¾è¡¨è®¾ç½®ä¸åŒçš„ç±»å‹ç‰¹å®šå‡½æ•°ï¼ˆæŒ‡é’ˆï¼‰ï¼Œ Redis çš„é“¾è¡¨å¯ä»¥ç”¨äºä¿å­˜å„ç§ä¸åŒç±»å‹çš„å€¼ã€‚</li>
</ul>
<p>å‚è€ƒæ–‡æ¡£ï¼š</p>
<ol>
<li>ã€Š<a href="http://redisbook.com/preview/adlist/implementation.html">redis è®¾è®¡ä¸å®ç°</a>ã€‹</li>
</ol>
]]></content>
      <categories>
        <category>redis</category>
      </categories>
      <tags>
        <tag>redis</tag>
      </tags>
  </entry>
  <entry>
    <title>èŠèŠredis sds</title>
    <url>/2022/09/30/%E8%81%8A%E8%81%8Aredis%20sds/</url>
    <content><![CDATA[<p>SDSå…¨æ‹¼ä¸ºï¼š<code>simple dynamic string</code>ï¼Œè§£é‡Šä¸ºï¼šç®€å•åŠ¨æ€å­—ç¬¦ä¸²</p>
<p>â€‹    Cè¯­è¨€å­—ç¬¦ä¸²ä½¿ç”¨é•¿åº¦ä¸ºn+1çš„å­—ç¬¦æ•°ç»„æ¥è¡¨ç¤ºé•¿åº¦ä¸ºnçš„å­—ç¬¦ä¸²ï¼Œå¹¶ä¸”å­—ç¬¦æ•°ç»„çš„æœ€åä¸€ä¸ªå…ƒç´ æ€»æ˜¯ç©ºå­—ç¬¦â€™\0â€™ï¼Œå› ä¸ºè¿™ç§å­—ç¬¦ä¸²è¡¨ç¤ºæ–¹å¼ä¸èƒ½æ»¡è¶³Rediså¯¹å­—ç¬¦ä¸²åœ¨å®‰å…¨æ€§ã€æ•ˆç‡ä»¥åŠåŠŸèƒ½æ–¹é¢çš„è¦æ±‚ï¼Œæ‰€ä»¥Redisè‡ªå·±æ„å»ºäº†SDSï¼Œç”¨äºæ»¡è¶³å…¶éœ€æ±‚ã€‚åœ¨Redisé‡Œï¼ŒCè¯­è¨€å­—ç¬¦ä¸²åªç”¨äºä¸€äº›æ— é¡»å¯¹å­—ç¬¦ä¸²å€¼è¿›è¡Œä¿®æ”¹çš„åœ°æ–¹ï¼Œæ¯”å¦‚ï¼šæ—¥å¿—ã€‚åœ¨Redisä¸­ï¼ŒåŒ…å«å­—ç¬¦ä¸²å€¼çš„é”®å€¼å¯¹éƒ½æ˜¯ä½¿ç”¨SDSå®ç°çš„ï¼Œé™¤æ­¤ä¹‹å¤–ï¼ŒSDSè¿˜è¢«ç”¨äºAOFç¼“å†²åŒºã€å®¢æˆ·ç«¯çŠ¶æ€çš„è¾“å…¥ç¼“å†²åŒºã€‚</p>
<span id="more"></span>

<h1 id="SDSå®šä¹‰"><a href="#SDSå®šä¹‰" class="headerlink" title="SDSå®šä¹‰"></a>SDSå®šä¹‰</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">struct sdshdr&#123;</span><br><span class="line">     //å­—èŠ‚æ•°ç»„</span><br><span class="line">     char buf[]; </span><br><span class="line">     //bufæ•°ç»„ä¸­å·²ä½¿ç”¨å­—èŠ‚æ•°é‡</span><br><span class="line">     int len;</span><br><span class="line">     //bufæ•°ç»„ä¸­æœªä½¿ç”¨å­—èŠ‚æ•°é‡</span><br><span class="line">     int free;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/../../../%E6%88%91%E7%9A%84%E5%9D%9A%E6%9E%9C%E4%BA%91/Typro%20%E6%96%87%E6%A1%A3%E5%BA%93/%E5%9B%BE%E7%89%87/20200313213825.png"></p>
<p>â€‹    ä¸Šå›¾å±•ç¤ºäº†ä¸€ä¸ªSDSå®ä¾‹ï¼Œlenè¡¨ç¤ºè¯¥SDSä¿å­˜äº†ä¸€ä¸ª5å­—èŠ‚é•¿åº¦ï¼ˆä¸åŒ…å«ç»“æŸç¬¦ï¼‰çš„å­—ç¬¦ä¸²ï¼Œfreeè¡¨ç¤ºè¯¥SDSè¿˜æœ‰5ä¸ªå­—èŠ‚çš„æœªä½¿ç”¨ç©ºé—´ï¼Œbufæ˜¯ä¸€ä¸ªcharç±»å‹çš„æ•°ç»„ï¼Œä¿å­˜äº†è¯¥SDSæ‰€å­˜å‚¨çš„å­—ç¬¦ä¸²å€¼</p>
<h1 id="ä¸ºä»€ä¹ˆä½¿ç”¨SDS"><a href="#ä¸ºä»€ä¹ˆä½¿ç”¨SDS" class="headerlink" title="ä¸ºä»€ä¹ˆä½¿ç”¨SDS"></a><strong>ä¸ºä»€ä¹ˆä½¿ç”¨SDS</strong></h1><h2 id="1-ç›¸æ¯”Cè¯­è¨€å­—ç¬¦ä¸²ï¼Œä½¿è·å–å­—ç¬¦ä¸²é•¿åº¦æ—¶é—´å¤æ‚åº¦é™ä¸ºO-1"><a href="#1-ç›¸æ¯”Cè¯­è¨€å­—ç¬¦ä¸²ï¼Œä½¿è·å–å­—ç¬¦ä¸²é•¿åº¦æ—¶é—´å¤æ‚åº¦é™ä¸ºO-1" class="headerlink" title="1. ç›¸æ¯”Cè¯­è¨€å­—ç¬¦ä¸²ï¼Œä½¿è·å–å­—ç¬¦ä¸²é•¿åº¦æ—¶é—´å¤æ‚åº¦é™ä¸ºO(1)"></a><strong>1. ç›¸æ¯”Cè¯­è¨€å­—ç¬¦ä¸²ï¼Œä½¿è·å–å­—ç¬¦ä¸²é•¿åº¦æ—¶é—´å¤æ‚åº¦é™ä¸ºO(1)</strong></h2><p>â€‹    Cè¯­è¨€å­—ç¬¦ä¸²ä¸è®°å½•è‡ªèº«é•¿åº¦ï¼Œå¦‚æœæƒ³è·å–è‡ªèº«é•¿åº¦å¿…é¡»éå†æ•´ä¸ªå­—ç¬¦ä¸²ï¼Œå¯¹æ¯ä¸ªå­—ç¬¦è¿›è¡Œè®¡æ•°ï¼Œè¿™ä¸ªæ“ä½œæ—¶é—´å¤æ‚åº¦æ˜¯O(n)ã€‚ç›¸æ¯”è¾ƒè€Œè¨€ï¼ŒRedisç¨‹åºåªè¦è®¿é—®SDSçš„lenå±æ€§å°±å¯ä»¥ç›´æ¥è·å–åˆ°å­—ç¬¦ä¸²é•¿åº¦ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(1)ï¼Œç¡®ä¿è·å–å­—ç¬¦ä¸²é•¿åº¦ä¸ä¼šæˆä¸ºRedisæ€§èƒ½ç“¶é¢ˆï¼Œæ¯”å¦‚å¯¹å­—ç¬¦ä¸²é”®åå¤æ‰§è¡Œstrlenå‘½ä»¤ã€‚å¦‚ï¼šè·å–â€œRedisâ€å­—ç¬¦ä¸²é•¿åº¦æ—¶ç¨‹åºä¼šç›´æ¥è®¿é—®lenå±æ€§å³å¯ï¼Œè¯¥å­—ç¬¦ä¸²é•¿åº¦ä¸º5ã€‚</p>
<h2 id="2-æœç»ç¼“å†²åŒºæº¢å‡º"><a href="#2-æœç»ç¼“å†²åŒºæº¢å‡º" class="headerlink" title="2. æœç»ç¼“å†²åŒºæº¢å‡º"></a><strong>2. æœç»ç¼“å†²åŒºæº¢å‡º</strong></h2><p>â€‹    å‡è®¾ç¨‹åºé‡Œæœ‰ä¸¤ä¸ªåœ¨å†…å­˜ä¸­ç´§é‚»çš„å­—ç¬¦ä¸²s1å’Œs2ï¼Œs1çš„å€¼ä¸ºRedisï¼Œåº•å±‚æ•°ç»„çš„å€¼ä¸º[â€˜Râ€™,â€™eâ€™,â€™dâ€™,â€™iâ€™,â€™sâ€™,â€™\0â€™]ï¼Œs2çš„å€¼ä¸ºMemcacheï¼Œåº•å±‚æ•°ç»„çš„å€¼ä¸º[â€˜Mâ€™,â€™eâ€™,â€™mâ€™,â€™câ€™,â€™aâ€™,â€™câ€™,â€™hâ€™,â€™eâ€™,â€™\0â€™]ï¼Œåœ¨Cè¯­è¨€ä¸­å¦‚æœè¦æ‰§è¡Œstrcat(s1, â€œ clusterâ€)æŠŠs1ä¿®æ”¹ä¸ºRedis clusterï¼Œå¦‚æœå¿˜è®°åœ¨æ‰§è¡Œstrcatå‘½ä»¤ä¹‹å‰ä¸ºs1é‡æ–°åˆ†é…ç©ºé—´ï¼Œé‚£ä¹ˆåœ¨æ‰§è¡Œå®Œstrcatå‘½ä»¤ä¹‹åï¼Œs1åº•å±‚æ•°ç»„çš„å€¼å˜ä¸º[â€˜Râ€™,â€™eâ€™,â€™dâ€™,â€™iâ€™,â€™sâ€™,â€™ â€˜,â€™câ€™,â€™lâ€™,â€™uâ€™,â€™sâ€™,â€™tâ€™,â€™eâ€™,â€™râ€™,â€™\0â€™]ï¼Œs2åº•å±‚æ•°ç»„çš„å€¼å˜ä¸º[â€˜câ€™,â€™lâ€™,â€™uâ€™,â€™sâ€™,â€™tâ€™,â€™eâ€™,â€™râ€™,â€™\0â€™,â€™\0â€™]ï¼Œs1çš„æ•°æ®æº¢å‡ºåˆ°s2æ‰€åœ¨çš„å†…å­˜ç©ºé—´ï¼Œs2çš„å€¼è¢«æ„å¤–ä¿®æ”¹ã€‚ä¸Cè¯­è¨€ä¸åŒï¼Œå½“SDS APIéœ€è¦å¯¹SDSè¿›è¡Œä¿®æ”¹æ—¶ï¼ŒAPIä¼šå…ˆæ£€æŸ¥SDSå½“å‰å‰©ä½™ç©ºé—´æ˜¯å¦æ»¡è¶³ä¿®æ”¹ä¹‹åæ‰€éœ€çš„ç©ºé—´ï¼Œå¦‚æœä¸æ»¡è¶³çš„è¯APIä¼šè‡ªåŠ¨å°†SDSçš„ç©ºé—´æ‰©å±•è‡³ä¿®æ”¹ä¹‹åæ‰€éœ€ç©ºé—´å¤§å°ï¼Œç„¶åå†æ‰§è¡Œå®é™…çš„ä¿®æ”¹æ“ä½œï¼Œæ‰€ä»¥SDSä¸ä¼šå‡ºç°ç¼“å†²åŒºæº¢å‡ºé—®é¢˜ã€‚ï¼ˆç¼“å†²åŒºæ‰©å……å¹¶éæ˜¯ç›´æ¥æ‰©å……åˆ°æ‰€éœ€è¦çš„ç©ºé—´å¤§å°ï¼Œå®ƒå’ŒSDSç©ºé—´åˆ†é…ç­–ç•¥æœ‰å…³ï¼Œå‚è§ä¸‹ä¸€å°èŠ‚ï¼‰</p>
<h2 id="3-å‡å°‘ä¿®æ”¹å­—ç¬¦ä¸²æ—¶å¸¦æ¥çš„å†…å­˜é‡åˆ†é…æ¬¡æ•°"><a href="#3-å‡å°‘ä¿®æ”¹å­—ç¬¦ä¸²æ—¶å¸¦æ¥çš„å†…å­˜é‡åˆ†é…æ¬¡æ•°" class="headerlink" title="3. å‡å°‘ä¿®æ”¹å­—ç¬¦ä¸²æ—¶å¸¦æ¥çš„å†…å­˜é‡åˆ†é…æ¬¡æ•°"></a><strong>3. å‡å°‘ä¿®æ”¹å­—ç¬¦ä¸²æ—¶å¸¦æ¥çš„å†…å­˜é‡åˆ†é…æ¬¡æ•°</strong></h2><p>â€‹    Cè¯­è¨€å­—ç¬¦ä¸²åº•å±‚æ˜¯ä½¿ç”¨ä¸€ä¸ªn+1ä¸ªå­—ç¬¦é•¿åº¦çš„charç±»å‹æ•°æ®å®ç°çš„ï¼Œæ‰€ä»¥æ¯æ¬¡å¢é•¿æˆ–ç¼©çŸ­ä¸€ä¸ªCè¯­è¨€å­—ç¬¦ä¸²ï¼Œç¨‹åºéƒ½è¦å¯¹è¿™ä¸ªå­—ç¬¦ä¸²æ•°ç»„è¿›è¡Œä¸€æ¬¡å†…å­˜é‡åˆ†é…æ“ä½œï¼š</p>
<ol>
<li>å¦‚æœç¨‹åºæ‰§è¡Œçš„æ˜¯å¢é•¿å­—ç¬¦ä¸²æ“ä½œï¼Œæ¯”å¦‚strcatæ“ä½œï¼Œåœ¨æ‰§è¡Œè¿™ä¸ªæ“ä½œä¹‹å‰éœ€è¦é€šè¿‡å†…å­˜é‡åˆ†é…æ‰©å±•åº•å±‚æ•°ç»„ï¼Œå¦‚æœå¿˜è®°äº†åˆ™ä¼šé€ æˆç¼“å†²åŒºæº¢å‡ºã€‚</li>
<li>å¦‚æœç¨‹åºæ‰§è¡Œçš„æ˜¯ç¼©çŸ­å­—ç¬¦ä¸²æ“ä½œï¼Œæ¯”å¦‚trimæ“ä½œï¼Œåœ¨æ‰§è¡Œè¿™ä¸ªæ“ä½œä¹‹å‰éœ€è¦é€šè¿‡å†…å­˜é‡åˆ†é…é‡Šæ”¾å­—ç¬¦ä¸²ä¸å†ä½¿ç”¨çš„å†…å­˜ç©ºé—´ï¼Œå¦‚æœå¿˜è®°äº†åˆ™ä¼šé€ æˆå†…å­˜æ³„æ¼ã€‚</li>
</ol>
<p>â€‹            å› ä¸ºå†…å­˜é‡åˆ†é…æ¶‰åŠå¤æ‚çš„ç®—æ³•ï¼Œå¹¶ä¸”å¯èƒ½éœ€è¦æ‰§è¡Œç³»ç»Ÿè°ƒç”¨ï¼Œæ‰€ä»¥å®ƒé€šå¸¸æ˜¯ä¸€ä¸ªæ¯”è¾ƒè€—æ—¶çš„æ“ä½œã€‚Redisç»å¸¸è¢«ç”¨äºé€Ÿåº¦è¦æ±‚ä¸¥è‹›ã€æ•°æ®è¢«é¢‘ç¹ä¿®æ”¹çš„åœºåˆï¼Œå¦‚æœæ¯æ¬¡ä¿®æ”¹å­—ç¬¦ä¸²éƒ½éœ€è¦æ‰§è¡Œä¸€æ¬¡å†…å­˜é‡åˆ†é…çš„è¯ï¼Œé‚£ä¹ˆå¯¹äºæ€§èƒ½ä¼šé€ æˆå¾ˆå¤§å½±å“ã€‚</p>
<p>â€‹            åœ¨SDSä¸­é€šè¿‡æœªä½¿ç”¨ç©ºé—´è§£é™¤äº†å­—ç¬¦ä¸²é•¿åº¦å’Œåº•å±‚æ•°ç»„é•¿åº¦ä¹‹é—´çš„å…³è”ï¼Œåœ¨SDSä¸­ï¼Œbufæ•°ç»„é•¿åº¦ä¸ä¸€å®šæ˜¯å­—ç¬¦ä¸²é•¿åº¦åŠ 1ï¼Œæ•°ç»„ä¸­å¯èƒ½åŒ…å«æœªä½¿ç”¨çš„å­—èŠ‚ï¼Œè¿™äº›å­—èŠ‚çš„æ•°é‡å°±æ˜¯ç”±SDSçš„freeå±æ€§è®°å½•ã€‚é€šè¿‡æœªä½¿ç”¨ç©ºé—´ï¼ŒSDSå®ç°äº†ç©ºé—´é¢„åˆ†é…å’Œæƒ°æ€§ç©ºé—´é‡Šæ”¾ä¸¤ç§ä¼˜åŒ–ç­–ç•¥ã€‚</p>
<h3 id="3-1-ç©ºé—´é¢„åˆ†é…"><a href="#3-1-ç©ºé—´é¢„åˆ†é…" class="headerlink" title="3.1 ç©ºé—´é¢„åˆ†é…"></a><strong>3.1 ç©ºé—´é¢„åˆ†é…</strong></h3><p>â€‹    ç”¨äºå­—ç¬¦ä¸²å¢é•¿æ“ä½œï¼Œå½“å­—ç¬¦ä¸²å¢é•¿æ—¶ï¼Œç¨‹åºä¼šå…ˆæ£€æŸ¥éœ€ä¸éœ€è¦å¯¹SDSç©ºé—´è¿›è¡Œæ‰©å±•ï¼Œå¦‚æœéœ€è¦æ‰©å±•ï¼Œç¨‹åºä¸ä»…ä¼šä¸ºSDSåˆ†é…ä¿®æ”¹æ‰€å¿…è¦çš„ç©ºé—´ï¼Œè¿˜ä¼šä¸ºSDSåˆ†é…é¢å¤–çš„æœªä½¿ç”¨ç©ºé—´ï¼Œé¢å¤–åˆ†é…çš„æœªä½¿ç”¨ç©ºé—´å…¬å¼å¦‚ä¸‹ï¼š</p>
<ol>
<li>å¦‚æœå¯¹SDSä¿®æ”¹ä¹‹åï¼ŒSDSçš„é•¿åº¦ï¼ˆä¿®æ”¹ä¹‹ålenå±æ€§çš„å€¼ï¼‰å°äº1MBï¼Œé‚£ä¹ˆåˆ™åˆ†é…å’Œlenå±æ€§åŒæ ·å¤§å°çš„æœªä½¿ç”¨ç©ºé—´ï¼Œè¿™æ—¶SDSçš„lenå±æ€§å’Œfreeå±æ€§çš„å€¼ç›¸åŒã€‚å¦‚ï¼šå¦‚æœä¿®æ”¹ä¹‹åSDSçš„lenå°†å˜ä¸º10å­—èŠ‚ï¼Œé‚£ä¹ˆç¨‹åºä¹Ÿä¼šåˆ†é…10å­—èŠ‚çš„æœªä½¿ç”¨ç©ºé—´ï¼ŒSDSçš„bufæ•°ç»„å®é™…é•¿åº¦å˜ä¸º10 + 10 + 1 &#x3D; 21ï¼ˆé¢å¤–ä¸€ä¸ªå­—èŠ‚ç”¨äºä¿å­˜ç»“æŸç¬¦\nï¼‰</li>
<li>å¦‚æœå¯¹SDSä¿®æ”¹ä¹‹åï¼ŒSDSçš„é•¿åº¦å¤§äºç­‰äº1MBï¼Œé‚£ä¹ˆç¨‹åºä¼šåˆ†é…1MBçš„æœªä½¿ç”¨ç©ºé—´ã€‚å¦‚ï¼šä¿®æ”¹ä¹‹åçš„lenå°†å˜ä¸º10MBï¼Œé‚£ä¹ˆç¨‹åºä¼šåˆ†é…1MBçš„æœªä½¿ç”¨ç©ºé—´ï¼ŒSDSçš„bugæ•°ç»„é•¿åº¦ä¸º10MB + 1MB + 1byte</li>
</ol>
<h3 id="3-2-æƒ°æ€§ç©ºé—´é‡Šæ”¾"><a href="#3-2-æƒ°æ€§ç©ºé—´é‡Šæ”¾" class="headerlink" title="3.2 æƒ°æ€§ç©ºé—´é‡Šæ”¾"></a><strong>3.2 æƒ°æ€§ç©ºé—´é‡Šæ”¾</strong></h3><p>â€‹    ç”¨äºä¼˜åŒ–SDSçš„å­—ç¬¦ä¸²æ”¶ç¼©æ“ä½œï¼Œå½“å­—ç¬¦ä¸²æ”¶ç¼©æ—¶ï¼Œç¨‹åºä¸ä¼šç«‹å³æ‰§è¡Œå†…å­˜é‡åˆ†é…æ¥å›æ”¶æ”¶ç¼©åå†…å­˜å¤šå‡ºæ¥çš„ç©ºé—´ï¼Œè€Œæ˜¯ä½¿ç”¨freeå±æ€§è®°å½•ä¸‹æ¥ï¼Œä»¥å¤‡å°†æ¥ä½¿ç”¨ã€‚</p>
<p><img src="/../../../%E6%88%91%E7%9A%84%E5%9D%9A%E6%9E%9C%E4%BA%91/Typro%20%E6%96%87%E6%A1%A3%E5%BA%93/%E5%9B%BE%E7%89%87/20200313213934.png"></p>
<p><img src="/../../../%E6%88%91%E7%9A%84%E5%9D%9A%E6%9E%9C%E4%BA%91/Typro%20%E6%96%87%E6%A1%A3%E5%BA%93/%E5%9B%BE%E7%89%87/20200313213920.png"></p>
<p>â€‹    é€šè¿‡ç©ºé—´é¢„åˆ†é…ï¼ŒRediså¯ä»¥å‡å°‘è¿ç»­æ‰§è¡Œå­—ç¬¦ä¸²å¢é•¿æ“ä½œæ‰€éœ€çš„å†…å­˜é‡åˆ†é…æ¬¡æ•°ï¼Œé€šè¿‡æƒ°æ€§ç©ºé—´é‡Šæ”¾ï¼ŒSDSé¿å…äº†ç¼©çŸ­å­—ç¬¦ä¸²æ—¶æ‰€éœ€çš„å†…å­˜é‡åˆ†é…æ“ä½œï¼Œå¹¶ä¸ºå°†æ¥ç”±å¯èƒ½çš„å¢é•¿æ“ä½œæä¾›äº†ä¼˜åŒ–ã€‚</p>
<h3 id="3-3-äºŒè¿›åˆ¶å®‰å…¨"><a href="#3-3-äºŒè¿›åˆ¶å®‰å…¨" class="headerlink" title="3.3 äºŒè¿›åˆ¶å®‰å…¨"></a>3.3 äºŒè¿›åˆ¶å®‰å…¨</h3><p>Cè¯­è¨€çš„å­—ç¬¦ä¸²ä¸èƒ½ä½¿ç”¨\0ç»“å°¾ï¼Œå¯¼è‡´Cè¯­è¨€å­—ç¬¦ä¸²ä¸èƒ½ä¿å­˜ å›¾ç‰‡ç­‰äºŒè¿›åˆ¶æ•°æ®ã€‚</p>
<p>redis ä½¿ç”¨å­—ç¬¦æ•°ç»„æ¥ä¿å­˜å­—ç¬¦ä¸²ï¼Œä¸ä¼šå¯¹æ•°æ®åšä»»ä½•é™åˆ¶ã€è¿‡æ»¤ã€å‡è®¾ï¼Œä½¿å¾—rediså…¼å®¹æ€§æ›´å¼ºã€‚</p>
]]></content>
      <categories>
        <category>redis</category>
      </categories>
      <tags>
        <tag>redis</tag>
      </tags>
  </entry>
  <entry>
    <title>æˆ‘åœ¨13å¹´åå¦‚ä½•ç¼–å†™Goçš„HTTPæœåŠ¡|Grafana Labs</title>
    <url>/2024/02/16/%E6%88%91%E5%9C%A813%E5%B9%B4%E5%90%8E%E5%A6%82%E4%BD%95%E7%BC%96%E5%86%99Go%E7%9A%84HTTP%E6%9C%8D%E5%8A%A1%20Grafana%20Labs/</url>
    <content><![CDATA[<p>å°†è¿‘å…­å¹´å‰ï¼Œæˆ‘å†™äº†ä¸€ç¯‡åšå®¢æ–‡ç« ï¼Œæ¦‚è¿°äº†<a href="https://pace.dev/blog/2018/05/09/how-I-write-http-services-after-eight-years.html">æˆ‘å¦‚ä½•ç¼–å†™Goçš„HTTPæœåŠ¡</a>ï¼Œç°åœ¨ï¼Œæˆ‘å†æ¬¡å‘Šè¯‰ä½ ï¼Œæˆ‘å¦‚ä½•ç¼–å†™HTTPæœåŠ¡ã€‚</p>
<span id="more"></span>

<hr>
<blockquote>
<p>Grafana Labsçš„é¦–å¸­å·¥ç¨‹å¸ˆã€Go Timeæ’­å®¢çš„ä¸»æŒäººMat Ryeråˆ†äº«äº†ä»–åœ¨ç¼–å†™Goçš„HTTPæœåŠ¡æ–¹é¢è¶…è¿‡åå‡ å¹´çš„ç»éªŒã€‚<br>åŸæ–‡é“¾æ¥ï¼š<a href="https://grafana.com/blog/2024/02/09/how-i-write-http-services-in-go-after-13-years/">https://grafana.com/blog/2024/02/09/how-i-write-http-services-in-go-after-13-years/</a></p>
</blockquote>
<p>é‚£ç¯‡åŸå§‹çš„åšæ–‡å¼•å‘äº†ä¸€äº›çƒ­è®®ï¼Œå¯¹æˆ‘ç°åœ¨çš„ç¼–ç æ–¹å¼äº§ç”Ÿäº†ä¸€äº›å½±å“ã€‚ç»è¿‡å¤šå¹´ä¸»æŒ<a href="https://changelog.com/gotime">Go Timeæ’­å®¢</a>ã€åœ¨<a href="https://twitter.com/matryer">Twitter</a>ä¸Šè®¨è®ºGoã€ä»¥åŠåœ¨ç»´æŠ¤è¿™æ ·çš„ä»£ç æ–¹é¢ç§¯ç´¯äº†æ›´å¤šçš„ç»éªŒåï¼Œæˆ‘è§‰å¾—æ˜¯æ—¶å€™è¿›è¡Œä¸€æ¬¡æ›´æ–°äº†ã€‚</p>
<p>ï¼ˆå¯¹äºé‚£äº›æ³¨æ„åˆ°Goå¹¶ä¸å®Œå…¨æœ‰13å¹´å†å²çš„å­¦ç©¶ä»¬ï¼Œæˆ‘å¼€å§‹åœ¨Go <a href="https://go.dev/doc/devel/pre_go1#r59">ç‰ˆæœ¬ .r59</a>ä¸­ç¼–å†™HTTPæœåŠ¡ã€‚ï¼‰<br>æœ¬æ–‡æ¶µç›–äº†ä¸ä½¿ç”¨Goæ„å»ºæœåŠ¡ç›¸å…³çš„å„ç§ä¸»é¢˜ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>ä¸ºäº†æœ€å¤§é™åº¦åœ°æé«˜å¯ç»´æŠ¤æ€§è€Œæ„å»ºæœåŠ¡å™¨å’Œå¤„ç†ç¨‹åºçš„ç»“æ„</li>
<li>ä¼˜åŒ–å¿«é€Ÿå¯åŠ¨å’Œä¼˜é›…å…³é—­çš„æŠ€å·§å’Œçªé—¨</li>
<li>å¦‚ä½•å¤„ç†é€‚ç”¨äºå¤šç§ç±»å‹è¯·æ±‚çš„å¸¸è§å·¥ä½œ</li>
<li>æ·±å…¥æ¢è®¨å¦‚ä½•æ­£ç¡®æµ‹è¯•æ‚¨çš„æœåŠ¡</li>
</ul>
<p>ä»å°å‹é¡¹ç›®åˆ°å¤§å‹é¡¹ç›®ï¼Œè¿™äº›å®è·µå¯¹æˆ‘æ¥è¯´ç»å—ä½äº†æ—¶é—´çš„è€ƒéªŒï¼Œæˆ‘å¸Œæœ›å®ƒä»¬å¯¹ä½ ä¹ŸåŒæ ·æœ‰æ•ˆã€‚</p>
<h2 id="è¿™ç¯‡æ–‡ç« é€‚åˆè°ï¼Ÿ"><a href="#è¿™ç¯‡æ–‡ç« é€‚åˆè°ï¼Ÿ" class="headerlink" title="è¿™ç¯‡æ–‡ç« é€‚åˆè°ï¼Ÿ"></a>è¿™ç¯‡æ–‡ç« é€‚åˆè°ï¼Ÿ</h2><p>è¿™ç¯‡æ–‡ç« é€‚åˆä½ ã€‚å®ƒé€‚ç”¨äºè®¡åˆ’ä½¿ç”¨Goç¼–å†™æŸç§ç±»å‹çš„HTTPæœåŠ¡çš„æ¯ä¸ªäººã€‚å¦‚æœä½ æ­£åœ¨å­¦ä¹ Goï¼Œä½ å¯èƒ½ä¼šå‘ç°è¿™ä¸ªæœ‰ç”¨ï¼Œå› ä¸ºå¾ˆå¤šç¤ºä¾‹éƒ½éµå¾ªäº†è‰¯å¥½çš„å®è·µã€‚æœ‰ç»éªŒçš„Goå¼€å‘è€…ä¹Ÿå¯èƒ½ä¼šå­¦åˆ°ä¸€äº›ä¸é”™çš„æ¨¡å¼ã€‚</p>
<p>è¦ä½¿è¿™ç¯‡æ–‡ç« å¯¹ä½ æœ€æœ‰ç”¨ï¼Œä½ éœ€è¦äº†è§£Goçš„åŸºç¡€çŸ¥è¯†ã€‚å¦‚æœä½ è§‰å¾—è‡ªå·±è¿˜æ²¡æœ‰æŒæ¡ï¼Œæˆ‘å¼ºçƒˆæ¨èé˜…è¯»Chris Jamesçš„<a href="https://quii.gitbook.io/learn-go-with-tests/">ã€Šé€šè¿‡æµ‹è¯•å­¦ä¹ Goã€‹</a>ã€‚å¦‚æœä½ æƒ³å¬æ›´å¤šå…³äºChrisçš„å†…å®¹ï¼Œä½ å¯ä»¥çœ‹çœ‹æˆ‘ä»¬åœ¨Go Timeä¸Šä¸Ben Johnsonä¸€èµ·è®¨è®ºçš„<a href="https://changelog.com/gotime/278">ã€ŠGoé¡¹ç›®çš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ã€‹</a>çš„é‚£ä¸€é›†ã€‚</p>
<p>å¦‚æœä½ ç†Ÿæ‚‰ä¹‹å‰ç‰ˆæœ¬çš„è¿™ç¯‡æ–‡ç« ï¼Œæœ¬èŠ‚å°†å¯¹ç°åœ¨çš„ä¸åŒä¹‹å¤„è¿›è¡Œäº†å¿«é€Ÿæ€»ç»“ã€‚å¦‚æœä½ æƒ³ä»å¤´å¼€å§‹é˜…è¯»ï¼Œå¯ä»¥è·³åˆ°ä¸‹ä¸€èŠ‚ã€‚</p>
<ol>
<li>æˆ‘çš„å¤„ç†ç¨‹åºè¿‡å»æ˜¯ä½œä¸ºæœåŠ¡å™¨ç»“æ„çš„æ–¹æ³•å­˜åœ¨çš„ï¼Œä½†ç°åœ¨æˆ‘ä¸å†è¿™æ ·åšäº†ã€‚å¦‚æœå¤„ç†ç¨‹åºå‡½æ•°éœ€è¦æŸä¸ªä¾èµ–é¡¹ï¼Œå®ƒå¯ä»¥ç›´æ¥ä½œä¸ºå‚æ•°ä¼ é€’ã€‚å½“ä½ åªæ˜¯æƒ³æµ‹è¯•å•ä¸ªå¤„ç†ç¨‹åºæ—¶ï¼Œä¸å†ä¼šå‡ºç°æ„å¤–çš„ä¾èµ–é¡¹ã€‚</li>
<li>æˆ‘è¿‡å»æ›´å–œæ¬¢ä½¿ç”¨<code>http.HandlerFunc</code>è€Œä¸æ˜¯<code>http.Handler</code>ï¼Œä½†ç°åœ¨å¤§å¤šæ•°ç¬¬ä¸‰æ–¹åº“éƒ½ä¼˜å…ˆè€ƒè™‘<code>http.Handler</code>ï¼Œæ‰€ä»¥é‡‡ç”¨å®ƒæ˜¯æœ‰é“ç†çš„ã€‚<code>http.HandlerFunc</code>ä»ç„¶éå¸¸æœ‰ç”¨ï¼Œä½†ç°åœ¨å¤§å¤šæ•°ä¸œè¥¿éƒ½è¡¨ç¤ºä¸ºæ¥å£ç±»å‹ã€‚æ— è®ºé€‰æ‹©å“ªç§æ–¹å¼ï¼Œéƒ½æ²¡æœ‰å¤ªå¤§åŒºåˆ«ã€‚</li>
<li>æˆ‘å¢åŠ äº†æ›´å¤šå…³äºæµ‹è¯•çš„å†…å®¹ï¼ŒåŒ…æ‹¬ä¸€äº›â€œæ„è§â€ã€‚</li>
<li>æˆ‘å¢åŠ äº†æ›´å¤šçš„ç« èŠ‚ï¼Œæ‰€ä»¥å»ºè®®æ¯ä¸ªäººéƒ½è¿›è¡Œå…¨é¢é˜…è¯»ã€‚</li>
</ol>
<h2 id="NewServeræ„é€ å‡½æ•°"><a href="#NewServeræ„é€ å‡½æ•°" class="headerlink" title="NewServeræ„é€ å‡½æ•°"></a><code>NewServer</code>æ„é€ å‡½æ•°</h2><p>è®©æˆ‘ä»¬é¦–å…ˆçœ‹ä¸€ä¸‹ä»»ä½•GoæœåŠ¡çš„æ ¸å¿ƒéƒ¨åˆ†ï¼šæœåŠ¡å™¨ã€‚<code>NewServer</code>å‡½æ•°åˆ›å»ºä¸»è¦çš„<code>http.Handler</code>ã€‚é€šå¸¸æˆ‘æ¯ä¸ªæœåŠ¡åªæœ‰ä¸€ä¸ª<code>NewServer</code>ï¼Œå¹¶ä¸”æˆ‘ä¾èµ–HTTPè·¯ç”±å°†æµé‡å¯¼å‘æ¯ä¸ªæœåŠ¡ä¸­çš„æ­£ç¡®å¤„ç†ç¨‹åºï¼ŒåŸå› å¦‚ä¸‹ï¼š</p>
<ul>
<li><code>NewServer</code>æ˜¯ä¸€ä¸ªå¤§å‹çš„æ„é€ å‡½æ•°ï¼Œå®ƒå°†æ‰€æœ‰ä¾èµ–é¡¹ä½œä¸ºå‚æ•°ä¼ å…¥</li>
<li>å¦‚æœå¯èƒ½çš„è¯ï¼Œå®ƒè¿”å›ä¸€ä¸ª<code>http.Handler</code>ï¼Œå¯¹äºæ›´å¤æ‚çš„æƒ…å†µå¯ä»¥æ˜¯ä¸€ä¸ªä¸“ç”¨ç±»å‹</li>
<li>å®ƒé€šå¸¸ä¼šé…ç½®è‡ªå·±çš„muxerå¹¶è°ƒç”¨<code>routes.go</code></li>
</ul>
<p>ä¾‹å¦‚ï¼Œä½ çš„ä»£ç å¯èƒ½ç±»ä¼¼äºä»¥ä¸‹ç¤ºä¾‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewServer</span><span class="params">(logger *Logger, config *Config, commentStore *commentStore, anotherStore *anotherStore)</span></span> http.Handler &#123;</span><br><span class="line">    mux := http.NewServeMux()</span><br><span class="line">    addRoutes(mux, logger, config, commentStore, anotherStore)</span><br><span class="line">    <span class="keyword">var</span> handler http.Handler = mux</span><br><span class="line">    handler = someMiddleware(handler)</span><br><span class="line">    handler = someMiddleware2(handler)</span><br><span class="line">    handler = someMiddleware3(handler)</span><br><span class="line">    <span class="keyword">return</span> handler</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨ä¸éœ€è¦æ‰€æœ‰ä¾èµ–é¡¹çš„æµ‹è¯•ç”¨ä¾‹ä¸­ï¼Œæˆ‘å°†<code>nil</code>ä½œä¸ºä¿¡å·ä¼ å…¥ï¼Œè¡¨ç¤ºä¸ä¼šä½¿ç”¨å®ƒä»¬ã€‚</p>
<p><code>NewServer</code>æ„é€ å‡½æ•°è´Ÿè´£é€‚ç”¨äºæ‰€æœ‰ç«¯ç‚¹çš„é¡¶å±‚HTTPå†…å®¹ï¼Œä¾‹å¦‚CORSã€èº«ä»½éªŒè¯ä¸­é—´ä»¶å’Œæ—¥å¿—è®°å½•ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> handler http.Handler = mux</span><br><span class="line">handler = logging.NewLoggingMiddleware(logger, handler)</span><br><span class="line">handler = logging.NewGoogleTraceIDMiddleware(logger, handler)</span><br><span class="line">handler = checkAuthHeaders(handler)</span><br><span class="line"><span class="keyword">return</span> handler</span><br></pre></td></tr></table></figure>

<p>é€šå¸¸ï¼Œé€šè¿‡ä½¿ç”¨Goçš„å†…ç½®<code>http</code>åŒ…å°†æœåŠ¡å™¨è®¾ç½®èµ·æ¥æ˜¯ä¸€ä¸ªç®€å•çš„è¿‡ç¨‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">srv := NewServer(logger, config, tenantsStore, slackLinkStore, msteamsLinkStore, proxy)</span><br><span class="line">httpServer := &amp;http.Server&#123;</span><br><span class="line">    Addr:    net.JoinHostPort(config.Host, config.Port),</span><br><span class="line">    Handler: srv,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">    log.Printf(<span class="string">&quot;listening on %s\n&quot;</span>, httpServer.Addr)</span><br><span class="line">    <span class="keyword">if</span> err := httpServer.ListenAndServe(); err != <span class="literal">nil</span> &amp;&amp; err != http.ErrServerClosed &#123;</span><br><span class="line">        fmt.Fprintf(os.Stderr, <span class="string">&quot;error listening and serving: %s\n&quot;</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;()</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line">wg.Add(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">defer</span> wg.Done()</span><br><span class="line">    &lt;-ctx.Done() <span class="comment">// make a new context for the Shutdown (thanks Alessandro Rosetti)</span></span><br><span class="line">    shutdownCtx := context.Background()</span><br><span class="line">    shutdownCtx, cancel := context.WithTimeout(ctx, <span class="number">10</span>*time.Second)</span><br><span class="line">    <span class="keyword">defer</span> cancel()</span><br><span class="line">    <span class="keyword">if</span> err := httpServer.Shutdown(shutdownCtx); err != <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Fprintf(os.Stderr, <span class="string">&quot;error shutting down http server: %s\n&quot;</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;()</span><br><span class="line">wg.Wait()</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br></pre></td></tr></table></figure>

<h3 id="é•¿å‚æ•°åˆ—è¡¨"><a href="#é•¿å‚æ•°åˆ—è¡¨" class="headerlink" title="é•¿å‚æ•°åˆ—è¡¨"></a>é•¿å‚æ•°åˆ—è¡¨</h3><p>åœ¨æŸä¸ªç‚¹ä¸Šï¼Œå¯èƒ½ä¼šè¾¾åˆ°ä¸é€‚åˆç»§ç»­æ·»åŠ ä¾èµ–é¡¹çš„é™åˆ¶ï¼Œä½†å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä¹æ„å°†ä¾èµ–é¡¹åˆ—è¡¨ä½œä¸ºå‚æ•°æ·»åŠ è¿›å»ã€‚è™½ç„¶æœ‰æ—¶å‚æ•°åˆ—è¡¨å¯èƒ½ä¼šå˜å¾—å¾ˆé•¿ï¼Œä½†æˆ‘å‘ç°è¿™æ ·åšä»ç„¶æ˜¯å€¼å¾—çš„ã€‚</p>
<p>æ˜¯çš„ï¼Œè¿™æ ·åšå¯ä»¥é¿å…åˆ›å»ºä¸€ä¸ªç»“æ„ä½“ï¼Œä½†çœŸæ­£çš„å¥½å¤„æ˜¯ï¼Œé€šè¿‡å‚æ•°ï¼Œæˆ‘å¯ä»¥è·å¾—ç¨å¾®æ›´å¤šçš„ç±»å‹å®‰å…¨æ€§ã€‚æˆ‘å¯ä»¥åˆ›å»ºä¸€ä¸ªè·³è¿‡æˆ‘ä¸å–œæ¬¢çš„ä»»ä½•å­—æ®µçš„ç»“æ„ä½“ï¼Œä½†å‡½æ•°ä¼šå¼ºåˆ¶æˆ‘å¿…é¡»æŸ¥æ‰¾å­—æ®µï¼Œæ‰èƒ½çŸ¥é“å¦‚ä½•åœ¨ç»“æ„ä½“ä¸­è®¾ç½®å®ƒä»¬ï¼Œå¦åˆ™æ— æ³•è°ƒç”¨å‡½æ•°ã€‚</p>
<p>å¦‚æœå°†å…¶æ ¼å¼åŒ–ä¸ºå‚ç›´åˆ—è¡¨ï¼Œå°±ä¸ä¼šé‚£ä¹ˆç³Ÿç³•ï¼Œå°±åƒæˆ‘åœ¨ç°ä»£å‰ç«¯ä»£ç ä¸­çœ‹åˆ°çš„é‚£æ ·ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">srv := NewServer(</span><br><span class="line">    logger,</span><br><span class="line">    config,</span><br><span class="line">    tenantsStore,</span><br><span class="line">    commentsStore,</span><br><span class="line">    conversationService,</span><br><span class="line">    chatGPTService,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h2 id="åœ¨routes-goä¸­æ˜ å°„æ•´ä¸ªAPIæ¥å£"><a href="#åœ¨routes-goä¸­æ˜ å°„æ•´ä¸ªAPIæ¥å£" class="headerlink" title="åœ¨routes.goä¸­æ˜ å°„æ•´ä¸ªAPIæ¥å£"></a>åœ¨<code>routes.go</code>ä¸­æ˜ å°„æ•´ä¸ªAPIæ¥å£</h2><p>è¿™ä¸ªæ–‡ä»¶æ˜¯æœåŠ¡ä¸­åˆ—å‡ºæ‰€æœ‰è·¯ç”±çš„åœ°æ–¹ã€‚</p>
<p>æœ‰æ—¶ä½ å¯èƒ½æ— æ³•é¿å…å°†å®ƒä»¬åˆ†æ•£åœ¨ä¸åŒåœ°æ–¹ï¼Œä½†èƒ½å¤Ÿåœ¨æ¯ä¸ªé¡¹ç›®çš„ä¸€ä¸ªæ–‡ä»¶ä¸­æŸ¥çœ‹å…¶APIæ¥å£æ˜¯éå¸¸æœ‰å¸®åŠ©çš„ã€‚</p>
<p>ç”±äº<code>NewServer</code>æ„é€ å‡½æ•°ä¸­æœ‰å¤§å‹çš„ä¾èµ–å‚æ•°åˆ—è¡¨ï¼Œæ‚¨é€šå¸¸ä¼šåœ¨è·¯ç”±å‡½æ•°ä¸­çœ‹åˆ°ç›¸åŒçš„åˆ—è¡¨ã€‚ä½†åŒæ ·ï¼Œè¿™å¹¶ä¸æ˜¯å¾ˆç³Ÿç³•ã€‚è€Œä¸”ï¼Œç”±äºGoçš„ç±»å‹æ£€æŸ¥åŠŸèƒ½ï¼Œå¦‚æœæ‚¨å¿˜è®°äº†æŸäº›å†…å®¹æˆ–è€…é¡ºåºä¸æ­£ç¡®ï¼Œæ‚¨å¾ˆå¿«å°±ä¼šå‘ç°ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">addRoutes</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    mux *http.ServeMux,</span></span></span><br><span class="line"><span class="params"><span class="function">    logger *logging.Logger,</span></span></span><br><span class="line"><span class="params"><span class="function">    config Config,</span></span></span><br><span class="line"><span class="params"><span class="function">    tenantsStore *TenantsStore,</span></span></span><br><span class="line"><span class="params"><span class="function">    commentsStore *CommentsStore,</span></span></span><br><span class="line"><span class="params"><span class="function">    conversationService *ConversationService,</span></span></span><br><span class="line"><span class="params"><span class="function">    chatGPTService *ChatGPTService,</span></span></span><br><span class="line"><span class="params"><span class="function">    authProxy *authProxy,</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span> &#123;</span><br><span class="line">    mux.Handle(<span class="string">&quot;/api/v1/&quot;</span>, handleTenantsGet(logger, tenantsStore))</span><br><span class="line">    mux.Handle(<span class="string">&quot;/oauth2/&quot;</span>, handleOAuth2Proxy(logger, authProxy))</span><br><span class="line">    mux.HandleFunc(<span class="string">&quot;/healthz&quot;</span>, handleHealthzPlease(logger))</span><br><span class="line">    mux.Handle(<span class="string">&quot;/&quot;</span>, http.NotFoundHandler())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨æˆ‘çš„ç¤ºä¾‹ä¸­ï¼Œ<code>addRoutes</code>ä¸è¿”å›é”™è¯¯ã€‚ä»»ä½•å¯èƒ½å¼•å‘é”™è¯¯çš„å†…å®¹éƒ½è¢«ç§»åˆ°äº†<code>run</code>å‡½æ•°ä¸­ï¼Œåœ¨åˆ°è¾¾è¿™ä¸€ç‚¹ä¹‹å‰è¿›è¡Œäº†å¤„ç†ï¼Œä»è€Œä½¿è¯¥å‡½æ•°ä¿æŒç®€å•å’Œæ‰å¹³ã€‚å½“ç„¶ï¼Œå¦‚æœä»»ä½•å¤„ç†ç¨‹åºç”±äºæŸç§åŸå› è¿”å›é”™è¯¯ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°ä¹Ÿå¯ä»¥è¿”å›é”™è¯¯ã€‚</p>
<h2 id="func-main-åªè°ƒç”¨run"><a href="#func-main-åªè°ƒç”¨run" class="headerlink" title="func main()åªè°ƒç”¨run()"></a><code>func main()</code>åªè°ƒç”¨<code>run()</code></h2><p><code>run</code>å‡½æ•°ç±»ä¼¼äº<code>main</code>å‡½æ•°ï¼Œåªæ˜¯å®ƒæ¥å—æ“ä½œç³»ç»Ÿçš„åŸºæœ¬åŠŸèƒ½ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›é”™è¯¯ã€‚</p>
<p>æˆ‘å¸Œæœ›<code>func main()</code>æ˜¯<code>func main() error</code>ã€‚æˆ–è€…åƒåœ¨Cè¯­è¨€ä¸­ä¸€æ ·ï¼Œå¯ä»¥è¿”å›é€€å‡ºä»£ç ï¼š<code>func main() int</code>ã€‚é€šè¿‡æ‹¥æœ‰ä¸€ä¸ªéå¸¸ç®€å•çš„<code>main</code>å‡½æ•°ï¼Œä½ ä¹Ÿå¯ä»¥å®ç°è‡ªå·±çš„æ¢¦æƒ³ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">run</span><span class="params">(ctx context.Context, w io.Writer, args []<span class="type">string</span>)</span></span> <span class="type">error</span> &#123;</span><br><span class="line">    ctx, cancel := signal.NotifyContext(ctx, os.Interrupt)</span><br><span class="line">    <span class="keyword">defer</span> cancel()</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    ctx := context.Background()</span><br><span class="line">    <span class="keyword">if</span> err := run(ctx, os.Stdout, os.Args); err != <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Fprintf(os.Stderr, <span class="string">&quot;%s\n&quot;</span>, err)</span><br><span class="line">        os.Exit(<span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ç¼–è¾‘ï¼šæˆ‘è¿‡å»åœ¨<code>main</code>å‡½æ•°ä¸­æ‰§è¡Œäº†<code>signal.NotifyContext</code>çš„éƒ¨åˆ†ï¼Œä½†æ˜¯Dave Hendersonï¼ˆå’Œå…¶ä»–å‡ ä¸ªäººï¼‰æŒ‡å‡º<code>cancel</code>å‡½æ•°ä¸ä¼šè¢«è°ƒç”¨ï¼Œæ‰€ä»¥æˆ‘å°†å…¶ç§»åˆ°äº†<code>run</code>å‡½æ•°ä¸­ã€‚</p>
</blockquote>
<p>ä¸Šé¢çš„ä»£ç ç›´æ¥è°ƒç”¨äº†<code>run</code>å‡½æ•°ï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ªä¸Šä¸‹æ–‡ï¼Œå¹¶åœ¨æ¥æ”¶åˆ°<code>Ctrl+C</code>æˆ–ç­‰æ•ˆä¿¡å·æ—¶å–æ¶ˆã€‚å¦‚æœ<code>run</code>å‡½æ•°è¿”å›<code>nil</code>ï¼Œåˆ™å‡½æ•°ä¼šæ­£å¸¸é€€å‡ºã€‚å¦‚æœè¿”å›é”™è¯¯ï¼Œåˆ™å°†å…¶å†™å…¥<code>stderr</code>å¹¶ä»¥éé›¶ä»£ç é€€å‡ºã€‚å¦‚æœæˆ‘æ­£åœ¨ç¼–å†™ä¸€ä¸ªéœ€è¦è€ƒè™‘é€€å‡ºä»£ç çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œæˆ‘è¿˜å¯ä»¥è¿”å›ä¸€ä¸ªæ•´æ•°ï¼Œè¿™æ ·æˆ‘å°±å¯ä»¥ç¼–å†™æµ‹è¯•æ¥æ–­è¨€è¿”å›çš„æ­£ç¡®ä»£ç ã€‚</p>
<p>æ“ä½œç³»ç»Ÿçš„åŸºæœ¬åŠŸèƒ½ä½œä¸ºå‚æ•°ä¼ é€’ç»™<code>run</code>ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå®ƒæ”¯æŒæ ‡å¿—ï¼Œåˆ™å¯ä»¥ä¼ å…¥<code>os.Args</code>ï¼Œç”šè‡³å¯ä»¥ä¼ å…¥<code>os.Stdin</code>ã€<code>os.Stdout</code>å’Œ<code>os.Stderr</code>ç­‰ä¾èµ–é¡¹ã€‚è¿™æ ·ï¼Œä½ çš„ç¨‹åºåœ¨æµ‹è¯•æ—¶ä¼šæ›´å®¹æ˜“ï¼Œå› ä¸ºæµ‹è¯•ä»£ç å¯ä»¥è°ƒç”¨<code>run</code>æ¥æ‰§è¡Œä½ çš„ç¨‹åºï¼Œé€šè¿‡ä¼ é€’ä¸åŒçš„å‚æ•°æ¥æ§åˆ¶å‚æ•°å’Œæ‰€æœ‰æµã€‚</p>
<p>ä¸‹è¡¨æ˜¾ç¤ºäº†è¿è¡Œå‡½æ•°çš„è¾“å…¥å‚æ•°ç¤ºä¾‹ï¼š</p>
<table>
<thead>
<tr>
<th><strong>å€¼</strong></th>
<th><strong>ç±»å‹</strong></th>
<th><strong>æè¿°</strong></th>
</tr>
</thead>
<tbody><tr>
<td><code>os.Args</code></td>
<td><code>[]string</code></td>
<td>åœ¨æ‰§è¡Œç¨‹åºæ—¶ä¼ å…¥çš„å‚æ•°ã€‚ä¹Ÿç”¨äºè§£ææ ‡å¿—ã€‚</td>
</tr>
<tr>
<td><code>os.Stdin</code></td>
<td><code>io.Reader</code></td>
<td>ç”¨äºè¯»å–è¾“å…¥</td>
</tr>
<tr>
<td><code>os.Stdout</code></td>
<td><code>io.Writer</code></td>
<td>ç”¨äºå†™å…¥è¾“å‡º</td>
</tr>
<tr>
<td><code>os.Stderr</code></td>
<td><code>io.Writer</code></td>
<td>ç”¨äºå†™å…¥é”™è¯¯æ—¥å¿—</td>
</tr>
<tr>
<td><code>os.Getenv</code></td>
<td><code>func(string) string</code></td>
<td>ç”¨äºè¯»å–ç¯å¢ƒå˜é‡</td>
</tr>
<tr>
<td><code>os.Getwd</code></td>
<td><code>func() (string, error)</code></td>
<td>è·å–å·¥ä½œç›®å½•</td>
</tr>
</tbody></table>
<p>å¦‚æœé¿å…ä½¿ç”¨å…¨å±€ä½œç”¨åŸŸæ•°æ®ï¼Œé€šå¸¸å¯ä»¥åœ¨æ›´å¤šåœ°æ–¹ä½¿ç”¨<code>t.Parallel()</code>ï¼Œä»¥åŠ å¿«æµ‹è¯•å¥—ä»¶çš„é€Ÿåº¦ã€‚ä¸€åˆ‡éƒ½æ˜¯è‡ªåŒ…å«çš„ï¼Œå› æ­¤å¯¹<code>run</code>çš„å¤šæ¬¡è°ƒç”¨ä¸ä¼šç›¸äº’å¹²æ‰°ã€‚</p>
<p>é€šå¸¸ï¼Œæˆ‘æœ€ç»ˆä¼šå¾—åˆ°ä»¥ä¸‹<code>run</code>å‡½æ•°çš„ç­¾åï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">run</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    ctx context.Context,</span></span></span><br><span class="line"><span class="params"><span class="function">    args []<span class="type">string</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    getenv <span class="keyword">func</span>(<span class="type">string</span>)</span></span> <span class="type">string</span>,</span><br><span class="line">    stdin io.Reader,</span><br><span class="line">    stdout, stderr io.Writer,</span><br><span class="line">) <span class="type">error</span></span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘ä»¬è¿›å…¥äº†<code>run</code>å‡½æ•°ï¼Œå¯ä»¥å›åˆ°æ­£å¸¸çš„Goä»£ç ç¼–å†™ï¼Œå¯ä»¥åƒæ²¡æœ‰äººåœ¨ä¹ä¸€æ ·è¿”å›é”™è¯¯ã€‚æˆ‘ä»¬gopherä»¬å–œæ¬¢è¿”å›é”™è¯¯ï¼Œæˆ‘ä»¬è¶Šæ—©æ‰¿è®¤è¿™ä¸€ç‚¹ï¼Œé‚£äº›åœ¨äº’è”ç½‘ä¸Šçš„äººå°±è¶Šæ—©èƒ½èµ¢å¾—èƒœåˆ©å¹¶æ¶ˆå¤±ã€‚</p>
<h3 id="ä¼˜é›…å…³é—­"><a href="#ä¼˜é›…å…³é—­" class="headerlink" title="ä¼˜é›…å…³é—­"></a>ä¼˜é›…å…³é—­</h3><p>å¦‚æœä½ è¿è¡Œå¤§é‡çš„æµ‹è¯•ï¼Œå½“æ¯ä¸ªæµ‹è¯•å®Œæˆæ—¶ï¼Œè®©ä½ çš„ç¨‹åºåœæ­¢æ˜¯å¾ˆé‡è¦çš„ã€‚ï¼ˆæˆ–è€…ä½ å¯èƒ½å†³å®šä¿æŒä¸€ä¸ªå®ä¾‹è¿è¡Œæ‰€æœ‰çš„æµ‹è¯•ï¼Œä½†è¿™å–å†³äºä½ ã€‚ï¼‰</p>
<p>ä¸Šä¸‹æ–‡è¢«ä¼ é€’ã€‚å¦‚æœç»ˆæ­¢ä¿¡å·è¿›å…¥ç¨‹åºï¼Œå®ƒå°†è¢«å–æ¶ˆï¼Œå› æ­¤åœ¨æ¯ä¸ªçº§åˆ«éƒ½å°Šé‡å®ƒæ˜¯å¾ˆé‡è¦çš„ã€‚è‡³å°‘ï¼Œå°†å…¶ä¼ é€’ç»™ä½ çš„ä¾èµ–é¡¹ã€‚æœ€å¥½ï¼Œæ£€æŸ¥ä»»ä½•é•¿æ—¶é—´è¿è¡Œæˆ–å¾ªç¯ä»£ç ä¸­çš„<code>Err()</code>æ–¹æ³•ï¼Œå¦‚æœè¿”å›é”™è¯¯ï¼Œåˆ™åœæ­¢æ­£åœ¨è¿›è¡Œçš„æ“ä½œå¹¶å°†å…¶è¿”å›ã€‚è¿™å°†æœ‰åŠ©äºæœåŠ¡å™¨ä¼˜é›…åœ°å…³é—­ã€‚å¦‚æœä½ å¯åŠ¨äº†å…¶ä»–çš„goroutineï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸Šä¸‹æ–‡æ¥å†³å®šæ˜¯å¦åœæ­¢å®ƒä»¬ã€‚</p>
<h3 id="æ§åˆ¶ç¯å¢ƒ"><a href="#æ§åˆ¶ç¯å¢ƒ" class="headerlink" title="æ§åˆ¶ç¯å¢ƒ"></a>æ§åˆ¶ç¯å¢ƒ</h3><p><code>args</code>å’Œ<code>getenv</code>å‚æ•°ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€äº›æ§åˆ¶ç¨‹åºè¡Œä¸ºçš„æ–¹æ³•ï¼Œé€šè¿‡æ ‡å¿—å’Œç¯å¢ƒå˜é‡ã€‚æ ‡å¿—ä½¿ç”¨argsè¿›è¡Œå¤„ç†ï¼ˆåªè¦ä½ ä¸ä½¿ç”¨å…¨å±€ç©ºé—´ç‰ˆæœ¬çš„flagsï¼Œå¹¶åœ¨<code>run</code>å†…éƒ¨ä½¿ç”¨<code>flags.NewFlagSet</code>ï¼‰ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸åŒçš„å€¼è°ƒç”¨runï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">args := []<span class="type">string</span>&#123;</span><br><span class="line">    <span class="string">&quot;myapp&quot;</span>,</span><br><span class="line">    <span class="string">&quot;--out&quot;</span>, outFile,</span><br><span class="line">    <span class="string">&quot;--fmt&quot;</span>, <span class="string">&quot;markdown&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">go</span> run(ctx, args, etc.)</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½ çš„ç¨‹åºä½¿ç”¨ç¯å¢ƒå˜é‡è€Œä¸æ˜¯æ ‡å¿—ï¼ˆç”šè‡³ä¸¤è€…éƒ½ä½¿ç”¨ï¼‰ï¼Œé‚£ä¹ˆ<code>getenv</code>å‡½æ•°å…è®¸ä½ æ’å…¥ä¸åŒçš„å€¼ï¼Œè€Œä¸éœ€è¦æ›´æ”¹å®é™…çš„ç¯å¢ƒã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">getenv := <span class="function"><span class="keyword">func</span><span class="params">(key <span class="type">string</span>)</span></span> <span class="type">string</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> key &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;MYAPP_FORMAT&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;markdown&quot;</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;MYAPP_TIMEOUT&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;5s&quot;</span></span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">go</span> run(ctx, args, getenv)</span><br></pre></td></tr></table></figure>

<p>å¯¹æˆ‘æ¥è¯´ï¼Œä½¿ç”¨è¿™ç§<code>getenv</code>æŠ€æœ¯æ¯”ä½¿ç”¨<code>t.SetEnv</code>æ§åˆ¶ç¯å¢ƒå˜é‡æ›´å¥½ï¼Œå› ä¸ºä½ å¯ä»¥é€šè¿‡è°ƒç”¨<code>t.Parallel()</code>ç»§ç»­å¹¶è¡Œè¿è¡Œæµ‹è¯•ï¼Œè€Œ<code>t.SetEnv</code>ä¸å…è®¸è¿™æ ·åšã€‚</p>
<p>å½“ç„¶ï¼Œå½“ä½ åœ¨ç¼–å†™å‘½ä»¤è¡Œå·¥å…·æ—¶ï¼Œè¿™ç§æŠ€æœ¯æ›´åŠ æœ‰ç”¨ï¼Œå› ä¸ºä½ ç»å¸¸å¸Œæœ›ä»¥ä¸åŒçš„è®¾ç½®è¿è¡Œç¨‹åºï¼Œä»¥æµ‹è¯•å…¶æ‰€æœ‰è¡Œä¸ºã€‚</p>
<p>åœ¨<code>main</code>å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä¼ å…¥çœŸæ­£çš„ä¸œè¥¿ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    ctx := context.Background()</span><br><span class="line">    <span class="keyword">if</span> err := run(ctx, os.Getenv, os.Stderr); err != <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Fprintf(os.Stderr, <span class="string">&quot;%s\n&quot;</span>, err)</span><br><span class="line">        os.Exit(<span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ä½¿ç”¨Makerå‡½æ•°è¿”å›å¤„ç†ç¨‹åº"><a href="#ä½¿ç”¨Makerå‡½æ•°è¿”å›å¤„ç†ç¨‹åº" class="headerlink" title="ä½¿ç”¨Makerå‡½æ•°è¿”å›å¤„ç†ç¨‹åº"></a>ä½¿ç”¨Makerå‡½æ•°è¿”å›å¤„ç†ç¨‹åº</h2><p>æˆ‘çš„å¤„ç†ç¨‹åºå‡½æ•°ä¸ç›´æ¥å®ç°<code>http.Handler</code>æˆ–<code>http.HandlerFunc</code>ï¼Œå®ƒä»¬è¿”å›å®ƒä»¬ã€‚å…·ä½“æ¥è¯´ï¼Œå®ƒä»¬è¿”å›<code>http.Handler</code>ç±»å‹ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// handleSomethingå¤„ç†é‚£äº›ä½ ç»å¸¸å¬åˆ°çš„ç½‘ç»œè¯·æ±‚ã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handleSomething</span><span class="params">(logger *Logger)</span></span> http.Handler &#123;</span><br><span class="line">    thing := prepareThing()</span><br><span class="line">    <span class="keyword">return</span> http.HandlerFunc(<span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">        <span class="comment">// ä½¿ç”¨thingå¤„ç†è¯·æ±‚</span></span><br><span class="line">        logger.Info(r.Context(), <span class="string">&quot;msg&quot;</span>, <span class="string">&quot;handleSomething&quot;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ç§æ¨¡å¼ä¸ºæ¯ä¸ªå¤„ç†ç¨‹åºæä¾›äº†ç‹¬ç«‹çš„é—­åŒ…ç¯å¢ƒã€‚ä½ å¯ä»¥åœ¨è¿™ä¸ªç©ºé—´ä¸­è¿›è¡Œåˆå§‹åŒ–å·¥ä½œï¼Œå¹¶ä¸”å½“è°ƒç”¨å¤„ç†ç¨‹åºæ—¶ï¼Œæ•°æ®å°†å¯ç”¨ã€‚</p>
<p>ç¡®ä¿åªè¯»å–å…±äº«æ•°æ®ã€‚å¦‚æœå¤„ç†ç¨‹åºä¿®æ”¹ä»»ä½•å†…å®¹ï¼Œä½ å°†éœ€è¦ä¸€ä¸ªäº’æ–¥é”æˆ–å…¶ä»–ä¸œè¥¿æ¥ä¿æŠ¤å®ƒã€‚</p>
<p>é€šå¸¸æƒ…å†µä¸‹ï¼Œä¸å»ºè®®åœ¨è¿™é‡Œå­˜å‚¨ç¨‹åºçŠ¶æ€ã€‚åœ¨å¤§å¤šæ•°äº‘ç¯å¢ƒä¸­ï¼Œä½ ä¸èƒ½ä¿è¯ä»£ç ä¼šæŒç»­è¿è¡Œå¾ˆé•¿æ—¶é—´ã€‚æ ¹æ®ä½ çš„ç”Ÿäº§ç¯å¢ƒï¼ŒæœåŠ¡å™¨é€šå¸¸ä¼šå…³é—­ä»¥èŠ‚çœèµ„æºï¼Œæˆ–è€…ä»…ä»…å› ä¸ºå…¶ä»–åŸå› å´©æºƒã€‚ä½ çš„æœåŠ¡å¯èƒ½ä¼šä»¥ä¸å¯é¢„æµ‹çš„æ–¹å¼åœ¨è®¸å¤šå®ä¾‹ä¹‹é—´è´Ÿè½½å‡è¡¡ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ¯ä¸ªå®ä¾‹åªèƒ½è®¿é—®è‡ªå·±çš„æœ¬åœ°æ•°æ®ã€‚å› æ­¤ï¼Œåœ¨çœŸå®é¡¹ç›®ä¸­æœ€å¥½ä½¿ç”¨æ•°æ®åº“æˆ–å…¶ä»–å­˜å‚¨APIæ¥æŒä¹…åŒ–æ•°æ®ã€‚</p>
<h2 id="åœ¨ä¸€ä¸ªåœ°æ–¹å¤„ç†è§£ç -ç¼–ç "><a href="#åœ¨ä¸€ä¸ªåœ°æ–¹å¤„ç†è§£ç -ç¼–ç " class="headerlink" title="åœ¨ä¸€ä¸ªåœ°æ–¹å¤„ç†è§£ç &#x2F;ç¼–ç "></a>åœ¨ä¸€ä¸ªåœ°æ–¹å¤„ç†è§£ç &#x2F;ç¼–ç </h2><p>æ¯ä¸ªæœåŠ¡éƒ½éœ€è¦è§£ç è¯·æ±‚ä½“å’Œç¼–ç å“åº”ä½“ã€‚è¿™æ˜¯ä¸€ä¸ªç»å¾—èµ·æ—¶é—´è€ƒéªŒçš„åˆç†æŠ½è±¡ã€‚</p>
<p>æˆ‘é€šå¸¸ä¼šæœ‰ä¸€å¯¹è¾…åŠ©å‡½æ•°å«åšencodeå’Œdecodeã€‚ä½¿ç”¨æ³›å‹çš„ç¤ºä¾‹ç‰ˆæœ¬å‘æ‚¨å±•ç¤ºï¼Œå®é™…ä¸Šæ‚¨åªæ˜¯åœ¨åŒ…è£…å‡ è¡ŒåŸºæœ¬ä»£ç ï¼Œæˆ‘é€šå¸¸ä¸ä¼šè¿™æ ·åšï¼Œä½†å½“æ‚¨éœ€è¦ä¸ºæ‰€æœ‰APIè¿›è¡Œæ›´æ”¹æ—¶ï¼Œè¿™å°†å˜å¾—éå¸¸æœ‰ç”¨ã€‚ï¼ˆä¾‹å¦‚ï¼Œå‡è®¾æ‚¨çš„æ–°è€æ¿è¿˜åœç•™åœ¨ä¸Šä¸–çºª90å¹´ä»£ï¼Œå¹¶ä¸”ä»–ä»¬æƒ³è¦æ·»åŠ XMLæ”¯æŒã€‚ï¼‰</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">encode</span>[<span class="title">T</span> <span class="title">any</span>]<span class="params">(w http.ResponseWriter, r *http.Request, status <span class="type">int</span>, v T)</span></span> <span class="type">error</span> &#123;</span><br><span class="line">    w.Header().Set(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/json&quot;</span>)</span><br><span class="line">    w.WriteHeader(status)</span><br><span class="line">    <span class="keyword">if</span> err := json.NewEncoder(w).Encode(v); err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;encode json: %w&quot;</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">decode</span>[<span class="title">T</span> <span class="title">any</span>]<span class="params">(r *http.Request)</span></span> (T, <span class="type">error</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> v T</span><br><span class="line">    <span class="keyword">if</span> err := json.NewDecoder(r.Body).Decode(&amp;v); err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> v, fmt.Errorf(<span class="string">&quot;decode json: %w&quot;</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> v, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ‰è¶£çš„æ˜¯ï¼Œç¼–è¯‘å™¨èƒ½å¤Ÿä»å‚æ•°ä¸­æ¨æ–­å‡ºç±»å‹ï¼Œå› æ­¤åœ¨è°ƒç”¨encodeæ—¶ä¸éœ€è¦ä¼ é€’ç±»å‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">err := encode(w, r, http.StatusOK, obj)</span><br></pre></td></tr></table></figure>

<p>ä½†ç”±äºdecodeä¸­çš„è¿”å›å‚æ•°ï¼Œæ‚¨éœ€è¦æŒ‡å®šæ‚¨æœŸæœ›çš„ç±»å‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">decoded, err := decode[CreateSomethingRequest](r)</span><br></pre></td></tr></table></figure>

<p>æˆ‘å°½é‡ä¸è¿‡åº¦ä½¿ç”¨è¿™äº›å‡½æ•°ï¼Œä½†è¿‡å»æˆ‘å¯¹ä¸€ä¸ªç®€å•çš„éªŒè¯æ¥å£éå¸¸æ»¡æ„ï¼Œå®ƒå¾ˆå¥½åœ°é€‚åº”äº†decodeå‡½æ•°ã€‚</p>
<h2 id="éªŒè¯æ•°æ®"><a href="#éªŒè¯æ•°æ®" class="headerlink" title="éªŒè¯æ•°æ®"></a>éªŒè¯æ•°æ®</h2><p>æˆ‘å–œæ¬¢ç®€å•çš„æ¥å£ã€‚å®é™…ä¸Šï¼Œæˆ‘éå¸¸å–œæ¬¢å®ƒä»¬ã€‚å•æ–¹æ³•æ¥å£å¾ˆå®¹æ˜“å®ç°ã€‚æ‰€ä»¥å½“æ¶‰åŠåˆ°éªŒè¯å¯¹è±¡æ—¶ï¼Œæˆ‘å–œæ¬¢è¿™æ ·åšï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Validatoræ˜¯ä¸€ä¸ªå¯ä»¥è¿›è¡ŒéªŒè¯çš„å¯¹è±¡ã€‚</span></span><br><span class="line"><span class="keyword">type</span> Validator <span class="keyword">interface</span> &#123;</span><br><span class="line">    <span class="comment">// Validæ£€æŸ¥å¯¹è±¡å¹¶è¿”å›ä»»ä½•é—®é¢˜ã€‚</span></span><br><span class="line">    <span class="comment">// å¦‚æœlen(problems) == 0ï¼Œåˆ™å¯¹è±¡æœ‰æ•ˆã€‚</span></span><br><span class="line">    Valid(ctx context.Context) (problems <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">string</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Valid</code>æ–¹æ³•æ¥å—ä¸€ä¸ªä¸Šä¸‹æ–‡ï¼ˆè¿™æ˜¯å¯é€‰çš„ï¼Œä½†åœ¨è¿‡å»å¯¹æˆ‘å¾ˆæœ‰ç”¨ï¼‰ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ˜ å°„ã€‚å¦‚æœå­—æ®µæœ‰é—®é¢˜ï¼Œå®ƒçš„åç§°å°†ç”¨ä½œé”®ï¼Œå¹¶å°†é—®é¢˜çš„äººç±»å¯è¯»è§£é‡Šè®¾ç½®ä¸ºå€¼ã€‚</p>
<p>è¯¥æ–¹æ³•å¯ä»¥æ‰§è¡Œä»»ä½•éœ€è¦éªŒè¯ç»“æ„ä½“å­—æ®µçš„æ“ä½œã€‚ä¾‹å¦‚ï¼Œå®ƒå¯ä»¥æ£€æŸ¥ä»¥ä¸‹å†…å®¹ï¼š</p>
<ul>
<li>å¿…å¡«å­—æ®µä¸èƒ½ä¸ºç©º</li>
<li>å…·æœ‰ç‰¹å®šæ ¼å¼ï¼ˆå¦‚ç”µå­é‚®ä»¶ï¼‰çš„å­—ç¬¦ä¸²æ˜¯å¦æ­£ç¡®</li>
<li>æ•°å­—æ˜¯å¦åœ¨å¯æ¥å—èŒƒå›´å†…</li>
</ul>
<p>å¦‚æœæ‚¨éœ€è¦æ‰§è¡Œæ›´å¤æ‚çš„æ“ä½œï¼Œæ¯”å¦‚åœ¨æ•°æ®åº“ä¸­æ£€æŸ¥å­—æ®µï¼Œé‚£ä¹ˆåº”è¯¥åœ¨å…¶ä»–åœ°æ–¹è¿›è¡Œï¼›å®ƒå¯èƒ½å¤ªé‡è¦ï¼Œä»¥è‡³äºä¸èƒ½è¢«è§†ä¸ºå¿«é€ŸéªŒè¯æ£€æŸ¥çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶ä¸”æ‚¨ä¸ä¼šæœŸæœ›åœ¨è¿™æ ·çš„å‡½æ•°ä¸­æ‰¾åˆ°è¿™ç§ç±»å‹çš„å†…å®¹ï¼Œå› æ­¤å®ƒå¯èƒ½å¾ˆå®¹æ˜“è¢«éšè—èµ·æ¥ã€‚</p>
<p>ç„¶åï¼Œæˆ‘ä½¿ç”¨ç±»å‹æ–­è¨€æ¥åˆ¤æ–­å¯¹è±¡æ˜¯å¦å®ç°äº†è¯¥æ¥å£ã€‚æˆ–è€…ï¼Œåœ¨æ³›å‹ä¸–ç•Œä¸­ï¼Œæˆ‘å¯èƒ½é€‰æ‹©æ›´æ˜ç¡®åœ°è¯´æ˜æ­£åœ¨å‘ç”Ÿçš„äº‹æƒ…ï¼Œé€šè¿‡æ›´æ”¹decodeæ–¹æ³•æ¥åšæŒè¦æ±‚å®ç°è¯¥æ¥å£ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">decodeValid</span>[<span class="title">T</span> <span class="title">Validator</span>]<span class="params">(r *http.Request)</span></span> (T, <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">string</span>, <span class="type">error</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> v T</span><br><span class="line">    <span class="keyword">if</span> err := json.NewDecoder(r.Body).Decode(&amp;v); err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> v, <span class="literal">nil</span>, fmt.Errorf(<span class="string">&quot;decode json: %w&quot;</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> problems := v.Valid(r.Context()); <span class="built_in">len</span>(problems) &gt; <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> v, problems, fmt.Errorf(<span class="string">&quot;invalid %T: %d problems&quot;</span>, v, <span class="built_in">len</span>(problems))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> v, <span class="literal">nil</span>, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨æ­¤ä»£ç ä¸­ï¼Œ<code>T</code>å¿…é¡»å®ç°<code>Validator</code>æ¥å£ï¼Œå¹¶ä¸”<code>Valid</code>æ–¹æ³•å¿…é¡»è¿”å›é›¶ä¸ªé—®é¢˜ï¼Œä»¥ä¾¿å°†å¯¹è±¡è§†ä¸ºæˆåŠŸè§£ç ã€‚</p>
<p>å¯¹äºé—®é¢˜ï¼Œè¿”å›<code>nil</code>æ˜¯å®‰å…¨çš„ï¼Œå› ä¸ºæˆ‘ä»¬å°†æ£€æŸ¥<code>len(problems)</code>ï¼Œå¯¹äº<code>nil</code>æ˜ å°„ï¼Œå®ƒå°†ä¸º<code>0</code>ï¼Œä½†ä¸ä¼šå¼•å‘ææ…Œã€‚</p>
<h2 id="é€‚é…å™¨æ¨¡å¼ç”¨äºä¸­é—´ä»¶"><a href="#é€‚é…å™¨æ¨¡å¼ç”¨äºä¸­é—´ä»¶" class="headerlink" title="é€‚é…å™¨æ¨¡å¼ç”¨äºä¸­é—´ä»¶"></a>é€‚é…å™¨æ¨¡å¼ç”¨äºä¸­é—´ä»¶</h2><p>ä¸­é—´ä»¶å‡½æ•°æ¥å—ä¸€ä¸ª<code>http.Handler</code>å¹¶è¿”å›ä¸€ä¸ªæ–°çš„<code>http.Handler</code>ï¼Œå¯ä»¥åœ¨è°ƒç”¨åŸå§‹å¤„ç†ç¨‹åºä¹‹å‰å’Œ&#x2F;æˆ–ä¹‹åè¿è¡Œä»£ç ï¼Œæˆ–è€…ç”šè‡³å¯ä»¥å†³å®šæ ¹æœ¬ä¸è°ƒç”¨åŸå§‹å¤„ç†ç¨‹åºã€‚</p>
<p>ä¸€ä¸ªç¤ºä¾‹æ˜¯æ£€æŸ¥ç”¨æˆ·æ˜¯å¦ä¸ºç®¡ç†å‘˜ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">adminOnly</span><span class="params">(h http.Handler)</span></span> http.Handler &#123;</span><br><span class="line">    <span class="keyword">return</span> http.HandlerFunc(<span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> !currentUser(r).IsAdmin &#123;</span><br><span class="line">            http.NotFound(w, r)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        h(w, r)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¤„ç†ç¨‹åºå†…éƒ¨çš„é€»è¾‘å¯ä»¥é€‰æ‹©æ˜¯å¦è°ƒç”¨åŸå§‹å¤„ç†ç¨‹åºã€‚åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œå¦‚æœ<code>IsAdmin</code>ä¸ºfalseï¼Œåˆ™å¤„ç†ç¨‹åºå°†è¿”å›<code>HTTP 404 Not Found</code>å¹¶è¿”å›ï¼ˆæˆ–ä¸­æ­¢ï¼‰ï¼›è¯·æ³¨æ„ï¼Œä¸è°ƒç”¨<code>h</code>å¤„ç†ç¨‹åºã€‚å¦‚æœ<code>IsAdmin</code>ä¸ºtrueï¼Œåˆ™å…è®¸ç”¨æˆ·è®¿é—®è·¯ç”±ï¼Œå› æ­¤å°†æ‰§è¡Œä¼ é€’ç»™<code>h</code>å¤„ç†ç¨‹åºã€‚</p>
<p>é€šå¸¸ï¼Œæˆ‘å°†ä¸­é—´ä»¶åˆ—åœ¨<code>routes.go</code>æ–‡ä»¶ä¸­ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> app</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">addRoutes</span><span class="params">(mux *http.ServeMux)</span></span> &#123;</span><br><span class="line">    mux.HandleFunc(<span class="string">&quot;/api/&quot;</span>, handleAPI())</span><br><span class="line">    mux.HandleFunc(<span class="string">&quot;/about&quot;</span>, handleAbout())</span><br><span class="line">    mux.HandleFunc(<span class="string">&quot;/&quot;</span>, handleIndex())</span><br><span class="line">    mux.HandleFunc(<span class="string">&quot;/admin&quot;</span>, adminOnly(handleAdminIndex()))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡æŸ¥çœ‹ç«¯ç‚¹æ˜ å°„ï¼Œè¿™ä½¿å¾—éå¸¸æ¸…æ™°ï¼Œå¯ä»¥çŸ¥é“åº”ç”¨äº†å“ªäº›ä¸­é—´ä»¶ã€‚å¦‚æœåˆ—è¡¨å¼€å§‹å˜å¾—æ›´é•¿ï¼Œè¯·å°è¯•å°†å®ƒä»¬åˆ†æˆå¤šè¡Œ - æˆ‘çŸ¥é“ï¼Œæˆ‘çŸ¥é“ï¼Œä½†æ‚¨ä¼šä¹ æƒ¯çš„ã€‚</p>
<h2 id="æœ‰æ—¶è¿”å›ä¸­é—´ä»¶"><a href="#æœ‰æ—¶è¿”å›ä¸­é—´ä»¶" class="headerlink" title="æœ‰æ—¶è¿”å›ä¸­é—´ä»¶"></a>æœ‰æ—¶è¿”å›ä¸­é—´ä»¶</h2><p>ä¸Šè¿°æ–¹æ³•å¯¹äºç®€å•æƒ…å†µéå¸¸å¥½ï¼Œä½†å¦‚æœä¸­é—´ä»¶éœ€è¦è®¸å¤šä¾èµ–é¡¹ï¼ˆä¸€ä¸ªè®°å½•å™¨ï¼Œä¸€ä¸ªæ•°æ®åº“ï¼Œä¸€äº›APIå®¢æˆ·ç«¯ï¼Œä¸€ä¸ªåŒ…å«â€œNever Gonna Give You Upâ€æ•°æ®çš„å­—èŠ‚æ•°ç»„ï¼Œä¾›ä»¥åçš„æ¶ä½œå‰§ä½¿ç”¨ï¼‰ï¼Œé‚£ä¹ˆæˆ‘å¯èƒ½ä¼šç¼–å†™ä¸€ä¸ªè¿”å›ä¸­é—´ä»¶å‡½æ•°çš„å‡½æ•°ã€‚</p>
<p>é—®é¢˜æ˜¯ï¼Œæ‚¨æœ€ç»ˆä¼šå¾—åˆ°è¿™æ ·çš„ä»£ç ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">mux.Handle(<span class="string">&quot;/route1&quot;</span>, middleware(logger, db, slackClient, rroll []<span class="type">byte</span>, handleSomething(handlerSpecificDeps))</span><br><span class="line">mux.Handle(<span class="string">&quot;/route2&quot;</span>, middleware(logger, db, slackClient, rroll []<span class="type">byte</span>, handleSomething2(handlerSpecificDeps))</span><br><span class="line">mux.Handle(<span class="string">&quot;/route3&quot;</span>, middleware(logger, db, slackClient, rroll []<span class="type">byte</span>, handleSomething3(handlerSpecificDeps))</span><br><span class="line">mux.Handle(<span class="string">&quot;/route4&quot;</span>, middleware(logger, db, slackClient, rroll []<span class="type">byte</span>, handleSomething4(handlerSpecificDeps))</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ä¼šä½¿ä»£ç è†¨èƒ€ï¼Œå¹¶ä¸”å®é™…ä¸Šå¹¶æ²¡æœ‰æä¾›ä»»ä½•æœ‰ç”¨çš„ä¸œè¥¿ã€‚ç›¸åï¼Œæˆ‘ä¼šè®©ä¸­é—´ä»¶å‡½æ•°æ¥å—ä¾èµ–é¡¹ï¼Œä½†è¿”å›ä¸€ä¸ªåªæ¥å—ä¸‹ä¸€ä¸ªå¤„ç†ç¨‹åºçš„å‡½æ•°ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">newMiddleware</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    logger Logger,</span></span></span><br><span class="line"><span class="params"><span class="function">    db *DB,</span></span></span><br><span class="line"><span class="params"><span class="function">    slackClient *slack.Client,</span></span></span><br><span class="line"><span class="params"><span class="function">    rroll []<span class="type">byte</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span> <span class="function"><span class="keyword">func</span><span class="params">(h http.Handler)</span></span> http.Handler</span><br></pre></td></tr></table></figure>

<p>è¿”å›ç±»å‹<code>func(h http.Handler) http.Handler</code>æ˜¯æˆ‘ä»¬åœ¨è®¾ç½®è·¯ç”±æ—¶å°†è°ƒç”¨çš„å‡½æ•°ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">middleware := newMiddleware(logger, db, slackClient, rroll)</span><br><span class="line">mux.Handle(<span class="string">&quot;/route1&quot;</span>, middleware(handleSomething(handlerSpecificDeps))</span><br><span class="line">mux.Handle(<span class="string">&quot;/route2&quot;</span>, middleware(handleSomething2(handlerSpecificDeps))</span><br><span class="line">mux.Handle(<span class="string">&quot;/route3&quot;</span>, middleware(handleSomething3(handlerSpecificDeps))</span><br><span class="line">mux.Handle(<span class="string">&quot;/route4&quot;</span>, middleware(handleSomething4(handlerSpecificDeps))</span><br></pre></td></tr></table></figure>

<p>æœ‰äº›äººå–œæ¬¢ï¼ˆä½†æˆ‘ä¸å–œæ¬¢ï¼‰ä»¥è¿™ç§æ–¹å¼æ­£å¼åŒ–å‡½æ•°ç±»å‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// middlewareæ˜¯ä¸€ä¸ªåŒ…è£…http.Handlersçš„å‡½æ•°</span></span><br><span class="line"><span class="comment">// åœ¨æ‰§è¡Œhå¤„ç†ç¨‹åºä¹‹å‰å’Œä¹‹åæä¾›åŠŸèƒ½</span></span><br><span class="line"><span class="keyword">type</span> middleware <span class="function"><span class="keyword">func</span><span class="params">(h http.Handler)</span></span> http.Handler</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ä¹Ÿå¯ä»¥ã€‚å¦‚æœæ‚¨å–œæ¬¢ï¼Œè¯·è¿™æ ·åšã€‚æˆ‘ä¸ä¼šåœ¨æ‚¨çš„å·¥ä½œå‘¨å›´ç­‰å¾…ï¼Œç„¶ååœ¨æ‚¨èº«è¾¹èµ°æ¥èµ°å»ï¼Œç”¨ä¸€ç§ä»¤äººç”Ÿç•çš„æ–¹å¼æ‚ç€æ‚¨çš„è‚©è†€ï¼Œé—®æ‚¨æ˜¯å¦å¯¹è‡ªå·±æ„Ÿåˆ°æ»¡æ„ã€‚</p>
<p>æˆ‘ä¸è¿™æ ·åšçš„åŸå› æ˜¯å› ä¸ºå®ƒå¢åŠ äº†é¢å¤–çš„é—´æ¥æ€§ã€‚å½“æ‚¨æŸ¥çœ‹ä¸Šé¢çš„<code>newMiddleware</code>å‡½æ•°çš„ç­¾åæ—¶ï¼Œå¾ˆæ˜æ˜¾æ­£åœ¨å‘ç”Ÿä»€ä¹ˆã€‚å¦‚æœè¿”å›ç±»å‹æ˜¯<code>middleware</code>ï¼Œåˆ™éœ€è¦é¢å¤–çš„å·¥ä½œã€‚å®é™…ä¸Šï¼Œæˆ‘ä¼˜åŒ–çš„æ˜¯é˜…è¯»ä»£ç ï¼Œè€Œä¸æ˜¯ç¼–å†™ä»£ç ã€‚</p>
<h3 id="éšè—è¯·æ±‚-å“åº”ç±»å‹çš„æœºä¼š"><a href="#éšè—è¯·æ±‚-å“åº”ç±»å‹çš„æœºä¼š" class="headerlink" title="éšè—è¯·æ±‚&#x2F;å“åº”ç±»å‹çš„æœºä¼š"></a>éšè—è¯·æ±‚&#x2F;å“åº”ç±»å‹çš„æœºä¼š</h3><p>å¦‚æœä¸€ä¸ªç«¯ç‚¹æœ‰è‡ªå·±çš„è¯·æ±‚å’Œå“åº”ç±»å‹ï¼Œé€šå¸¸å®ƒä»¬åªå¯¹è¯¥ç‰¹å®šå¤„ç†ç¨‹åºæœ‰ç”¨ã€‚</p>
<p>å¦‚æœæ˜¯è¿™æ ·çš„æƒ…å†µï¼Œæ‚¨å¯ä»¥åœ¨å‡½æ•°å†…éƒ¨å®šä¹‰å®ƒä»¬ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handleSomething</span><span class="params">()</span></span> http.HandlerFunc &#123;</span><br><span class="line">    <span class="keyword">type</span> request <span class="keyword">struct</span> &#123;</span><br><span class="line">        Name <span class="type">string</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">type</span> response <span class="keyword">struct</span> &#123;</span><br><span class="line">        Greeting <span class="type">string</span> <span class="string">`json:&quot;greeting&quot;`</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å¯ä»¥ä½¿å…¨å±€ç©ºé—´ä¿æŒæ¸…æ™°ï¼Œå¹¶é˜²æ­¢å…¶ä»–å¤„ç†ç¨‹åºä¾èµ–äºæ‚¨å¯èƒ½ä¸è®¤ä¸ºæ˜¯ç¨³å®šçš„æ•°æ®ã€‚</p>
<p>å½“æ‚¨çš„æµ‹è¯•ä»£ç éœ€è¦ä½¿ç”¨ç›¸åŒçš„ç±»å‹æ—¶ï¼Œæœ‰æ—¶ä¼šé‡åˆ°è¿™ç§æ–¹æ³•çš„æ‘©æ“¦ã€‚å…¬å¹³åœ°è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªå°†å®ƒä»¬æ‹†åˆ†å‡ºæ¥çš„å¥½ç†ç”±ï¼Œå¦‚æœæ‚¨æƒ³è¿™æ ·åšçš„è¯ã€‚</p>
<h2 id="åœ¨æµ‹è¯•ä¸­ä½¿ç”¨å†…è”è¯·æ±‚-å“åº”ç±»å‹è¿›è¡Œé¢å¤–çš„æ•…äº‹å™è¿°"><a href="#åœ¨æµ‹è¯•ä¸­ä½¿ç”¨å†…è”è¯·æ±‚-å“åº”ç±»å‹è¿›è¡Œé¢å¤–çš„æ•…äº‹å™è¿°" class="headerlink" title="åœ¨æµ‹è¯•ä¸­ä½¿ç”¨å†…è”è¯·æ±‚&#x2F;å“åº”ç±»å‹è¿›è¡Œé¢å¤–çš„æ•…äº‹å™è¿°"></a>åœ¨æµ‹è¯•ä¸­ä½¿ç”¨å†…è”è¯·æ±‚&#x2F;å“åº”ç±»å‹è¿›è¡Œé¢å¤–çš„æ•…äº‹å™è¿°</h2><p>å¦‚æœæ‚¨çš„è¯·æ±‚&#x2F;å“åº”ç±»å‹åœ¨å¤„ç†ç¨‹åºå†…éƒ¨éšè—ï¼Œæ‚¨å¯ä»¥åœ¨æµ‹è¯•ä»£ç ä¸­å£°æ˜æ–°ç±»å‹ã€‚</p>
<p>è¿™æ˜¯ä¸€ä¸ªæœºä¼šï¼Œå¯ä»¥å‘æœªæ¥éœ€è¦ç†è§£æ‚¨çš„ä»£ç çš„äººè®²è¿°ä¸€äº›æ•…äº‹ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬çš„ä»£ç ä¸­æœ‰ä¸€ä¸ª<code>Person</code>ç±»å‹ï¼Œå¹¶ä¸”æˆ‘ä»¬åœ¨è®¸å¤šç«¯ç‚¹ä¸Šé‡å¤ä½¿ç”¨å®ƒã€‚å¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ª<code>/greet</code>ç«¯ç‚¹ï¼Œæˆ‘ä»¬å¯èƒ½åªå…³å¿ƒä»–ä»¬çš„å§“åï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨æµ‹è¯•ä»£ç ä¸­è¡¨è¾¾è¿™ä¸€ç‚¹ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestGreet</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">    is := is.New(t)</span><br><span class="line"></span><br><span class="line">    person := <span class="keyword">struct</span> &#123;</span><br><span class="line">        Name <span class="type">string</span> <span class="string">`json:&quot;name&quot;`</span></span><br><span class="line">    &#125;&#123;</span><br><span class="line">        Name: <span class="string">&quot;Mat Ryer&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> buf bytes.Buffer</span><br><span class="line">    err := json.NewEncoder(&amp;buf).Encode(person)</span><br><span class="line">    is.NoErr(err)</span><br><span class="line"></span><br><span class="line">    req, err := http.NewRequest(http.MethodPost, <span class="string">&quot;/greet&quot;</span>, &amp;buf)</span><br><span class="line">    is.NoErr(err)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//... more test code here</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»è¿™ä¸ªæµ‹è¯•ä¸­å¯ä»¥æ˜ç¡®çœ‹å‡ºï¼Œæˆ‘ä»¬åªå…³å¿ƒ<code>Name</code>å­—æ®µã€‚</p>
<h2 id="ä½¿ç”¨sync-Onceå»¶è¿Ÿè®¾ç½®"><a href="#ä½¿ç”¨sync-Onceå»¶è¿Ÿè®¾ç½®" class="headerlink" title="ä½¿ç”¨sync.Onceå»¶è¿Ÿè®¾ç½®"></a>ä½¿ç”¨<code>sync.Once</code>å»¶è¿Ÿè®¾ç½®</h2><p>å¦‚æœåœ¨å‡†å¤‡å¤„ç†ç¨‹åºæ—¶éœ€è¦æ‰§è¡Œä»»ä½•æ˜‚è´µçš„æ“ä½œï¼Œæˆ‘ä¼šå°†å…¶æ¨è¿Ÿåˆ°é¦–æ¬¡è°ƒç”¨è¯¥å¤„ç†ç¨‹åºæ—¶ã€‚</p>
<p>è¿™æé«˜äº†åº”ç”¨ç¨‹åºçš„å¯åŠ¨æ—¶é—´ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handleTemplate</span><span class="params">(files <span class="type">string</span>...)</span></span> http.HandlerFunc &#123;</span><br><span class="line">    <span class="keyword">var</span> (</span><br><span class="line">        init   sync.Once</span><br><span class="line">        tpl    *template.Template</span><br><span class="line">        tplerr <span class="type">error</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">        init.Do(<span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">            tpl, tplerr = template.ParseFiles(files...)</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> tplerr != <span class="literal">nil</span> &#123;</span><br><span class="line">            http.Error(w, tplerr.Error(), http.StatusInternalServerError)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// use tpl</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>sync.Once</code>ç¡®ä¿ä»£ç åªæ‰§è¡Œä¸€æ¬¡ï¼Œå¹¶ä¸”å…¶ä»–è°ƒç”¨ï¼ˆå…¶ä»–äººå‘èµ·ç›¸åŒè¯·æ±‚ï¼‰å°†é˜»å¡ï¼Œç›´åˆ°å®Œæˆã€‚</p>
<ul>
<li>é”™è¯¯æ£€æŸ¥ä½äº<code>init</code>å‡½æ•°ä¹‹å¤–ï¼Œå› æ­¤å¦‚æœå‡ºç°é—®é¢˜ï¼Œæˆ‘ä»¬ä»ç„¶ä¼šæ˜¾ç¤ºé”™è¯¯ï¼Œå¹¶ä¸”ä¸ä¼šåœ¨æ—¥å¿—ä¸­ä¸¢å¤±å®ƒã€‚</li>
<li>å¦‚æœä¸è°ƒç”¨å¤„ç†ç¨‹åºï¼Œåˆ™ä¸ä¼šæ‰§è¡Œæ˜‚è´µçš„å·¥ä½œ - è¿™å¯èƒ½åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šæœ‰ç›Šï¼Œè¿™å–å†³äºä»£ç çš„éƒ¨ç½²æ–¹å¼ã€‚</li>
</ul>
<p>è¯·è®°ä½ï¼Œé€šè¿‡è¿™æ ·åšï¼Œæ‚¨å°†åˆå§‹åŒ–æ—¶é—´ä»å¯åŠ¨æ—¶ç§»åŠ¨åˆ°è¿è¡Œæ—¶ï¼ˆé¦–æ¬¡è®¿é—®ç«¯ç‚¹æ—¶ï¼‰ã€‚æˆ‘ç»å¸¸ä½¿ç”¨Google App Engineï¼Œæ‰€ä»¥å¯¹æˆ‘æ¥è¯´è¿™æ˜¯æœ‰æ„ä¹‰çš„ï¼Œä½†æ‚¨çš„æƒ…å†µå¯èƒ½ä¸åŒï¼Œå› æ­¤å€¼å¾—è€ƒè™‘ä½•æ—¶ä½•åœ°ä»¥è¿™ç§æ–¹å¼ä½¿ç”¨<code>sync.Once</code>ã€‚</p>
<h2 id="ä¸ºå¯æµ‹è¯•æ€§è®¾è®¡"><a href="#ä¸ºå¯æµ‹è¯•æ€§è®¾è®¡" class="headerlink" title="ä¸ºå¯æµ‹è¯•æ€§è®¾è®¡"></a>ä¸ºå¯æµ‹è¯•æ€§è®¾è®¡</h2><p>è¿™äº›æ¨¡å¼çš„å‘å±•éƒ¨åˆ†æ˜¯å› ä¸ºå®ƒä»¬åœ¨æµ‹è¯•ä»£ç ä¸­éå¸¸å®¹æ˜“æµ‹è¯•ä»£ç ã€‚<code>run</code>å‡½æ•°æ˜¯ä»æµ‹è¯•ä»£ç ä¸­ç›´æ¥è¿è¡Œç¨‹åºçš„ç®€å•æ–¹æ³•ã€‚</p>
<p>åœ¨Goä¸­ï¼Œæœ‰å¾ˆå¤šæµ‹è¯•é€‰é¡¹ï¼Œå®ƒä»¬ä¸æ˜¯å…³äºå¯¹ä¸é”™çš„é—®é¢˜ï¼Œè€Œæ˜¯å…³äºï¼š</p>
<ul>
<li>æŸ¥çœ‹æµ‹è¯•ä»£ç æ˜¯å¦å¯ä»¥è½»æ¾ç†è§£æ‚¨çš„ç¨‹åºåœ¨åšä»€ä¹ˆï¼Ÿ</li>
<li>æ‚¨æ˜¯å¦å¯ä»¥è½»æ¾æ›´æ”¹ä»£ç è€Œä¸å¿…æ‹…å¿ƒç ´åå…¶ä»–éƒ¨åˆ†ï¼Ÿ</li>
<li>å¦‚æœæ‰€æœ‰æµ‹è¯•éƒ½é€šè¿‡ï¼Œæ‚¨æ˜¯å¦å¯ä»¥æ¨é€åˆ°ç”Ÿäº§ç¯å¢ƒï¼Œè¿˜æ˜¯è¿˜éœ€è¦æ¶µç›–æ›´å¤šå†…å®¹ï¼Ÿ</li>
</ul>
<h3 id="å•å…ƒæµ‹è¯•çš„å•å…ƒæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#å•å…ƒæµ‹è¯•çš„å•å…ƒæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="å•å…ƒæµ‹è¯•çš„å•å…ƒæ˜¯ä»€ä¹ˆï¼Ÿ"></a>å•å…ƒæµ‹è¯•çš„å•å…ƒæ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>éµå¾ªè¿™äº›æ¨¡å¼ï¼Œå¤„ç†ç¨‹åºæœ¬èº«ä¹Ÿæ˜¯å¯ä»¥ç‹¬ç«‹æµ‹è¯•çš„ï¼Œä½†æˆ‘é€šå¸¸ä¸è¿™æ ·åšï¼Œæˆ‘å°†åœ¨ä¸‹é¢è§£é‡Šä¸ºä»€ä¹ˆã€‚æ‚¨å¿…é¡»è€ƒè™‘å¯¹äºæ‚¨çš„é¡¹ç›®æ¥è¯´ä»€ä¹ˆæ˜¯æœ€ä½³æ–¹æ³•ã€‚</p>
<p>è¦ä»…æµ‹è¯•å¤„ç†ç¨‹åºï¼Œæ‚¨å¯ä»¥ï¼š</p>
<ol>
<li>è°ƒç”¨å‡½æ•°ä»¥è·å–<code>http.Handler</code> - æ‚¨å¿…é¡»ä¼ é€’æ‰€æœ‰æ‰€éœ€çš„ä¾èµ–é¡¹ï¼ˆè¿™æ˜¯ä¸€é¡¹åŠŸèƒ½ï¼‰ã€‚</li>
<li>ä½¿ç”¨çœŸå®çš„<code>http.Request</code>å’Œæ¥è‡ª<code>httptest</code>åŒ…çš„<code>ResponseRecorder</code>è°ƒç”¨<code>ServeHTTP</code>æ–¹æ³•ï¼ˆè¯·å‚é˜…<a href="https://pkg.go.dev/net/http/httptest#ResponseRecorder">https://pkg.go.dev/net/http/httptest#ResponseRecorder</a>ï¼‰ã€‚</li>
<li>å¯¹å“åº”è¿›è¡Œæ–­è¨€ï¼ˆæ£€æŸ¥çŠ¶æ€ç ï¼Œè§£ç ä¸»ä½“å¹¶ç¡®ä¿æ­£ç¡®ï¼Œæ£€æŸ¥ä»»ä½•é‡è¦çš„æ ‡å¤´ç­‰ï¼‰ã€‚</li>
</ol>
<p>å¦‚æœè¿™æ ·åšï¼Œæ‚¨å°†è·³è¿‡ä»»ä½•åƒèº«ä»½éªŒè¯è¿™æ ·çš„ä¸­é—´ä»¶ï¼Œç›´æ¥è¿›å…¥å¤„ç†ç¨‹åºä»£ç ã€‚å¦‚æœæœ‰ç‰¹å®šçš„å¤æ‚æ€§éœ€è¦æ„å»ºä¸€äº›æµ‹è¯•æ”¯æŒï¼Œè¿™æ˜¯å¾ˆå¥½çš„ã€‚ç„¶è€Œï¼Œå½“æ‚¨çš„æµ‹è¯•ä»£ç åƒçœŸå®ç”¨æˆ·ä¸€æ ·è°ƒç”¨APIæ—¶ï¼Œä¼šæœ‰ä¸€ä¸ªä¼˜åŠ¿ã€‚åœ¨è¿™ä¸ªå±‚é¢ä¸Šï¼Œæˆ‘æ›´å€¾å‘äºç«¯åˆ°ç«¯æµ‹è¯•ï¼Œè€Œä¸æ˜¯å•å…ƒæµ‹è¯•æ‰€æœ‰å†…éƒ¨éƒ¨ä»¶ã€‚</p>
<p>æˆ‘å®æ„¿è°ƒç”¨<code>run</code>å‡½æ•°ä»¥å°½å¯èƒ½æ¥è¿‘å®ƒåœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿è¡Œçš„æ–¹å¼è¿è¡Œæ•´ä¸ªç¨‹åºã€‚è¿™å°†è§£æä»»ä½•å‚æ•°ï¼Œè¿æ¥åˆ°ä»»ä½•ä¾èµ–é¡¹ï¼Œè¿ç§»æ•°æ®åº“ï¼Œæ— è®ºå®ƒåœ¨é‡å¤–åšä»€ä¹ˆï¼Œæœ€ç»ˆå¯åŠ¨æœåŠ¡å™¨ã€‚ç„¶åï¼Œå½“æˆ‘ä»æµ‹è¯•ä»£ç ä¸­è®¿é—®APIæ—¶ï¼Œæˆ‘ä¼šç©¿è¿‡æ‰€æœ‰å±‚ï¼Œå¹¶ä¸çœŸå®æ•°æ®åº“äº¤äº’ã€‚æˆ‘è¿˜ä¼šåŒæ—¶æµ‹è¯•<code>routes.go</code>ã€‚</p>
<p>æˆ‘å‘ç°ï¼Œé€šè¿‡è¿™ç§æ–¹æ³•ï¼Œæˆ‘èƒ½å¤Ÿæ›´æ—©åœ°å‘ç°æ›´å¤šçš„é—®é¢˜ï¼Œå¹¶ä¸”å¯ä»¥é¿å…ç‰¹å®šåœ°æµ‹è¯•æ ·æ¿ä»£ç ã€‚å®ƒè¿˜å‡å°‘äº†æµ‹è¯•ä¸­çš„é‡å¤ã€‚å¦‚æœæˆ‘å‹¤å¥‹åœ°æµ‹è¯•æ¯ä¸€å±‚ï¼Œæˆ‘å¯èƒ½ä¼šä»¥ç¨å¾®ä¸åŒçš„æ–¹å¼å¤šæ¬¡è¯´ç›¸åŒçš„äº‹æƒ…ã€‚æ‚¨å¿…é¡»ç»´æŠ¤æ‰€æœ‰è¿™äº›å†…å®¹ï¼Œå› æ­¤å¦‚æœæ‚¨æƒ³è¦æ›´æ”¹æŸäº›å†…å®¹ï¼Œæ›´æ–°ä¸€ä¸ªå‡½æ•°å’Œä¸‰ä¸ªæµ‹è¯•å¹¶ä¸æ„Ÿè§‰éå¸¸æœ‰æ•ˆç‡ã€‚é€šè¿‡ç«¯åˆ°ç«¯æµ‹è¯•ï¼Œæ‚¨åªéœ€ä¸€ä¸ªä¸»è¦æµ‹è¯•é›†ï¼Œæè¿°ç”¨æˆ·ä¸ç³»ç»Ÿä¹‹é—´çš„äº¤äº’ã€‚</p>
<p>åœ¨å…¶ä¸­é€‚å½“çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»ç„¶åœ¨å…¶ä¸­ä½¿ç”¨å•å…ƒæµ‹è¯•ã€‚å¦‚æœæˆ‘ä½¿ç”¨TDDï¼ˆæˆ‘ç»å¸¸è¿™æ ·åšï¼‰ï¼Œé‚£ä¹ˆæˆ‘é€šå¸¸å·²ç»å®Œæˆäº†å¾ˆå¤šæµ‹è¯•ï¼Œæˆ‘å¾ˆä¹æ„ç»´æŠ¤å®ƒä»¬ã€‚ä½†æ˜¯ï¼Œå¦‚æœè¿™äº›æµ‹è¯•åœ¨é‡å¤ä¸ç«¯åˆ°ç«¯æµ‹è¯•ä¸­ç›¸åŒçš„å†…å®¹ï¼Œæˆ‘å°†è¿”å›å¹¶åˆ é™¤å®ƒä»¬ã€‚</p>
<p>è¿™ä¸ªå†³å®šå°†å–å†³äºå¾ˆå¤šå› ç´ ï¼Œä»å‘¨å›´äººçš„æ„è§åˆ°é¡¹ç›®çš„å¤æ‚æ€§ï¼Œå› æ­¤åƒæœ¬æ–‡ä¸­çš„æ‰€æœ‰å»ºè®®ä¸€æ ·ï¼Œå¦‚æœè¿™å¯¹æ‚¨æ¥è¯´è¡Œä¸é€šï¼Œä¸è¦å¼ºæ±‚ã€‚</p>
<h3 id="ä½¿ç”¨runå‡½æ•°è¿›è¡Œæµ‹è¯•"><a href="#ä½¿ç”¨runå‡½æ•°è¿›è¡Œæµ‹è¯•" class="headerlink" title="ä½¿ç”¨runå‡½æ•°è¿›è¡Œæµ‹è¯•"></a>ä½¿ç”¨<code>run</code>å‡½æ•°è¿›è¡Œæµ‹è¯•</h3><p>æˆ‘å–œæ¬¢åœ¨æ¯ä¸ªæµ‹è¯•ä¸­è°ƒç”¨<code>run</code>å‡½æ•°ã€‚æ¯ä¸ªæµ‹è¯•éƒ½ä¼šè·å¾—ä¸€ä¸ªç‹¬ç«‹çš„ç¨‹åºå®ä¾‹ã€‚å¯¹äºæ¯ä¸ªæµ‹è¯•ï¼Œæˆ‘å¯ä»¥ä¼ é€’ä¸åŒçš„å‚æ•°ã€æ ‡å¿—å€¼ã€æ ‡å‡†è¾“å…¥å’Œè¾“å‡ºç®¡é“ï¼Œç”šè‡³ç¯å¢ƒå˜é‡ã€‚</p>
<p>ç”±äº<code>run</code>å‡½æ•°æ¥å—ä¸€ä¸ª<code>context.Context</code>ï¼Œè€Œä¸”æˆ‘ä»¬çš„æ‰€æœ‰ä»£ç éƒ½éµå®ˆä¸Šä¸‹æ–‡ï¼ˆå¯¹å§ï¼Œå¤§å®¶éƒ½éµå®ˆä¸Šä¸‹æ–‡ï¼Œå¯¹å§ï¼Ÿï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨<code>context.WithCancel</code>æ¥è·å¾—ä¸€ä¸ªå–æ¶ˆå‡½æ•°ã€‚é€šè¿‡å»¶è¿Ÿæ‰§è¡Œ<code>cancel</code>å‡½æ•°ï¼Œå½“æµ‹è¯•å‡½æ•°è¿”å›æ—¶ï¼ˆå³æµ‹è¯•è¿è¡Œç»“æŸæ—¶ï¼‰ï¼Œä¸Šä¸‹æ–‡å°†è¢«å–æ¶ˆï¼Œç¨‹åºå°†ä¼˜é›…åœ°å…³é—­ã€‚åœ¨Go 1.14ä¸­ï¼Œä»–ä»¬æ·»åŠ äº†<code>t.Cleanup</code>æ–¹æ³•ï¼Œå®ƒæ˜¯å¯¹ä½¿ç”¨<code>defer</code>å…³é”®å­—çš„æ›¿ä»£æ–¹æ³•ï¼Œå¦‚æœä½ æƒ³äº†è§£æ›´å¤šå…³äºä¸ºä»€ä¹ˆè¦è¿™æ ·åšçš„åŸå› ï¼Œè¯·æŸ¥çœ‹è¿™ä¸ªé—®é¢˜ï¼š<a href="https://github.com/golang/go/issues/37333">https://github.com/golang/go/issues/37333</a>ã€‚</p>
<p>è¿™ä¸€åˆ‡åªéœ€è¦å¾ˆå°‘çš„ä»£ç å°±èƒ½å®ç°ã€‚å½“ç„¶ï¼Œä½ è¿˜å¿…é¡»ä¸€ç›´æ£€æŸ¥<code>ctx.Err</code>æˆ–<code>ctx.Done</code>ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Test</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">    ctx := context.Background()</span><br><span class="line">    ctx, cancel := context.WithCancel(ctx)</span><br><span class="line">    t.Cleanup(cancel)</span><br><span class="line">    <span class="keyword">go</span> run(ctx) <span class="comment">// æµ‹è¯•ä»£ç æ”¾åœ¨è¿™é‡Œ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ç­‰å¾…å°±ç»ªçŠ¶æ€"><a href="#ç­‰å¾…å°±ç»ªçŠ¶æ€" class="headerlink" title="ç­‰å¾…å°±ç»ªçŠ¶æ€"></a>ç­‰å¾…å°±ç»ªçŠ¶æ€</h3><p>ç”±äº<code>run</code>å‡½æ•°åœ¨ä¸€ä¸ªgoroutineä¸­æ‰§è¡Œï¼Œæˆ‘ä»¬ä¸çŸ¥é“å®ƒä½•æ—¶å‡†å¤‡å°±ç»ªã€‚å¦‚æœæˆ‘ä»¬è¦åƒçœŸæ­£çš„ç”¨æˆ·ä¸€æ ·å¼€å§‹ä½¿ç”¨APIï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“ä½•æ—¶å®ƒå‡†å¤‡å°±ç»ªã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥è®¾ç½®ä¸€ç§ä¿¡å·å°±ç»ªçš„æ–¹å¼ï¼Œæ¯”å¦‚ä¸€ä¸ªé€šé“ä¹‹ç±»çš„ä¸œè¥¿ï¼Œä½†æˆ‘æ›´å–œæ¬¢åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œä¸€ä¸ª<code>/healthz</code>æˆ–<code>/readyz</code>ç«¯ç‚¹ã€‚æ­£å¦‚æˆ‘å¹´è¿ˆçš„ç¥–æ¯å¸¸è¯´çš„é‚£æ ·ï¼Œå¸ƒä¸çš„çœŸæ­£å¥½ååœ¨äºå®é™…çš„HTTPè¯·æ±‚ï¼ˆå¥¹å½“æ—¶å°±å¾ˆå…ˆè¿›ï¼‰ã€‚</p>
<p>è¿™æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬åŠªåŠ›ä½¿ä»£ç æ›´å…·å¯æµ‹è¯•æ€§ï¼Œä¹Ÿè®©æˆ‘ä»¬äº†è§£åˆ°ç”¨æˆ·çš„éœ€æ±‚ã€‚ä»–ä»¬å¯èƒ½ä¹Ÿæƒ³çŸ¥é“æœåŠ¡æ˜¯å¦å·²ç»å°±ç»ªï¼Œé‚£ä¸ºä»€ä¹ˆä¸æä¾›ä¸€ç§å®˜æ–¹çš„æ–¹å¼æ¥è·å–è¿™ä¸ªä¿¡æ¯å‘¢ï¼Ÿ</p>
<p>è¦ç­‰å¾…æœåŠ¡å°±ç»ªï¼Œä½ å¯ä»¥ç¼–å†™ä¸€ä¸ªå¾ªç¯ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// waitForReadyè°ƒç”¨æŒ‡å®šçš„ç«¯ç‚¹ï¼Œç›´åˆ°æ”¶åˆ°200å“åº”ï¼Œæˆ–è€…ä¸Šä¸‹æ–‡è¢«å–æ¶ˆï¼Œæˆ–è€…è¶…æ—¶è¾¾åˆ°ã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">waitForReady</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    ctx context.Context,</span></span></span><br><span class="line"><span class="params"><span class="function">    timeout time.Duration,</span></span></span><br><span class="line"><span class="params"><span class="function">    endpoint <span class="type">string</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span> <span class="type">error</span> &#123;</span><br><span class="line">    client := http.Client&#123;&#125;</span><br><span class="line">    startTime := time.Now()</span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">        req, err := http.NewRequestWithContext(</span><br><span class="line">            ctx,</span><br><span class="line">            http.MethodGet,</span><br><span class="line">            endpoint,</span><br><span class="line">            <span class="literal">nil</span>,</span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;failed to create request: %w&quot;</span>, err)</span><br><span class="line">        &#125;</span><br><span class="line">        resp, err := client.Do(req)</span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">            fmt.Printf(<span class="string">&quot;Error making request: %s\n&quot;</span>, err.Error())</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> resp.StatusCode == http.StatusOK &#123;</span><br><span class="line">            fmt.Println(<span class="string">&quot;Endpoint is ready!&quot;</span>)</span><br><span class="line">            resp.Body.Close()</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">        &#125;</span><br><span class="line">        resp.Body.Close()</span><br><span class="line">        <span class="keyword">select</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> &lt;-ctx.Done():</span><br><span class="line">            <span class="keyword">return</span> ctx.Err()</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">if</span> time.Since(startTime) &gt;= timeout &#123;</span><br><span class="line">                <span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;timeout reached while waiting for endpoint&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// æ¯æ¬¡æ£€æŸ¥ä¹‹é—´ç­‰å¾…ä¸€å°æ®µæ—¶é—´</span></span><br><span class="line">            time.Sleep(<span class="number">250</span> * time.Millisecond)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å°†æ‰€æœ‰è¿™äº›ä»˜è¯¸å®è·µ"><a href="#å°†æ‰€æœ‰è¿™äº›ä»˜è¯¸å®è·µ" class="headerlink" title="å°†æ‰€æœ‰è¿™äº›ä»˜è¯¸å®è·µ"></a>å°†æ‰€æœ‰è¿™äº›ä»˜è¯¸å®è·µ</h2><p>ä½¿ç”¨è¿™äº›æŠ€æœ¯æ¥æ„å»ºç®€å•çš„APIä»ç„¶æ˜¯æˆ‘æœ€å–œæ¬¢çš„æ–¹æ³•ã€‚å®ƒç¬¦åˆæˆ‘è¿½æ±‚çš„ç›®æ ‡ï¼Œå³é€šè¿‡æ˜“äºé˜…è¯»ã€æ˜“äºé€šè¿‡å¤åˆ¶æ¨¡å¼æ‰©å±•ã€æ˜“äºæ–°äººä½¿ç”¨ã€æ˜“äºä¿®æ”¹è€Œæ— éœ€æ‹…å¿ƒã€æ˜ç¡®åœ°ä¸ä½¿ç”¨ä»»ä½•é­”æ³•æ¥å®ç°å¯ç»´æŠ¤æ€§çš„å“è¶Šä»£ç ã€‚å³ä½¿åœ¨æˆ‘ä½¿ç”¨åƒæˆ‘ä»¬è‡ªå·±çš„<a href="https://github.com/pacedotdev/oto">OtoåŒ…</a>è¿™æ ·çš„ä»£ç ç”Ÿæˆæ¡†æ¶æ¥æ ¹æ®æˆ‘è‡ªå®šä¹‰çš„æ¨¡æ¿ä¸ºæˆ‘ç¼–å†™æ ·æ¿ä»£ç çš„æƒ…å†µä¸‹ï¼Œè¿™ä¸€ç‚¹ä»ç„¶æˆç«‹ã€‚</p>
<p>åœ¨æ›´å¤§çš„é¡¹ç›®æˆ–è¾ƒå¤§çš„ç»„ç»‡ä¸­ï¼Œç‰¹åˆ«æ˜¯åƒGrafana Labsè¿™æ ·çš„ç»„ç»‡ï¼Œä½ ç»å¸¸ä¼šé‡åˆ°å½±å“è¿™äº›å†³ç­–çš„ç‰¹å®šæŠ€æœ¯é€‰æ‹©ã€‚gRPCå°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ã€‚åœ¨å·²ç»å½¢æˆäº†ä¸€äº›æ¨¡å¼å’Œç»éªŒã€æˆ–è€…å…¶ä»–å¹¿æ³›ä½¿ç”¨çš„å·¥å…·æˆ–æŠ½è±¡å­˜åœ¨çš„æƒ…å†µä¸‹ï¼Œä½ ç»å¸¸ä¼šå‘ç°è‡ªå·±åšå‡ºå®ç”¨ä¸»ä¹‰çš„é€‰æ‹©ï¼Œè·Ÿéšæ½®æµï¼Œå°½ç®¡æˆ‘æ€€ç–‘ï¼ˆæˆ–è€…è¯´å¸Œæœ›ï¼Ÿï¼‰è¿™ç¯‡æ–‡ç« å¯¹ä½ ä»ç„¶æœ‰ä¸€äº›æœ‰ç”¨çš„ä¸œè¥¿ã€‚</p>
<p>æˆ‘çš„æ—¥å¸¸å·¥ä½œæ˜¯ä¸Grafana Labså†…éƒ¨çš„ä¸€ç»„æ‰åæ¨ªæº¢çš„äººå‘˜ä¸€èµ·æ„å»ºæ–°çš„<a href="https://grafana.com/products/cloud/irm/">Grafana IRM</a>å¥—ä»¶ã€‚æœ¬æ–‡è®¨è®ºçš„æ¨¡å¼å¸®åŠ©æˆ‘ä»¬äº¤ä»˜å¯é çš„å·¥å…·ã€‚å¬åˆ°ä½ åœ¨å±å¹•å‰å¤§å–Šâ€œå‘Šè¯‰æˆ‘æ›´å¤šå…³äºè¿™äº›ä¼Ÿå¤§çš„å·¥å…·çš„äº‹æƒ…ï¼â€ã€‚</p>
<p>å¤§å¤šæ•°äººä½¿ç”¨Grafanaæ¥å¯è§†åŒ–ä»–ä»¬çš„ç³»ç»Ÿè¿è¡Œæƒ…å†µï¼Œå¹¶ä¸”é€šè¿‡Grafana Alertingåœ¨æŒ‡æ ‡è¶…å‡ºå¯æ¥å—èŒƒå›´æ—¶æ”¶åˆ°é€šçŸ¥ã€‚æœ‰äº†Grafana OnCallï¼Œä½ çš„è®¡åˆ’å’Œå‡çº§è§„åˆ™å°†è‡ªåŠ¨åŒ–å¤„ç†å‡ºç°é—®é¢˜æ—¶ä¸æ­£ç¡®äººå‘˜è”ç³»çš„è¿‡ç¨‹ã€‚</p>
<p>Grafana Incidentè®©ä½ ç®¡ç†é‚£äº›ä¸å¯é¿å…çš„å…¨å‘˜å‚ä¸æ—¶åˆ»ï¼Œè¿™å¯¹æˆ‘ä»¬å¤§å¤šæ•°äººæ¥è¯´éƒ½å¤ªç†Ÿæ‚‰äº†ã€‚å®ƒä¸ºä½ åˆ›å»ºZoomä¼šè®®å®¤ï¼Œä¸€ä¸ªä¸“ç”¨çš„Slacké¢‘é“ï¼Œå¹¶è·Ÿè¸ªäº‹ä»¶çš„æ—¶é—´çº¿ï¼Œè®©ä½ ä¸“æ³¨äºè§£å†³é—®é¢˜ã€‚åœ¨Slackä¸­ï¼Œä½ åœ¨é¢‘é“ä¸­ä»¥æœºå™¨äººè¡¨æƒ…ç¬¦å·ä½œä¸ºååº”æ ‡è®°çš„ä»»ä½•å†…å®¹éƒ½å°†æ·»åŠ åˆ°æ—¶é—´çº¿ä¸­ã€‚è¿™æ ·ï¼Œåœ¨è¿›è¡Œæ€»ç»“æˆ–äº‹åå®¡æŸ¥è®¨è®ºæ—¶ï¼Œå¾ˆå®¹æ˜“æ”¶é›†å…³é”®äº‹ä»¶ã€‚</p>
]]></content>
      <categories>
        <category>go</category>
      </categories>
      <tags>
        <tag>ç¿»è¯‘</tag>
        <tag>GO</tag>
      </tags>
  </entry>
  <entry>
    <title>ç©è½¬memos</title>
    <url>/2023/11/26/%E7%8E%A9%E8%BD%ACmemos/</url>
    <content><![CDATA[<p>memos æ˜¯ä¸€ä¸ªå¼€æºçš„ï¼Œç±»ä¼¼flomo çš„ ç¬”è®°æœåŠ¡ï¼ŒåŒæ—¶æ”¯æŒï¼Œå¾®ä¿¡å°ç¨‹åºã€Obsidianã€logseq ç­‰æ•ˆç‡å·¥å…·çš„è”åŠ¨ï¼Œå¯ç©æ€§æ¯”è¾ƒå¥½ã€‚</p>
<span id="more"></span>
<h2 id="æ­å»º"><a href="#æ­å»º" class="headerlink" title="æ­å»º"></a>æ­å»º</h2><p>memos å®˜æ–¹æä¾›dockerï¼Œæ‰€ä»¥åªéœ€è¦å†ä»»æ„ä¸€å°æœ‰å®‰è£…docker çš„æœºå™¨ä¸Šå°±å¯ä»¥å®‰è£…è¿è¡Œã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -d --name memos -p 5230:5230 -v ~/.memos/:/var/opt/memos ghcr.io/usememos/memos:latest</span><br></pre></td></tr></table></figure>
<p>æˆ–è€…</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line">version: <span class="string">&#x27;3&#x27;</span></span><br><span class="line">services:</span><br><span class="line">  memos:</span><br><span class="line">    image: ghcr.io/usememos/memos:latest</span><br><span class="line">    container_name: memos</span><br><span class="line">    ports:</span><br><span class="line">      - <span class="number">5230</span>:<span class="number">5230</span></span><br><span class="line">    volumes:</span><br><span class="line">      - ~/.memos/:/var/opt/memos</span><br><span class="line">    restart: always</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­<code>~/.memos/</code> sqllite ç­‰æ•°æ®æ–‡ä»¶çš„ç›®å½•ï¼Œå¯ä»¥æŒ‡å®šæˆä»»æ„çš„ç›®å½•ã€‚<br>è¿™æ ·memos å°±èƒ½æ­å»ºäº†ï¼Œé€šè¿‡ <a href="http://127.0.0.1:5230/">http://127.0.0.1:5230</a> å°±å¯ä»¥è®¿é—®äº†ã€‚<br>æ•ˆæœå¦‚ä¸‹<br><img src="https://images.hxzhouh.com/blog-images/2023/11/a0575a5f76c15cfde90390fff6fc5595.png"></p>
<h3 id="å¯ç”¨-https"><a href="#å¯ç”¨-https" class="headerlink" title="å¯ç”¨ https"></a>å¯ç”¨ https</h3><p>ä¸ºäº†å®‰å…¨å¯ä»¥nginx + dns è§£æ æ”¯æŒhttpsã€‚è¿™é‡Œä¸å±•å¼€ï¼Œå¯ä»¥å‚è€ƒ å…¶ä»–åšå®¢æˆ–è€…<a href="https://hexo.hxzhouh.com/2023/09/23/%E5%9C%A8VPS%E4%B8%8A%E6%90%AD%E5%BB%BAvaultwarden/">åœ¨VPSä¸Šæ­å»ºvaultwarden</a>ï¼Œæˆ‘çš„é…ç½®æ˜¯</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">                listen 443 ssl;</span><br><span class="line">                server_name memos.hxzhouh.com;</span><br><span class="line"></span><br><span class="line">                ssl_certificate /etc/nginx/cert/public.pem;</span><br><span class="line">                ssl_certificate_key /etc/nginx/cert/private.key;</span><br><span class="line">                #ssl_certificate /path/to/your/ssl_certificate.pem; # æ‚¨çš„ SSL è¯ä¹¦è·¯å¾„</span><br><span class="line">                #ssl_certificate_key /path/to/your/ssl_certificate_key.key; # æ‚¨çš„ SSL å¯†é’¥è·¯å¾„</span><br><span class="line">                location / &#123;</span><br><span class="line">                        proxy_pass http://127.0.0.1:5230/;</span><br><span class="line">                        rewrite ^/(.*)$ /$1 break;</span><br><span class="line">                        proxy_redirect off;</span><br><span class="line">                        proxy_set_header Host $host;</span><br><span class="line">                        proxy_set_header X-Forwarded-Proto $scheme;</span><br><span class="line">                        proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">                        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">                        proxy_set_header Upgrade-Insecure-Requests 1;</span><br><span class="line">                        proxy_set_header X-Forwarded-Proto https;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<h2 id="æ•°æ®å¤‡ä»½"><a href="#æ•°æ®å¤‡ä»½" class="headerlink" title="æ•°æ®å¤‡ä»½"></a>æ•°æ®å¤‡ä»½</h2><p>æ•°æ®å¤‡ä»½ï¼Œå¯ä»¥ä½¿ç”¨<code>rclone</code> å·¥å…·ï¼Œå¤‡ä»½<code>~/.memos/</code> ç›®å½•ï¼Œæˆ–è€…ç›´æ¥ä½¿ç”¨ memos æä¾›çš„å°†æ•°æ®å­˜å‚¨åˆ°S3</p>
<h2 id="æ‹“å±•åŠŸèƒ½"><a href="#æ‹“å±•åŠŸèƒ½" class="headerlink" title="æ‹“å±•åŠŸèƒ½"></a>æ‹“å±•åŠŸèƒ½</h2><h3 id="æ‰“é€š-Obsidian"><a href="#æ‰“é€š-Obsidian" class="headerlink" title="æ‰“é€š Obsidian"></a>æ‰“é€š Obsidian</h3><h3 id="æ‰“é€šå¾®ä¿¡"><a href="#æ‰“é€šå¾®ä¿¡" class="headerlink" title="æ‰“é€šå¾®ä¿¡"></a>æ‰“é€šå¾®ä¿¡</h3><p>æ‰“é€šå¾®ä¿¡æ˜¯ç”¨ä¸€ä¸ªå°ç¨‹åºå®ç°çš„ï¼Œå…·ä½“å¯ä»¥å‚è€ƒè¿™ä¸ªé¡¹ç›®**<a href="https://github.com/Rabithua/memos_wmp">memos_wmp</a>**<br>ä½†æ˜¯ï¼Œæˆ‘æ²¡æœ‰å·²ç»å¤‡æ¡ˆçš„åŸŸåï¼Œæ‰€ä»¥è¿™æ­¥å°±æ”¾å¼ƒäº†ã€‚</p>
<h3 id="raycast"><a href="#raycast" class="headerlink" title="raycast"></a>raycast</h3><p>raycast æ”¯æŒ memos <a href="https://www.raycast.com/JakeYu/memos">æ’ä»¶</a>ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„åœ¨raycastä¸­ä½¿ç”¨ memos</p>
<h3 id="telegram"><a href="#telegram" class="headerlink" title="telegram"></a>telegram</h3><p>æ”¯æŒtelegramè½¬å‘æ¶ˆæ¯ä¿å­˜åˆ°memos ä¸­ï¼Œå‚è€ƒè¿™ä¸ª<a href="https://www.usememos.com/docs/integration/telegram-bot">Integration with Telegram Bot</a></p>
]]></content>
      <categories>
        <category>å·¥å…·</category>
      </categories>
      <tags>
        <tag>memos</tag>
      </tags>
  </entry>
  <entry>
    <title>å¦‚ä½•åˆ©ç”¨ github copilotæ­å»º chatgpt-4  æœåŠ¡</title>
    <url>/2024/01/12/%E5%A6%82%E4%BD%95%E5%88%A9%E7%94%A8%20github%20copilot%E6%90%AD%E5%BB%BA%20chatgpt-4%20%20%E6%9C%8D%E5%8A%A1/</url>
    <content><![CDATA[<h1 id="å¦‚ä½•åˆ©ç”¨-github-copilotæ­å»º-chatgpt-4-æœåŠ¡"><a href="#å¦‚ä½•åˆ©ç”¨-github-copilotæ­å»º-chatgpt-4-æœåŠ¡" class="headerlink" title="å¦‚ä½•åˆ©ç”¨ github copilotæ­å»º chatgpt-4  æœåŠ¡"></a>å¦‚ä½•åˆ©ç”¨ github copilotæ­å»º chatgpt-4  æœåŠ¡</h1><p>Github Copilot æ˜¯ GitHub å¼€å‘ AI åŠ©æ‰‹ï¼Œå®ƒå¯ä»¥å¸®åŠ©å¼€å‘è€…ç¼–å†™ä»£ç ã€‚å®ƒæ˜¯ä¸€ä¸ªåŸºäº OpenAI Codex çš„ Visual Studio Code æ’ä»¶ï¼Œå®ƒå¯ä»¥ä¸ºä½ æä¾›ä»£ç æç¤ºã€è‡ªåŠ¨è¡¥å…¨ã€è‡ªåŠ¨ä¿®å¤ã€è‡ªåŠ¨é‡æ„ç­‰åŠŸèƒ½ã€‚ç°åœ¨ Github Copilot è¿˜æ”¯æŒchatåŠŸèƒ½ï¼Œå®ƒçš„åº•å±‚é€»è¾‘åŸºäºGPT-4ï¼Œä½†æ˜¯ç›®å‰ä»…æ”¯æŒåœ¨vs code ä¸­ä½¿ç”¨ï¼Œ ä½†æ˜¯æˆ‘æ—¥å¸¸å¼€å‘ç¯å¢ƒæ˜¯Golangï¼Œæœ¬æ–‡å°†ä»‹ç»å¦‚ä½•åˆ©ç”¨github copilotæ­å»ºchatgpt-4æœåŠ¡ï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹ä½¿ç”¨chatgpt-4ã€‚</p>
<span id="more"></span>

<h1 id="æœ¬æ–‡æ¶‰åŠçš„å¼€æºç»„å»º"><a href="#æœ¬æ–‡æ¶‰åŠçš„å¼€æºç»„å»º" class="headerlink" title="æœ¬æ–‡æ¶‰åŠçš„å¼€æºç»„å»º"></a>æœ¬æ–‡æ¶‰åŠçš„å¼€æºç»„å»º</h1><ul>
<li><a href="https://github.com/ChatGPTNextWeb/ChatGPT-Next-Web">ChatGPT-Next-Web</a> One-Click to get a well-designed cross-platform ChatGPT web UI, with GPT3, GPT4 &amp; Gemini Pro support.</li>
<li><a href="https://github.com/aaamoon/copilot-gpt4-service">copilot-gpt4-service</a></li>
<li>ä¸€ä¸ª aws ec2 æœåŠ¡å™¨ï¼Œ æˆ‘ä»¬éœ€è¦å†ä¸Šé¢è¿è¡Œ copilot-gpt4-service æœåŠ¡ï¼Œæ‚¨ä¹Ÿå¯ä»¥é€‰æ‹©æ‚¨å–œæ¬¢çš„äº‘æœåŠ¡å•†ã€‚æˆ–è€…åœ¨æœ¬åœ°è¿è¡Œéƒ½å¯ä»¥ã€‚</li>
<li>Vercel ä¸€ä¸ªå…è´¹çš„é™æ€ç½‘ç«™æ‰˜ç®¡æœåŠ¡ï¼Œæˆ‘ä»¬éœ€è¦å†ä¸Šé¢éƒ¨ç½² ChatGPT-Next-Web æœåŠ¡</li>
<li>cloudflare ä¸€ä¸ªå…è´¹çš„cdnæœåŠ¡ï¼Œæˆ‘ä»¬ç”¨æ¥è§£æåŸŸåã€‚</li>
</ul>
<h1 id="è·å–-GitHub-Copilot-token"><a href="#è·å–-GitHub-Copilot-token" class="headerlink" title="è·å– GitHub Copilot token"></a>è·å– GitHub Copilot token</h1><p>è¯·å‚è€ƒè¿™ä¸ªæ–‡æ¡£ [GitHub Copilot token](<a href="https://github.com/aaamoon/copilot-gpt4-service/blob/master/README_CN.md#%E8%8E%B7%E5%8F%96-copilot-token%EF%BC%89">https://github.com/aaamoon/copilot-gpt4-service/blob/master/README_CN.md#%E8%8E%B7%E5%8F%96-copilot-tokenï¼‰</a><br>åœ¨ mac ç”µè„‘ä¸Šï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤è·å– token</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">bash -c &quot;$(curl -fsSL https://raw.githubusercontent.com/aaamoon/copilot-gpt4-service/master/shells/get_copilot_token.sh)&quot;</span><br></pre></td></tr></table></figure>
<p><img src="https://images.hxzhouh.com/blog-images/2024/01/d3343f8fc1b209783fb653e11ff4577a.png"></p>
<p>å¦‚å›¾æ‰€ç¤ºã€‚æ‚¨éœ€è¦å°†token å¤åˆ¶åˆ°å‰ªåˆ‡æ¿ï¼Œåé¢ä¼šç”¨åˆ°ã€‚</p>
<h1 id="è¿è¡Œ-copilot-gpt4-service-æœåŠ¡"><a href="#è¿è¡Œ-copilot-gpt4-service-æœåŠ¡" class="headerlink" title="è¿è¡Œ copilot-gpt4-service æœåŠ¡"></a>è¿è¡Œ copilot-gpt4-service æœåŠ¡</h1><ol>
<li>copilot-gpt4-service  æ”¯æŒdockeréƒ¨ç½²ï¼Œå®˜æ–¹æä¾› <a href="https://github.com/aaamoon/copilot-gpt4-service/blob/master/docker-compose.yml">docker-compose</a> æ–‡ä»¶ï¼Œæˆ‘ä»¬åªéœ€è¦ä¿®æ”¹ä¸€ä¸‹ç¯å¢ƒå˜é‡å³å¯ã€‚<br><img src="https://images.hxzhouh.com/blog-images/2024/01/6807404147e2cf24aab940f711af877c.png" alt="image-20240112110203576"></li>
<li>å†nginx ä¸Šæ·»åŠ ä¸€ä¸ªserver<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">        listen 443 ssl;</span><br><span class="line">        listen [::]:443 ssl;</span><br><span class="line">        server_name chat.example.com;</span><br><span class="line"></span><br><span class="line">        ssl_certificate /etc/nginx/cert/public.pem;</span><br><span class="line">        ssl_certificate_key /etc/nginx/cert/private.key;</span><br><span class="line">        location / &#123;</span><br><span class="line">                proxy_pass http://127.0.0.1:8086/;  # copilot-gpt4-service  addr </span><br><span class="line">                rewrite ^/(.*)$ /$1 break;</span><br><span class="line">                proxy_redirect off;</span><br><span class="line">                proxy_set_header Host $host;</span><br><span class="line">                proxy_set_header X-Forwarded-Proto $scheme;</span><br><span class="line">                proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">                proxy_set_header Upgrade-Insecure-Requests 1;</span><br><span class="line">                proxy_set_header X-Forwarded-Proto https;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
åˆ«å¿˜è®° é‡æ–°åŠ è½½nginx é…ç½®æ–‡ä»¶  </li>
<li>å†cloudflare ä¸Šæ·»åŠ ä¸€ä¸ªåŸŸåè§£æ chat.example.com  è§£æåˆ°nginx æœåŠ¡å™¨çš„ipåœ°å€</li>
</ol>
<h1 id="å†-Vercel-ä¸Šéƒ¨ç½²-ChatGPT-Next-Web-æœåŠ¡"><a href="#å†-Vercel-ä¸Šéƒ¨ç½²-ChatGPT-Next-Web-æœåŠ¡" class="headerlink" title="å† Vercel ä¸Šéƒ¨ç½² ChatGPT-Next-Web æœåŠ¡"></a>å† Vercel ä¸Šéƒ¨ç½² ChatGPT-Next-Web æœåŠ¡</h1><p>ChatGPT-Next-Web æ”¯æŒ ä¸€é”®éƒ¨ç½²åˆ°vercelã€‚ æ‚¨ä¸ç”¨æ”¹åŠ¨ä»»ä½•ä¸œè¥¿ã€‚</p>
<p><img src="https://images.hxzhouh.com/blog-images/2024/01/53e4d610736d7d7784c66113bfee8cf1.png">éƒ¨ç½²å®Œæˆåï¼Œæ‚¨å¯ä»¥åœ¨vercel ä¸Šæ·»åŠ ä¸€ä¸ªä¸ªæ€§åŒ–çš„åŸŸåã€‚æ¯”å¦‚ chatnext.example.com</p>
<h1 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h1><p>æ‰“å¼€æµè§ˆå™¨ï¼Œè¾“å…¥ chatnext.example.comï¼Œ ç‚¹å‡»å·¦ä¸‹è§’çš„è®¾ç½®æŒ‰é’®ï¼Œé€‰æ‹©è‡ªå®šä¹‰æ¥å£ï¼Œè¾“å…¥ <a href="https://chat.example.com,/">https://chat.example.comï¼Œ</a> api token ä½¿ç”¨ ç¬¬ä¸€æ­¥å¤åˆ¶çš„ GitHub Copilot tokenï¼Œ ç‚¹å‡»ä¿å­˜ï¼Œç„¶åå°±å¯ä»¥å¼€å§‹èŠå¤©äº†ã€‚</p>
<p>psï¼š æˆ‘ä¸çŸ¥é“è¿™ç§åšæ³•æ˜¯ä¸æ˜¯ç¬¦åˆgithub copilot çš„ä½¿ç”¨åè®®ï¼Œä½†æ˜¯æˆ‘è¿™ä¹ˆåšåªæ˜¯ä¸ºäº†æ–¹ä¾¿æˆ‘çš„ä½¿ç”¨ï¼Œæˆ‘ä¸ä¼šåˆ†äº«ç»™å…¶ä»–äººä½¿ç”¨ï¼Œå¦‚æœæ‚¨ä¹Ÿéƒ¨ç½²äº† è‡ªå·±çš„æœåŠ¡ï¼Œä¹Ÿè¯·ä¸è¦åˆ†äº«ç»™å…¶ä»–äººä½¿ç”¨ã€‚</p>
<hr>
<p>å¦‚æœæ‚¨å–œæ¬¢æˆ‘çš„æ–‡ç« ï¼Œéº»çƒ¦ç»™æˆ‘followã€é¼“æŒï¼Œè¿™å¯¹æˆ‘å¾ˆæœ‰å¸®åŠ©ã€‚è°¢è°¢ï¼</p>
]]></content>
      <categories>
        <category>blog</category>
      </categories>
      <tags>
        <tag>github</tag>
        <tag>copilot</tag>
        <tag>chatgpt-4</tag>
      </tags>
  </entry>
  <entry>
    <title>æ¯ä¸ªäººéƒ½åº”è¯¥è€ƒè™‘é‡‡ç”¨çš„ Linux å†…æ ¸å®‰å…¨å¯è°ƒ</title>
    <url>/2024/03/15/%E6%AF%8F%E4%B8%AA%E4%BA%BA%E9%83%BD%E5%BA%94%E8%AF%A5%E8%80%83%E8%99%91%E9%87%87%E7%94%A8%E7%9A%84%20Linux%20%E5%86%85%E6%A0%B8%E5%AE%89%E5%85%A8%E5%8F%AF%E8%B0%83/</url>
    <content><![CDATA[<h1 id="æ¯ä¸ªäººéƒ½åº”è¯¥è€ƒè™‘é‡‡ç”¨çš„Linuxå†…æ ¸å®‰å…¨å¯è°ƒ"><a href="#æ¯ä¸ªäººéƒ½åº”è¯¥è€ƒè™‘é‡‡ç”¨çš„Linuxå†…æ ¸å®‰å…¨å¯è°ƒ" class="headerlink" title="æ¯ä¸ªäººéƒ½åº”è¯¥è€ƒè™‘é‡‡ç”¨çš„Linuxå†…æ ¸å®‰å…¨å¯è°ƒ"></a>æ¯ä¸ªäººéƒ½åº”è¯¥è€ƒè™‘é‡‡ç”¨çš„Linuxå†…æ ¸å®‰å…¨å¯è°ƒ</h1><p>åŸæ–‡è¿æ¥ï¼š<a href="https://blog.cloudflare.com/linux-kernel-hardening/">https://blog.cloudflare.com/linux-kernel-hardening/</a></p>
<p>æœ¬æ–‡ä»‹ç»äº†ä¸€äº›Linuxå†…æ ¸çš„åŠŸèƒ½ï¼Œè¿™äº›åŠŸèƒ½å¸®åŠ©æˆ‘ä»¬ä¿æŒç”Ÿäº§ç³»ç»Ÿæ›´å®‰å…¨ã€‚æˆ‘ä»¬å°†æ·±å…¥æ¢è®¨å®ƒä»¬çš„å·¥ä½œåŸç†ä»¥åŠä¸ºä»€ä¹ˆæ‚¨ä¹Ÿåº”è¯¥è€ƒè™‘å¯ç”¨å®ƒä»¬ã€‚</p>
<span id="more"></span>

<p><img src="https://images.hxzhouh.com/blog-images/2024/03/b6bf3148716461c32a9f1e5447cb2c62.png" alt="Linuxå†…æ ¸å®‰å…¨è°ƒæ•´ï¼šæ¯ä¸ªäººéƒ½åº”è¯¥è€ƒè™‘é‡‡ç”¨çš„æ–¹æ³•"></p>
<p>Linuxå†…æ ¸æ˜¯è®¸å¤šç°ä»£ç”Ÿäº§ç³»ç»Ÿçš„æ ¸å¿ƒã€‚å®ƒå†³å®šäº†ä½•æ—¶å…è®¸è¿è¡Œä»»ä½•ä»£ç ä»¥åŠå“ªäº›ç¨‹åº&#x2F;ç”¨æˆ·å¯ä»¥è®¿é—®å“ªäº›èµ„æºã€‚å®ƒç®¡ç†å†…å­˜ï¼Œè°ƒè§£å¯¹ç¡¬ä»¶çš„è®¿é—®ï¼Œå¹¶åœ¨ç¨‹åºè¿è¡Œæ—¶çš„å¹•åä»£è¡¨ç¨‹åºæ‰§è¡Œå¤§éƒ¨åˆ†å·¥ä½œã€‚ç”±äºå†…æ ¸å§‹ç»ˆå‚ä¸ä»»ä½•ä»£ç æ‰§è¡Œï¼Œå®ƒå¤„äºæœ€ä½³ä½ç½®æ¥ä¿æŠ¤ç³»ç»Ÿå…å—æ¶æ„ç¨‹åºçš„ä¾µå®³ï¼Œæ‰§è¡Œæ‰€éœ€çš„ç³»ç»Ÿå®‰å…¨ç­–ç•¥ï¼Œå¹¶ä¸ºæ›´å®‰å…¨çš„ç”Ÿäº§ç¯å¢ƒæä¾›å®‰å…¨åŠŸèƒ½ã€‚</p>
<p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†å›é¡¾Cloudflareåœ¨Linuxå†…æ ¸å®‰å…¨é…ç½®æ–¹é¢çš„ä¸€äº›ä½¿ç”¨æ–¹æ³•ï¼Œä»¥åŠå®ƒä»¬å¦‚ä½•å¸®åŠ©é˜»æ­¢æˆ–å‡å°‘æ½œåœ¨çš„ç³»ç»Ÿå¦¥åã€‚</p>
<h2 id="å®‰å…¨å¯åŠ¨"><a href="#å®‰å…¨å¯åŠ¨" class="headerlink" title="å®‰å…¨å¯åŠ¨"></a>å®‰å…¨å¯åŠ¨</h2><p>å½“æœºå™¨ï¼ˆæ— è®ºæ˜¯ç¬”è®°æœ¬è¿˜æ˜¯æœåŠ¡å™¨ï¼‰å¯åŠ¨æ—¶ï¼Œå®ƒç»å†äº†å‡ ä¸ªå¼•å¯¼é˜¶æ®µï¼š</p>
<p><img src="https://images.hxzhouh.com/blog-images/2024/03/a960262885fbf648dbdc2bd800cde2ca.png" alt="image3-17"></p>
<p>åœ¨å®‰å…¨å¯åŠ¨æ¶æ„ä¸­ï¼Œä¸Šå›¾ä¸­çš„æ¯ä¸ªé˜¶æ®µåœ¨ä¼ é€’æ‰§è¡Œæƒä¹‹å‰éƒ½ä¼šéªŒè¯ä¸‹ä¸€ä¸ªé˜¶æ®µçš„å®Œæ•´æ€§ï¼Œä»è€Œå½¢æˆæ‰€è°“çš„å®‰å…¨å¯åŠ¨é“¾ã€‚è¿™æ ·ï¼Œâ€œå¯ä¿¡åº¦â€å°±æ‰©å±•åˆ°å¼•å¯¼é“¾ä¸­çš„æ¯ä¸ªç»„ä»¶ï¼Œå› ä¸ºå¦‚æœæˆ‘ä»¬éªŒè¯äº†ç‰¹å®šé˜¶æ®µçš„ä»£ç å®Œæ•´æ€§ï¼Œæˆ‘ä»¬å¯ä»¥ç›¸ä¿¡è¯¥ä»£ç å¯ä»¥éªŒè¯ä¸‹ä¸€ä¸ªé˜¶æ®µçš„å®Œæ•´æ€§ã€‚</p>
<p>æˆ‘ä»¬ä¹‹å‰å·²ç»ä»‹ç»è¿‡Cloudflareåœ¨å¼•å¯¼è¿‡ç¨‹çš„åˆå§‹é˜¶æ®µå®ç°å®‰å…¨å¯åŠ¨çš„æ–¹æ³•ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†é‡ç‚¹ä»‹ç»Linuxå†…æ ¸ã€‚</p>
<p>å®‰å…¨å¯åŠ¨æ˜¯ä»»ä½•æ“ä½œç³»ç»Ÿå®‰å…¨æœºåˆ¶çš„åŸºçŸ³ã€‚Linuxå†…æ ¸æ˜¯æ“ä½œç³»ç»Ÿå®‰å…¨é…ç½®å’Œç­–ç•¥çš„ä¸»è¦æ‰§è¡Œè€…ï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»ç¡®ä¿Linuxå†…æ ¸æœ¬èº«æ²¡æœ‰è¢«ç¯¡æ”¹ã€‚åœ¨æˆ‘ä»¬ä¹‹å‰å…³äºå®‰å…¨å¯åŠ¨çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨UEFI Secure Bootæ¥ç¡®ä¿Linuxå†…æ ¸çš„å®Œæ•´æ€§ã€‚</p>
<p>ä½†æ¥ä¸‹æ¥ä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿå†…æ ¸æ‰§è¡Œåï¼Œå®ƒå¯èƒ½å°è¯•åŠ è½½å…¶ä»–é©±åŠ¨ç¨‹åºï¼Œæˆ–è€…åœ¨Linuxä¸–ç•Œä¸­ç§°ä¸ºå†…æ ¸æ¨¡å—ã€‚å†…æ ¸æ¨¡å—åŠ è½½ä¸ä»…é™äºå¼•å¯¼è¿‡ç¨‹ã€‚æ¨¡å—å¯ä»¥åœ¨è¿è¡Œæ—¶çš„ä»»ä½•æ—¶å€™åŠ è½½â€”â€”å½“æ’å…¥æ–°è®¾å¤‡å¹¶éœ€è¦é©±åŠ¨ç¨‹åºæ—¶ï¼Œéœ€è¦å¯¹ç½‘ç»œå †æ ˆè¿›è¡Œä¸€äº›é™„åŠ æ‰©å±•ï¼ˆä¾‹å¦‚ï¼Œç”¨äºç»†ç²’åº¦é˜²ç«å¢™è§„åˆ™ï¼‰ï¼Œæˆ–è€…åªæ˜¯ç”±ç³»ç»Ÿç®¡ç†å‘˜æ‰‹åŠ¨åŠ è½½ã€‚</p>
<p>ç„¶è€Œï¼Œä¸å—æ§åˆ¶çš„å†…æ ¸æ¨¡å—åŠ è½½å¯èƒ½å¯¹ç³»ç»Ÿå®Œæ•´æ€§æ„æˆé‡å¤§é£é™©ã€‚ä¸å¸¸è§„ç¨‹åºä¸åŒï¼Œå†…æ ¸æ¨¡å—æ˜¯ç›´æ¥æ³¨å…¥å¹¶åœ¨Linuxå†…æ ¸åœ°å€ç©ºé—´ä¸­ç›´æ¥æ‰§è¡Œçš„ä»£ç ç‰‡æ®µã€‚åœ¨ä¸åŒçš„å†…æ ¸æ¨¡å—å’Œæ ¸å¿ƒå†…æ ¸å­ç³»ç»Ÿä¸­ï¼Œä»£ç å’Œæ•°æ®ä¹‹é—´æ²¡æœ‰åˆ†ç¦»ï¼Œå› æ­¤ä¸€åˆ‡éƒ½å¯ä»¥è®¿é—®ä¸€åˆ‡ã€‚è¿™æ„å‘³ç€ä¸€ä¸ªæ¶æ„çš„å†…æ ¸æ¨¡å—å¯ä»¥å®Œå…¨ä½¿æ“ä½œç³»ç»Ÿçš„å¯ä¿¡åº¦å¤±æ•ˆï¼Œå¹¶ä½¿å®‰å…¨å¯åŠ¨å˜å¾—æ— æ•ˆã€‚ä¾‹å¦‚ï¼Œè€ƒè™‘ä¸€ä¸ªç®€å•çš„Debian 12ï¼ˆBookwormå®‰è£…ï¼‰ï¼Œä½†å¯ç”¨äº†SELinuxé…ç½®å’Œå¼ºåˆ¶æ‰§è¡Œï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ignat@dev:~$ lsb_release --all</span><br><span class="line">No LSB modules are available.</span><br><span class="line">Distributor ID:	Debian</span><br><span class="line">Description:	Debian GNU/Linux 12 (bookworm)</span><br><span class="line">Release:	12</span><br><span class="line">Codename:	bookworm</span><br><span class="line">ignat@dev:~$ <span class="built_in">uname</span> -a</span><br><span class="line">Linux dev 6.1.0-18-cloud-amd64 <span class="comment">#1 SMP PREEMPT_DYNAMIC Debian 6.1.76-1 (2024-02-01) x86_64 GNU/Linux</span></span><br><span class="line">ignat@dev:~$ sudo getenforce</span><br><span class="line">Enforcing</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘ä»¬éœ€è¦è¿›è¡Œä¸€äº›ç ”ç©¶ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬çœ‹åˆ°æˆ‘ä»¬æ­£åœ¨è¿è¡Œ6.1.76 Linuxå†…æ ¸ã€‚å¦‚æœæˆ‘ä»¬æ¢ç´¢æºä»£ç ï¼Œæˆ‘ä»¬ä¼šå‘ç°<a href="https://elixir.bootlin.com/linux/v6.1.76/source/security/selinux/hooks.c#L107">åœ¨å†…æ ¸å†…éƒ¨ï¼ŒSELinuxé…ç½®å­˜å‚¨åœ¨ä¸€ä¸ªå•ä¾‹ç»“æ„ä¸­</a>ï¼Œè¯¥ç»“æ„<a href="https://elixir.bootlin.com/linux/v6.1.76/source/security/selinux/include/security.h#L92">å®šä¹‰å¦‚ä¸‹</a>ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">selinux_state</span> &#123;</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> CONFIG_SECURITY_SELINUX_DISABLE</span></span><br><span class="line">	<span class="type">bool</span> disabled;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> CONFIG_SECURITY_SELINUX_DEVELOP</span></span><br><span class="line">	<span class="type">bool</span> enforcing;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">	<span class="type">bool</span> checkreqprot;</span><br><span class="line">	<span class="type">bool</span> initialized;</span><br><span class="line">	<span class="type">bool</span> policycap[__POLICYDB_CAP_MAX];</span><br><span class="line"></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">page</span> *<span class="title">status_page</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">mutex</span> <span class="title">status_lock</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">selinux_avc</span> *<span class="title">avc</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">selinux_policy</span> __<span class="title">rcu</span> *<span class="title">policy</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">mutex</span> <span class="title">policy_mutex</span>;</span></span><br><span class="line">&#125; __randomize_layout;</span><br></pre></td></tr></table></figure>

<p>ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºï¼Œå¦‚æœå†…æ ¸é…ç½®å¯ç”¨äº†<code>CONFIG_SECURITY_SELINUX_DEVELOP</code>ï¼Œåˆ™è¯¥ç»“æ„å°†å…·æœ‰ä¸€ä¸ªåä¸º<code>enforcing</code>çš„å¸ƒå°”å˜é‡ï¼Œè¯¥å˜é‡æ§åˆ¶SELinuxåœ¨è¿è¡Œæ—¶çš„å¼ºåˆ¶æ‰§è¡ŒçŠ¶æ€ã€‚è¿™æ­£æ˜¯ä¸Šé¢çš„<code>$ sudo getenforce</code>å‘½ä»¤è¿”å›çš„å†…å®¹ã€‚æˆ‘ä»¬å¯ä»¥å†æ¬¡æ£€æŸ¥Debianå†…æ ¸ç¡®å®å·²å¯ç”¨è¯¥é…ç½®é€‰é¡¹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ignat@dev:~$ grep CONFIG_SECURITY_SELINUX_DEVELOP /boot/config-`<span class="built_in">uname</span> -r` CONFIG_SECURITY_SELINUX_DEVELOP=y</span><br></pre></td></tr></table></figure>

<p>å¾ˆå¥½ï¼ç°åœ¨æˆ‘ä»¬åœ¨å†…æ ¸ä¸­æœ‰ä¸€ä¸ªå˜é‡ï¼Œè´Ÿè´£æŸç§å®‰å…¨æ‰§è¡Œï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•æ”»å‡»å®ƒã€‚ä½†æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯<code>__randomize_layout</code>å±æ€§ï¼šç”±äºæˆ‘ä»¬çš„Debianå†…æ ¸å®é™…ä¸Šæ²¡æœ‰è®¾ç½®<code>CONFIG_SECURITY_SELINUX_DISABLE</code>ï¼Œå› æ­¤<code>enforcing</code>å®é™…ä¸Šå°†æ˜¯ç»“æ„ä½“çš„ç¬¬ä¸€ä¸ªæˆå‘˜ã€‚å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬çŸ¥é“ç»“æ„ä½“çš„ä½ç½®ï¼Œæˆ‘ä»¬ç«‹å³å°±çŸ¥é“äº†<code>enforcing</code>æ ‡å¿—çš„ä½ç½®ã€‚ä½¿ç”¨<code>__randomize_layout</code>ï¼Œåœ¨å†…æ ¸ç¼–è¯‘æœŸé—´ï¼Œç¼–è¯‘å™¨å¯èƒ½ä¼šå°†æˆå‘˜æ”¾ç½®åœ¨ç»“æ„ä½“çš„ä»»æ„ä½ç½®ï¼Œå› æ­¤åˆ›å»ºé€šç”¨çš„æ¼æ´åˆ©ç”¨å˜å¾—æ›´åŠ å›°éš¾ã€‚ä½†æ˜¯ï¼Œåœ¨å†…æ ¸ä¸­ä»»æ„ç»“æ„ä½“éšæœºåŒ–<a href="https://elixir.bootlin.com/linux/v6.1.76/source/security/Kconfig.hardening#L301">å¯èƒ½ä¼šå¼•å…¥æ€§èƒ½å½±å“</a>ï¼Œå› æ­¤é€šå¸¸è¢«ç¦ç”¨ï¼Œå¹¶ä¸”å¯¹äºDebianå†…æ ¸è€Œè¨€ï¼Œå®ƒæ˜¯è¢«ç¦ç”¨çš„ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ignat@dev:~$ grep RANDSTRUCT /boot/config-`<span class="built_in">uname</span> -r` CONFIG_RANDSTRUCT_NONE=y</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨<a href="https://git.kernel.org/pub/scm/devel/pahole/pahole.git/">paholeå·¥å…·</a>å’Œå†…æ ¸è°ƒè¯•ç¬¦å·ï¼ˆå¦‚æœå¯ç”¨ï¼‰æˆ–ï¼ˆåœ¨ç°ä»£å†…æ ¸ä¸Šï¼Œå¦‚æœå¯ç”¨ï¼‰å†…æ ¸<a href="https://www.kernel.org/doc/html/next/bpf/btf.html">BTF</a>ä¿¡æ¯æ¥ç¡®è®¤<code>enforcing</code>æ ‡å¿—çš„ç¼–è¯‘ä½ç½®ã€‚æˆ‘ä»¬å°†ä½¿ç”¨åè€…ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ignat@dev:~$ pahole -C selinux_state /sys/kernel/btf/vmlinux</span><br><span class="line">struct selinux_state &#123;</span><br><span class="line">	bool                       enforcing;            /*     0     1 */</span><br><span class="line">	bool                       checkreqprot;         /*     1     1 */</span><br><span class="line">	bool                       initialized;          /*     2     1 */</span><br><span class="line">	bool                       policycap[8];         /*     3     8 */</span><br><span class="line"></span><br><span class="line">	/* XXX 5 bytes hole, try to pack */</span><br><span class="line"></span><br><span class="line">	struct page *              status_page;          /*    16     8 */</span><br><span class="line">	struct mutex               status_lock;          /*    24    32 */</span><br><span class="line">	struct selinux_avc *       avc;                  /*    56     8 */</span><br><span class="line">	/* --- cacheline 1 boundary (64 bytes) --- */</span><br><span class="line">	struct selinux_policy *    policy;               /*    64     8 */</span><br><span class="line">	struct mutex               policy_mutex;         /*    72    32 */</span><br><span class="line"></span><br><span class="line">	/* size: 104, cachelines: 2, members: 9 */</span><br><span class="line">	/* <span class="built_in">sum</span> members: 99, holes: 1, <span class="built_in">sum</span> holes: 5 */</span><br><span class="line">	/* last cacheline: 40 bytes */</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>


<p>å› æ­¤ï¼Œ<code>enforcing</code>ç¡®å®ä½äºç»“æ„ä½“çš„å¼€å¤´ï¼Œæˆ‘ä»¬ç”šè‡³ä¸éœ€è¦æˆä¸ºç‰¹æƒç”¨æˆ·å³å¯ç¡®è®¤è¿™ä¸€ç‚¹ã€‚</p>
<p>å¤ªæ£’äº†ï¼æˆ‘ä»¬åªéœ€è¦å†…æ ¸å†…çš„<code>selinux_state</code>å˜é‡çš„è¿è¡Œæ—¶åœ°å€ï¼š<br>ï¼ˆshell&#x2F;bashï¼‰</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ignat@dev:~$ sudo grep selinux_state /proc/kallsyms</span><br><span class="line">ffffffffbc3bcae0 B selinux_state</span><br></pre></td></tr></table></figure>

<p>æœ‰äº†æ‰€æœ‰è¿™äº›ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€ä¸ªå‡ ä¹å®Œå…¨ç¬¦åˆæ•™ç§‘ä¹¦çš„ç®€å•å†…æ ¸æ¨¡å—æ¥æ“çºµSELinuxçŠ¶æ€ï¼š</p>
<p>Mymod.c:</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/module.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> __init <span class="title function_">mod_init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">bool</span> *selinux_enforce = (<span class="type">bool</span> *)<span class="number">0xffffffffbc3bcae0</span>;</span><br><span class="line">	*selinux_enforce = <span class="literal">false</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">mod_fini</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module_init(mod_init);</span><br><span class="line">module_exit(mod_fini);</span><br><span class="line"></span><br><span class="line">MODULE_DESCRIPTION(<span class="string">&quot;A somewhat malicious module&quot;</span>);</span><br><span class="line">MODULE_AUTHOR(<span class="string">&quot;Ignat Korchagin &lt;ignat@cloudflare.com&gt;&quot;</span>);</span><br><span class="line">MODULE_LICENSE(<span class="string">&quot;GPL&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>ä»¥åŠç›¸åº”çš„<code>Kbuild</code>æ–‡ä»¶ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">obj-m := mymod.o</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨è¿™ä¸¤ä¸ªæ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®<a href="https://docs.kernel.org/kbuild/modules.html">å®˜æ–¹å†…æ ¸æ–‡æ¡£</a>æ„å»ºä¸€ä¸ªå®Œæ•´çš„å†…æ ¸æ¨¡å—ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ignat@dev:~$ <span class="built_in">cd</span> mymod/</span><br><span class="line">ignat@dev:~/mymod$ <span class="built_in">ls</span></span><br><span class="line">Kbuild  mymod.c</span><br><span class="line">ignat@dev:~/mymod$ make -C /lib/modules/`<span class="built_in">uname</span> -r`/build M=<span class="variable">$PWD</span></span><br><span class="line">make: Entering directory <span class="string">&#x27;/usr/src/linux-headers-6.1.0-18-cloud-amd64&#x27;</span></span><br><span class="line">  CC [M]  /home/ignat/mymod/mymod.o</span><br><span class="line">  MODPOST /home/ignat/mymod/Module.symvers</span><br><span class="line">  CC [M]  /home/ignat/mymod/mymod.mod.o</span><br><span class="line">  LD [M]  /home/ignat/mymod/mymod.ko</span><br><span class="line">  BTF [M] /home/ignat/mymod/mymod.ko</span><br><span class="line">Skipping BTF generation <span class="keyword">for</span> /home/ignat/mymod/mymod.ko due to unavailability of vmlinux</span><br><span class="line">make: Leaving directory <span class="string">&#x27;/usr/src/linux-headers-6.1.0-18-cloud-amd64&#x27;</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœç°åœ¨å°è¯•åŠ è½½æ­¤æ¨¡å—ï¼Œç³»ç»Ÿå¯èƒ½ä¸å…è®¸ï¼Œå› ä¸ºSELinuxç­–ç•¥çš„åŸå› ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ignat@dev:~/mymod$ sudo insmod mymod.ko insmod: ERROR: could not load module mymod.ko: Permission denied</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡å°†æ¨¡å—å¤åˆ¶åˆ°æ ‡å‡†æ¨¡å—è·¯å¾„ä¸­çš„æŸä¸ªä½ç½®æ¥è§£å†³æ­¤é—®é¢˜ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ignat@dev:~/mymod$ sudo <span class="built_in">cp</span> mymod.ko /lib/modules/`<span class="built_in">uname</span> -r`/kernel/crypto/</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨è®©æˆ‘ä»¬è¯•è¯•ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ignat@dev:~/mymod$ sudo getenforce Enforcing ignat@dev:~/mymod$ sudo insmod /lib/modules/`<span class="built_in">uname</span> -r`/kernel/crypto/mymod.ko ignat@dev:~/mymod$ sudo getenforce Permissive</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ä¸ä»…é€šè¿‡æ¶æ„å†…æ ¸æ¨¡å—é™é»˜åœ°ç¦ç”¨äº†SELinuxä¿æŠ¤ï¼Œè€Œä¸”è¿˜å®Œæˆäº†è¿™ä¸€æ“ä½œã€‚æ­£å¸¸çš„<code>sudo setenforce 0</code>å³ä½¿è¢«å…è®¸ï¼Œä¹Ÿä¼šé€šè¿‡å®˜æ–¹çš„<a href="https://elixir.bootlin.com/linux/v6.1.76/source/security/selinux/selinuxfs.c#L173">selinuxfsæ¥å£ï¼Œå¹¶å‘å‡ºå®¡æ ¸æ¶ˆæ¯</a>ã€‚æˆ‘ä»¬çš„ä»£ç ç›´æ¥æ“ä½œå†…æ ¸å†…å­˜ï¼Œå› æ­¤æ²¡æœ‰äººä¼šå‘å‡ºè­¦æŠ¥ã€‚è¿™è¯´æ˜ä¸ºä»€ä¹ˆä¸å—æ§åˆ¶çš„å†…æ ¸æ¨¡å—åŠ è½½éå¸¸å±é™©ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå¤§å¤šæ•°å®‰å…¨æ ‡å‡†å’Œå•†ä¸šå®‰å…¨ç›‘æ§äº§å“ä¸»å¼ å¯†åˆ‡ç›‘æ§å†…æ ¸æ¨¡å—åŠ è½½çš„åŸå› ã€‚</p>
<p>ä½†æ˜¯ï¼Œåœ¨Cloudflareä¸Šï¼Œæˆ‘ä»¬ä¸éœ€è¦ç›‘è§†å†…æ ¸æ¨¡å—ã€‚è®©æˆ‘ä»¬åœ¨Cloudflareç”Ÿäº§å†…æ ¸ä¸Šé‡å¤è¿™ä¸ªè¿‡ç¨‹ï¼ˆä¸ºç®€æ´èµ·è§ï¼Œè·³è¿‡æ¨¡å—é‡æ–°ç¼–è¯‘ï¼‰ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ignat@dev:~$ grep MODULE_SIG /boot/config-6.1.0-18-cloud-amd64</span><br><span class="line">CONFIG_MODULE_SIG_FORMAT=y</span><br><span class="line">CONFIG_MODULE_SIG=y</span><br><span class="line"><span class="comment"># CONFIG_MODULE_SIG_FORCE is not set</span></span><br><span class="line">â€¦</span><br></pre></td></tr></table></figure>

<p>å½“å°è¯•åŠ è½½æ¨¡å—æ—¶ï¼Œæˆ‘ä»¬ä¼šæ”¶åˆ°â€œKey was rejected by serviceâ€é”™è¯¯ï¼Œå¹¶ä¸”å†…æ ¸æ—¥å¿—å°†æ˜¾ç¤ºä»¥ä¸‹æ¶ˆæ¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ignat@dev:~/mymod$ sudo dmesg | <span class="built_in">tail</span> -n 1 [41515.037031] Loading of unsigned module is rejected</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯å› ä¸ºCloudflareå†…æ ¸è¦æ±‚æ‰€æœ‰å†…æ ¸æ¨¡å—å…·æœ‰æœ‰æ•ˆçš„ç­¾åï¼Œå› æ­¤æˆ‘ä»¬æ— éœ€æ‹…å¿ƒæ¶æ„æ¨¡å—åœ¨æŸä¸ªæ—¶é—´ç‚¹è¢«åŠ è½½ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ignat@dev:~$ grep MODULE_SIG_FORCE /boot/config-`<span class="built_in">uname</span> -r` CONFIG_MODULE_SIG_FORCE=y</span><br></pre></td></tr></table></figure>

<p>ä¸ºäº†å®Œæ•´èµ·è§ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒDebianæ ‡å‡†å†…æ ¸ä¹Ÿæ”¯æŒæ¨¡å—ç­¾åï¼Œä½†ä¸å¼ºåˆ¶æ‰§è¡Œï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ignat@dev:~$ grep MODULE_SIG /boot/config-6.1.0-18-cloud-amd64 CONFIG_MODULE_SIG_FORMAT=y CONFIG_MODULE_SIG=y <span class="comment"># CONFIG_MODULE_SIG_FORCE is not set â€¦</span></span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°é…ç½®æ„å‘³ç€ï¼Œå¦‚æœå¯ç”¨ï¼Œå†…æ ¸å°†éªŒè¯æ¨¡å—ç­¾åã€‚ä½†æ˜¯å¦‚æœæ²¡æœ‰ç­¾å-æ¨¡å—å°†è¢«åŠ è½½ï¼Œå¹¶å‘å‡ºè­¦å‘Šæ¶ˆæ¯ï¼Œ<a href="https://docs.kernel.org/admin-guide/tainted-kernels.html">å†…æ ¸å°†è¢«æ±¡æŸ“</a>ã€‚</p>
<h3 id="å†…æ ¸æ¨¡å—ç­¾åçš„å¯†é’¥ç®¡ç†"><a href="#å†…æ ¸æ¨¡å—ç­¾åçš„å¯†é’¥ç®¡ç†" class="headerlink" title="å†…æ ¸æ¨¡å—ç­¾åçš„å¯†é’¥ç®¡ç†"></a>å†…æ ¸æ¨¡å—ç­¾åçš„å¯†é’¥ç®¡ç†</h3><p>ç­¾åçš„å†…æ ¸æ¨¡å—éå¸¸å¥½ï¼Œä½†æ˜¯å®ƒä¼šå¸¦æ¥å¯†é’¥ç®¡ç†é—®é¢˜ï¼šè¦ç­¾åä¸€ä¸ªæ¨¡å—ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªç”±å†…æ ¸ä¿¡ä»»çš„ç­¾åå¯†é’¥å¯¹ã€‚å¯†é’¥å¯¹çš„å…¬é’¥é€šå¸¸ç›´æ¥åµŒå…¥åˆ°å†…æ ¸äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ï¼Œå› æ­¤å†…æ ¸å¯ä»¥è½»æ¾ä½¿ç”¨å®ƒæ¥éªŒè¯æ¨¡å—ç­¾åã€‚å¯†é’¥å¯¹çš„ç§é’¥éœ€è¦å—åˆ°ä¿æŠ¤å’Œå®‰å…¨ï¼Œå› ä¸ºå¦‚æœæ³„æ¼ï¼Œä»»ä½•äººéƒ½å¯ä»¥ç¼–è¯‘å’Œç­¾åä¸€ä¸ªæ½œåœ¨æ¶æ„çš„å†…æ ¸æ¨¡å—ï¼Œè€Œæˆ‘ä»¬çš„å†…æ ¸å°†æ¥å—å®ƒã€‚</p>
<p>ä½†æ˜¯ï¼Œå¦‚ä½•æ¶ˆé™¤ä¸¢å¤±é£é™©å‘¢ï¼Ÿé¦–å…ˆä¸è¦ä¸€å¼€å§‹å°±æ‹¥æœ‰å®ƒï¼å¹¸è¿çš„æ˜¯ï¼Œå†…æ ¸æ„å»ºç³»ç»Ÿ<a href="https://elixir.bootlin.com/linux/v6.6.17/source/certs/Makefile#L36">å°†ä¸ºæ¨¡å—ç­¾åç”Ÿæˆä¸€ä¸ªéšæœºå¯†é’¥å¯¹</a>ï¼Œå¦‚æœæ²¡æœ‰æä¾›å¯†é’¥ã€‚åœ¨Cloudflareï¼Œæˆ‘ä»¬ä½¿ç”¨è¯¥åŠŸèƒ½åœ¨å†…æ ¸ç¼–è¯‘é˜¶æ®µå¯¹æ‰€æœ‰å†…æ ¸æ¨¡å—è¿›è¡Œç­¾åã€‚ä½†æ˜¯ï¼Œåœ¨ç¼–è¯‘å’Œç­¾åå®Œæˆåï¼Œæˆ‘ä»¬ä¸ä¼šå°†ç§é’¥å­˜å‚¨åœ¨å®‰å…¨çš„ä½ç½®ï¼Œè€Œæ˜¯é”€æ¯ç§é’¥ï¼š</p>
<p><img src="https://images.hxzhouh.com/blog-images/2024/03/46b61bf0a9163c9836837b598bc64d9e.png" alt="image1-19"></p>
<p>å› æ­¤ï¼Œæ ¹æ®ä¸Šè¿°è¿‡ç¨‹ï¼š</p>
<ol>
<li>å†…æ ¸æ„å»ºç³»ç»Ÿä¸ºæ¨¡å—ç­¾åç”Ÿæˆäº†ä¸€ä¸ªéšæœºå¯†é’¥å¯¹ï¼Œå¹¶ç¼–è¯‘å†…æ ¸å’Œæ¨¡å—</li>
<li>å…¬é’¥åµŒå…¥åˆ°å†…æ ¸æ˜ åƒä¸­ï¼Œç§é’¥ç”¨äºç­¾åæ‰€æœ‰æ¨¡å—</li>
<li>ç§é’¥è¢«é”€æ¯</li>
</ol>
<p>é€šè¿‡è¿™ç§æ–¹æ¡ˆï¼Œæˆ‘ä»¬ä¸ä»…æ— éœ€æ‹…å¿ƒæ¨¡å—ç­¾åå¯†é’¥ç®¡ç†é—®é¢˜ï¼Œè€Œä¸”æˆ‘ä»¬è¿˜ä¸ºæ¯ä¸ªå‘å¸ƒåˆ°ç”Ÿäº§ç¯å¢ƒçš„å†…æ ¸ä½¿ç”¨ä¸åŒçš„å¯†é’¥ã€‚å› æ­¤ï¼Œå³ä½¿æŸä¸ªç‰¹å®šçš„æ„å»ºè¿‡ç¨‹è¢«åŠ«æŒå¹¶ä¸”ç­¾åå¯†é’¥æœªè¢«é”€æ¯å¹¶ä¸”æœ‰å¯èƒ½æ³„æ¼ï¼Œå½“å‘å¸ƒå†…æ ¸æ›´æ–°æ—¶ï¼Œè¯¥å¯†é’¥å°†ä¸å†æœ‰æ•ˆã€‚</p>
<p>ç„¶è€Œï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒDebianå†…æ ¸çš„åº“å­˜ç‰ˆæœ¬ä¹Ÿæ”¯æŒæ¨¡å—ç­¾åï¼Œä½†ä¸å¼ºåˆ¶æ‰§è¡Œï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ignat@dev:~$ grep MODULE_SIG /boot/config-6.1.0-18-cloud-amd64 CONFIG_MODULE_SIG_FORMAT=y CONFIG_MODULE_SIG=y <span class="comment"># CONFIG_MODULE_SIG_FORCE is not set â€¦</span></span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°é…ç½®æ„å‘³ç€ï¼Œå¦‚æœå¯ç”¨ï¼Œå†…æ ¸å°†éªŒè¯æ¨¡å—ç­¾åã€‚ä½†æ˜¯å¦‚æœæ²¡æœ‰ç­¾å-æ¨¡å—å°†è¢«åŠ è½½ï¼Œå¹¶å‘å‡ºè­¦å‘Šæ¶ˆæ¯ï¼Œ<a href="https://docs.kernel.org/admin-guide/tainted-kernels.html">å†…æ ¸å°†è¢«æ±¡æŸ“</a>ã€‚</p>
<h3 id="KEXEC"><a href="#KEXEC" class="headerlink" title="KEXEC"></a>KEXEC</h3><p><a href="https://en.wikipedia.org/wiki/Kexec">KEXEC</a>ï¼ˆæˆ–<code>kexec_load()</code>ï¼‰æ˜¯Linuxä¸­ä¸€ä¸ªæœ‰è¶£çš„ç³»ç»Ÿè°ƒç”¨ï¼Œå®ƒå…è®¸ä¸€ä¸ªå†…æ ¸ç›´æ¥æ‰§è¡Œï¼ˆæˆ–è·³è½¬åˆ°ï¼‰å¦ä¸€ä¸ªå†…æ ¸ã€‚è¿™ä¸ªæƒ³æ³•æ˜¯åœ¨ä¸ç»è¿‡å®Œæ•´çš„é‡æ–°å¯åŠ¨è¿‡ç¨‹çš„æƒ…å†µä¸‹æ›´å¿«åœ°åˆ‡æ¢&#x2F;æ›´æ–°&#x2F;é™çº§å†…æ ¸ï¼Œä»¥å‡å°‘æ½œåœ¨çš„ç³»ç»Ÿåœæœºæ—¶é—´ã€‚ç„¶è€Œï¼Œå®ƒæ˜¯åœ¨å¾ˆä¹…ä»¥å‰å¼€å‘çš„ï¼Œå½“æ—¶å®‰å…¨å¯åŠ¨å’Œç³»ç»Ÿå®Œæ•´æ€§è¿˜ä¸æ˜¯ä¸€ä¸ªé—®é¢˜ã€‚å› æ­¤ï¼Œå®ƒçš„åŸå§‹è®¾è®¡å­˜åœ¨å®‰å…¨ç¼ºé™·ï¼Œå¯ä»¥<a href="https://mjg59.dreamwidth.org/28746.html">ç»•è¿‡å®‰å…¨å¯åŠ¨å¹¶æ½œåœ¨åœ°ç ´åç³»ç»Ÿå®Œæ•´æ€§</a>ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥æ ¹æ®<a href="https://man7.org/linux/man-pages/man2/kexec_load.2.html">ç³»ç»Ÿè°ƒç”¨çš„å®šä¹‰</a>çœ‹åˆ°è¿™äº›é—®é¢˜ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">kexec_segment</span> &#123;</span></span><br><span class="line">	<span class="type">const</span> <span class="type">void</span> *buf;</span><br><span class="line">	<span class="type">size_t</span> bufsz;</span><br><span class="line">	<span class="type">const</span> <span class="type">void</span> *mem;</span><br><span class="line">	<span class="type">size_t</span> memsz;</span><br><span class="line">&#125;;</span><br><span class="line">...</span><br><span class="line"><span class="type">long</span> <span class="title function_">kexec_load</span><span class="params">(<span class="type">unsigned</span> <span class="type">long</span> entry, <span class="type">unsigned</span> <span class="type">long</span> nr_segments, <span class="keyword">struct</span> kexec_segment *segments, <span class="type">unsigned</span> <span class="type">long</span> flags)</span>;</span><br></pre></td></tr></table></figure>

<p>å› æ­¤ï¼Œå†…æ ¸æœŸæœ›çš„åªæ˜¯ä¸€ç»„è¦æ‰§è¡Œçš„ä»£ç ç¼“å†²åŒºã€‚åœ¨å½“æ—¶ï¼Œå†…æ ¸å†…éƒ¨æ²¡æœ‰å¤ªå¤šçš„æ•°æ®è§£æçš„æ„¿æœ›ï¼Œå› æ­¤ï¼Œè§£æè¦æ‰§è¡Œçš„å†…æ ¸æ˜ åƒæ˜¯åœ¨ç”¨æˆ·ç©ºé—´ä¸­å®Œæˆçš„ï¼Œå¹¶ä¸”ä»…å‘å†…æ ¸æä¾›å…¶æ‰€éœ€çš„æ•°æ®ã€‚æ­¤å¤–ï¼Œä¸ºäº†åœ¨æ—§å†…æ ¸å…³é—­æ—¶æ¥ç®¡å¹¶ä¸”æ–°å†…æ ¸å°šæœªæ‰§è¡Œæ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªä¸­é—´ç¨‹åºã€‚åœ¨kexecä¸–ç•Œä¸­ï¼Œæ­¤ç¨‹åºç§°ä¸º<a href="https://git.kernel.org/pub/scm/utils/kernel/kexec/kexec-tools.git/tree/purgatory">purgatory</a>ã€‚å› æ­¤ï¼Œé—®é¢˜æ˜¾è€Œæ˜“è§ï¼šæˆ‘ä»¬å‘å†…æ ¸æä¾›ä¸€å †ä»£ç ï¼Œå®ƒå°†æ„‰å¿«åœ°ä»¥æœ€é«˜ç‰¹æƒçº§åˆ«æ‰§è¡Œå®ƒã€‚ä½†æ˜¯ï¼Œä¸åŸå§‹å†…æ ¸æˆ–purgatoryä»£ç ç›¸åï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°æä¾›ç±»ä¼¼äºæœ¬æ–‡ä¸­æ¼”ç¤ºçš„ä»£ç ï¼Œè¯¥ä»£ç ç¦ç”¨SELinuxï¼ˆæˆ–å¯¹å†…æ ¸æ‰§è¡Œå…¶ä»–æ“ä½œï¼‰ã€‚</p>
<p>åœ¨Cloudflareä¸Šï¼Œæˆ‘ä»¬å·²ç»å°†<code>kexec_load()</code>ç¦ç”¨äº†ä¸€æ®µæ—¶é—´ï¼Œä»…å› ä¸ºè¿™ä¸ªåŸå› ã€‚ä½¿ç”¨kexecå®ç°æ›´å¿«çš„é‡æ–°å¯åŠ¨çš„ä¼˜ç‚¹æ˜¯ï¼Œ<a href="https://elixir.bootlin.com/linux/v6.6.17/source/kernel/Kconfig.kexec#L30">ç¡¬ä»¶å¯èƒ½æœªæ­£ç¡®åˆå§‹åŒ–</a>ï¼Œå› æ­¤å³ä½¿æ²¡æœ‰å®‰å…¨é—®é¢˜ï¼Œä¹Ÿä¸å€¼å¾—ä½¿ç”¨å®ƒã€‚ä½†æ˜¯ï¼Œkexecç¡®å®æä¾›äº†ä¸€ä¸ªæœ‰ç”¨çš„åŠŸèƒ½-å®ƒæ˜¯Linuxå†…æ ¸<a href="https://docs.kernel.org/admin-guide/kdump/kdump.html">å´©æºƒè½¬å‚¨è§£å†³æ–¹æ¡ˆ</a>çš„åŸºç¡€ã€‚ç®€è€Œè¨€ä¹‹ï¼Œå¦‚æœå†…æ ¸åœ¨ç”Ÿäº§ä¸­å´©æºƒï¼ˆç”±äºé”™è¯¯æˆ–å…¶ä»–é”™è¯¯ï¼‰ï¼Œå¤‡ä»½å†…æ ¸ï¼ˆä½¿ç”¨kexecé¢„å…ˆåŠ è½½ï¼‰å¯ä»¥æ¥ç®¡ï¼Œæ”¶é›†å¹¶ä¿å­˜å†…å­˜è½¬å‚¨ä»¥ä¾›è¿›ä¸€æ­¥è°ƒæŸ¥ã€‚è¿™ä½¿å¾—åœ¨ç”Ÿäº§ä¸­æ›´æœ‰æ•ˆåœ°è°ƒæŸ¥å†…æ ¸å’Œå…¶ä»–é—®é¢˜æˆä¸ºå¯èƒ½ï¼Œå› æ­¤å®ƒæ˜¯ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ã€‚</p>
<p>å¹¸è¿çš„æ˜¯ï¼Œè‡ªä»<a href="https://mjg59.dreamwidth.org/28746.html">æŒ‡å‡ºäº†kexecçš„åŸå§‹é—®é¢˜</a>ä»¥æ¥ï¼ŒLinuxå¼€å‘äº†ä¸€ç§æ›¿ä»£çš„<a href="https://elixir.bootlin.com/linux/v6.6.17/source/kernel/Kconfig.kexec#L36">å®‰å…¨çš„kexecæ¥å£</a>ï¼šä¸å…¶ä½¿ç”¨ä»£ç ç¼“å†²åŒºï¼Œå®ƒæœŸæœ›ä½¿ç”¨åŒ…å«è¦æ‰§è¡Œçš„å†…æ ¸æ˜ åƒå’Œinitrdçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå¹¶åœ¨å†…æ ¸å†…éƒ¨è¿›è¡Œè§£æã€‚å› æ­¤ï¼Œåªèƒ½æä¾›æœ‰æ•ˆçš„å†…æ ¸æ˜ åƒã€‚åœ¨æ­¤åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥<a href="https://elixir.bootlin.com/linux/v6.6.17/source/kernel/Kconfig.kexec#L48">é…ç½®</a>å¹¶<a href="https://elixir.bootlin.com/linux/v6.6.17/source/kernel/Kconfig.kexec#L62">è¦æ±‚</a>kexecä»¥ç¡®ä¿æ‰€æä¾›çš„æ˜ åƒå…·æœ‰æ­£ç¡®çš„ç­¾åï¼Œå› æ­¤åªæœ‰ç»æˆæƒçš„ä»£ç å¯ä»¥åœ¨kexecåœºæ™¯ä¸­æ‰§è¡Œã€‚ä¸€ä¸ªå®‰å…¨çš„kexecé…ç½®å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ignat@dev:~$ grep KEXEC /boot/config-`<span class="built_in">uname</span> -r` CONFIG_KEXEC_CORE=y CONFIG_HAVE_IMA_KEXEC=y <span class="comment"># CONFIG_KEXEC is not set CONFIG_KEXEC_FILE=y CONFIG_KEXEC_SIG=y CONFIG_KEXEC_SIG_FORCE=y CONFIG_KEXEC_BZIMAGE_VERIFY_SIG=y â€¦</span></span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šé…ç½®ç¡®ä¿äº†ç¦ç”¨äº†ä¼ ç»Ÿçš„<code>kexec_load()</code>ç³»ç»Ÿè°ƒç”¨ï¼Œé€šè¿‡ç¦ç”¨<code>CONFIG_KEXEC</code>æ¥å®ç°ï¼Œä½†ä»ç„¶å¯ä»¥ä½¿ç”¨æ–°çš„<code>kexec_file_load()</code>ç³»ç»Ÿè°ƒç”¨é€šè¿‡<code>CONFIG_KEXEC_FILE=y</code>è¿›è¡ŒLinuxå†…æ ¸å´©æºƒè½¬å‚¨çš„é…ç½®ï¼Œå¹¶å¼ºåˆ¶æ‰§è¡Œç­¾åæ£€æŸ¥ï¼ˆ<code>CONFIG_KEXEC_SIG=y</code>å’Œ<code>CONFIG_KEXEC_SIG_FORCE=y</code>ï¼‰ã€‚</p>
<p>è¯·æ³¨æ„ï¼ŒDebianå†…æ ¸çš„åº“å­˜ç‰ˆæœ¬å¯ç”¨äº†ä¼ ç»Ÿçš„<code>kexec_load()</code>ç³»ç»Ÿè°ƒç”¨ï¼Œå¹¶ä¸”ä¸å¼ºåˆ¶æ‰§è¡Œ<code>kexec_file_load()</code>çš„ç­¾åæ£€æŸ¥ï¼ˆç±»ä¼¼äºæ¨¡å—ç­¾åæ£€æŸ¥ï¼‰ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ignat@dev:~$ grep KEXEC /boot/config-6.1.0-18-cloud-amd64 CONFIG_KEXEC=y CONFIG_KEXEC_FILE=y CONFIG_ARCH_HAS_KEXEC_PURGATORY=y CONFIG_KEXEC_SIG=y <span class="comment"># CONFIG_KEXEC_SIG_FORCE is not set CONFIG_KEXEC_BZIMAGE_VERIFY_SIG=y â€¦</span></span><br></pre></td></tr></table></figure>

<h2 id="å†…æ ¸åœ°å€ç©ºé—´å¸ƒå±€éšæœºåŒ–ï¼ˆKASLRï¼‰"><a href="#å†…æ ¸åœ°å€ç©ºé—´å¸ƒå±€éšæœºåŒ–ï¼ˆKASLRï¼‰" class="headerlink" title="å†…æ ¸åœ°å€ç©ºé—´å¸ƒå±€éšæœºåŒ–ï¼ˆKASLRï¼‰"></a>å†…æ ¸åœ°å€ç©ºé—´å¸ƒå±€éšæœºåŒ–ï¼ˆKASLRï¼‰</h2><p>å³ä½¿åœ¨åº“å­˜çš„Debianå†…æ ¸ä¸Šï¼Œå¦‚æœæ‚¨å°è¯•åœ¨ç³»ç»Ÿé‡æ–°å¯åŠ¨åé‡å¤æˆ‘ä»¬åœ¨â€œå®‰å…¨å¯åŠ¨â€éƒ¨åˆ†ä¸­æè¿°çš„ç»ƒä¹ ï¼Œæ‚¨å¯èƒ½ä¼šå‘ç°å®ƒæ— æ³•å†ç¦ç”¨SELinuxã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬åœ¨æ¶æ„å†…æ ¸æ¨¡å—ä¸­ç¡¬ç¼–ç äº†<code>selinux_state</code>çš„å†…æ ¸åœ°å€ï¼Œä½†ç°åœ¨åœ°å€å·²æ›´æ”¹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ignat@dev:~$ sudo grep selinux_state /proc/kallsyms ffffffffb41bcae0 B selinux_state</span><br></pre></td></tr></table></figure>

<p><a href="https://docs.kernel.org/security/self-protection.html#kernel-address-space-layout-randomization-kaslr">å†…æ ¸åœ°å€ç©ºé—´å¸ƒå±€éšæœºåŒ–ï¼ˆæˆ–KASLRï¼‰</a>æ˜¯ä¸€ä¸ªç®€å•çš„æ¦‚å¿µï¼šå®ƒåœ¨æ¯æ¬¡å¯åŠ¨æ—¶éƒ½ä¼šè½»å¾®ä¸”éšæœºåœ°ç§»åŠ¨å†…æ ¸ä»£ç å’Œæ•°æ®ï¼š</p>
<p><img src="https://images.hxzhouh.com/blog-images/2024/03/70708d7d7185c3edd9a77c712198af8c.png" alt="Screenshot-2024-03-06-at-13.53.23-2"></p>
<p>è¿™æ˜¯ä¸ºäº†å¯¹æŠ—åŸºäºå¯¹å†…æ ¸å†…éƒ¨ç»“æ„å’Œä»£ç ä½ç½®çš„äº†è§£çš„æœ‰é’ˆå¯¹æ€§çš„åˆ©ç”¨ï¼ˆå¦‚æœ¬æ–‡ä¸­çš„æ¶æ„æ¨¡å—ï¼‰ã€‚å¯¹äºåƒDebianè¿™æ ·çš„æµè¡ŒLinuxå‘è¡Œç‰ˆå†…æ ¸å°¤å…¶æœ‰ç”¨ï¼Œå› ä¸ºå¤§å¤šæ•°ç”¨æˆ·ä½¿ç”¨ç›¸åŒçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»»ä½•äººéƒ½å¯ä»¥ä¸‹è½½è°ƒè¯•ç¬¦å·å’ŒåŒ…å«æ‰€æœ‰å†…æ ¸å†…éƒ¨åœ°å€çš„System.mapæ–‡ä»¶ã€‚åªè¦æ³¨æ„ï¼šå®ƒä¸ä¼šé˜»æ­¢æ¨¡å—åŠ è½½å’Œé€ æˆä¼¤å®³ï¼Œä½†å®ƒå¯èƒ½æ— æ³•å®ç°ç¦ç”¨SELinuxçš„æœ‰é’ˆå¯¹æ€§æ•ˆæœã€‚ç›¸åï¼Œå®ƒå°†ä¿®æ”¹éšæœºçš„å†…æ ¸å†…å­˜ç‰‡æ®µï¼Œå¯èƒ½å¯¼è‡´å†…æ ¸å´©æºƒã€‚</p>
<p>Cloudflareå†…æ ¸å’ŒDebianå†…æ ¸éƒ½å¯ç”¨äº†æ­¤åŠŸèƒ½ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ignat@dev:~$ grep RANDOMIZE_BASE /boot/config-`<span class="built_in">uname</span> -r` CONFIG_RANDOMIZE_BASE=y</span><br></pre></td></tr></table></figure>

<h3 id="å—é™åˆ¶çš„å†…æ ¸æŒ‡é’ˆ"><a href="#å—é™åˆ¶çš„å†…æ ¸æŒ‡é’ˆ" class="headerlink" title="å—é™åˆ¶çš„å†…æ ¸æŒ‡é’ˆ"></a>å—é™åˆ¶çš„å†…æ ¸æŒ‡é’ˆ</h3><p>è™½ç„¶KASLRæœ‰åŠ©äºé’ˆå¯¹æ€§çš„åˆ©ç”¨ï¼Œä½†å¾ˆå®¹æ˜“ç»•è¿‡ï¼Œå› ä¸ºæ¯æ¬¡åªæ˜¯é€šè¿‡å•ä¸ªéšæœºåç§»é‡ç§»åŠ¨æ‰€æœ‰å†…å®¹ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºã€‚å› æ­¤ï¼Œå¦‚æœæ”»å‡»è€…çŸ¥é“è‡³å°‘ä¸€ä¸ªè¿è¡Œæ—¶å†…æ ¸åœ°å€ï¼Œä»–ä»¬å¯ä»¥é€šè¿‡å°†è¿è¡Œæ—¶åœ°å€ä»å†…æ ¸çš„System.mapæ–‡ä»¶ä¸­çš„ç›¸åŒç¬¦å·ï¼ˆå‡½æ•°æˆ–æ•°æ®ç»“æ„ï¼‰çš„ç¼–è¯‘æ—¶åœ°å€ä¸­å‡å»æ¥æ¢å¤æ­¤åç§»é‡ã€‚ä¸€æ—¦ä»–ä»¬çŸ¥é“äº†åç§»é‡ï¼Œä»–ä»¬å°±å¯ä»¥é€šè¿‡è°ƒæ•´å®ƒä»¬æ¥æ¢å¤æ‰€æœ‰å…¶ä»–ç¬¦å·çš„åœ°å€ã€‚</p>
<p>å› æ­¤ï¼Œç°ä»£å†…æ ¸ä¸ºäº†è‡³å°‘ä¸å°†å†…æ ¸åœ°å€æ³„æ¼ç»™éç‰¹æƒç”¨æˆ·è€Œé‡‡å–äº†é¢„é˜²æªæ–½ã€‚å…¶ä¸­ä¸€ä¸ªä¸»è¦çš„è°ƒæ•´é€‰é¡¹æ˜¯<a href="https://www.kernel.org/doc/html/latest/admin-guide/sysctl/kernel.html#kptr-restrict">kptr_restrict sysctl</a>ã€‚å°†å…¶è‡³å°‘è®¾ç½®ä¸º<code>1</code>ä»¥ç¦æ­¢æ™®é€šç”¨æˆ·æŸ¥çœ‹å†…æ ¸æŒ‡é’ˆæ˜¯ä¸€ä¸ªå¥½ä¸»æ„ï¼š<br>ï¼ˆshell&#x2F;bashï¼‰</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ignat@dev:~$ sudo sysctl -w kernel.kptr_restrict=1</span><br><span class="line">kernel.kptr_restrict = 1</span><br><span class="line">ignat@dev:~$ grep selinux_state /proc/kallsyms</span><br><span class="line">0000000000000000 B selinux_state</span><br></pre></td></tr></table></figure>

<p>ç‰¹æƒç”¨æˆ·ä»ç„¶å¯ä»¥æŸ¥çœ‹æŒ‡é’ˆï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ignat@dev:~$ sudo grep selinux_state /proc/kallsyms ffffffffb41bcae0 B selinux_state</span><br></pre></td></tr></table></figure>

<p>ç±»ä¼¼äº<a href="https://www.kernel.org/doc/html/latest/admin-guide/sysctl/kernel.html#kptr-restrict">kptr_restrict sysctl</a>ï¼Œè¿˜æœ‰<a href="https://www.kernel.org/doc/html/latest/admin-guide/sysctl/kernel.html#dmesg-restrict">dmesg_restrict</a>ï¼Œå¦‚æœè®¾ç½®ï¼Œå°†é˜»æ­¢æ™®é€šç”¨æˆ·è¯»å–å†…æ ¸æ—¥å¿—ï¼ˆé€šè¿‡å…¶æ¶ˆæ¯ä¹Ÿå¯èƒ½æ³„æ¼å†…æ ¸æŒ‡é’ˆï¼‰ã€‚è™½ç„¶æ‚¨éœ€è¦åœ¨æ¯æ¬¡å¯åŠ¨æ—¶æ˜¾å¼è®¾ç½®<a href="https://www.kernel.org/doc/html/latest/admin-guide/sysctl/kernel.html#kptr-restrict">kptr_restrict sysctl</a>çš„å€¼ï¼ˆæˆ–ä½¿ç”¨ä¸€äº›ç³»ç»Ÿsysctlé…ç½®å®ç”¨ç¨‹åºï¼Œå¦‚<a href="https://www.freedesktop.org/software/systemd/man/latest/systemd-sysctl.service.html">æ­¤å·¥å…·</a>ï¼‰ï¼Œä½†æ‚¨å¯ä»¥é€šè¿‡<code>CONFIG_SECURITY_DMESG_RESTRICT</code>å†…æ ¸é…ç½®é€‰é¡¹æ¥é…ç½®<a href="https://www.kernel.org/doc/html/latest/admin-guide/sysctl/kernel.html#dmesg-restrict">dmesg_restrict</a>çš„åˆå§‹å€¼ã€‚Cloudflareå†…æ ¸å’ŒDebianå†…æ ¸éƒ½é€šè¿‡è¿™ç§æ–¹å¼å¼ºåˆ¶æ‰§è¡Œ<a href="https://www.kernel.org/doc/html/latest/admin-guide/sysctl/kernel.html#dmesg-restrict">dmesg_restrict</a>ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ignat@dev:~$ grep CONFIG_SECURITY_DMESG_RESTRICT /boot/config-`<span class="built_in">uname</span> -r` CONFIG_SECURITY_DMESG_RESTRICT=y</span><br></pre></td></tr></table></figure>

<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ&#x2F;proc&#x2F;kallsymså’Œå†…æ ¸æ—¥å¿—ä¸æ˜¯æ½œåœ¨çš„å†…æ ¸æŒ‡é’ˆæ³„æ¼çš„å”¯ä¸€æ¥æºã€‚Linuxå†…æ ¸ä¸­æœ‰å¾ˆå¤šé—ç•™é—®é¢˜ï¼Œè€Œä¸”<a href="https://docs.kernel.org/latest/admin-guide/kernel-parameters.html#debug-kernel-parameters">æ–°çš„æ³„æ¼æ¥æºä¸æ–­è¢«å‘ç°å’Œä¿®å¤</a>ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆåŠæ—¶è·Ÿä¸Šæœ€æ–°çš„å†…æ ¸é”™è¯¯ä¿®å¤ç‰ˆæœ¬éå¸¸é‡è¦ã€‚</p>
<h2 id="Lockdown-LSM"><a href="#Lockdown-LSM" class="headerlink" title="Lockdown LSM"></a>Lockdown LSM</h2><p><a href="https://www.kernel.org/doc/html/latest/admin-guide/LSM/index.html">Linux Security Modules (LSM)</a>æ˜¯ä¸€ä¸ªåŸºäºé’©å­çš„æ¡†æ¶ï¼Œç”¨äºåœ¨Linuxå†…æ ¸ä¸­å®ç°å®‰å…¨ç­–ç•¥å’Œå¼ºåˆ¶è®¿é—®æ§åˆ¶ã€‚æˆ‘ä»¬ä¹‹å‰[ä»‹ç»è¿‡æˆ‘ä»¬ä½¿ç”¨çš„å¦ä¸€ä¸ªLSMæ¨¡å—ï¼ŒBPF-LSM]ã€‚</p>
<p>BPF-LSMæ˜¯æˆ‘ä»¬å†…æ ¸å®‰å…¨æ€§çš„ä¸€ä¸ªæœ‰ç”¨çš„åŸºç¡€ç»„ä»¶ï¼Œä½†åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬è¦æåˆ°æˆ‘ä»¬ä½¿ç”¨çš„å¦ä¸€ä¸ªæœ‰ç”¨çš„LSMæ¨¡å—â€”â€”<a href="https://man7.org/linux/man-pages/man7/kernel_lockdown.7.html">Lockdown LSM</a>ã€‚Lockdownå¯ä»¥å¤„äºä¸‰ç§çŠ¶æ€ï¼ˆç”±<code>/sys/kernel/security/lockdown</code>ç‰¹æ®Šæ–‡ä»¶æ§åˆ¶ï¼‰ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ignat@dev:~$ <span class="built_in">cat</span> /sys/kernel/security/lockdown [none] integrity confidentiality</span><br></pre></td></tr></table></figure>

<p><code>none</code>æ˜¯æœªæ‰§è¡Œä»»ä½•æ“ä½œå¹¶ä¸”æ¨¡å—å®é™…ä¸Šè¢«ç¦ç”¨çš„çŠ¶æ€ã€‚å½“Lockdownå¤„äº<code>integrity</code>çŠ¶æ€æ—¶ï¼Œå†…æ ¸å°è¯•é˜»æ­¢ä»»ä½•å¯èƒ½ç ´åå…¶å®Œæ•´æ€§çš„æ“ä½œã€‚æˆ‘ä»¬åœ¨æœ¬æ–‡ä¸­å·²ç»æ¶µç›–äº†å…¶ä¸­çš„ä¸€äº›ç¤ºä¾‹ï¼šåŠ è½½æœªç­¾åçš„æ¨¡å—å’Œé€šè¿‡KEXECæ‰§è¡Œæœªç­¾åçš„ä»£ç ã€‚ä½†æ˜¯ï¼Œè¯¥LSMè¿˜å°è¯•é˜»æ­¢<a href="https://man7.org/linux/man-pages/man7/kernel_lockdown.7.html">LSMçš„mané¡µä¸­æåˆ°çš„å…¶ä»–æ½œåœ¨æ–¹å¼</a>ã€‚<code>confidentiality</code>æ˜¯æœ€ä¸¥æ ¼çš„æ¨¡å¼ï¼Œå…¶ä¸­Lockdownè¿˜å°è¯•é˜»æ­¢å†…æ ¸ä¿¡æ¯æ³„æ¼ã€‚åœ¨å®è·µä¸­ï¼Œè¿™å¯¹äºæœåŠ¡å™¨å·¥ä½œè´Ÿè½½æ¥è¯´å¯èƒ½è¿‡äºä¸¥æ ¼ï¼Œå› ä¸ºå®ƒä¼šé˜»æ­¢æ‰€æœ‰è¿è¡Œæ—¶è°ƒè¯•åŠŸèƒ½ï¼Œå¦‚<code>perf</code>æˆ–eBPFã€‚</p>
<p>è®©æˆ‘ä»¬çœ‹çœ‹Lockdown LSMçš„å®é™…æ•ˆæœã€‚åœ¨ä¸€ä¸ªåŸºæœ¬çš„Debianç³»ç»Ÿä¸Šï¼Œåˆå§‹çŠ¶æ€æ˜¯<code>none</code>ï¼Œæ„å‘³ç€æ²¡æœ‰è¢«é”å®šï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ignat@dev:~$ <span class="built_in">uname</span> -a Linux dev 6.1.0-18-cloud-amd64 <span class="comment">#1 SMP PREEMPT_DYNAMIC Debian 6.1.76-1 (2024-02-01) x86_64 GNU/Linux ignat@dev:~$ cat /sys/kernel/security/lockdown [none] integrity confidentiality</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥å°†ç³»ç»Ÿåˆ‡æ¢åˆ°<code>integrity</code>æ¨¡å¼ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ignat@dev:~$ <span class="built_in">echo</span> integrity | sudo <span class="built_in">tee</span> /sys/kernel/security/lockdown integrity ignat@dev:~$ <span class="built_in">cat</span> /sys/kernel/security/lockdown none [integrity] confidentiality</span><br></pre></td></tr></table></figure>

<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬åªèƒ½å°†ç³»ç»Ÿè®¾ç½®ä¸ºæ›´ä¸¥æ ¼çš„çŠ¶æ€ï¼Œè€Œä¸èƒ½è¿”å›ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ—¦è¿›å…¥<code>integrity</code>æ¨¡å¼ï¼Œæˆ‘ä»¬åªèƒ½åˆ‡æ¢åˆ°<code>confidentiality</code>æ¨¡å¼ï¼Œè€Œä¸èƒ½åˆ‡æ¢å›<code>none</code>æ¨¡å¼ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ignat@dev:~$ <span class="built_in">echo</span> none | sudo <span class="built_in">tee</span> /sys/kernel/security/lockdown none <span class="built_in">tee</span>: /sys/kernel/security/lockdown: Operation not permitted</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œå³ä½¿åœ¨åº“å­˜çš„Debianå†…æ ¸ä¸Šï¼Œæˆ‘ä»¬ä¹Ÿæ— æ³•å†åŠ è½½æ½œåœ¨æ¶æ„çš„æœªç­¾åå†…æ ¸æ¨¡å—ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ignat@dev:~$ sudo insmod mymod/mymod.ko insmod: ERROR: could not insert module mymod/mymod.ko: Operation not permitted</span><br></pre></td></tr></table></figure>

<p>è€Œä¸”å†…æ ¸æ—¥å¿—ä¼šå‹å¥½åœ°æŒ‡å‡ºè¿™æ˜¯ç”±äºLockdown LSMå¼•èµ·çš„ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ignat@dev:~$ sudo dmesg | <span class="built_in">tail</span> -n 1 [21728.820129] Lockdown: insmod: unsigned module loading is restricted; see man kernel_lockdown.7</span><br></pre></td></tr></table></figure>

<p>æ­£å¦‚æˆ‘ä»¬æ‰€çœ‹åˆ°çš„ï¼ŒLockdown LSMæœ‰åŠ©äºåŠ å¼ºå†…æ ¸çš„å®‰å…¨æ€§ï¼Œå¦åˆ™å¯èƒ½ä¸ä¼šå¯ç”¨å…¶ä»–å¼ºåˆ¶æ‰§è¡Œä½ï¼Œå¦‚åº“å­˜çš„Debianå†…æ ¸ã€‚</p>
<p>å¦‚æœæ‚¨è‡ªå·±ç¼–è¯‘å†…æ ¸ï¼Œæ‚¨å¯ä»¥æ›´è¿›ä¸€æ­¥ï¼Œå°†<a href="https://elixir.bootlin.com/linux/v6.6.17/source/security/lockdown/Kconfig#L33">Lockdown LSMçš„åˆå§‹çŠ¶æ€è®¾ç½®ä¸ºæ¯”noneæ›´ä¸¥æ ¼çš„çŠ¶æ€</a>ã€‚è¿™æ­£æ˜¯æˆ‘ä»¬ä¸ºCloudflareç”Ÿäº§å†…æ ¸æ‰€åšçš„ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ignat@dev:~$ grep LOCK_DOWN /boot/config-6.6.17-cloudflare-2024.2.9 <span class="comment"># CONFIG_LOCK_DOWN_KERNEL_FORCE_NONE is not set CONFIG_LOCK_DOWN_KERNEL_FORCE_INTEGRITY=y # CONFIG_LOCK_DOWN_KERNEL_FORCE_CONFIDENTIALITY is not set</span></span><br></pre></td></tr></table></figure>

<h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å›é¡¾äº†Cloudflareåœ¨Linuxå†…æ ¸å®‰å…¨é…ç½®æ–¹é¢ä½¿ç”¨çš„ä¸€äº›æœ‰ç”¨æ–¹æ³•ã€‚è¿™åªæ˜¯ä¸€ä¸ªå°çš„å­é›†ï¼Œè¿˜æœ‰è®¸å¤šå…¶ä»–å¯ç”¨çš„åŠŸèƒ½ï¼Œå¹¶ä¸”Linuxå†…æ ¸ç¤¾åŒºä¸æ–­å¼€å‘ã€å®¡æŸ¥å’Œæ”¹è¿›æ›´å¤šåŠŸèƒ½ã€‚æˆ‘ä»¬å¸Œæœ›æœ¬æ–‡èƒ½å¤Ÿä¸ºæ‚¨ä»‹ç»è¿™äº›å®‰å…¨åŠŸèƒ½ï¼Œå¹¶ä¸”å¦‚æœæ‚¨å°šæœªè¿™æ ·åšï¼Œæ‚¨å¯ä»¥è€ƒè™‘åœ¨Linuxç³»ç»Ÿä¸­å¯ç”¨å®ƒä»¬ã€‚</p>
]]></content>
      <categories>
        <category>blog</category>
      </categories>
      <tags>
        <tag>linux</tag>
        <tag>å®‰å…¨</tag>
      </tags>
  </entry>
  <entry>
    <title>å¦‚ä½•ç”¨æ±‡ç¼–åˆ†æGoä»£ç </title>
    <url>/2024/01/16/%E5%A6%82%E4%BD%95%E7%94%A8%E6%B1%87%E7%BC%96%E5%88%86%E6%9E%90Go%E4%BB%A3%E7%A0%81/</url>
    <content><![CDATA[<p>ä»Šå¤©ä»‹ç»å‡ ä¸ªå¸¸ç”¨çš„æŸ¥çœ‹ Go æ±‡ç¼–ä»£ç ã€è°ƒè¯• Go ç¨‹åºçš„å‘½ä»¤å’Œå·¥å…·ï¼Œ</p>
<span id="more"></span>
<p>æ¯”è¾ƒè¿™ä¸¤æ®µä»£ç </p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Student <span class="keyword">struct</span> &#123;</span><br><span class="line">	Class <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> a = &amp;Student&#123;<span class="number">1</span>&#125;</span><br><span class="line">	<span class="built_in">println</span>(a)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>çš„æ‰§è¡Œæ•ˆç‡è¦é«˜äºä¸‹é¢è¿™æ®µä»£ç ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Student <span class="keyword">struct</span> &#123;</span><br><span class="line">	Class <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> a = Student&#123;<span class="number">1</span>&#125;</span><br><span class="line">	<span class="keyword">var</span> b = &amp;a</span><br><span class="line">	<span class="built_in">println</span>(b)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¹¶ä¸”ç»™ä½ è®²äº†ä¸€é€šé“ç†ï¼Œä½ å¥½åƒæ²¡æ³•è¾©èµ¢ä»–ã€‚æ€ä¹ˆåŠï¼Ÿ<br>ç›´æ¥ç”¨ä¸€è¡Œå‘½ä»¤ç”Ÿæˆæ±‡ç¼–ä»£ç ï¼Œé©¬ä¸Šå¯ä»¥æˆ³ç©¿ä»–ï¼Œæ‰“ä»–çš„è„¸ã€‚</p>
<h1 id="go-tool-ç”Ÿæˆæ±‡ç¼–"><a href="#go-tool-ç”Ÿæˆæ±‡ç¼–" class="headerlink" title="go tool ç”Ÿæˆæ±‡ç¼–"></a>go tool ç”Ÿæˆæ±‡ç¼–</h1><p>å…¶å®å¾ˆç®€å•ï¼Œæœ‰ä¸¤ä¸ªå‘½ä»¤å¯ä»¥åšåˆ°ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">go tool compile -S main.go</span><br></pre></td></tr></table></figure>

<p>å’Œï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">go build main.go &amp;&amp; go tool objdump ./main</span><br></pre></td></tr></table></figure>

<p> å‰è€…æ˜¯ç¼–è¯‘ï¼Œå³å°†æºä»£ç ç¼–è¯‘æˆÂ <code>.o</code>Â ç›®æ ‡æ–‡ä»¶ï¼Œå¹¶è¾“å‡ºæ±‡ç¼–ä»£ç ã€‚</p>
<p>åè€…æ˜¯åæ±‡ç¼–ï¼Œå³ä»å¯æ‰§è¡Œæ–‡ä»¶åç¼–è¯‘æˆæ±‡ç¼–ï¼Œæ‰€ä»¥è¦å…ˆç”¨Â <code>go build</code>Â å‘½ä»¤ç¼–è¯‘å‡ºå¯æ‰§è¡Œæ–‡ä»¶ã€‚</p>
<p>äºŒè€…ä¸å°½ç›¸åŒï¼Œä½†éƒ½èƒ½çœ‹åˆ°å‰é¢ä¸¤ä¸ªç¤ºä¾‹ä»£ç å¯¹åº”çš„æ±‡ç¼–ä»£ç æ˜¯ä¸€è‡´çš„ã€‚åŒäº‹çš„â€œè°£è¨€â€ä¸æ”»è‡ªç ´ï¼Œè„¸éƒ½è¢«ä½ æ‰“ç–¼äº†ã€‚</p>
<h1 id="æ‰¾åˆ°-runtime-æºç "><a href="#æ‰¾åˆ°-runtime-æºç " class="headerlink" title="æ‰¾åˆ° runtime æºç "></a>æ‰¾åˆ° runtime æºç </h1><p>Go æ˜¯ä¸€é—¨æœ‰ runtime çš„è¯­è¨€ï¼Œä»€ä¹ˆæ˜¯ runtimeï¼Ÿå…¶å®å°±æ˜¯ä¸€æ®µè¾…åŠ©ç¨‹åºï¼Œç”¨æˆ·æ²¡æœ‰å†™çš„ä»£ç ï¼Œruntime æ›¿æˆ‘ä»¬å†™äº†ï¼Œæ¯”å¦‚ Go è°ƒåº¦å™¨çš„ä»£ç ã€‚</p>
<p>æˆ‘ä»¬åªéœ€è¦çŸ¥é“ç”¨ go å…³é”®å­—åˆ›å»º goroutineï¼Œå°±å¯ä»¥ç–¯ç‹‚å †ä¸šåŠ¡äº†ã€‚è‡³äº goroutine æ˜¯æ€ä¹ˆè¢«è°ƒåº¦çš„ï¼Œæ ¹æœ¬ä¸éœ€è¦å…³å¿ƒï¼Œè¿™äº›æ˜¯ runtime è°ƒåº¦å™¨çš„å·¥ä½œã€‚</p>
<p>é‚£æˆ‘ä»¬è‡ªå·±å†™çš„ä»£ç å¦‚ä½•å’Œ runtime é‡Œçš„ä»£ç å¯¹åº”èµ·æ¥å‘¢ï¼Ÿ</p>
<p>å‰é¢ä»‹ç»çš„æ–¹æ³•å°±å¯ä»¥åšåˆ°ï¼Œåªéœ€è¦åŠ ä¸€ä¸ªÂ <code>grep</code>Â å°±å¯ä»¥ã€‚</p>
<p>ä¾‹å¦‚ï¼Œæˆ‘æƒ³çŸ¥é“ go å…³é”®å­—å¯¹åº” runtime é‡Œçš„å“ªä¸ªå‡½æ•°ï¼Œäºæ˜¯å†™äº†ä¸€æ®µæµ‹è¯•ä»£ç ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="built_in">println</span>(<span class="number">1</span>+<span class="number">2</span>)</span><br><span class="line">	&#125;()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å› ä¸ºÂ <code>go func()&#123;&#125;()</code>Â é‚£ä¸€è¡Œä»£ç åœ¨ç¬¬ 4 è¡Œï¼Œæ‰€ä»¥ï¼Œgrep çš„æ—¶å€™åŠ ä¸€ä¸ªæ¡ä»¶ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">go tool compile -S main.go | grep <span class="string">&quot;main.go:4&quot;</span></span><br><span class="line"></span><br><span class="line">// æˆ–</span><br><span class="line"></span><br><span class="line">go build main.go &amp;&amp; go tool objdump ./main | grep <span class="string">&quot;main.go:4&quot;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://images.hxzhouh.com/blog-images/2024/01/ddda1a97dad5e145c1b83e0cf89bf1f7.png" alt="Pasted image 20240116112336"></p>
<p>é©¬ä¸Šå°±èƒ½çœ‹åˆ°Â <code>go func()&#123;&#125;()</code>Â å¯¹åº”Â <code>newproc()</code>Â å‡½æ•°ï¼Œè¿™æ—¶å†æ·±å…¥ç ”ç©¶ä¸‹Â <code>newproc()</code>Â å‡½æ•°å°±å¤§æ¦‚çŸ¥é“ goroutine æ˜¯å¦‚ä½•è¢«åˆ›å»ºçš„ã€‚</p>
<h1 id="ä¸dlvè°ƒè¯•ä»£ç "><a href="#ä¸dlvè°ƒè¯•ä»£ç " class="headerlink" title="ä¸dlvè°ƒè¯•ä»£ç "></a>ä¸dlvè°ƒè¯•ä»£ç </h1><p>é‚£æœ‰åŒå­¦é—®äº†ï¼Œæœ‰æ²¡æœ‰å…¶ä»–å¯ä»¥è°ƒè¯• Goã€ä»¥åŠå’Œ Go ç¨‹åºäº’åŠ¨çš„æ–¹æ³•å‘¢ï¼Ÿå…¶å®æ˜¯æœ‰çš„ï¼è¿™å°±æ˜¯æˆ‘ä»¬è¦ä»‹ç»çš„ dlv è°ƒè¯•å·¥å…·ï¼Œç›®å‰å®ƒå¯¹è°ƒè¯• Go çš„ç¨‹åºæ”¯æŒæ˜¯æœ€å¥½çš„ã€‚</p>
<p>ä¹‹å‰æ²¡æˆ‘æ€ä¹ˆç ”ç©¶å®ƒï¼Œåªä¼šä¸€äº›éå¸¸ç®€å•çš„å‘½ä»¤ï¼Œè¿™æ¬¡å­¦ä¼šäº†å‡ ä¸ªè¿›é˜¶çš„æŒ‡ä»¤ï¼Œå¨åŠ›æŒºå¤§ï¼Œä¹Ÿè¿›ä¸€æ­¥åŠ æ·±äº†å¯¹ Go çš„ç†è§£ã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬å¸¦ç€ä¸€ä¸ªä»»åŠ¡æ¥è®²è§£ dlv å¦‚ä½•ä½¿ç”¨ã€‚</p>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œå‘ä¸€ä¸ª nil çš„ slice append å…ƒç´ ï¼Œä¸ä¼šæœ‰ä»»ä½•é—®é¢˜ã€‚ä½†æ˜¯å‘ä¸€ä¸ª nil çš„ map æ’å…¥æ–°å…ƒç´ ï¼Œé©¬ä¸Šå°±ä¼šæŠ¥ panicã€‚è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿåˆæ˜¯åœ¨å“ª panic å‘¢ï¼Ÿ</p>
<p>é¦–å…ˆå†™å‡ºè®© map äº§ç”Ÿ panic çš„ç¤ºä¾‹ç¨‹åºï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> m <span class="keyword">map</span>[<span class="type">int</span>]<span class="type">int</span></span><br><span class="line">	m[<span class="number">1</span>] = <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€ç”¨Â <code>go build</code>Â å‘½ä»¤ç¼–è¯‘ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">go build main.go</span><br></pre></td></tr></table></figure>

<p>ç„¶åï¼Œä½¿ç”¨ dlv è¿›å…¥è°ƒè¯•çŠ¶æ€ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">dlv <span class="built_in">exec</span> ./main</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨Â <code>b</code>Â è¿™ä¸ªå‘½ä»¤æ‰“æ–­ç‚¹ï¼Œæœ‰ä¸‰ç§æ–¹æ³•ï¼š</p>
<ol>
<li>b + åœ°å€</li>
<li>b + ä»£ç è¡Œæ•°</li>
<li>b + å‡½æ•°å</li>
</ol>
<p>æˆ‘ä»¬è¦åœ¨å¯¹ map èµ‹å€¼çš„åœ°æ–¹åŠ ä¸ªæ–­ç‚¹ã€‚ä½ç½®æ˜¯ç¬¬äº”è¡Œï¼Œæˆ‘ä»¬åœ¨ç¬¬äº”è¡ŒåŠ ä¸€ä¸ªæ–­ç‚¹ã€‚</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">(dlv) b main.go:5</span><br><span class="line">Breakpoint 1 <span class="built_in">set</span> at 0x104203070 <span class="keyword">for</span> main.main() ./main.go:5</span><br><span class="line">(dlv)</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡ŒÂ <code>c</code>Â å‘½ä»¤ï¼Œç›´æ¥è¿è¡Œåˆ°æ–­ç‚¹å¤„,æ‰§è¡ŒÂ <code>disass</code>Â å‘½ä»¤ï¼Œå¯ä»¥çœ‹åˆ°æ±‡ç¼–æŒ‡ä»¤ï¼š<br><img src="https://images.hxzhouh.com/blog-images/2024/01/108eac7ada0934c2e59e6405c399e3ca.png" alt="Pasted image 20240116165330"></p>
<p>è¿™æ—¶ä½¿ç”¨Â <code>si</code>Â å‘½ä»¤ï¼Œæ‰§è¡Œå•æ¡æŒ‡ä»¤ï¼Œå¤šæ¬¡æ‰§è¡ŒÂ <code>si</code>ï¼Œå°±ä¼šæ‰§è¡Œåˆ° map èµ‹å€¼å‡½æ•°Â &#96;mapassign_fast64:<br><img src="https://images.hxzhouh.com/blog-images/2024/01/df61dc4321789a163071d054e2d40f4b.png" alt="Pasted image 20240116165429"><br><img src="https://images.hxzhouh.com/blog-images/2024/01/c9223b5250b9fdf891adfaeee8493633.png" alt="Pasted image 20240116170428"><br>ç„¶åæˆ‘ä»¬åœ¨ map_fast64.goä¸Šé¢æ·»åŠ ä¸€ä¸ªæ–­ç‚¹ï¼Œ</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">b /opt/homebrew/Cellar/go/1.21.6/libexec/src/runtime/map_fast64.go:93</span><br></pre></td></tr></table></figure>
<p>è¿™æ—¶å†ç”¨å•æ­¥å‘½ä»¤Â <code>s</code>ï¼Œå°±ä¼šè¿›å…¥åˆ¤æ–­ h çš„å€¼ä¸º nil çš„åˆ†æ”¯ï¼Œç„¶åæ‰§è¡ŒÂ <code>panic</code>Â å‡½æ•°ï¼š<br><img src="https://images.hxzhouh.com/blog-images/2024/01/3c305ca7f39d3b6bd35f5d640d5d7ef1.png" alt="Pasted image 20240116170619"></p>
<p><img src="https://images.hxzhouh.com/blog-images/2024/01/123a0062745492be1a90b5028331faea.png" alt="Pasted image 20240116170945"><br>è‡³æ­¤ï¼Œå‘ nil çš„ map èµ‹å€¼æ—¶ï¼Œäº§ç”Ÿ panic çš„ä»£ç å°±è¢«æˆ‘ä»¬æ‰¾åˆ°äº†ã€‚æ¥ç€ï¼ŒæŒ‰å›¾ç´¢éª¥æ‰¾åˆ°å¯¹åº” runtime æºç çš„ä½ç½®ï¼Œå°±å¯ä»¥è¿›ä¸€æ­¥æ¢ç´¢äº†ã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨Â <code>bt</code>Â å‘½ä»¤çœ‹åˆ°è°ƒç”¨æ ˆï¼š<br><img src="https://images.hxzhouh.com/blog-images/2024/01/6cd9f5f16328f257c5020ac976a8ba42.png" alt="Pasted image 20240116171018"><br>ä½¿ç”¨Â <code>frame 1</code>Â å‘½ä»¤å¯ä»¥è·³è½¬åˆ°ç›¸åº”ä½ç½®ã€‚è¿™é‡ŒÂ <code>1</code>Â å¯¹åº”å›¾ä¸­çš„Â <code>main.go:5</code>ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å‰é¢æ‰“æ–­ç‚¹çš„åœ°æ–¹ï¼Œæ˜¯ä¸æ˜¯éå¸¸é…·ç‚«ã€‚</p>
<p>ä¸Šé¢è¿™å¼ å›¾é‡Œæˆ‘ä»¬ä¹Ÿèƒ½æ¸…æ¥šåœ°çœ‹åˆ°ï¼Œç”¨æˆ· goroutine å…¶å®æ˜¯è¢« goexit å‡½æ•°ä¸€è·¯è°ƒç”¨è¿‡æ¥çš„ã€‚å½“ç”¨æˆ· goroutine æ‰§è¡Œå®Œæ¯•åï¼Œå°±ä¼šå›åˆ° goexit å‡½æ•°åšä¸€äº›æ”¶å°¾å·¥ä½œã€‚å½“ç„¶ï¼Œè¿™æ˜¯é¢˜å¤–è¯äº†ã€‚</p>
<h2 id="å¦å¤–ï¼Œç”¨-dlv-ä¹Ÿèƒ½å¹²ç¬¬äºŒéƒ¨åˆ†â€œæ‰¾åˆ°-runtime-æºç â€çš„æ´»ã€‚-æ€»ç»“ä»Šå¤©ç³»ç»Ÿåœ°è®²äº†å‡ æ‹›é€šè¿‡å‘½ä»¤å’Œå·¥å…·æŸ¥çœ‹ç”¨æˆ·ä»£ç å¯¹åº”çš„-runtime-æºç æˆ–è€…æ±‡ç¼–ä»£ç çš„æ–¹æ³•ï¼Œéå¸¸å®ç”¨ã€‚æœ€åå†æ±‡æ€»ä¸€ä¸‹ï¼š1-go-tool-compile2-go-tool-objdump3-dlvåé¢ï¼Œæˆ‘ä»¬ä¼šç”¨è¿™äº›å·¥å…·ç»§ç»­åˆ†æ-goè¯­è¨€çš„æºç ï¼Œæ¯”å¦‚map-slice-ç­‰ï¼Œæœ‰äº†è¿™äº›å·¥å…·ï¼Œæˆ‘ä»¬çš„å­¦ä¹ è¿‡ç¨‹ä¼šäº‹åŠåŠŸå€ã€‚"><a href="#å¦å¤–ï¼Œç”¨-dlv-ä¹Ÿèƒ½å¹²ç¬¬äºŒéƒ¨åˆ†â€œæ‰¾åˆ°-runtime-æºç â€çš„æ´»ã€‚-æ€»ç»“ä»Šå¤©ç³»ç»Ÿåœ°è®²äº†å‡ æ‹›é€šè¿‡å‘½ä»¤å’Œå·¥å…·æŸ¥çœ‹ç”¨æˆ·ä»£ç å¯¹åº”çš„-runtime-æºç æˆ–è€…æ±‡ç¼–ä»£ç çš„æ–¹æ³•ï¼Œéå¸¸å®ç”¨ã€‚æœ€åå†æ±‡æ€»ä¸€ä¸‹ï¼š1-go-tool-compile2-go-tool-objdump3-dlvåé¢ï¼Œæˆ‘ä»¬ä¼šç”¨è¿™äº›å·¥å…·ç»§ç»­åˆ†æ-goè¯­è¨€çš„æºç ï¼Œæ¯”å¦‚map-slice-ç­‰ï¼Œæœ‰äº†è¿™äº›å·¥å…·ï¼Œæˆ‘ä»¬çš„å­¦ä¹ è¿‡ç¨‹ä¼šäº‹åŠåŠŸå€ã€‚" class="headerlink" title="å¦å¤–ï¼Œç”¨ dlv ä¹Ÿèƒ½å¹²ç¬¬äºŒéƒ¨åˆ†â€œæ‰¾åˆ° runtime æºç â€çš„æ´»ã€‚# æ€»ç»“ä»Šå¤©ç³»ç»Ÿåœ°è®²äº†å‡ æ‹›é€šè¿‡å‘½ä»¤å’Œå·¥å…·æŸ¥çœ‹ç”¨æˆ·ä»£ç å¯¹åº”çš„ runtime æºç æˆ–è€…æ±‡ç¼–ä»£ç çš„æ–¹æ³•ï¼Œéå¸¸å®ç”¨ã€‚æœ€åå†æ±‡æ€»ä¸€ä¸‹ï¼š1. go tool compile2. go tool objdump3. dlvåé¢ï¼Œæˆ‘ä»¬ä¼šç”¨è¿™äº›å·¥å…·ç»§ç»­åˆ†æ goè¯­è¨€çš„æºç ï¼Œæ¯”å¦‚map slice ç­‰ï¼Œæœ‰äº†è¿™äº›å·¥å…·ï¼Œæˆ‘ä»¬çš„å­¦ä¹ è¿‡ç¨‹ä¼šäº‹åŠåŠŸå€ã€‚ "></a>å¦å¤–ï¼Œç”¨ dlv ä¹Ÿèƒ½å¹²ç¬¬äºŒéƒ¨åˆ†â€œæ‰¾åˆ° runtime æºç â€çš„æ´»ã€‚<br># æ€»ç»“<br>ä»Šå¤©ç³»ç»Ÿåœ°è®²äº†å‡ æ‹›é€šè¿‡å‘½ä»¤å’Œå·¥å…·æŸ¥çœ‹ç”¨æˆ·ä»£ç å¯¹åº”çš„ runtime æºç æˆ–è€…æ±‡ç¼–ä»£ç çš„æ–¹æ³•ï¼Œéå¸¸å®ç”¨ã€‚æœ€åå†æ±‡æ€»ä¸€ä¸‹ï¼š<br>1. go tool compile<br>2. go tool objdump<br>3. dlv<br>åé¢ï¼Œæˆ‘ä»¬ä¼šç”¨è¿™äº›å·¥å…·ç»§ç»­åˆ†æ goè¯­è¨€çš„æºç ï¼Œæ¯”å¦‚map slice ç­‰ï¼Œæœ‰äº†è¿™äº›å·¥å…·ï¼Œæˆ‘ä»¬çš„å­¦ä¹ è¿‡ç¨‹ä¼šäº‹åŠåŠŸå€ã€‚ </h2><p>å¦‚æœä½ å–œæ¬¢æˆ‘çš„æ–‡ç« ï¼Œæ¬¢è¿ç»™æˆ‘followingè·Ÿ ğŸ‘ï¼Œè¿™å¯¹æˆ‘å¾ˆæœ‰å¸®åŠ©ã€‚</p>
]]></content>
      <categories>
        <category>go</category>
      </categories>
      <tags>
        <tag>Go</tag>
      </tags>
  </entry>
  <entry>
    <title>è®¡ç®—æœºä¸­çš„æ—¶é—´ çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ä¼šç”¨æ‰ä½ å¤šå°‘CPUï¼Ÿ</title>
    <url>/2024/03/19/%E8%AE%A1%E7%AE%97%E6%9C%BA%E4%B8%AD%E7%9A%84%E6%97%B6%E9%97%B4%20%E7%BA%BF%E7%A8%8B%E4%B8%8A%E4%B8%8B%E6%96%87%E5%88%87%E6%8D%A2%E4%BC%9A%E7%94%A8%E6%8E%89%E4%BD%A0%E5%A4%9A%E5%B0%91CPU%EF%BC%9F/</url>
    <content><![CDATA[<p>è¿›ç¨‹æ˜¯æ“ä½œç³»ç»Ÿçš„ä¼Ÿå¤§å‘æ˜ä¹‹ä¸€ï¼Œå¯¹åº”ç”¨ç¨‹åºå±è”½äº†CPUè°ƒåº¦ã€å†…å­˜ç®¡ç†ç­‰ç¡¬ä»¶ç»†èŠ‚ï¼Œè€ŒæŠ½è±¡å‡ºä¸€ä¸ªè¿›ç¨‹çš„æ¦‚å¿µï¼Œè®©åº”ç”¨ç¨‹åºä¸“å¿ƒäºå®ç°è‡ªå·±çš„ä¸šåŠ¡é€»è¾‘æ—¢å¯ï¼Œè€Œä¸”åœ¨æœ‰é™çš„CPUä¸Šå¯ä»¥â€œåŒæ—¶â€è¿›è¡Œè®¸å¤šä¸ªä»»åŠ¡ã€‚ä½†æ˜¯å®ƒä¸ºç”¨æˆ·å¸¦æ¥æ–¹ä¾¿çš„åŒæ—¶ï¼Œä¹Ÿå¼•å…¥äº†ä¸€äº›é¢å¤–çš„å¼€é”€ã€‚å¦‚ä¸‹å›¾ï¼Œåœ¨è¿›ç¨‹è¿è¡Œä¸­é—´çš„æ—¶é—´é‡Œï¼Œè™½ç„¶CPUä¹Ÿåœ¨å¿™äºå¹²æ´»ï¼Œä½†æ˜¯å´æ²¡æœ‰å®Œæˆä»»ä½•çš„ç”¨æˆ·å·¥ä½œï¼Œè¿™å°±æ˜¯è¿›ç¨‹æœºåˆ¶å¸¦æ¥çš„é¢å¤–å¼€é”€ã€‚  </p>
<span id="more"></span>
<p><img src="https://images.hxzhouh.com/blog-images/2024/03/e1fd29a84d212fe4c9161eaa7edda593.png" alt="Pasted image 20240319113416"></p>
<p>åœ¨è¿›ç¨‹Aåˆ‡æ¢åˆ°è¿›ç¨‹Bçš„è¿‡ç¨‹ä¸­ï¼Œå…ˆä¿å­˜Aè¿›ç¨‹çš„ä¸Šä¸‹æ–‡ï¼Œä»¥ä¾¿äºç­‰Aæ¢å¤è¿è¡Œçš„æ—¶å€™ï¼Œèƒ½å¤ŸçŸ¥é“Aè¿›ç¨‹çš„ä¸‹ä¸€æ¡æŒ‡ä»¤æ˜¯å•¥ã€‚ç„¶åå°†è¦è¿è¡Œçš„Bè¿›ç¨‹çš„ä¸Šä¸‹æ–‡æ¢å¤åˆ°å¯„å­˜å™¨ä¸­ã€‚è¿™ä¸ªè¿‡ç¨‹è¢«ç§°ä¸ºä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€åœ¨è¿›ç¨‹ä¸å¤šã€åˆ‡æ¢ä¸é¢‘ç¹çš„åº”ç”¨åœºæ™¯ä¸‹é—®é¢˜ä¸å¤§ã€‚ä½†æ˜¯ç°åœ¨Linuxæ“ä½œç³»ç»Ÿè¢«ç”¨åˆ°äº†é«˜å¹¶å‘çš„ç½‘ç»œç¨‹åºåç«¯æœåŠ¡å™¨ã€‚åœ¨å•æœºæ”¯æŒæˆåƒä¸Šä¸‡ä¸ªç”¨æˆ·è¯·æ±‚çš„æ—¶å€™ï¼Œè¿™ä¸ªå¼€é”€å°±å¾—æ‹¿å‡ºæ¥è¯´é“è¯´é“äº†ã€‚å› ä¸ºç”¨æˆ·è¿›ç¨‹åœ¨è¯·æ±‚Redisã€Mysqlæ•°æ®ç­‰ç½‘ç»œIOé˜»å¡æ‰çš„æ—¶å€™ï¼Œæˆ–è€…åœ¨è¿›ç¨‹æ—¶é—´ç‰‡åˆ°äº†ï¼Œéƒ½ä¼šå¼•å‘ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚</p>
<p><img src="https://images.hxzhouh.com/blog-images/2024/03/1412e8c9d5f8d443e04acce317ec68f3.png" alt="Pasted image 20240319112652"></p>
<h1 id="ä¸€ä¸ªç®€å•çš„è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€æµ‹è¯•å®éªŒ"><a href="#ä¸€ä¸ªç®€å•çš„è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€æµ‹è¯•å®éªŒ" class="headerlink" title="ä¸€ä¸ªç®€å•çš„è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€æµ‹è¯•å®éªŒ"></a>ä¸€ä¸ªç®€å•çš„è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€æµ‹è¯•å®éªŒ</h1><p>åºŸè¯ä¸å¤šè¯´ï¼Œæˆ‘ä»¬å…ˆç”¨ä¸ªå®éªŒæµ‹è¯•ä¸€ä¸‹ï¼Œåˆ°åº•ä¸€æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢éœ€è¦å¤šé•¿çš„CPUæ—¶é—´ï¼å®éªŒæ–¹æ³•æ˜¯åˆ›å»ºä¸¤ä¸ªè¿›ç¨‹å¹¶åœ¨å®ƒä»¬ä¹‹é—´ä¼ é€ä¸€ä¸ªä»¤ç‰Œã€‚å…¶ä¸­ä¸€ä¸ªè¿›ç¨‹åœ¨è¯»å–ä»¤ç‰Œæ—¶å°±ä¼šå¼•èµ·é˜»å¡ã€‚å¦ä¸€ä¸ªè¿›ç¨‹å‘é€ä»¤ç‰Œåç­‰å¾…å…¶è¿”å›æ—¶ä¹Ÿå¤„äºé˜»å¡çŠ¶æ€ã€‚å¦‚æ­¤å¾€è¿”ä¼ é€ä¸€å®šçš„æ¬¡æ•°ï¼Œç„¶åç»Ÿè®¡ä»–ä»¬çš„å¹³å‡å•æ¬¡åˆ‡æ¢æ—¶é—´å¼€é”€ã€‚<br><a href="https://gist.github.com/hxzhouh/7c201a16f6dc37068fa9eefae9334b04">test04</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">gcc main.c -o main</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">./main./main</span></span><br><span class="line">Before Context Switch Time1565352257 s, 774767 us</span><br><span class="line">After Context SWitch Time1565352257 s, 842852 us</span><br></pre></td></tr></table></figure>

<p>æ¯æ¬¡æ‰§è¡Œçš„æ—¶é—´ä¼šæœ‰å·®å¼‚ï¼Œå¤šæ¬¡è¿è¡Œå<strong>å¹³å‡æ¯æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢è€—æ—¶3.5uså·¦å³</strong>ã€‚å½“ç„¶äº†è¿™ä¸ªæ•°å­—å› æœºå™¨è€Œå¼‚ï¼Œè€Œä¸”å»ºè®®åœ¨å®æœºä¸Šæµ‹è¯•ã€‚</p>
<p>å‰é¢æˆ‘ä»¬æµ‹è¯•ç³»ç»Ÿè°ƒç”¨çš„æ—¶å€™ï¼Œæœ€ä½å€¼æ˜¯200nsã€‚å¯è§ï¼Œä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€è¦æ¯”ç³»ç»Ÿè°ƒç”¨çš„å¼€é”€è¦å¤§ã€‚ç³»ç»Ÿè°ƒç”¨åªæ˜¯åœ¨è¿›ç¨‹å†…å°†ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€ï¼Œç„¶åå†åˆ‡å›æ¥ï¼Œè€Œä¸Šä¸‹æ–‡åˆ‡æ¢å¯æ˜¯ç›´æ¥ä»è¿›ç¨‹Aåˆ‡æ¢åˆ°äº†è¿›ç¨‹Bã€‚æ˜¾ç„¶è¿™ä¸ªä¸Šä¸‹æ–‡åˆ‡æ¢éœ€è¦å®Œæˆçš„å·¥ä½œé‡æ›´å¤§ã€‚</p>
<h1 id="è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€éƒ½æœ‰å“ªäº›"><a href="#è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€éƒ½æœ‰å“ªäº›" class="headerlink" title="è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€éƒ½æœ‰å“ªäº›"></a>è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€éƒ½æœ‰å“ªäº›</h1><p>é‚£ä¹ˆä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ—¶å€™ï¼ŒCPUçš„å¼€é”€éƒ½å…·ä½“æœ‰å“ªäº›å‘¢ï¼Ÿå¼€é”€åˆ†æˆä¸¤ç§ï¼Œä¸€ç§æ˜¯ç›´æ¥å¼€é”€ã€ä¸€ç§æ˜¯é—´æ¥å¼€é”€ã€‚</p>
<p>ç›´æ¥å¼€é”€å°±æ˜¯åœ¨åˆ‡æ¢æ—¶ï¼Œcpuå¿…é¡»åšçš„äº‹æƒ…ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>1ã€åˆ‡æ¢é¡µè¡¨å…¨å±€ç›®å½•</li>
<li>2ã€åˆ‡æ¢å†…æ ¸æ€å †æ ˆ</li>
<li>3ã€åˆ‡æ¢ç¡¬ä»¶ä¸Šä¸‹æ–‡ï¼ˆè¿›ç¨‹æ¢å¤å‰ï¼Œå¿…é¡»è£…å…¥å¯„å­˜å™¨çš„æ•°æ®ç»Ÿç§°ä¸ºç¡¬ä»¶ä¸Šä¸‹æ–‡ï¼‰<ul>
<li>ip(instruction pointer)ï¼šæŒ‡å‘å½“å‰æ‰§è¡ŒæŒ‡ä»¤çš„ä¸‹ä¸€æ¡æŒ‡ä»¤</li>
<li>bp(base pointer): ç”¨äºå­˜æ”¾æ‰§è¡Œä¸­çš„å‡½æ•°å¯¹åº”çš„æ ˆå¸§çš„æ ˆåº•åœ°å€</li>
<li>sp(stack poinger): ç”¨äºå­˜æ”¾æ‰§è¡Œä¸­çš„å‡½æ•°å¯¹åº”çš„æ ˆå¸§çš„æ ˆé¡¶åœ°å€</li>
<li>cr3:é¡µç›®å½•åŸºå€å¯„å­˜å™¨ï¼Œä¿å­˜é¡µç›®å½•è¡¨çš„ç‰©ç†åœ°å€</li>
<li>â€¦â€¦</li>
</ul>
</li>
<li>4ã€åˆ·æ–°TLB</li>
<li>5ã€ç³»ç»Ÿè°ƒåº¦å™¨çš„ä»£ç æ‰§è¡Œ</li>
</ul>
<p>é—´æ¥å¼€é”€ä¸»è¦æŒ‡çš„æ˜¯è™½ç„¶åˆ‡æ¢åˆ°ä¸€ä¸ªæ–°è¿›ç¨‹åï¼Œç”±äºå„ç§ç¼“å­˜å¹¶ä¸çƒ­ï¼Œé€Ÿåº¦è¿è¡Œä¼šæ…¢ä¸€äº›ã€‚å¦‚æœè¿›ç¨‹å§‹ç»ˆéƒ½åœ¨ä¸€ä¸ªCPUä¸Šè°ƒåº¦è¿˜å¥½ä¸€äº›ï¼Œå¦‚æœè·¨CPUçš„è¯ï¼Œä¹‹å‰çƒ­èµ·æ¥çš„TLBã€L1ã€L2ã€L3å› ä¸ºè¿è¡Œçš„è¿›ç¨‹å·²ç»å˜äº†ï¼Œæ‰€ä»¥ä»¥å±€éƒ¨æ€§åŸç†cacheèµ·æ¥çš„ä»£ç ã€æ•°æ®ä¹Ÿéƒ½æ²¡æœ‰ç”¨äº†ï¼Œå¯¼è‡´æ–°è¿›ç¨‹ç©¿é€åˆ°å†…å­˜çš„IOä¼šå˜å¤šã€‚ å…¶å®æˆ‘ä»¬ä¸Šé¢çš„å®éªŒå¹¶æ²¡æœ‰å¾ˆå¥½åœ°æµ‹é‡åˆ°è¿™ç§æƒ…å†µï¼Œæ‰€ä»¥å®é™…çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€å¯èƒ½æ¯”3.5usè¦å¤§ã€‚<br>æƒ³äº†è§£æ›´è¯¦ç»†æ“ä½œè¿‡ç¨‹çš„åŒå­¦è¯·å‚è€ƒã€Šæ·±å…¥ç†è§£Linuxå†…æ ¸ã€‹ä¸­çš„ç¬¬ä¸‰ç« å’Œç¬¬ä¹ç« ã€‚</p>
<h2 id="ä¸€ä¸ªæ›´ä¸ºä¸“ä¸šçš„æµ‹è¯•å·¥å…·-lmbench"><a href="#ä¸€ä¸ªæ›´ä¸ºä¸“ä¸šçš„æµ‹è¯•å·¥å…·-lmbench" class="headerlink" title="ä¸€ä¸ªæ›´ä¸ºä¸“ä¸šçš„æµ‹è¯•å·¥å…·-lmbench"></a>ä¸€ä¸ªæ›´ä¸ºä¸“ä¸šçš„æµ‹è¯•å·¥å…·-lmbench</h2><p>lmbenchç”¨äºè¯„ä»·ç³»ç»Ÿç»¼åˆæ€§èƒ½çš„å¤šå¹³å°å¼€æºbenchmarkï¼Œèƒ½å¤Ÿæµ‹è¯•åŒ…æ‹¬æ–‡æ¡£è¯»å†™ã€å†…å­˜æ“ä½œã€è¿›ç¨‹åˆ›å»ºé”€æ¯å¼€é”€ã€ç½‘ç»œç­‰æ€§èƒ½ã€‚ä½¿ç”¨æ–¹æ³•ç®€å•ï¼Œä½†å°±æ˜¯è·‘æœ‰ç‚¹æ…¢ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥è‡ªå·±è¯•ä¸€è¯•ã€‚<br>è¿™ä¸ªå·¥å…·çš„ä¼˜åŠ¿æ˜¯æ˜¯è¿›è¡Œäº†å¤šç»„å®éªŒï¼Œæ¯ç»„2ä¸ªè¿›ç¨‹ã€8ä¸ªã€16ä¸ªã€‚æ¯ä¸ªè¿›ç¨‹ä½¿ç”¨çš„æ•°æ®å¤§å°ä¹Ÿåœ¨å˜ï¼Œå……åˆ†æ¨¡æ‹Ÿcache missé€ æˆçš„å½±å“ã€‚æˆ‘ç”¨ä»–æµ‹äº†ä¸€ä¸‹ç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">-------------------------------------------------------------------------</span><br><span class="line">Host                 OS  2p/0K 2p/16K 2p/64K 8p/16K 8p/64K 16p/16K 16p/64K  </span><br><span class="line">                         ctxsw  ctxsw  ctxsw ctxsw  ctxsw   ctxsw   ctxsw  </span><br><span class="line">--------- ------------- ------ ------ ------ ------ ------ ------- -------  </span><br><span class="line">bjzw_46_7 Linux 2.6.32- 2.7800 2.7800 2.7000 4.3800 4.0400 4.75000 5.48000</span><br></pre></td></tr></table></figure>

<p>lmbenchæ˜¾ç¤ºçš„è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢è€—æ—¶ä»2.7usåˆ°5.48ä¹‹é—´ã€‚</p>
<h1 id="çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢è€—æ—¶"><a href="#çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢è€—æ—¶" class="headerlink" title="çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢è€—æ—¶"></a>çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢è€—æ—¶</h1><p>å‰é¢æˆ‘ä»¬æµ‹è¯•äº†è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€ï¼Œæˆ‘ä»¬å†ç»§ç»­åœ¨Linuxæµ‹è¯•ä¸€ä¸‹çº¿ç¨‹ã€‚çœ‹çœ‹ç©¶ç«Ÿæ¯”è¿›ç¨‹èƒ½ä¸èƒ½å¿«ä¸€äº›ï¼Œå¿«çš„è¯èƒ½å¿«å¤šå°‘ã€‚</p>
<p>åœ¨Linuxä¸‹å…¶å®æœ¬å¹¶æ²¡æœ‰çº¿ç¨‹ï¼Œåªæ˜¯ä¸ºäº†è¿åˆå¼€å‘è€…å£å‘³ï¼Œæäº†ä¸ªè½»é‡çº§è¿›ç¨‹å‡ºæ¥å°±å«åšäº†çº¿ç¨‹ã€‚è½»é‡çº§è¿›ç¨‹å’Œè¿›ç¨‹ä¸€æ ·ï¼Œéƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„task_structè¿›ç¨‹æè¿°ç¬¦ï¼Œä¹Ÿéƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„pidã€‚ä»æ“ä½œç³»ç»Ÿè§†è§’çœ‹ï¼Œè°ƒåº¦ä¸Šå’Œè¿›ç¨‹æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œéƒ½æ˜¯åœ¨ç­‰å¾…é˜Ÿåˆ—çš„åŒå‘é“¾è¡¨é‡Œé€‰æ‹©ä¸€ä¸ªtask_structåˆ‡åˆ°è¿è¡Œæ€è€Œå·²ã€‚åªä¸è¿‡è½»é‡çº§è¿›ç¨‹å’Œæ™®é€šè¿›ç¨‹çš„åŒºåˆ«æ˜¯å¯ä»¥å…±äº«åŒä¸€å†…å­˜åœ°å€ç©ºé—´ã€ä»£ç æ®µã€å…¨å±€å˜é‡ã€åŒä¸€æ‰“å¼€æ–‡ä»¶é›†åˆè€Œå·²ã€‚</p>
<blockquote>
<p>åŒä¸€è¿›ç¨‹ä¸‹çš„çº¿ç¨‹ä¹‹æ‰€æœ‰getpid()çœ‹åˆ°çš„pidæ˜¯ä¸€æ ·çš„ï¼Œå…¶å®task_structé‡Œè¿˜æœ‰ä¸€ä¸ªtgidå­—æ®µã€‚ å¯¹äºå¤šçº¿ç¨‹ç¨‹åºæ¥è¯´ï¼Œgetpid()ç³»ç»Ÿè°ƒç”¨è·å–çš„å®é™…ä¸Šæ˜¯è¿™ä¸ªtgidï¼Œå› æ­¤éš¶å±åŒä¸€è¿›ç¨‹çš„å¤šçº¿ç¨‹çœ‹èµ·æ¥PIDç›¸åŒã€‚</p>
</blockquote>
<p>æˆ‘ä»¬ç”¨ä¸€ä¸ªå®éªŒæ¥æµ‹è¯•ä¸€ä¸‹<a href="https://www.jianshu.com/p/0d90b92000c0">test06</a>ã€‚å…¶åŸç†å’Œè¿›ç¨‹æµ‹è¯•å·®ä¸å¤šï¼Œåˆ›å»ºäº†20ä¸ªçº¿ç¨‹ï¼Œåœ¨çº¿ç¨‹ä¹‹é—´é€šè¿‡ç®¡é“æ¥ä¼ é€’ä¿¡å·ã€‚æ¥åˆ°ä¿¡å·å°±å”¤é†’ï¼Œç„¶åå†ä¼ é€’ä¿¡å·ç»™ä¸‹ä¸€ä¸ªçº¿ç¨‹ï¼Œè‡ªå·±ç¡çœ ã€‚ è¿™ä¸ªå®éªŒé‡Œå•ç‹¬è€ƒè™‘äº†ç»™ç®¡é“ä¼ é€’ä¿¡å·çš„é¢å¤–å¼€é”€ï¼Œå¹¶åœ¨ç¬¬ä¸€æ­¥å°±ç»Ÿè®¡äº†å‡ºæ¥ã€‚</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"># gcc -lpthread <span class="selector-tag">main</span><span class="selector-class">.c</span> -o <span class="selector-tag">main</span></span><br><span class="line"><span class="number">0.508250</span>  </span><br><span class="line"><span class="number">4.363495</span></span><br></pre></td></tr></table></figure>

<p>æ¯æ¬¡å®éªŒç»“æœä¼šæœ‰ä¸€äº›å·®å¼‚ï¼Œä¸Šé¢çš„ç»“æœæ˜¯å–äº†å¤šæ¬¡çš„ç»“æœä¹‹åç„¶åå¹³å‡çš„ï¼Œå¤§çº¦æ¯æ¬¡çº¿ç¨‹åˆ‡æ¢å¼€é”€å¤§çº¦æ˜¯3.8uså·¦å³ã€‚<strong>ä»ä¸Šä¸‹æ–‡åˆ‡æ¢çš„è€—æ—¶ä¸Šæ¥çœ‹ï¼ŒLinuxçº¿ç¨‹ï¼ˆè½»é‡çº§è¿›ç¨‹ï¼‰å…¶å®å’Œè¿›ç¨‹å·®åˆ«ä¸å¤ªå¤§</strong>ã€‚</p>
<h2 id="Linuxç›¸å…³å‘½ä»¤"><a href="#Linuxç›¸å…³å‘½ä»¤" class="headerlink" title="Linuxç›¸å…³å‘½ä»¤"></a>Linuxç›¸å…³å‘½ä»¤</h2><p>æ—¢ç„¶æˆ‘ä»¬çŸ¥é“äº†ä¸Šä¸‹æ–‡åˆ‡æ¢æ¯”è¾ƒçš„æ¶ˆè€—CPUæ—¶é—´ï¼Œé‚£ä¹ˆæˆ‘ä»¬é€šè¿‡ä»€ä¹ˆå·¥å…·å¯ä»¥æŸ¥çœ‹ä¸€ä¸‹Linuxé‡Œç©¶ç«Ÿåœ¨å‘ç”Ÿå¤šå°‘åˆ‡æ¢å‘¢ï¼Ÿå¦‚æœä¸Šä¸‹æ–‡åˆ‡æ¢å·²ç»å½±å“åˆ°äº†ç³»ç»Ÿæ•´ä½“æ€§èƒ½ï¼Œæˆ‘ä»¬æœ‰æ²¡æœ‰åŠæ³•æŠŠæœ‰é—®é¢˜çš„è¿›ç¨‹æªå‡ºæ¥ï¼Œå¹¶æŠŠå®ƒä¼˜åŒ–æ‰å‘¢ï¼Ÿ</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line"># vmstat 1  </span><br><span class="line">procs -----------memory---------- ---swap-- -----io---- --system-- -----cpu-----  </span><br><span class="line"> r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st  </span><br><span class="line"> 2  0      0 595504   5724 190884    0    0   295   297    0    0 14  6 75  0  4  </span><br><span class="line"> 5  0      0 593016   5732 193288    0    0     0    92 19889 29104 20  6 67  0  7  </span><br><span class="line"> 3  0      0 591292   5732 195476    0    0     0     0 20151 28487 20  6 66  0  8  </span><br><span class="line"> 4  0      0 589296   5732 196800    0    0   116   384 19326 27693 20  7 67  0  7  </span><br><span class="line"> 4  0      0 586956   5740 199496    0    0   216    24 18321 24018 22  8 62  0  8</span><br></pre></td></tr></table></figure>
<p>æˆ–è€…æ˜¯</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sar -w 1  </span></span><br><span class="line">proc/s  </span><br><span class="line">     Total number of tasks created per second.  </span><br><span class="line">cswch/s  </span><br><span class="line">     Total number of context switches per second.  </span><br><span class="line">11:19:20 AM    proc/s   cswch/s  </span><br><span class="line">11:19:21 AM    110.28  23468.22  </span><br><span class="line">11:19:22 AM    128.85  33910.58  </span><br><span class="line">11:19:23 AM     47.52  40733.66  </span><br><span class="line">11:19:24 AM     35.85  30972.64  </span><br><span class="line">11:19:25 AM     47.62  24951.43  </span><br><span class="line">11:19:26 AM     47.52  42950.50  </span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<p>ä¸Šå›¾çš„ç¯å¢ƒæ˜¯ä¸€å°ç”Ÿäº§ç¯å¢ƒæœºå™¨ï¼Œé…ç½®æ˜¯8æ ¸8Gçš„KVMè™šæœºï¼Œç¯å¢ƒæ˜¯åœ¨nginx+fpmçš„ï¼Œfpmæ•°é‡ä¸º1000ï¼Œå¹³å‡æ¯ç§’å¤„ç†çš„ç”¨æˆ·æ¥å£è¯·æ±‚å¤§çº¦100å·¦å³ã€‚å…¶ä¸­<strong>csåˆ—</strong>è¡¨ç¤ºçš„å°±æ˜¯åœ¨1så†…ç³»ç»Ÿå‘ç”Ÿçš„ä¸Šä¸‹æ–‡åˆ‡æ¢æ¬¡æ•°ï¼Œå¤§çº¦1såˆ‡æ¢æ¬¡æ•°éƒ½è¾¾åˆ°4Wæ¬¡äº†ã€‚ç²—ç•¥ä¼°ç®—ä¸€ä¸‹ï¼Œæ¯æ ¸å¤§çº¦æ¯ç§’éœ€è¦åˆ‡æ¢5Kæ¬¡ï¼Œåˆ™1så†…éœ€è¦èŠ±å°†è¿‘20msåœ¨ä¸Šä¸‹æ–‡åˆ‡æ¢ä¸Šã€‚è¦çŸ¥é“è¿™æ˜¯è™šæœºï¼Œæœ¬èº«åœ¨è™šæ‹ŸåŒ–ä¸Šè¿˜ä¼šæœ‰ä¸€äº›é¢å¤–å¼€é”€ï¼Œè€Œä¸”è¿˜è¦çœŸæ­£æ¶ˆè€—CPUåœ¨ç”¨æˆ·æ¥å£é€»è¾‘å¤„ç†ã€ç³»ç»Ÿè°ƒç”¨å†…æ ¸é€»è¾‘å¤„ç†ã€ä»¥åŠç½‘ç»œè¿æ¥çš„å¤„ç†ä»¥åŠè½¯ä¸­æ–­ï¼Œæ‰€ä»¥20msçš„å¼€é”€å®é™…ä¸Šä¸ä½äº†ã€‚<br>é‚£ä¹ˆè¿›ä¸€æ­¥ï¼Œæˆ‘ä»¬çœ‹ä¸‹åˆ°åº•æ˜¯å“ªäº›è¿›ç¨‹å¯¼è‡´äº†é¢‘ç¹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Ÿ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># pidstat -w 1  </span></span><br><span class="line">11:07:56 AM       PID   cswch/s nvcswch/s  Command</span><br><span class="line">11:07:56 AM     32316      4.00      0.00  php-fpm  </span><br><span class="line">11:07:56 AM     32508    160.00     34.00  php-fpm  </span><br><span class="line">11:07:56 AM     32726    131.00      8.00  php-fpm  </span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<p>ç”±äºfpmæ˜¯åŒæ­¥é˜»å¡çš„æ¨¡å¼ï¼Œæ¯å½“è¯·æ±‚Redisã€Memcacheã€Mysqlçš„æ—¶å€™å°±ä¼šé˜»å¡å¯¼è‡´cswch&#x2F;sè‡ªæ„¿ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œè€Œåªæœ‰æ—¶é—´ç‰‡åˆ°äº†ä¹‹åæ‰ä¼šè§¦å‘nvcswch&#x2F;séè‡ªæ„¿åˆ‡æ¢ã€‚å¯è§fpmè¿›ç¨‹å¤§éƒ¨åˆ†çš„åˆ‡æ¢éƒ½æ˜¯è‡ªæ„¿çš„ã€éè‡ªæ„¿çš„æ¯”è¾ƒå°‘ã€‚</p>
<p>å¦‚æœæƒ³æŸ¥çœ‹å…·ä½“æŸä¸ªè¿›ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢æ€»æƒ…å†µï¼Œå¯ä»¥åœ¨&#x2F;procæ¥å£ä¸‹ç›´æ¥çœ‹ï¼Œä¸è¿‡è¿™ä¸ªæ˜¯æ€»å€¼ã€‚</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">grep ctxt /proc/32583/status  </span><br><span class="line">voluntary_ctxt_switches:        573066  </span><br><span class="line">nonvoluntary_ctxt_switches:     89260</span><br></pre></td></tr></table></figure>
<h1 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h1><ul>
<li>ä¸Šä¸‹æ–‡åˆ‡æ¢å…·ä½“åšå“ªäº›äº‹æƒ…æˆ‘ä»¬æ²¡æœ‰å¿…è¦è®°ï¼Œåªéœ€è¦è®°ä½ä¸€ä¸ªç»“è®ºæ—¢å¯ï¼Œåœ¨æˆ‘çš„å·¥ä½œæœº<strong>ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€å¤§çº¦æ˜¯2.7-5.48uså·¦å³</strong>ï¼Œä½ è‡ªå·±çš„æœºå™¨å¯ä»¥ç”¨æˆ‘æä¾›çš„ä»£ç æˆ–å·¥å…·è¿›è¡Œä¸€ç•ªæµ‹è¯•ã€‚</li>
<li>å¯ä»¥ä½¿ç”¨ <code>vmstat</code> <code>sar</code> ç­‰å·¥å…·æŸ¥çœ‹è¿›ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œè¿›è€Œå®šä½æ€§èƒ½é—®é¢˜ã€‚</li>
<li>lmbenchç›¸å¯¹æ›´å‡†ç¡®ä¸€äº›ï¼Œå› ä¸ºè€ƒè™‘äº†åˆ‡æ¢åCache misså¯¼è‡´çš„é¢å¤–å¼€é”€ã€‚</li>
</ul>
]]></content>
      <tags>
        <tag>linux</tag>
        <tag>ç³»ç»Ÿç¼–ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title>ARTS 0907-0913</title>
    <url>/2022/09/30/arts/ARTS%200907-0913/</url>
    <content><![CDATA[<p>ARTS æ˜¯é™ˆæµ©ï¼ˆç½‘åå·¦è€³æœµè€—å­ï¼‰åœ¨æå®¢æ—¶é—´ä¸“æ é‡Œå‘èµ·çš„ä¸€ä¸ªæ´»åŠ¨ï¼Œç›®çš„æ˜¯é€šè¿‡åˆ†äº«çš„æ–¹å¼æ¥åšæŒå­¦ä¹ ã€‚</p>
<blockquote>
<p>æ¯äººæ¯å‘¨å†™ä¸€ä¸ª ARTSï¼š</p>
<p>Algorithm æ˜¯ä¸€é“ç®—æ³•é¢˜ï¼Œ</p>
<p>Review æ˜¯è¯»ä¸€ç¯‡è‹±æ–‡æ–‡ç« ï¼Œ</p>
<p>Technique&#x2F;Tips æ˜¯åˆ†äº«ä¸€ä¸ªå°æŠ€æœ¯ï¼Œ</p>
<p>Share æ˜¯åˆ†äº«ä¸€ä¸ªè§‚ç‚¹ã€‚</p>
</blockquote>
<h1 id="Algorithm"><a href="#Algorithm" class="headerlink" title="Algorithm:"></a>Algorithm:</h1><ul>
<li>leetcode <a href="https://leetcode-cn.com/problems/reverse-linked-list/">206 </a></li>
<li>leetcode <a href="https://leetcode-cn.com/problems/linked-list-cycle/solution/">141</a></li>
<li>leetcode 19</li>
</ul>
<h1 id="Review"><a href="#Review" class="headerlink" title="Review"></a>Review</h1><p><a href="https://tech.meituan.com/2020/08/13/openstack-to-kubernetes-in-meituan.html">Kuberneteså¦‚ä½•æ”¹å˜ç¾å›¢çš„äº‘åŸºç¡€è®¾æ–½ï¼Ÿ</a></p>
]]></content>
      <categories>
        <category>arts</category>
      </categories>
      <tags>
        <tag>arts</tag>
      </tags>
  </entry>
  <entry>
    <title>ARTS-2023-38</title>
    <url>/2023/09/22/arts/ARTS-2023-38/</url>
    <content><![CDATA[<h1 id="ARTS-2023-38"><a href="#ARTS-2023-38" class="headerlink" title="ARTS-2023-38"></a>ARTS-2023-38</h1><blockquote>
<p>ARTS æ˜¯é™ˆæµ©ï¼ˆç½‘åå·¦è€³æœµè€—å­ï¼‰åœ¨æå®¢æ—¶é—´ä¸“æ é‡Œå‘èµ·çš„ä¸€ä¸ªæ´»åŠ¨ï¼Œç›®çš„æ˜¯é€šè¿‡åˆ†äº«çš„æ–¹å¼æ¥åšæŒå­¦ä¹ ã€‚ æ¯äººæ¯å‘¨å†™ä¸€ä¸ª ARTSï¼š Algorithm æ˜¯ä¸€é“ç®—æ³•é¢˜ï¼Œ Review æ˜¯è¯»ä¸€ç¯‡è‹±æ–‡æ–‡ç« ï¼Œ Technique&#x2F;Tips æ˜¯åˆ†äº«ä¸€ä¸ªå°æŠ€æœ¯ï¼Œ Share æ˜¯åˆ†äº«ä¸€ä¸ªè§‚ç‚¹ã€‚</p>
</blockquote>
<span id="more"></span>
<h2 id="ç®—æ³•"><a href="#ç®—æ³•" class="headerlink" title="ç®—æ³•"></a>ç®—æ³•</h2><hr>
<p>#ç®—æ³• #leetcode</p>
<p><a href="https://leetcode.cn/problems/best-time-to-buy-and-sell-stock-ii/description/?envType=study-plan-v2&envId=top-interview-150">leetCode 122  </a><br>ç”¨[[åŠ¨æ€è§„åˆ’]]  æ¥åšè¿™ä¸ªé¢˜ç›®</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">maxProfit</span><span class="params">(prices []<span class="type">int</span>)</span></span> (ans <span class="type">int</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">1</span>; i &lt; <span class="built_in">len</span>(prices); i++ &#123;</span><br><span class="line">        ans += max(<span class="number">0</span>, prices[i]-prices[i<span class="number">-1</span>])</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">max</span><span class="params">(a, b <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> a &gt; b &#123;</span><br><span class="line">        <span class="keyword">return</span> a</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> b</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>[[55. è·³è·ƒæ¸¸æˆ]]</p>
<h2 id="Review"><a href="#Review" class="headerlink" title="Review"></a>Review</h2><hr>
<p>#å¥½æ–‡ #é˜…è¯»</p>
<p><a href="https://go.googlesource.com/proposal/+/master/design/11502-securitypolicy.md">https://go.googlesource.com/proposal/+/master/design/11502-securitypolicy.md</a></p>
<p>æœ€è¿‘å¼€å§‹çœ‹ go çš„ä¸€äº›è®¾è®¡æ–‡æ¡£ï¼Œ è€ƒå¤çš„ï¼Œ æ–°çš„éƒ½çœ‹ï¼Œçœ‹ç€ç°åœ¨ä¸€äº›ç†Ÿæ‚‰çš„ä¸œè¥¿ä»¥å‰æ˜¯æ€ä¹ˆè¢«è®¾è®¡å‡ºæ¥çš„ï¼Œ å¾ˆæœ‰æ„æ€</p>
<h2 id="Technique-Tips"><a href="#Technique-Tips" class="headerlink" title="Technique&#x2F;Tips"></a>Technique&#x2F;Tips</h2><hr>
<p>#å·¥å…·  </p>
<p>[[omnivore]] ä¸€ä¸ªå¼€æºçš„ç¨åé˜…è¯»è½¯ä»¶ï¼Œæœ‰ç‚¹ç±»ä¼¼readwise çš„readerï¼Œç›®å‰å±äºèµ·æ­¥é˜¶æ®µæŠŠï¼Œæœ‰æ´»è·ƒçš„å¼€å‘åœˆå­ï¼Œä¼šä¸€ç›´å…³æ³¨è¿™ä¸ªè½¯ä»¶ã€‚</p>
<ul>
<li><a href="https://linux.cn/article-16102-1.html">https://linux.cn/article-16102-1.html</a></li>
<li><a href="https://blog.omnivore.app/p/getting-started-with-omnivore">https://blog.omnivore.app/p/getting-started-with-omnivore</a></li>
</ul>
<p>ä¸€é”®å±è”½Twitterä¸Šçš„ é»„æ¨ï¼Œå—å¤Ÿäº†ã€‚ã€‚<br><a href="https://github.com/daymade/Twitter-Block-Porn">https://github.com/daymade/Twitter-Block-Porn</a></p>
<h2 id="Share"><a href="#Share" class="headerlink" title="Share"></a>Share</h2><hr>
<p>#ç¢ç¢å¿µ #è§‚ç‚¹</p>
]]></content>
      <categories>
        <category>arts</category>
      </categories>
      <tags>
        <tag>ç®—æ³•</tag>
        <tag>arts</tag>
        <tag>leetcode</tag>
        <tag>å¥½æ–‡</tag>
        <tag>é˜…è¯»</tag>
        <tag>å·¥å…·</tag>
        <tag>ç¢ç¢å¿µ</tag>
        <tag>è§‚ç‚¹</tag>
      </tags>
  </entry>
  <entry>
    <title>ARTS-2023-39</title>
    <url>/2023/09/27/arts/ARTS-2023-39/</url>
    <content><![CDATA[<blockquote>
<p>ARTS æ˜¯é™ˆæµ©ï¼ˆç½‘åå·¦è€³æœµè€—å­ï¼‰åœ¨æå®¢æ—¶é—´ä¸“æ é‡Œå‘èµ·çš„ä¸€ä¸ªæ´»åŠ¨ï¼Œç›®çš„æ˜¯é€šè¿‡åˆ†äº«çš„æ–¹å¼æ¥åšæŒå­¦ä¹ ã€‚ æ¯äººæ¯å‘¨å†™ä¸€ä¸ª ARTSï¼š Algorithm æ˜¯ä¸€é“ç®—æ³•é¢˜ï¼Œ Review æ˜¯è¯»ä¸€ç¯‡è‹±æ–‡æ–‡ç« ï¼Œ Technique&#x2F;Tips æ˜¯åˆ†äº«ä¸€ä¸ªå°æŠ€æœ¯ï¼Œ Share æ˜¯åˆ†äº«ä¸€ä¸ªè§‚ç‚¹ã€‚</p>
</blockquote>
<span id="more"></span>

<h2 id="ç®—æ³•"><a href="#ç®—æ³•" class="headerlink" title="ç®—æ³•"></a>ç®—æ³•</h2><hr>
<h2 id="ç®—æ³•-leetcodeæœ¬å‘¨æ”¾å‡å‰ä¸€å‘¨ï¼Œæ¯”è¾ƒé¢“åºŸï¼Œå¾ˆå¤šéƒ½æ²¡å®Œæˆã€‚-Review"><a href="#ç®—æ³•-leetcodeæœ¬å‘¨æ”¾å‡å‰ä¸€å‘¨ï¼Œæ¯”è¾ƒé¢“åºŸï¼Œå¾ˆå¤šéƒ½æ²¡å®Œæˆã€‚-Review" class="headerlink" title="#ç®—æ³• #leetcodeæœ¬å‘¨æ”¾å‡å‰ä¸€å‘¨ï¼Œæ¯”è¾ƒé¢“åºŸï¼Œå¾ˆå¤šéƒ½æ²¡å®Œæˆã€‚## Review"></a>#ç®—æ³• #leetcode<br>æœ¬å‘¨æ”¾å‡å‰ä¸€å‘¨ï¼Œæ¯”è¾ƒé¢“åºŸï¼Œå¾ˆå¤šéƒ½æ²¡å®Œæˆã€‚<br>## Review</h2><p>#å¥½æ–‡ #é˜…è¯»</p>
<h2 id="Technique-Tips"><a href="#Technique-Tips" class="headerlink" title="Technique&#x2F;Tips"></a>Technique&#x2F;Tips</h2><hr>
<p>#å·¥å…·  </p>
<ol>
<li>åœ¨æœ¬åœ°ç”Ÿæˆæµ‹è¯•è¯ä¹¦ã€‚ <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é¦–å…ˆï¼Œç”Ÿæˆä¸€ä¸ªRSAç§é’¥æ–‡ä»¶ï¼ˆ`server.key`ï¼‰ï¼š</span></span><br><span class="line">openssl genpkey -algorithm RSA -out server.key</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">æ¥ä¸‹æ¥ï¼Œç”Ÿæˆä¸€ä¸ªè‡ªç­¾åè¯ä¹¦è¯·æ±‚ï¼ˆCSRï¼‰ï¼š</span></span><br><span class="line">openssl req -new -key server.key -out server.csr</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åœ¨æ‰§è¡Œæ­¤å‘½ä»¤æ—¶ï¼Œæ‚¨å°†è¢«è¦æ±‚æä¾›ä¸€äº›è¯ä¹¦ä¿¡æ¯ï¼Œä¾‹å¦‚å›½å®¶ã€å·ã€åŸå¸‚ã€å…¬å¸ç­‰ã€‚æ‚¨å¯ä»¥æ ¹æ®éœ€è¦æä¾›è¿™äº›ä¿¡æ¯ï¼Œæˆ–è€…æŒ‰ç…§é»˜è®¤å€¼ç•™ç©ºã€‚</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">ç°åœ¨ï¼Œä½¿ç”¨ç”Ÿæˆçš„ç§é’¥å’Œè¯ä¹¦è¯·æ±‚æ¥ç”Ÿæˆè‡ªç­¾åè¯ä¹¦ï¼š</span></span><br><span class="line">openssl x509 -req -days 365 -in server.csr -signkey server.key -out server.crt</span><br></pre></td></tr></table></figure>
å¦‚æœè¿™ä¸ªè¯ä¹¦å†æµè§ˆå™¨é‡Œé¢æ˜¾ç¤ºä¸å®‰å…¨ï¼Œå¯ä»¥å°è¯•ä¿¡ä»»æœ¬åœ°è¯ä¹¦</li>
</ol>
<blockquote>
<ol>
<li>æ‰“å¼€Chromeæµè§ˆå™¨ã€‚  </li>
<li>åœ¨åœ°å€æ ä¸­è¾“å…¥ <code>chrome://flags/#allow-insecure-localhost/</code> å¹¶æŒ‰ Enter é”®ã€‚  </li>
<li>æ‰¾åˆ°å¹¶å¯ç”¨ â€œAllow invalid certificates for resources loaded from localhostâ€ é€‰é¡¹ã€‚ </li>
<li>é‡æ–°å¯åŠ¨Chromeæµè§ˆå™¨ã€‚<br><img src="https://images.hxzhouh.com/blog-images/2023/09/c72bb8fc1990bb18c394ae237d8b4ad9.png" alt="image.png"></li>
</ol>
</blockquote>
<h2 id="Share"><a href="#Share" class="headerlink" title="Share"></a>Share</h2><hr>
<p>#ç¢ç¢å¿µ #è§‚ç‚¹</p>
]]></content>
      <categories>
        <category>arts</category>
      </categories>
      <tags>
        <tag>ç®—æ³•</tag>
        <tag>leetcode</tag>
        <tag>å¥½æ–‡</tag>
        <tag>é˜…è¯»</tag>
        <tag>å·¥å…·</tag>
        <tag>ç¢ç¢å¿µ</tag>
        <tag>è§‚ç‚¹</tag>
      </tags>
  </entry>
  <entry>
    <title>ARTS 0914-0920</title>
    <url>/2023/09/21/arts/ARTS%200914-0920/</url>
    <content><![CDATA[<p>RTS æ˜¯é™ˆæµ©ï¼ˆç½‘åå·¦è€³æœµè€—å­ï¼‰åœ¨æå®¢æ—¶é—´ä¸“æ é‡Œå‘èµ·çš„ä¸€ä¸ªæ´»åŠ¨ï¼Œç›®çš„æ˜¯é€šè¿‡åˆ†äº«çš„æ–¹å¼æ¥åšæŒå­¦ä¹ ã€‚</p>
<blockquote>
<p>æ¯äººæ¯å‘¨å†™ä¸€ä¸ª ARTSï¼š</p>
<p>Algorithm æ˜¯ä¸€é“ç®—æ³•é¢˜ï¼Œ</p>
<p>Review æ˜¯è¯»ä¸€ç¯‡è‹±æ–‡æ–‡ç« ï¼Œ</p>
<p>Technique&#x2F;Tips æ˜¯åˆ†äº«ä¸€ä¸ªå°æŠ€æœ¯ï¼Œ</p>
<p>Share æ˜¯åˆ†äº«ä¸€ä¸ªè§‚ç‚¹ã€‚</p>
</blockquote>
<h1 id="Algorithm"><a href="#Algorithm" class="headerlink" title="Algorithm:"></a>Algorithm:</h1><p>leetCode: </p>
<p>82</p>
<p>83</p>
<h1 id="Review"><a href="#Review" class="headerlink" title="Review"></a>Review</h1><ul>
<li><a href="https://blog.pixielabs.ai/blog/ebpf-function-tracing/post/">https://blog.pixielabs.ai/blog/ebpf-function-tracing/post/</a></li>
<li></li>
</ul>
]]></content>
      <categories>
        <category>arts</category>
      </categories>
      <tags>
        <tag>arts</tag>
      </tags>
  </entry>
  <entry>
    <title>ARTS-2023-40</title>
    <url>/2023/10/02/arts/ARTS-2023-40/</url>
    <content><![CDATA[<blockquote>
<p>ARTS æ˜¯é™ˆæµ©ï¼ˆç½‘åå·¦è€³æœµè€—å­ï¼‰åœ¨æå®¢æ—¶é—´ä¸“æ é‡Œå‘èµ·çš„ä¸€ä¸ªæ´»åŠ¨ï¼Œç›®çš„æ˜¯é€šè¿‡åˆ†äº«çš„æ–¹å¼æ¥åšæŒå­¦ä¹ ã€‚ æ¯äººæ¯å‘¨å†™ä¸€ä¸ª ARTSï¼š Algorithm æ˜¯ä¸€é“ç®—æ³•é¢˜ï¼Œ Review æ˜¯è¯»ä¸€ç¯‡è‹±æ–‡æ–‡ç« ï¼Œ Technique&#x2F;Tips æ˜¯åˆ†äº«ä¸€ä¸ªå°æŠ€æœ¯ï¼Œ Share æ˜¯åˆ†äº«ä¸€ä¸ªè§‚ç‚¹ã€‚</p>
</blockquote>
<span id="more"></span>

<h2 id="ç®—æ³•"><a href="#ç®—æ³•" class="headerlink" title="ç®—æ³•"></a>ç®—æ³•</h2><p>#ç®—æ³• #leetcode</p>
<ol>
<li><a href="https://leetcode.cn/problems/excel-sheet-column-title/">168.Â Excelè¡¨åˆ—åç§°</a><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">convertToTitle</span><span class="params">(columnNumber <span class="type">int</span>)</span></span> <span class="type">string</span> &#123;</span><br><span class="line"><span class="keyword">var</span> res <span class="type">string</span></span><br><span class="line"><span class="keyword">for</span> columnNumber &gt; <span class="number">0</span> &#123;</span><br><span class="line">	columnNumber-- <span class="comment">// 0-25</span></span><br><span class="line">	res = <span class="type">string</span>(<span class="type">rune</span>(columnNumber%<span class="number">26</span>+<span class="string">&#x27;A&#x27;</span>)) + res</span><br><span class="line">	columnNumber /= <span class="number">26</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
å°±æ˜¯æŠŠ int è½¬26è¿›åˆ¶ï¼Œè¾—è½¬ç›¸é™¤æ³•ï¼Ÿ å¥½åƒæ˜¯è¿™ä¸ªåå­—æŠŠï¼Ÿ</li>
</ol>
<h2 id="Review"><a href="#Review" class="headerlink" title="Review"></a>Review</h2><h2 id="å¥½æ–‡-é˜…è¯»1-https-buildkite-com-blog-goodbye-integers-hello-uuidsä½¿ç”¨uuid-ä½œä¸ºæ•°æ®åº“çš„ä¸»é”®Idï¼Œå…¼é¡¾æ€§èƒ½ä»¥åŠå¯ç”¨æ€§ï¼Œmongodb-çš„-uuid-å‰å…«ä½æ˜¯æ—¶é—´æˆ³ï¼Œå¯ä»¥ç”¨æ¥è¿›è¡ŒèŒƒå›´æŸ¥è¯¢ã€‚-Technique-Tips"><a href="#å¥½æ–‡-é˜…è¯»1-https-buildkite-com-blog-goodbye-integers-hello-uuidsä½¿ç”¨uuid-ä½œä¸ºæ•°æ®åº“çš„ä¸»é”®Idï¼Œå…¼é¡¾æ€§èƒ½ä»¥åŠå¯ç”¨æ€§ï¼Œmongodb-çš„-uuid-å‰å…«ä½æ˜¯æ—¶é—´æˆ³ï¼Œå¯ä»¥ç”¨æ¥è¿›è¡ŒèŒƒå›´æŸ¥è¯¢ã€‚-Technique-Tips" class="headerlink" title="#å¥½æ–‡ #é˜…è¯»1. https://buildkite.com/blog/goodbye-integers-hello-uuidsä½¿ç”¨uuid ä½œä¸ºæ•°æ®åº“çš„ä¸»é”®Idï¼Œå…¼é¡¾æ€§èƒ½ä»¥åŠå¯ç”¨æ€§ï¼Œmongodb çš„ uuid å‰å…«ä½æ˜¯æ—¶é—´æˆ³ï¼Œå¯ä»¥ç”¨æ¥è¿›è¡ŒèŒƒå›´æŸ¥è¯¢ã€‚## Technique&#x2F;Tips"></a>#å¥½æ–‡ #é˜…è¯»<br>1. <a href="https://buildkite.com/blog/goodbye-integers-hello-uuids">https://buildkite.com/blog/goodbye-integers-hello-uuids</a><br>ä½¿ç”¨uuid ä½œä¸ºæ•°æ®åº“çš„ä¸»é”®Idï¼Œå…¼é¡¾æ€§èƒ½ä»¥åŠå¯ç”¨æ€§ï¼Œ<br>mongodb çš„ uuid å‰å…«ä½æ˜¯æ—¶é—´æˆ³ï¼Œå¯ä»¥ç”¨æ¥è¿›è¡ŒèŒƒå›´æŸ¥è¯¢ã€‚<br>## Technique&#x2F;Tips</h2><p>#å·¥å…·  </p>
<ol>
<li>#æµè§ˆå™¨æ’ä»¶ <a href="https://www.trancy.org/zh-cn">trancy</a> ä¸€ä¸ªæ²‰æµ¸å¼çš„ç¿»è¯‘æ’ä»¶ï¼Œé›†æˆäº†aiåŠŸèƒ½ï¼Œç›®å‰è¿™ç§æ’ä»¶è¶Šæ¥è¶Šå¤šäº†ã€‚</li>
</ol>
<h2 id="Share"><a href="#Share" class="headerlink" title="Share"></a>Share</h2><p>#ç¢ç¢å¿µ #è§‚ç‚¹</p>
<ol>
<li>æˆ‘è¦åšæŒå†™é•¿æ–‡åšå®¢ã€‚ã€‚</li>
<li>çœ‹åˆ°å¥½çœ‹çš„åšå®¢ï¼Œè¿˜æ˜¯è¦æ”¶è—èµ·æ¥ï¼Œæˆ‘çš„è®°å¿†åŠ›åº”è¯¥åªæœ‰ä¸ƒç§’ã€‚</li>
</ol>
]]></content>
      <categories>
        <category>arts</category>
      </categories>
      <tags>
        <tag>ç®—æ³•</tag>
        <tag>leetcode</tag>
        <tag>å¥½æ–‡</tag>
        <tag>é˜…è¯»</tag>
        <tag>å·¥å…·</tag>
        <tag>ç¢ç¢å¿µ</tag>
        <tag>è§‚ç‚¹</tag>
      </tags>
  </entry>
  <entry>
    <title>ARTS-2023-41</title>
    <url>/2023/10/09/arts/ARTS-2023-41/</url>
    <content><![CDATA[<blockquote>
<p>ARTS æ˜¯é™ˆæµ©ï¼ˆç½‘åå·¦è€³æœµè€—å­ï¼‰åœ¨æå®¢æ—¶é—´ä¸“æ é‡Œå‘èµ·çš„ä¸€ä¸ªæ´»åŠ¨ï¼Œç›®çš„æ˜¯é€šè¿‡åˆ†äº«çš„æ–¹å¼æ¥åšæŒå­¦ä¹ ã€‚ æ¯äººæ¯å‘¨å†™ä¸€ä¸ª ARTSï¼š Algorithm æ˜¯ä¸€é“ç®—æ³•é¢˜ï¼Œ Review æ˜¯è¯»ä¸€ç¯‡è‹±æ–‡æ–‡ç« ï¼Œ Technique&#x2F;Tips æ˜¯åˆ†äº«ä¸€ä¸ªå°æŠ€æœ¯ï¼Œ Share æ˜¯åˆ†äº«ä¸€ä¸ªè§‚ç‚¹ã€‚</p>
</blockquote>
<span id="more"></span>

<h2 id="ç®—æ³•"><a href="#ç®—æ³•" class="headerlink" title="ç®—æ³•"></a>ç®—æ³•</h2><p>#ç®—æ³• #leetcode<br>leetcod 344 ç¿»è½¬å­—ç¬¦ä¸² æ°´äº†ä¸€é“é¢˜</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">reverseString</span><span class="params">(s []<span class="type">byte</span>)</span></span> &#123;  </span><br><span class="line">    <span class="keyword">for</span> i, j := <span class="number">0</span>, <span class="built_in">len</span>(s)<span class="number">-1</span>; i &lt; j; i, j = i+<span class="number">1</span>, j<span class="number">-1</span> &#123;  </span><br><span class="line">       s[i], s[j] = s[j], s[i]  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">reverseString1</span><span class="params">(s []<span class="type">byte</span>)</span></span> &#123;  </span><br><span class="line">    l := <span class="number">0</span>  </span><br><span class="line">    r := <span class="built_in">len</span>(s) - <span class="number">1</span>  </span><br><span class="line">    <span class="keyword">for</span> l &lt; r &#123;  </span><br><span class="line">       s[l] ^= s[r]  </span><br><span class="line">       s[r] ^= s[l]  </span><br><span class="line">       s[l] ^= s[r]  </span><br><span class="line">       r--  </span><br><span class="line">       l++  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Review"><a href="#Review" class="headerlink" title="Review"></a>Review</h2><p>#å¥½æ–‡ #é˜…è¯»<br><a href="https://xargin.com/misc/">https://xargin.com/misc/</a>  æ›¹å¤§çš„æ–‡ç« ï¼Œ</p>
<h2 id="Technique-Tips"><a href="#Technique-Tips" class="headerlink" title="Technique&#x2F;Tips"></a>Technique&#x2F;Tips</h2><p>#å·¥å…·  </p>
<p>åˆ†äº«ä¸€ä¸ªå‘½ä»¤ã€‚ç”¨æ¥æŸ¥æ—¥å¿—ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cat log.2023-10-13-15 |grep ERROR |grep &quot;.onEventWithoutMerge:93&quot; |awk -F&#x27;reqid&#x27; &#x27;&#123;print $2&#125;&#x27; |awk &#x27;&#123;print $1&#125;&#x27; |xargs -P 4 -I &#123;&#125; grep &#123;&#125; log.2023-10-13-15 &gt;allerr.log</span><br></pre></td></tr></table></figure>
<h2 id="Share"><a href="#Share" class="headerlink" title="Share"></a>Share</h2><p>#ç¢ç¢å¿µ #è§‚ç‚¹</p>
<p>å†æˆ‘å¸å·¥ä½œï¼Œè§‰å¾—æ•ˆç‡æ˜¯æ²¡ç”¨çš„ï¼Œç»å¤§å¤šæ•°å·¥ä½œï¼Œéƒ½æ˜¯å¾ˆç®€å•çš„åŸºæœ¬å·¥ä½œã€‚ä½†æ˜¯ï¼Œè¿™ç§æƒ…å†µèƒ½æŒç»­å¤šä¹…ï¼Ÿè¿˜æ˜¯è¦é‡è§†æ•ˆç‡èµ·æ¥ã€‚</p>
]]></content>
      <categories>
        <category>arts</category>
      </categories>
      <tags>
        <tag>ç®—æ³•</tag>
        <tag>leetcode</tag>
        <tag>å¥½æ–‡</tag>
        <tag>é˜…è¯»</tag>
        <tag>å·¥å…·</tag>
        <tag>ç¢ç¢å¿µ</tag>
        <tag>è§‚ç‚¹</tag>
      </tags>
  </entry>
  <entry>
    <title>ARTS-2023-43</title>
    <url>/2023/10/23/arts/ARTS-2023-43/</url>
    <content><![CDATA[<blockquote>
<p>ARTS æ˜¯é™ˆæµ©ï¼ˆç½‘åå·¦è€³æœµè€—å­ï¼‰åœ¨æå®¢æ—¶é—´ä¸“æ é‡Œå‘èµ·çš„ä¸€ä¸ªæ´»åŠ¨ï¼Œç›®çš„æ˜¯é€šè¿‡åˆ†äº«çš„æ–¹å¼æ¥åšæŒå­¦ä¹ ã€‚ æ¯äººæ¯å‘¨å†™ä¸€ä¸ª ARTSï¼š<br>Algorithm æ˜¯ä¸€é“ç®—æ³•é¢˜<br>Review æ˜¯è¯»ä¸€ç¯‡è‹±æ–‡æ–‡ç« <br>Technique&#x2F;Tips æ˜¯åˆ†äº«ä¸€ä¸ªå°æŠ€æœ¯<br>Share æ˜¯åˆ†äº«ä¸€ä¸ªè§‚ç‚¹ã€‚</p>
</blockquote>
<span id="more"></span>

<p>æœ¬å‘¨å†å¤‡è€ƒä»¥åŠäº¤æ¥çš„äº‹æƒ…ï¼Œarts åŸºæœ¬ä¸Šéƒ½æç½®äº†ã€‚ã€‚ã€‚ã€‚ã€‚ ğŸ¤”</p>
<h2 id="Algorithm"><a href="#Algorithm" class="headerlink" title="Algorithm"></a>Algorithm</h2><p>#ç®—æ³• #leetcode</p>
<h2 id="Review"><a href="#Review" class="headerlink" title="Review"></a>Review</h2><p>#å¥½æ–‡ #é˜…è¯»</p>
<h2 id="Technique-Tips"><a href="#Technique-Tips" class="headerlink" title="Technique&#x2F;Tips"></a>Technique&#x2F;Tips</h2><p>#å·¥å…·  </p>
<h2 id="Share"><a href="#Share" class="headerlink" title="Share"></a>Share</h2><p>#ç¢ç¢å¿µ #è§‚ç‚¹</p>
<p>æœ€åï¼Œæˆ‘æƒ³è¯´æœ‰æ—¶å€™ç¬¨åŠæ³•æ‰æ˜¯æœ€èªæ˜çš„ï¼Œæ…¢æ…¢æ¥æ‰æ˜¯æœ€å¿«çš„ã€‚è¯»æ–‡æ¡£ä¸ä¸€å®šèƒ½ç›´æ¥ç»™æˆ‘ä»¬ç”Ÿæ´»çš„æœ€ä¼˜è§£ï¼Œä½†æ˜¯ä»–èƒ½è®©æˆ‘ä»¬è¶‹è¿‘äºçŸ¥é“æœ€ä¼˜è§£çš„è·¯å¾„ã€‚ç”Ÿæ´»å°±åƒä¸€åœºå†’é™©ï¼Œä¹Ÿè®¸æ–‡æ¡£å°±æ˜¯æˆ‘ä»¬æ‰‹ä¸­çš„åœ°å›¾å’ŒæŒ‡å—é’ˆã€‚  æ…¢æ…¢æ¥ä¸ç€æ€¥ï¼Œæ—¶é—´è¿˜å¾ˆé•¿ã€‚</p>
]]></content>
      <categories>
        <category>arts</category>
      </categories>
      <tags>
        <tag>ç®—æ³•</tag>
        <tag>leetcode</tag>
        <tag>å¥½æ–‡</tag>
        <tag>é˜…è¯»</tag>
        <tag>å·¥å…·</tag>
        <tag>ç¢ç¢å¿µ</tag>
        <tag>è§‚ç‚¹</tag>
      </tags>
  </entry>
  <entry>
    <title>ARTS-2023-44</title>
    <url>/2023/10/30/arts/ARTS-2023-44/</url>
    <content><![CDATA[<blockquote>
<p>ARTS æ˜¯é™ˆæµ©ï¼ˆç½‘åå·¦è€³æœµè€—å­ï¼‰åœ¨æå®¢æ—¶é—´ä¸“æ é‡Œå‘èµ·çš„ä¸€ä¸ªæ´»åŠ¨ï¼Œç›®çš„æ˜¯é€šè¿‡åˆ†äº«çš„æ–¹å¼æ¥åšæŒå­¦ä¹ ã€‚ æ¯äººæ¯å‘¨å†™ä¸€ä¸ª ARTSï¼š<br>Algorithm æ˜¯ä¸€é“ç®—æ³•é¢˜<br>Review æ˜¯è¯»ä¸€ç¯‡è‹±æ–‡æ–‡ç« <br>Technique&#x2F;Tips æ˜¯åˆ†äº«ä¸€ä¸ªå°æŠ€æœ¯<br>Share æ˜¯åˆ†äº«ä¸€ä¸ªè§‚ç‚¹ã€‚</p>
</blockquote>
<span id="more"></span>

<h2 id="Algorithm"><a href="#Algorithm" class="headerlink" title="Algorithm"></a>Algorithm</h2><p>#ç®—æ³• #leetcode</p>
<h2 id="Review"><a href="#Review" class="headerlink" title="Review"></a>Review</h2><p>#å¥½æ–‡ #é˜…è¯»<br><a href="https://github.com/ZachGoldberg/Startup-CTO-Handbook">https://github.com/ZachGoldberg/Startup-CTO-Handbook</a>  </p>
<h2 id="Technique-Tips"><a href="#Technique-Tips" class="headerlink" title="Technique&#x2F;Tips"></a>Technique&#x2F;Tips</h2><p>#å·¥å…·  </p>
<h2 id="Share"><a href="#Share" class="headerlink" title="Share"></a>Share</h2><p>#ç¢ç¢å¿µ #è§‚ç‚¹</p>
]]></content>
      <categories>
        <category>arts</category>
      </categories>
      <tags>
        <tag>ç®—æ³•</tag>
        <tag>leetcode</tag>
        <tag>å¥½æ–‡</tag>
        <tag>é˜…è¯»</tag>
        <tag>å·¥å…·</tag>
        <tag>ç¢ç¢å¿µ</tag>
        <tag>è§‚ç‚¹</tag>
      </tags>
  </entry>
  <entry>
    <title>ARTS-2023-45</title>
    <url>/2023/11/06/arts/ARTS-2023-45/</url>
    <content><![CDATA[<blockquote>
<p>ARTS æ˜¯é™ˆæµ©ï¼ˆç½‘åå·¦è€³æœµè€—å­ï¼‰åœ¨æå®¢æ—¶é—´ä¸“æ é‡Œå‘èµ·çš„ä¸€ä¸ªæ´»åŠ¨ï¼Œç›®çš„æ˜¯é€šè¿‡åˆ†äº«çš„æ–¹å¼æ¥åšæŒå­¦ä¹ ã€‚ æ¯äººæ¯å‘¨å†™ä¸€ä¸ª ARTSï¼š<br>Algorithm æ˜¯ä¸€é“ç®—æ³•é¢˜<br>Review æ˜¯è¯»ä¸€ç¯‡è‹±æ–‡æ–‡ç« <br>Technique&#x2F;Tips æ˜¯åˆ†äº«ä¸€ä¸ªå°æŠ€æœ¯<br>Share æ˜¯åˆ†äº«ä¸€ä¸ªè§‚ç‚¹ã€‚</p>
</blockquote>
<span id="more"></span>

<h2 id="Algorithm"><a href="#Algorithm" class="headerlink" title="Algorithm"></a>Algorithm</h2><p>#ç®—æ³• #leetcode</p>
<h2 id="Review"><a href="#Review" class="headerlink" title="Review"></a>Review</h2><p>#å¥½æ–‡ #é˜…è¯»</p>
<p><a href="http://pf.bigpixel.cn/zh-CN/city/1.html">http://pf.bigpixel.cn/zh-CN/city/1.html</a><br>ä¸€ä¸ªæŒºæœ‰è¶£çš„ç½‘ç«™ï¼Œç”¨åƒäº¿åƒç´ çœ‹ä¸–ç•Œå„ä¸ªåŸå¸‚<br><a href="https://netflixtechblog.com/linux-performance-analysis-in-60-000-milliseconds-accc10403c55">60000 æ¯«ç§’ Linux æ€§èƒ½åˆ†æ</a><br>è¿™ç¯‡æ–‡ç« ä»‹ç»äº†åœ¨ 60 ç§’å†…åˆ†æ Linux æ€§èƒ½é—®é¢˜çš„æ–¹æ³•ã€‚ä½œè€…é¦–å…ˆä»‹ç»äº†ä¸€äº›åŸºæœ¬çš„æ€§èƒ½æŒ‡æ ‡ï¼ŒåŒ…æ‹¬ CPU ä½¿ç”¨ç‡ã€å†…å­˜ä½¿ç”¨ç‡ã€ç½‘ç»œæµé‡å’Œ I&#x2F;O æ“ä½œã€‚ç„¶åï¼Œä½œè€…ä»‹ç»äº†ä¸€äº›ç”¨äºç›‘æ§è¿™äº›æŒ‡æ ‡çš„å·¥å…·ï¼ŒåŒ…æ‹¬ topã€htopã€vmstatã€iostat å’Œ netstatã€‚</p>
<h2 id="Technique-Tips"><a href="#Technique-Tips" class="headerlink" title="Technique&#x2F;Tips"></a>Technique&#x2F;Tips</h2><p>#å·¥å…·<br>æ‰¹é‡é‡å‘½å æ–‡ä»¶åç¼€</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">for file in *.md; do mv &quot;$file&quot; &quot;$&#123;file%.md&#125;.txt&quot;; done</span><br></pre></td></tr></table></figure>
<h2 id="Share"><a href="#Share" class="headerlink" title="Share"></a>Share</h2><p>#ç¢ç¢å¿µ #è§‚ç‚¹</p>
]]></content>
      <categories>
        <category>arts</category>
      </categories>
      <tags>
        <tag>ç®—æ³•</tag>
        <tag>leetcode</tag>
        <tag>å¥½æ–‡</tag>
        <tag>é˜…è¯»</tag>
        <tag>å·¥å…·</tag>
        <tag>ç¢ç¢å¿µ</tag>
        <tag>è§‚ç‚¹</tag>
      </tags>
  </entry>
  <entry>
    <title>ARTS-2023-46</title>
    <url>/2023/11/13/arts/ARTS-2023-46/</url>
    <content><![CDATA[<blockquote>
<p>ARTS æ˜¯é™ˆæµ©ï¼ˆç½‘åå·¦è€³æœµè€—å­ï¼‰åœ¨æå®¢æ—¶é—´ä¸“æ é‡Œå‘èµ·çš„ä¸€ä¸ªæ´»åŠ¨ï¼Œç›®çš„æ˜¯é€šè¿‡åˆ†äº«çš„æ–¹å¼æ¥åšæŒå­¦ä¹ ã€‚ æ¯äººæ¯å‘¨å†™ä¸€ä¸ª ARTSï¼š<br>Algorithm æ˜¯ä¸€é“ç®—æ³•é¢˜<br>Review æ˜¯è¯»ä¸€ç¯‡è‹±æ–‡æ–‡ç« <br>Technique&#x2F;Tips æ˜¯åˆ†äº«ä¸€ä¸ªå°æŠ€æœ¯<br>Share æ˜¯åˆ†äº«ä¸€ä¸ªè§‚ç‚¹ã€‚</p>
</blockquote>
<span id="more"></span>

<h2 id="Algorithm"><a href="#Algorithm" class="headerlink" title="Algorithm"></a>Algorithm</h2><p>#ç®—æ³• #leetcode</p>
<ol>
<li><a href="https://leetcode.cn/problems/roman-to-integer/description/?envType=study-plan-v2&envId=top-interview-150">leetcode 13 </a><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> symbolValues = <span class="keyword">map</span>[<span class="type">byte</span>]<span class="type">int</span>&#123;<span class="string">&#x27;I&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;V&#x27;</span>: <span class="number">5</span>, <span class="string">&#x27;X&#x27;</span>: <span class="number">10</span>, <span class="string">&#x27;L&#x27;</span>: <span class="number">50</span>, <span class="string">&#x27;C&#x27;</span>: <span class="number">100</span>, <span class="string">&#x27;D&#x27;</span>: <span class="number">500</span>, <span class="string">&#x27;M&#x27;</span>: <span class="number">1000</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ€è·¯</span></span><br><span class="line"><span class="comment">// æ­£å¸¸æ¥è¯´ï¼Œå–å‡ºæ¯ä¸ªå­—ç¬¦å¯¹åº”çš„å€¼ï¼Œç„¶ååˆ¤æ–­å‰åå¤§å°ï¼Œå¦‚æœå‰é¢çš„æ¯”åé¢çš„å°ï¼Œé‚£ä¹ˆå°±æ˜¯å‡å»å‰é¢çš„å€¼ï¼Œå¦åˆ™å°±æ˜¯åŠ ä¸Šå‰é¢çš„å€¼</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">romanToInt</span><span class="params">(s <span class="type">string</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">	n := <span class="built_in">len</span>(s)</span><br><span class="line">	ans := <span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="keyword">range</span> s &#123;</span><br><span class="line">		value := symbolValues[s[i]]</span><br><span class="line">		<span class="keyword">if</span> i &lt; n<span class="number">-1</span> &amp;&amp; value &lt; symbolValues[s[i+<span class="number">1</span>]] &#123;</span><br><span class="line">			ans -= value</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			ans += value</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> ans</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="Review"><a href="#Review" class="headerlink" title="Review"></a>Review</h2><p>å­¦ä¹ èµ„æ–™::<a href="https://braydie.gitbooks.io/how-to-be-a-programmer/content/zh/"># How to be a Programmer ä¸­æ–‡ç‰ˆ</a></p>
<p>#å¥½æ–‡ #é˜…è¯»</p>
<h2 id="Technique-Tips"><a href="#Technique-Tips" class="headerlink" title="Technique&#x2F;Tips"></a>Technique&#x2F;Tips</h2><p>#å·¥å…·  </p>
<ol>
<li>Microsoft InShellisenseæ’ä»¶<br><a href="https://github.com/microsoft/inshellisense">inshellisense</a> ä¸º shell æä¾› IDE é£æ ¼çš„è‡ªåŠ¨å®ŒæˆåŠŸèƒ½ã€‚å®ƒæ˜¯ä¸€ä¸ªç”¨äºè‡ªåŠ¨å®Œæˆçš„ç»ˆç«¯æœ¬æœºè¿è¡Œæ—¶ï¼Œæ”¯æŒ 600 å¤šä¸ªå‘½ä»¤è¡Œå·¥å…·ã€‚ inshellisense æ”¯æŒ Windowsã€Linux å’Œ MacOSã€‚</li>
</ol>
<p>è¿™ä¸ªæ’ä»¶ éœ€è¦é€‚åº”ä¸€ä¸‹ï¼Œå“ˆå“ˆï¼Œå¯¹ä»¥å‰çš„ä¸€äº›ä¹ æƒ¯ä¾µå…¥è›®å¤§çš„ã€‚<br> 2. gitåˆ é™¤æ²¡è¢«è·Ÿè¸ªçš„ æ–‡ä»¶<br> git clean -f -d -x  git åˆ é™¤ æ²¡è¢«è·Ÿè¸ªçš„æ–‡ä»¶ï¼Œæœ‰æ—¶å€™æœ‰ç”¨æŠŠã€‚æ¯”å¦‚é¢‘ç¹åˆ‡æ¢åˆ†æ”¯ã€‚</p>
<h2 id="Share"><a href="#Share" class="headerlink" title="Share"></a>Share</h2><p>#ç¢ç¢å¿µ #è§‚ç‚¹</p>
<ol>
<li>æ˜¨æ™šï¼ˆ2023-11-12ï¼‰ é˜¿é‡Œäº‘æ•…éšœäº†ï¼Œå½“æ—¶åœ¨åšé¥­ï¼Œå¬åˆ°è¿™ä¸ªäº‹æƒ…åï¼Œè§‰å¾—ä¸å¯æ€è®®ï¼Œåé¢æœ‰å“ˆå“ˆå¤§ç¬‘ï¼Œå˜²è®½maxï¼Œåˆ°äº†ä»Šå¤©ï¼Œæ„Ÿè§‰æˆ‘æœ‰ä»€ä¹ˆèµ„æ ¼ç¬‘çš„å‡ºæ¥ï¼Œé˜¿é‡Œäº‘å·²ç»å¾ˆä¼Ÿå¤§äº†ï¼Œæˆ‘èƒ½å†™å‡ºè¿™æ ·çš„ç³»ç»Ÿï¼Ÿä¸è¿‡è¿˜æ˜¯å¾—å‡ºä¸‹é¢çš„æ•™è®­<ol>
<li>äº‘ä¸æ˜¯ä¸‡èƒ½çš„ï¼Œäº‘ä¹Ÿå¾ˆè´µã€‚</li>
<li>ä¿æŒæ•¬ç•ã€‚</li>
</ol>
</li>
<li>æœ¬å‘¨è¯»å®Œäº†ã€Šä»£ç æ•´æ´ä¹‹é“ï¼šç¨‹åºå‘˜çš„èŒä¸šç´ å…»ã€‹æ…¢æ…¢çš„å›åˆ°äº†æ­£å¸¸çš„èŠ‚å¥äº†ï¼Œçœ‹ä¹¦å†™æ–‡å­—ï¼ŒObsidiançš„æ‘¸ç´¢ä¹Ÿå¼€å§‹æœ‰ç‚¹é—¨é“äº†ï¼Œä¸€åˆ‡å¼€å§‹æ…¢æ…¢çš„å¥½è½¬ã€‚<a href=""></a></li>
</ol>
]]></content>
      <categories>
        <category>arts</category>
      </categories>
      <tags>
        <tag>ç®—æ³•</tag>
        <tag>leetcode</tag>
        <tag>å¥½æ–‡</tag>
        <tag>é˜…è¯»</tag>
        <tag>å·¥å…·</tag>
        <tag>ç¢ç¢å¿µ</tag>
        <tag>è§‚ç‚¹</tag>
      </tags>
  </entry>
  <entry>
    <title>ARTS-2023-47</title>
    <url>/2023/11/20/arts/ARTS-2023-47/</url>
    <content><![CDATA[<blockquote>
<p>ARTS æ˜¯é™ˆæµ©ï¼ˆç½‘åå·¦è€³æœµè€—å­ï¼‰åœ¨æå®¢æ—¶é—´ä¸“æ é‡Œå‘èµ·çš„ä¸€ä¸ªæ´»åŠ¨ï¼Œç›®çš„æ˜¯é€šè¿‡åˆ†äº«çš„æ–¹å¼æ¥åšæŒå­¦ä¹ ã€‚ æ¯äººæ¯å‘¨å†™ä¸€ä¸ª ARTSï¼š<br>Algorithm æ˜¯ä¸€é“ç®—æ³•é¢˜<br>Review æ˜¯è¯»ä¸€ç¯‡è‹±æ–‡æ–‡ç« <br>Technique&#x2F;Tips æ˜¯åˆ†äº«ä¸€ä¸ªå°æŠ€æœ¯<br>Share æ˜¯åˆ†äº«ä¸€ä¸ªè§‚ç‚¹ã€‚</p>
</blockquote>
<span id="more"></span>

<h2 id="Algorithm"><a href="#Algorithm" class="headerlink" title="Algorithm"></a>Algorithm</h2><h3 id="leetcode-383"><a href="#leetcode-383" class="headerlink" title="leetcode 383"></a>leetcode 383</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">canConstruct</span><span class="params">(ransomNote <span class="type">string</span>, magazine <span class="type">string</span>)</span></span> <span class="type">bool</span> &#123;  </span><br><span class="line">    h := <span class="built_in">make</span>([]<span class="type">int</span>, <span class="number">26</span>)  </span><br><span class="line">    <span class="keyword">for</span> _, v := <span class="keyword">range</span> magazine &#123;  </span><br><span class="line">       h[v-<span class="string">&#x27;a&#x27;</span>]++  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">for</span> _, v := <span class="keyword">range</span> ransomNote &#123;  </span><br><span class="line">       <span class="keyword">if</span> h[v-<span class="string">&#x27;a&#x27;</span>] &gt; <span class="number">0</span> &#123;  </span><br><span class="line">          h[v-<span class="string">&#x27;a&#x27;</span>]--  </span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">          <span class="keyword">return</span> <span class="literal">false</span>  </span><br><span class="line">       &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="49"><a href="#49" class="headerlink" title="49"></a>49</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">groupAnagrams</span><span class="params">(strs []<span class="type">string</span>)</span></span> [][]<span class="type">string</span> &#123;  </span><br><span class="line">  </span><br><span class="line">    r := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>][]<span class="type">string</span>, <span class="number">1000</span>)  </span><br><span class="line">    <span class="keyword">for</span> _, v := <span class="keyword">range</span> strs &#123;  </span><br><span class="line">       key := <span class="built_in">make</span>([]<span class="type">byte</span>, <span class="number">26</span>, <span class="number">26</span>)  </span><br><span class="line">       <span class="keyword">for</span> _, v1 := <span class="keyword">range</span> v &#123;  </span><br><span class="line">          key[v1-<span class="string">&#x27;a&#x27;</span>]++  </span><br><span class="line">       &#125;  </span><br><span class="line">       <span class="keyword">if</span> _, ok := r[<span class="type">string</span>(key)]; ok &#123;  </span><br><span class="line">          r[<span class="type">string</span>(key)] = <span class="built_in">append</span>(r[<span class="type">string</span>(key)], v)  </span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">          r[<span class="type">string</span>(key)] = []<span class="type">string</span>&#123;v&#125;  </span><br><span class="line">       &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">    result := [][]<span class="type">string</span>&#123;&#125;  </span><br><span class="line">    <span class="keyword">for</span> _, v := <span class="keyword">range</span> r &#123;  </span><br><span class="line">       result = <span class="built_in">append</span>(result, v)  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">return</span> result  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Review"><a href="#Review" class="headerlink" title="Review"></a>Review</h2><p>1.<a href="https://medium.com/gitconnected/awesome-terminal-applications-e4a06022dffa"> Awesome Terminal Applications</a><br>    åŸºäºmac ç³»ç»Ÿï¼Œä»‹ç»äº†ç»ˆç«¯å·¥å…·ï¼Œçœ‹ä¸Šå»è›®é…·çš„ï¼Œç›®å‰å†ç”¨ tldr</p>
<h2 id="Technique-Tips"><a href="#Technique-Tips" class="headerlink" title="Technique&#x2F;Tips"></a>Technique&#x2F;Tips</h2><p>#æµè§ˆå™¨æ’ä»¶ <strong><a href="https://chromewebstore.google.com/detail/egejbknaophaadmhijkepokfchkbnelc?hl=en">Medium Parser</a> - ä¸€ä¸ªç”¨äºæŸ¥çœ‹ Medium ä»˜è´¹æ–‡ç« çš„æµè§ˆå™¨æ’ä»¶</strong>å®ƒçš„åŸç†æ˜¯é€šè¿‡ Google Web ç¼“å­˜æŸ¥çœ‹ Medium ä»˜è´¹æ–‡ç« ã€‚</p>
<h3 id="linux-sar"><a href="#linux-sar" class="headerlink" title="#linux sar"></a>#linux sar</h3><p><strong>sarå‘½ä»¤</strong>Â æ˜¯Linuxä¸‹ç³»ç»Ÿè¿è¡ŒçŠ¶æ€ç»Ÿè®¡å·¥å…·ï¼Œå®ƒå°†æŒ‡å®šçš„æ“ä½œç³»ç»ŸçŠ¶æ€è®¡æ•°å™¨æ˜¾ç¤ºåˆ°æ ‡å‡†è¾“å‡ºè®¾å¤‡ã€‚sarå·¥å…·å°†å¯¹ç³»ç»Ÿå½“å‰çš„çŠ¶æ€è¿›è¡Œå–æ ·ï¼Œç„¶åé€šè¿‡è®¡ç®—æ•°æ®å’Œæ¯”ä¾‹æ¥è¡¨è¾¾ç³»ç»Ÿçš„å½“å‰è¿è¡ŒçŠ¶æ€ã€‚å®ƒçš„ç‰¹ç‚¹æ˜¯å¯ä»¥è¿ç»­å¯¹ç³»ç»Ÿå–æ ·ï¼Œè·å¾—å¤§é‡çš„å–æ ·æ•°æ®ã€‚å–æ ·æ•°æ®å’Œåˆ†æçš„ç»“æœéƒ½å¯ä»¥å­˜å…¥æ–‡ä»¶ï¼Œä½¿ç”¨å®ƒæ—¶æ¶ˆè€—çš„ç³»ç»Ÿèµ„æºå¾ˆå°ã€‚<br>å®ƒæä¾›äº†ä¸€ä¸‹çš„é€‰é¡¹ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">-A: æ˜¾ç¤ºæ‰€æœ‰çš„æŠ¥å‘Šä¿¡æ¯ï¼›</span><br><span class="line">-b: æ˜¾ç¤ºI/Oé€Ÿç‡ï¼›</span><br><span class="line">-B: æ˜¾ç¤ºæ¢é¡µçŠ¶æ€ï¼›</span><br><span class="line">-c: æ˜¾ç¤ºè¿›ç¨‹åˆ›å»ºæ´»åŠ¨ï¼›</span><br><span class="line">-d: æ˜¾ç¤ºæ¯ä¸ªå—è®¾å¤‡çš„çŠ¶æ€ï¼›</span><br><span class="line">-e: è®¾ç½®æ˜¾ç¤ºæŠ¥å‘Šçš„ç»“æŸæ—¶é—´ï¼›</span><br><span class="line">-f: ä»æŒ‡å®šæ–‡ä»¶æå–æŠ¥å‘Šï¼›</span><br><span class="line">-i: è®¾çŠ¶æ€ä¿¡æ¯åˆ·æ–°çš„é—´éš”æ—¶é—´ï¼›</span><br><span class="line">-n: æŠ¥å‘Šç½‘ç»œç»Ÿè®¡ä¿¡æ¯ã€‚</span><br><span class="line">-P: æŠ¥å‘Šæ¯ä¸ªCPUçš„çŠ¶æ€ï¼›</span><br><span class="line">-R: æ˜¾ç¤ºå†…å­˜çŠ¶æ€ï¼›</span><br><span class="line">-u: æ˜¾ç¤ºCPUåˆ©ç”¨ç‡ï¼›</span><br><span class="line">-v: æ˜¾ç¤ºç´¢å¼•èŠ‚ç‚¹ï¼Œæ–‡ä»¶å’Œå…¶ä»–å†…æ ¸è¡¨çš„çŠ¶æ€ï¼›</span><br><span class="line">-w: æ˜¾ç¤ºäº¤æ¢åˆ†åŒºçŠ¶æ€ï¼›</span><br><span class="line">-x: æ˜¾ç¤ºç»™å®šè¿›ç¨‹çš„çŠ¶æ€ã€‚</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">-r: ä»¥åˆ†é¡µæ–¹å¼æ˜¾ç¤ºè¾“å‡ºï¼Œæ¯é¡µæœ€å¤šæ˜¾ç¤º 100 è¡Œã€‚ </span><br><span class="line">-o: è¾“å‡ºé€‰é¡¹ï¼ŒæŒ‡å®šè¦æ˜¾ç¤ºçš„åˆ—ã€‚ä¾‹å¦‚ï¼Œ`-o mrk,prt,cvg` å°†æ˜¾ç¤º CPU ä½¿ç”¨ç‡ã€è¿›ç¨‹æ ‡è¯†ç¬¦ã€ç£ç›˜ä½¿ç”¨ç‡ å’Œ ç½‘ç»œæµé‡ã€‚ </span><br><span class="line">-t: æ—¶é—´æˆ³é€‰é¡¹ï¼ŒæŒ‡å®šè¦åœ¨è¾“å‡ºä¸­æ·»åŠ æ—¶é—´æˆ³ã€‚ </span><br><span class="line">-s: ç»Ÿè®¡é€‰é¡¹ï¼ŒæŒ‡å®šè¦æ˜¾ç¤ºçš„ç»Ÿè®¡æ•°æ®çš„ç±»å‹ã€‚ä¾‹å¦‚ï¼Œ`-s us,ms` å°†æ˜¾ç¤º CPU ä½¿ç”¨ç‡çš„ us å’Œ ms æ—¶é—´æ®µçš„å¹³å‡å€¼ã€‚ </span><br><span class="line">-c: é€‰é¡¹ç”¨äºæŒ‡å®šè¦å‘é€çš„å‘½ä»¤ã€‚ä¾‹å¦‚ï¼Œ`-c ls` å°†æ˜¾ç¤ºå½“å‰ç›®å½•ä¸­çš„æ–‡ä»¶å’Œå­ç›®å½•åˆ—è¡¨ã€‚</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨å®ä¾‹ï¼š<br>sar å¯ä»¥ç”¨æ¥è§‚æµ‹å¾ˆå¤š æ¯”è¾ƒç»†è‡´çš„æŒ‡æ ‡ï¼Œæ¯”å¦‚ï¼š</p>
<ol>
<li>æŸ¥çœ‹ç³»ç»Ÿå½“å‰çš„ç½‘ç»œååé‡å’Œ PPS <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ•°å­—1è¡¨ç¤ºæ¯éš”1ç§’è¾“å‡ºä¸€ç»„æ•°æ®</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sar -n DEV 1</span></span><br><span class="line">Linux 4.15.0-1035 (ubuntu)   01/06/19   _x86_64_  (2 CPU)</span><br><span class="line"></span><br><span class="line">13:21:40        IFACE   rxpck/s   txpck/s    rxkB/s    txkB/s   rxcmp/s   txcmp/s  rxmcst/s   %ifutil</span><br><span class="line">13:21:41         eth0     18.00     20.00      5.79      4.25      0.00      0.00      0.00      0.00</span><br><span class="line">13:21:41      docker0      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00</span><br><span class="line">13:21:41           lo      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00</span><br></pre></td></tr></table></figure></li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">rxpck/s å’Œ txpck/s åˆ†åˆ«æ˜¯æ¥æ”¶å’Œå‘é€çš„ PPSï¼Œå•ä½ä¸ºåŒ… / ç§’ã€‚</span><br><span class="line">rxkB/s å’Œ txkB/s åˆ†åˆ«æ˜¯æ¥æ”¶å’Œå‘é€çš„ååé‡ï¼Œå•ä½æ˜¯ KB/ ç§’ã€‚</span><br><span class="line">rxcmp/s å’Œ txcmp/s åˆ†åˆ«æ˜¯æ¥æ”¶å’Œå‘é€çš„å‹ç¼©æ•°æ®åŒ…æ•°ï¼Œå•ä½æ˜¯åŒ… / ç§’ã€‚</span><br><span class="line"><span class="meta prompt_">%</span><span class="language-bash">ifutil æ˜¯ç½‘ç»œæ¥å£çš„ä½¿ç”¨ç‡ï¼Œå³åŠåŒå·¥æ¨¡å¼ä¸‹ä¸º (rxkB/s+txkB/s)/Bandwidthï¼Œè€Œå…¨åŒå·¥æ¨¡å¼ä¸‹ä¸º max(rxkB/s, txkB/s)/Bandwidthã€‚</span></span><br></pre></td></tr></table></figure>

<h2 id="Share"><a href="#Share" class="headerlink" title="Share"></a>Share</h2><p>#go101 log.fatal è°ƒç”¨çš„æ˜¯os.exitï¼ˆï¼‰defer ä¸ä¼šç”Ÿæ•ˆã€‚<br>![[Pasted image 20231122202715.png]]<br>#go101  æ•°æ®çš„å‘é€è€…ï¼Œæ‰èƒ½å†³å®šchannel ä»€ä¹ˆæ—¶å€™å…³é—­ã€‚</p>
]]></content>
      <categories>
        <category>arts</category>
      </categories>
      <tags>
        <tag>atrs</tag>
      </tags>
  </entry>
  <entry>
    <title>ARTS-2023-48</title>
    <url>/2023/11/27/arts/ARTS-2023-48/</url>
    <content><![CDATA[<blockquote>
<p>ARTS æ˜¯é™ˆæµ©ï¼ˆç½‘åå·¦è€³æœµè€—å­ï¼‰åœ¨æå®¢æ—¶é—´ä¸“æ é‡Œå‘èµ·çš„ä¸€ä¸ªæ´»åŠ¨ï¼Œç›®çš„æ˜¯é€šè¿‡åˆ†äº«çš„æ–¹å¼æ¥åšæŒå­¦ä¹ ã€‚ æ¯äººæ¯å‘¨å†™ä¸€ä¸ª ARTSï¼š<br>Algorithm æ˜¯ä¸€é“ç®—æ³•é¢˜<br>Review æ˜¯è¯»ä¸€ç¯‡è‹±æ–‡æ–‡ç« <br>Technique&#x2F;Tips æ˜¯åˆ†äº«ä¸€ä¸ªå°æŠ€æœ¯<br>Share æ˜¯åˆ†äº«ä¸€ä¸ªè§‚ç‚¹ã€‚</p>
</blockquote>
<span id="more"></span>

<h2 id="Algorithm"><a href="#Algorithm" class="headerlink" title="Algorithm"></a>Algorithm</h2><h2 id="Review"><a href="#Review" class="headerlink" title="Review"></a>Review</h2><p><a href="https://www.riverphillips.dev/blog/go-cfs">https://www.riverphillips.dev/blog/go-cfs</a> ä¸€ä¸ªè€ç”Ÿå¸¸è°ˆçš„é—®é¢˜ï¼Œ GOMAXPROCS çš„è®¾ç½®ã€‚</p>
<h2 id="Technique-Tips"><a href="#Technique-Tips" class="headerlink" title="Technique&#x2F;Tips"></a>Technique&#x2F;Tips</h2><p>ä½¿ç”¨ <a href="https://github.com/Yidadaa/ChatGPT-Next-Web">ChatGPT-Next-Web</a> +<a href="https://www.gptapi.us/"> gptapi</a> æ­å»ºäº†ä¸€ä¸ªé•œåƒç«™ï¼Œçœ‹èƒ½æ´»å¤šä¹…æŠŠã€‚</p>
<iframe allow="autoplay *; encrypted-media *; fullscreen *; clipboard-write" frameborder="0" height="450" style="width:100%;max-width:660px;overflow:hidden;border-radius:10px;" sandbox="allow-forms allow-popups allow-same-origin allow-scripts allow-storage-access-by-user-activation allow-top-navigation-by-user-activation" src="https://embed.music.apple.com/cn/playlist/vol-1000-%E5%9C%A8%E6%97%B6%E5%85%89%E5%8F%98%E5%B9%BB%E4%B8%AD%E6%B0%B8%E4%B8%8D%E5%A4%B1%E5%8E%BB/pl.u-RRbV0gVCmgNxNDx"></iframe>

<h2 id="Share"><a href="#Share" class="headerlink" title="Share"></a>Share</h2>]]></content>
      <categories>
        <category>arts</category>
      </categories>
  </entry>
  <entry>
    <title>ARTS-2023-42</title>
    <url>/2023/10/16/arts/ARTS-2023-42/</url>
    <content><![CDATA[<blockquote>
<p>ARTS æ˜¯é™ˆæµ©ï¼ˆç½‘åå·¦è€³æœµè€—å­ï¼‰åœ¨æå®¢æ—¶é—´ä¸“æ é‡Œå‘èµ·çš„ä¸€ä¸ªæ´»åŠ¨ï¼Œç›®çš„æ˜¯é€šè¿‡åˆ†äº«çš„æ–¹å¼æ¥åšæŒå­¦ä¹ ã€‚ æ¯äººæ¯å‘¨å†™ä¸€ä¸ª ARTSï¼š<br>Algorithm æ˜¯ä¸€é“ç®—æ³•é¢˜<br>Review æ˜¯è¯»ä¸€ç¯‡è‹±æ–‡æ–‡ç« <br>Technique&#x2F;Tips æ˜¯åˆ†äº«ä¸€ä¸ªå°æŠ€æœ¯<br>Share æ˜¯åˆ†äº«ä¸€ä¸ªè§‚ç‚¹ã€‚</p>
</blockquote>
<span id="more"></span>

<h2 id="Algorithm"><a href="#Algorithm" class="headerlink" title="Algorithm"></a>Algorithm</h2><p>#ç®—æ³• #leetcode  </p>
<ol>
<li>leetcode 45 <figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">jump</span><span class="params">(nums []<span class="type">int</span>)</span></span> <span class="type">int</span> &#123;  </span><br><span class="line">    length := <span class="built_in">len</span>(nums)  </span><br><span class="line">    end := <span class="number">0</span>  </span><br><span class="line">    maxPosition := <span class="number">0</span>  </span><br><span class="line">    steps := <span class="number">0</span>  </span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; length<span class="number">-1</span>; i++ &#123;  </span><br><span class="line">       maxPosition = max(maxPosition, i+nums[i])  </span><br><span class="line">       <span class="keyword">if</span> i == end &#123;  </span><br><span class="line">          end = maxPosition  </span><br><span class="line">          steps++  </span><br><span class="line">       &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">return</span> steps  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="Review"><a href="#Review" class="headerlink" title="Review"></a>Review</h2><p>#å¥½æ–‡ #é˜…è¯»<br><a href="https://substack.com/redirect/5c83001c-e5fb-4213-8871-41e93c28dfb1?j=eyJ1IjoibHNxdmoifQ.3oGmLofndxScvklxajPKu05xrXKSE0fYF651WfgCv6U">å¦‚ä½•åšå‡ºä¼Ÿå¤§çš„å·¥ä½œï¼Ÿ</a> </p>
<ul>
<li><input checked="" disabled="" type="checkbox"> <a href="things:///show?id=NU7XfixHt1ewVSJ3hXEteZ">é˜…è¯»</a> âœ… 2023-11-08<br><a href="https://www.brendangregg.com/linuxperf.html">Linux Performance</a></li>
</ul>
<h2 id="Technique-Tips"><a href="#Technique-Tips" class="headerlink" title="Technique&#x2F;Tips"></a>Technique&#x2F;Tips</h2><p>#å·¥å…·  </p>
<h2 id="Share"><a href="#Share" class="headerlink" title="Share"></a>Share</h2><p>#ç¢ç¢å¿µ #è§‚ç‚¹</p>
]]></content>
      <categories>
        <category>arts</category>
      </categories>
      <tags>
        <tag>ç®—æ³•</tag>
        <tag>leetcode</tag>
        <tag>å¥½æ–‡</tag>
        <tag>é˜…è¯»</tag>
        <tag>å·¥å…·</tag>
        <tag>ç¢ç¢å¿µ</tag>
        <tag>è§‚ç‚¹</tag>
      </tags>
  </entry>
  <entry>
    <title>ARTS-2023-49</title>
    <url>/2023/12/04/arts/ARTS-2023-49/</url>
    <content><![CDATA[<blockquote>
<p>ARTS æ˜¯é™ˆæµ©ï¼ˆç½‘åå·¦è€³æœµè€—å­ï¼‰åœ¨æå®¢æ—¶é—´ä¸“æ é‡Œå‘èµ·çš„ä¸€ä¸ªæ´»åŠ¨ï¼Œç›®çš„æ˜¯é€šè¿‡åˆ†äº«çš„æ–¹å¼æ¥åšæŒå­¦ä¹ ã€‚ æ¯äººæ¯å‘¨å†™ä¸€ä¸ª ARTSï¼š<br>Algorithm æ˜¯ä¸€é“ç®—æ³•é¢˜<br>Review æ˜¯è¯»ä¸€ç¯‡è‹±æ–‡æ–‡ç« <br>Technique&#x2F;Tips æ˜¯åˆ†äº«ä¸€ä¸ªå°æŠ€æœ¯<br>Share æ˜¯åˆ†äº«ä¸€ä¸ªè§‚ç‚¹ã€‚</p>
</blockquote>
<span id="more"></span>

<h2 id="Algorithm"><a href="#Algorithm" class="headerlink" title="Algorithm"></a>Algorithm</h2><p>ç»§ç»­åœ¨åšäºŒå‰æ ‘çš„é¢˜ç›®ã€‚<br>leetcode 97: ä¸­åºéå†</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">inorderTraversal</span><span class="params">(root *TreeNode)</span></span> []<span class="type">int</span> &#123;  </span><br><span class="line">    <span class="keyword">if</span> root == <span class="literal">nil</span> &#123;  </span><br><span class="line">       <span class="keyword">return</span> []<span class="type">int</span>&#123;&#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">if</span> root.Left == <span class="literal">nil</span> &amp;&amp; root.Right == <span class="literal">nil</span> &#123;  </span><br><span class="line">       <span class="keyword">return</span> []<span class="type">int</span>&#123;root.Val&#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">    result := []<span class="type">int</span>&#123;&#125;  </span><br><span class="line">    result = <span class="built_in">append</span>(result, inorderTraversal(root.Left)...)  </span><br><span class="line">    result = <span class="built_in">append</span>(result, root.Val)  </span><br><span class="line">    result = <span class="built_in">append</span>(result, inorderTraversal(root.Right)...)  </span><br><span class="line">    <span class="keyword">return</span> result  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>leetcode 173: ä¹Ÿæ˜¯ä¸­åºéå†</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> BSTIterator <span class="keyword">struct</span> &#123;  </span><br><span class="line">    stack []<span class="type">int</span> <span class="comment">// ç”¨äºå­˜å‚¨ä¸­åºéå†çš„ç»“æœ  </span></span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Constructor</span><span class="params">(root *TreeNode)</span></span> BSTIterator &#123;  </span><br><span class="line">    <span class="keyword">return</span> BSTIterator&#123;stack: inorderTraversal(root)&#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">inorderTraversal</span><span class="params">(root *TreeNode)</span></span> []<span class="type">int</span> &#123;  </span><br><span class="line">    <span class="keyword">if</span> root == <span class="literal">nil</span> &#123;  </span><br><span class="line">       <span class="keyword">return</span> []<span class="type">int</span>&#123;&#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">if</span> root.Left == <span class="literal">nil</span> &amp;&amp; root.Right == <span class="literal">nil</span> &#123;  </span><br><span class="line">       <span class="keyword">return</span> []<span class="type">int</span>&#123;root.Val&#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">    result := []<span class="type">int</span>&#123;&#125;  </span><br><span class="line">    result = <span class="built_in">append</span>(result, inorderTraversal(root.Left)...)  </span><br><span class="line">    result = <span class="built_in">append</span>(result, root.Val)  </span><br><span class="line">    result = <span class="built_in">append</span>(result, inorderTraversal(root.Right)...)  </span><br><span class="line">    <span class="keyword">return</span> result  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *BSTIterator)</span></span> Next() <span class="type">int</span> &#123;  </span><br><span class="line">    val := this.stack[<span class="number">0</span>]  </span><br><span class="line">    this.stack = this.stack[<span class="number">1</span>:]  </span><br><span class="line">    <span class="keyword">return</span> val  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *BSTIterator)</span></span> HasNext() <span class="type">bool</span> &#123;  </span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">len</span>(this.stack) &gt; <span class="number">0</span>  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Review"><a href="#Review" class="headerlink" title="Review"></a>Review</h2><p><a href="https://colobu.com/2023/12/07/more-precise-sleep/">æ›´ç²¾å‡†çš„sleep</a><br>å¤´ä¸€æ¬¡çŸ¥é“time.sleep çš„ç²¾åº¦é—®é¢˜ï¼Œæƒ³æƒ³ä¹Ÿæ˜¯å“ˆï¼ŒCPUé¢‘ç‡å°±åœ¨é‚£é‡Œï¼Œæ€ä¹ˆå¯èƒ½æä¾›é‚£ä¹ˆé«˜ç²¾åº¦çš„ä¼‘çœ ã€‚<code>time.sleep</code> çš„ç²¾åº¦æ˜¯1mså·¦å³ã€‚å¦‚æœæƒ³è¦æ›´é«˜ç²¾åº¦çš„ä¼‘çœ ï¼Œä½¿ç”¨<code>syscall.Nanosleep</code> å¯ä»¥æä¾›ns çº§åˆ«çš„ä¼‘çœ ï¼Œä½†æ˜¯å®ƒæ˜¯é˜»å¡è¿›ç¨‹çš„ã€‚</p>
<h2 id="Technique-Tips"><a href="#Technique-Tips" class="headerlink" title="Technique&#x2F;Tips"></a>Technique&#x2F;Tips</h2><p>#å·¥ç¨‹å¸ˆå·¥å…·Â é¼ é¡»ç®¡ï¼Œé›¾å‡‡æ‹¼éŸ³æ–¹æ¡ˆï¼Œ<a href="https://github.com/iDvel/rime-ice">https://github.com/iDvel/rime-ice</a>å¼€ç®±å³ç”¨çš„é¼ é¡»ç®¡æ–¹æ¡ˆï¼Œè®°å½•ä¸€ä¸‹ï¼Œç­‰ä¸‹å¿˜è®°äº†ã€‚</p>
<h2 id="Share"><a href="#Share" class="headerlink" title="Share"></a>Share</h2><p>ä¸è¦æŠŠèŒä¸šï¼ˆcareerï¼‰å½“æˆæŸä¸€ä»¶å…·ä½“çš„äº‹æƒ…ï¼Œè¿™æ˜¯äººç±»å‘æ˜çš„æœ€å±é™©ã€æœ€ä»¤äººçª’æ¯çš„æ¦‚å¿µä¹‹ä¸€ï¼Œä¹Ÿæ˜¯å¤§å¤šæ•°æ¢¦æƒ³å’Œç›´è§‰çš„æ•Œäººã€‚</p>
<p>èŒä¸šåº”è¯¥æ˜¯ä¸€ä¸ªæŠ½è±¡çš„æ¦‚å¿µï¼ŒæŒ‡çš„æ˜¯ä¸€ä¸ªäººåœ¨æ—¥å¸¸çš„å·¥ä½œå’Œç”Ÿæ´»ä¸­ï¼Œä¸æ–­æ¢ç´¢ã€åŸ¹è®­ã€å®è·µã€é€æ­¥è¿›æ­¥çš„è¿‡ç¨‹ã€‚</p>
]]></content>
      <categories>
        <category>arts</category>
      </categories>
      <tags>
        <tag>arts</tag>
        <tag>å·¥ç¨‹å¸ˆå·¥å…·</tag>
      </tags>
  </entry>
  <entry>
    <title>ARTS-2023-50</title>
    <url>/2023/12/11/arts/ARTS-2023-50/</url>
    <content><![CDATA[<blockquote>
<p>ARTS æ˜¯é™ˆæµ©ï¼ˆç½‘åå·¦è€³æœµè€—å­ï¼‰åœ¨æå®¢æ—¶é—´ä¸“æ é‡Œå‘èµ·çš„ä¸€ä¸ªæ´»åŠ¨ï¼Œç›®çš„æ˜¯é€šè¿‡åˆ†äº«çš„æ–¹å¼æ¥åšæŒå­¦ä¹ ã€‚ æ¯äººæ¯å‘¨å†™ä¸€ä¸ª ARTSï¼š<br>Algorithm æ˜¯ä¸€é“ç®—æ³•é¢˜<br>Review æ˜¯è¯»ä¸€ç¯‡è‹±æ–‡æ–‡ç« <br>Technique&#x2F;Tips æ˜¯åˆ†äº«ä¸€ä¸ªå°æŠ€æœ¯<br>Share æ˜¯åˆ†äº«ä¸€ä¸ªè§‚ç‚¹ã€‚</p>
</blockquote>
<span id="more"></span>

<h2 id="Algorithm"><a href="#Algorithm" class="headerlink" title="Algorithm"></a>Algorithm</h2><p><a href="https://leetcode.cn/problems/is-subsequence/?envType=study-plan-v2&envId=top-interview-150">392</a></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">isSubsequence</span><span class="params">(s <span class="type">string</span>, t <span class="type">string</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(s) == <span class="number">0</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(t) == <span class="number">0</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">	&#125;</span><br><span class="line">	sIndex := <span class="number">0</span></span><br><span class="line">	tIndex := <span class="number">0</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> sIndex &lt; <span class="built_in">len</span>(s) &amp;&amp; tIndex &lt; <span class="built_in">len</span>(t) &#123;</span><br><span class="line">		<span class="keyword">if</span> s[sIndex] == t[tIndex] &#123;</span><br><span class="line">			sIndex++</span><br><span class="line">		&#125;</span><br><span class="line">		tIndex++</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> sIndex == <span class="built_in">len</span>(s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Review"><a href="#Review" class="headerlink" title="Review"></a>Review</h2><p><a href="https://go.dev/blog/survey2023-h2-results">Go Developer Survey 2023 H2 Results </a><br>go ç¤¾åŒº2023å¹´å¼€å‘è€…æŠ¥å‘Šï¼Œæ„Ÿè§‰è·Ÿ2022å¹´æ¯”è¾ƒï¼Œæ²¡å•¥å˜åŒ–ï¼Œæœ€å¤§çš„æ˜¯ï¼Œå¤§å®¶å¼€å§‹æ‹¥æŠ±AIäº†ã€‚<br><a href="https://fs.blog/stop-reading-news/">Stop Reading News</a><br>å¤§å®¶éƒ½ä¸çœ‹æ–°é—»äº†ï¼Œéƒ½åœ¨çœ‹çŸ­è§†é¢‘ ğŸ˜„</p>
<h2 id="Technique-Tips"><a href="#Technique-Tips" class="headerlink" title="Technique&#x2F;Tips"></a>Technique&#x2F;Tips</h2><p> <a href="https://link.zhubai.love/api/link?url=https://www.insanelycooltools.com&post_id=2345899633101881344&subscriber_id=2096257190994108416&token=b3bf68a76d446e74c673027bae243b4e&timestamp=1702282461562&signature=7d5f5fa8340d2a5fe973f57ebbbb7e474835975b365d28ea4da032928d4e5ece">Insanely Cool Tools</a></p>
<p>è¿™ä¸ªç½‘ç«™æ”¶é›†äº†å„ç§çƒ­é—¨å·¥å…·å’ŒæœåŠ¡èµ„æºï¼Œåˆåˆ›ä¼ä¸šå¸¸ç”¨çš„ä¸€äº›å·¥å…·å’ŒæœåŠ¡ã€‚<br><a href="https://github.com/trimstray/the-book-of-secret-knowledge">the-book-of-secret-knowledge</a><br>è¦†ç›–å¾ˆå¹¿çš„ç½‘ç»œå®‰å…¨çŸ¥è¯†ï¼Œæ–¹æ–¹é¢é¢ã€‚</p>
<p><a href="https://github.com/microsoft/Mastering-GitHub-Copilot-for-Paired-Programming">https://github.com/microsoft/Mastering-GitHub-Copilot-for-Paired-Programming</a><br>å¾®è½¯å‡ºçš„ GitHub Copilot æ•™ç¨‹ï¼Œåªæœ‰ 6 å ‚è¯¾ï¼Œä¼šæ•™ä½ å¦‚ä½•æœ‰æ•ˆåˆ©ç”¨ GitHub Copilot ä»¥åŠä¸ AI ç»“å¯¹ç¼–ç¨‹ã€‚ è¯¾ç¨‹ä¸€å…± 10 å°æ—¶ï¼Œå¯ä»¥ä½“éªŒå¦‚ä½•é€šè¿‡ VSCode å’Œ GitHub Copilot Chat è¿›è¡Œå®æ—¶åä½œï¼Œå­¦ä¹ å¦‚ä½•ä½¿ç”¨ GitHub Copilot è‡ªåŠ¨è¡¥å…¨ä»£ç ï¼Œå¤„ç†é”™è¯¯å’Œå†™å•å…ƒæµ‹è¯•ï¼Œå°½å¯èƒ½æ•™ä¼šä½ ä½¿ç”¨ GitHub Copilot çš„æœ€ä½³å®è·µï¼Œè®©ä½ å¯ä»¥æå‡å†™ä»£ç çš„æ•ˆç‡å’Œè´¨é‡ã€‚</p>
<h2 id="Share"><a href="#Share" class="headerlink" title="Share"></a>Share</h2><p><a href="https://hexo.hxzhouh.com/2023/12/12/aws%20ec2%20%E5%88%87%E6%8D%A2%E5%88%B0ipv6/">aws ec2 åˆ‡æ¢åˆ°ipv6</a></p>
]]></content>
      <categories>
        <category>arts</category>
      </categories>
  </entry>
  <entry>
    <title>ARTS-2023-51</title>
    <url>/2023/12/18/arts/ARTS-2023-51/</url>
    <content><![CDATA[<blockquote>
<p>ARTS æ˜¯é™ˆæµ©ï¼ˆç½‘åå·¦è€³æœµè€—å­ï¼‰åœ¨æå®¢æ—¶é—´ä¸“æ é‡Œå‘èµ·çš„ä¸€ä¸ªæ´»åŠ¨ï¼Œç›®çš„æ˜¯é€šè¿‡åˆ†äº«çš„æ–¹å¼æ¥åšæŒå­¦ä¹ ã€‚ æ¯äººæ¯å‘¨å†™ä¸€ä¸ª ARTSï¼š<br>Algorithm æ˜¯ä¸€é“ç®—æ³•é¢˜<br>Review æ˜¯è¯»ä¸€ç¯‡è‹±æ–‡æ–‡ç« <br>Technique&#x2F;Tips æ˜¯åˆ†äº«ä¸€ä¸ªå°æŠ€æœ¯<br>Share æ˜¯åˆ†äº«ä¸€ä¸ªè§‚ç‚¹ã€‚</p>
</blockquote>
<span id="more"></span>

<p>æœ¬å‘¨çœŸæ˜¯æ‡’å‘€ã€‚ã€‚ã€‚ã€‚ã€‚ å•¥éƒ½æ²¡åšã€‚</p>
<h2 id="Algorithm"><a href="#Algorithm" class="headerlink" title="Algorithm"></a>Algorithm</h2><h2 id="Review"><a href="#Review" class="headerlink" title="Review"></a>Review</h2><p>æœ€è¿‘å‘ç°äº† <a href="https://dave.cheney.net/">Dave Cheney</a> å¤§ä½¬çš„åšå®¢ï¼Œè¡¥è¯¾ä¸­ã€‚<br><a href="https://dave.cheney.net/2021/01/05/a-few-bytes-here-a-few-there-pretty-soon-youre-talking-real-memory">https://dave.cheney.net/2021/01/05/a-few-bytes-here-a-few-there-pretty-soon-youre-talking-real-memory</a><br>æœ¬æ–‡è®²çš„è²Œä¼¼æ˜¯ go å†…å­˜åˆ†é…å¤§å°çš„é—®é¢˜ï¼Œä½†æ˜¯å¥½åƒæ²¡çœ‹å¤ªæ˜ç™½ã€‚ã€‚ã€‚ã€‚</p>
<h2 id="Technique-Tips"><a href="#Technique-Tips" class="headerlink" title="Technique&#x2F;Tips"></a>Technique&#x2F;Tips</h2><h2 id="Share"><a href="#Share" class="headerlink" title="Share"></a>Share</h2>]]></content>
      <categories>
        <category>arts</category>
      </categories>
  </entry>
  <entry>
    <title>ARTS-2023-52</title>
    <url>/2023/12/25/arts/ARTS-2023-52/</url>
    <content><![CDATA[<blockquote>
<p>ARTS æ˜¯é™ˆæµ©ï¼ˆç½‘åå·¦è€³æœµè€—å­ï¼‰åœ¨æå®¢æ—¶é—´ä¸“æ é‡Œå‘èµ·çš„ä¸€ä¸ªæ´»åŠ¨ï¼Œç›®çš„æ˜¯é€šè¿‡åˆ†äº«çš„æ–¹å¼æ¥åšæŒå­¦ä¹ ã€‚ æ¯äººæ¯å‘¨å†™ä¸€ä¸ª ARTSï¼š<br>Algorithm æ˜¯ä¸€é“ç®—æ³•é¢˜<br>Review æ˜¯è¯»ä¸€ç¯‡è‹±æ–‡æ–‡ç« <br>Technique&#x2F;Tips æ˜¯åˆ†äº«ä¸€ä¸ªå°æŠ€æœ¯<br>Share æ˜¯åˆ†äº«ä¸€ä¸ªè§‚ç‚¹ã€‚</p>
</blockquote>
<span id="more"></span>
<p>æœ€åä¸€å‘¨äº†ï¼Œ2024å¼€å§‹ã€‚ã€‚ã€‚</p>
<h2 id="Algorithm"><a href="#Algorithm" class="headerlink" title="Algorithm"></a>Algorithm</h2><p><a href="https://leetcode.cn/problems/happy-number/">202. å¿«ä¹æ•°</a></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">isHappy</span><span class="params">(n <span class="type">int</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">	m := <span class="keyword">map</span>[<span class="type">int</span>]<span class="type">bool</span>&#123;&#125;</span><br><span class="line">	<span class="keyword">for</span> ; n != <span class="number">1</span> &amp;&amp; !m[n]; n, m[n] = step(n), <span class="literal">true</span> &#123; &#125;</span><br><span class="line">	<span class="keyword">return</span> n == <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">step</span><span class="params">(n <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">	sum := <span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> n &gt; <span class="number">0</span> &#123;</span><br><span class="line">		sum += (n%<span class="number">10</span>) * (n%<span class="number">10</span>)</span><br><span class="line">		n = n/<span class="number">10</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> sum</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Review"><a href="#Review" class="headerlink" title="Review"></a>Review</h2><p><a href="https://go.dev/ref/mem">https://go.dev/ref/mem</a>   goå†…å­˜æ¨¡å‹ï¼Œç»ˆäºæŠŠè¿™ç¯‡åšå®¢çœ‹å®Œäº†ã€‚</p>
<h2 id="Technique-Tips"><a href="#Technique-Tips" class="headerlink" title="Technique&#x2F;Tips"></a>Technique&#x2F;Tips</h2><ul>
<li>#tools ripgrep + fzfï¼Œæœä»€ä¹ˆéƒ½å¿«ã€‚</li>
<li><a href="https://chromewebstore.google.com/detail/%E8%B1%86%E4%BC%B4%EF%BC%9A%E8%B1%86%E7%93%A3%E8%B4%A6%E5%8F%B7%E5%A4%87%E4%BB%BD%E5%B7%A5%E5%85%B7/ghppfgfeoafdcaebjoglabppkfmbcjdd?hl=zh-CN">è±†ä¼´ï¼šè±†ç“£è´¦å·å¤‡ä»½å·¥å…·</a> è±†ç“£é‡åº¦ç”¨æˆ·ï¼Œè¿™ä¸ªæµè§ˆå™¨æ‹“å±•å¯ä»¥å°†ä½ å†è±†ç“£çš„ä¿¡æ¯å…¨éƒ¨ä¿å­˜çš„åˆ°æœ¬åœ°ã€‚ ä¹Ÿå¯ä»¥å¯¼å…¥å¦å¤–çš„è´¦å·ï¼Œå¥½ç”¨ã€‚</li>
<li>devv.ai  é¢å‘ç¨‹åºå‘˜çš„AIGC æµè§ˆå™¨ï¼Œ</li>
</ul>
<h2 id="Share"><a href="#Share" class="headerlink" title="Share"></a>Share</h2>]]></content>
      <categories>
        <category>arts</category>
      </categories>
  </entry>
  <entry>
    <title>ARTS-2024-02</title>
    <url>/2024/01/09/arts/ARTS-2024-02/</url>
    <content><![CDATA[<blockquote>
<p>ARTS æ˜¯é™ˆæµ©ï¼ˆç½‘åå·¦è€³æœµè€—å­ï¼‰åœ¨æå®¢æ—¶é—´ä¸“æ é‡Œå‘èµ·çš„ä¸€ä¸ªæ´»åŠ¨ï¼Œç›®çš„æ˜¯é€šè¿‡åˆ†äº«çš„æ–¹å¼æ¥åšæŒå­¦ä¹ ã€‚ æ¯äººæ¯å‘¨å†™ä¸€ä¸ª ARTSï¼š<br>Algorithm æ˜¯ä¸€é“ç®—æ³•é¢˜<br>Review æ˜¯è¯»ä¸€ç¯‡è‹±æ–‡æ–‡ç« <br>Technique&#x2F;Tips æ˜¯åˆ†äº«ä¸€ä¸ªå°æŠ€æœ¯<br>Share æ˜¯åˆ†äº«ä¸€ä¸ªè§‚ç‚¹ã€‚</p>
</blockquote>
<span id="more"></span>

<h2 id="Algorithm"><a href="#Algorithm" class="headerlink" title="Algorithm"></a>Algorithm</h2><h2 id="Review"><a href="#Review" class="headerlink" title="Review"></a>Review</h2><p><a href="https://commandcenter.blogspot.com/2024/01/what-we-got-right-what-we-got-wrong.html">What We Got Right, What We Got Wrong</a><br>    # åšå¯¹çš„åœ°æ–¹ï¼š<br>    1.  ç»Ÿä¸€çš„è§„èŒƒï¼Œæ–¹ä¾¿åé¢çš„ä½¿ç”¨è€…ç†è§£ï¼Œä»¥åŠå®ç°ä¸åŒçš„ç¼–è¯‘å™¨ï¼ŒåŒæ—¶ï¼Œä¸ºäº†å…¼å®¹ä¸åŒçš„ç¼–è¯‘å™¨ï¼Œåè¿‡æ¥åˆå½±å“ è§„èŒƒçš„ç»Ÿä¸€ã€‚<br>    2. å¤šç§ç¼–è¯‘å™¨ï¼Œè·Ÿ1 æ˜¯ç»‘å®šå…³ç³»<br>    3. è·¨å¹³å°ï¼Œ<br>    4.  ä¿æŒå‘åå…¼å®¹<br>    5. å®Œå–„çš„æ–‡æ¡£åº“<br>    6. åŠŸèƒ½å¼ºå¤§ä¸”å¤šæ ·çš„å·¥å…·<br>    7. æ ¼å¼åŒ– fmtï¼ˆæœ€å–œæ¬¢çš„åŠŸèƒ½ï¼Œä¸éœ€è¦é ç¨‹åºå‘˜è‡ªå·±ç»´æŠ¤ç»Ÿä¸€çš„é£æ ¼ï¼‰<br>    # åšçš„ä¸å¤ªå¥½çš„åœ°æ–¹<br>    1. å¹¶å‘ï¼Œå¹¶å‘!&#x3D;å¹¶è¡Œï¼Œ<br>    golang çš„ goï¼ˆgoroutineï¼‰åŠŸèƒ½ï¼Œè®©å¹¶å‘ç¼–ç¨‹çœŸæ­£çš„èµ°è¿›äº†æ¯ä¸ªç¨‹åºå‘˜çš„æ—¥å¸¸ç”Ÿæ´»ï¼Œè®©goçœ‹èµ·æ¥åƒä¸€ä¸ªæ–°çš„è¯­è¨€ï¼Œå¾ˆä»¤äººå…´å¥‹ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬ä¼šå†ç¨‹åºé‡Œé¢å†™ä¸€å † go func(){} ï¼Œä½†æ˜¯å´æ²¡å–åˆ°æƒ³è¦çš„ç»“æœï¼Œç”šè‡³å¯èƒ½ä»£ç æ›´æ…¢äº†ï¼Œè¿™å¾ˆæ‰“å‡»ç§¯ææ€§ï¼Œå…¶ä¸­çœŸæ­£çš„åŸå› æ˜¯ å¹¶å‘ï¼&#x3D;å¹¶è¡Œã€‚<br>    2. interface<br>     ä¸»è¦æ˜¯ç¤¾åŒºè§‰å¾—æ²¡æ³›å‹ï¼Œå…¶å®æ¥å£å¾ˆå¥½ç”¨çš„ã€‚<br>    3. ç¼–è¯‘å™¨<br>    4. é¡¹ç›®ç®¡ç† ç¤¾åŒºè¿è¥æ€»æ˜¯å¾ˆéš¾çš„<br>    5. åŒ…ç®¡ç† æ·±æ¶ç—›ç»</p>
<h2 id="Technique-Tips"><a href="#Technique-Tips" class="headerlink" title="Technique&#x2F;Tips"></a>Technique&#x2F;Tips</h2><p>#å·¥ç¨‹å¸ˆå·¥å…· <a href="https://github.com/princjef/gomarkdoc">gomarkdoc</a> å†å¼€å‘ä»£ç çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦ç»´æŠ¤ä¸€ä»½ä»£ç ä»¥åŠä¸€ä»½æ–‡æ¡£ï¼Œé€šå¸¸è¿™ä¸¤ä¸ªéƒ¨åˆ†æ˜¯åˆ†å¼€çš„ï¼Œgomarkdoc å¯ä»¥å¸®æˆ‘ä»¬ä»çš„æ³¨é‡Šä¸­ç”Ÿæˆæ¥å£æ–‡æ¡£ï¼Œæ–¹ä¾¿æˆ‘ä»¬æˆ‘ä»¬å†™æ–‡æ¡£ä»¥åŠç»´æŠ¤ã€‚</p>
<h2 id="Share"><a href="#Share" class="headerlink" title="Share"></a>Share</h2>]]></content>
      <categories>
        <category>arts</category>
      </categories>
  </entry>
  <entry>
    <title>ARTS-2024-01</title>
    <url>/2024/01/02/arts/ARTS-2024-01/</url>
    <content><![CDATA[<blockquote>
<p>ARTS æ˜¯é™ˆæµ©ï¼ˆç½‘åå·¦è€³æœµè€—å­ï¼‰åœ¨æå®¢æ—¶é—´ä¸“æ é‡Œå‘èµ·çš„ä¸€ä¸ªæ´»åŠ¨ï¼Œç›®çš„æ˜¯é€šè¿‡åˆ†äº«çš„æ–¹å¼æ¥åšæŒå­¦ä¹ ã€‚ æ¯äººæ¯å‘¨å†™ä¸€ä¸ª ARTSï¼š<br>Algorithm æ˜¯ä¸€é“ç®—æ³•é¢˜<br>Review æ˜¯è¯»ä¸€ç¯‡è‹±æ–‡æ–‡ç« <br>Technique&#x2F;Tips æ˜¯åˆ†äº«ä¸€ä¸ªå°æŠ€æœ¯<br>Share æ˜¯åˆ†äº«ä¸€ä¸ªè§‚ç‚¹ã€‚</p>
</blockquote>
<span id="more"></span>
<p>2024 ç¬¬ä¸€æ¬¡arts åŠ æ²¹</p>
<h2 id="Algorithm"><a href="#Algorithm" class="headerlink" title="Algorithm"></a>Algorithm</h2><p><a href="https://leetcode.cn/problems/contains-duplicate-ii/">219. å­˜åœ¨é‡å¤å…ƒç´  II</a> ğŸŸ¢<br><a href="https://leetcode.cn/problems/longest-consecutive-sequence/">128. æœ€é•¿è¿ç»­åºåˆ—</a> ğŸŸ¡ å°†æ•°ç»„å‡åºæ’åˆ—ï¼Œæˆ–è€…æ”¾åœ¨ä¸€ä¸ªmapé‡Œé¢ï¼Œç„¶ååœ¨å»è·å–é•¿åº¦ã€‚ã€‚</p>
<h2 id="Review"><a href="#Review" class="headerlink" title="Review"></a>Review</h2><p><a href="https://roytanck.com/2023/12/23/in-2024-please-switch-to-firefox/">In 2024, please switch to Firefox</a><br>firefox å¥½ç”¨ï¼ŒåšæŒéšç§ä¿æŠ¤æ›´åŠ æ˜¯ä¸ºäº†ç»´æŠ¤ web çš„å¼€æ”¾æ ‡å‡†<br>psï¼šæœ‰å‡ ä¸ªäººä¼šå»ä¸»åŠ¨é€‰æ‹©æµè§ˆå™¨å‘¢ï¼Ÿ</p>
<h2 id="Technique-Tips"><a href="#Technique-Tips" class="headerlink" title="Technique&#x2F;Tips"></a>Technique&#x2F;Tips</h2><h2 id="Share"><a href="#Share" class="headerlink" title="Share"></a>Share</h2><blockquote>
<p>ä¸€ä¸ªä¸æˆç†Ÿçš„ç†æƒ³ä¸»ä¹‰è€…ä¼šä¸ºç†æƒ³æ‚²å£®åœ°æ­»å»ï¼Œè€Œä¸€ä¸ªæˆç†Ÿçš„ç†æƒ³ä¸»ä¹‰è€…åˆ™æ„¿æ„ä¸ºäº†ç†æƒ³è‹Ÿä¸”å·ç”Ÿã€‚  ã€Šéº¦ç”°é‡Œçš„å®ˆæœ›è€…ã€‹</p>
</blockquote>
]]></content>
      <categories>
        <category>arts</category>
      </categories>
  </entry>
</search>
